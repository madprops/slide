(function(){"use strict";typeof globalThis.process>"u"&&(globalThis.process={env:{}}),typeof globalThis.process.env>"u"&&(globalThis.process.env={}),typeof globalThis.process.env.NODE_ENV>"u"&&(globalThis.process.env.NODE_ENV="production"),typeof BigInt>"u"&&(BigInt=function(t){if(isNaN(t))throw new Error("");return t});const B=BigInt(0),E=BigInt(1),ln=BigInt(2),as=BigInt(5),vt=BigInt(10),Xh=2e3,M={s:E,n:B,d:E};function ie(t,e){try{t=BigInt(t)}catch{throw ye()}return t*e}function Ot(t){return typeof t=="bigint"?t:Math.floor(t)}function lt(t,e){if(e===B)throw ls();const n=Object.create(ct.prototype);n.s=t<B?-E:E,t=t<B?-t:t;const s=We(t,e);return n.n=t/s,n.d=e/s,n}function Te(t){const e={};let n=t,s=ln,o=as-E;for(;o<=n;){for(;n%s===B;)n/=s,e[s]=(e[s]||B)+E;o+=E+ln*s++}return n!==t?n>1&&(e[n]=(e[n]||B)+E):e[t]=(e[t]||B)+E,e}const wt=function(t,e){let n=B,s=E,o=E;if(t!=null)if(e!==void 0){if(typeof t=="bigint")n=t;else{if(isNaN(t))throw ye();if(t%1!==0)throw Ro();n=BigInt(t)}if(typeof e=="bigint")s=e;else{if(isNaN(e))throw ye();if(e%1!==0)throw Ro();s=BigInt(e)}o=n*s}else if(typeof t=="object"){if("d"in t&&"n"in t)n=BigInt(t.n),s=BigInt(t.d),"s"in t&&(n*=BigInt(t.s));else if(0 in t)n=BigInt(t[0]),1 in t&&(s=BigInt(t[1]));else if(typeof t=="bigint")n=t;else throw ye();o=n*s}else if(typeof t=="number"){if(isNaN(t))throw ye();if(t<0&&(o=-E,t=-t),t%1===0)n=BigInt(t);else if(t>0){let c=1,i=0,u=1,a=1,l=1,p=1e7;for(t>=1&&(c=10**Math.floor(1+Math.log10(t)),t/=c);u<=p&&l<=p;){let f=(i+a)/(u+l);if(t===f){u+l<=p?(n=i+a,s=u+l):l>u?(n=a,s=l):(n=i,s=u);break}else t>f?(i+=a,u+=l):(a+=i,l+=u),u>p?(n=a,s=l):(n=i,s=u)}n=BigInt(n)*BigInt(c),s=BigInt(s)}}else if(typeof t=="string"){let c=0,i=B,u=B,a=B,l=E,p=E,f=t.replace(/_/g,"").match(/\d+|./g);if(f===null)throw ye();if(f[c]==="-"?(o=-E,c++):f[c]==="+"&&c++,f.length===c+1?u=ie(f[c++],o):f[c+1]==="."||f[c]==="."?(f[c]!=="."&&(i=ie(f[c++],o)),c++,(c+1===f.length||f[c+1]==="("&&f[c+3]===")"||f[c+1]==="'"&&f[c+3]==="'")&&(u=ie(f[c],o),l=vt**BigInt(f[c].length),c++),(f[c]==="("&&f[c+2]===")"||f[c]==="'"&&f[c+2]==="'")&&(a=ie(f[c+1],o),p=vt**BigInt(f[c+1].length)-E,c+=3)):f[c+1]==="/"||f[c+1]===":"?(u=ie(f[c],o),l=ie(f[c+2],E),c+=3):f[c+3]==="/"&&f[c+1]===" "&&(i=ie(f[c],o),u=ie(f[c+2],o),l=ie(f[c+4],E),c+=5),f.length<=c)s=l*p,o=n=a+s*i+p*u;else throw ye()}else if(typeof t=="bigint")n=t,o=t,s=E;else throw ye();if(s===B)throw ls();M.s=o<B?-E:E,M.n=n<B?-n:n,M.d=s<B?-s:s};function Gh(t,e,n){let s=E;for(;e>B;t=t*t%n,e>>=E)e&E&&(s=s*t%n);return s}function Zh(t,e){for(;e%ln===B;e/=ln);for(;e%as===B;e/=as);if(e===E)return B;let n=vt%e,s=1;for(;n!==E;s++)if(n=n*vt%e,s>Xh)return B;return BigInt(s)}function wh(t,e,n){let s=E,o=Gh(vt,n,e);for(let c=0;c<300;c++){if(s===o)return BigInt(c);s=s*vt%e,o=o*vt%e}return 0}function We(t,e){if(!t)return e;if(!e)return t;for(;;){if(t%=e,!t)return e;if(e%=t,!e)return t}}function ct(t,e){if(wt(t,e),this instanceof ct)t=We(M.d,M.n),this.s=M.s,this.n=M.n/t,this.d=M.d/t;else return lt(M.s*M.n,M.d)}var ls=function(){return new Error("Division by Zero")},ye=function(){return new Error("Invalid argument")},Ro=function(){return new Error("Parameters must be integer")};ct.prototype={s:E,n:B,d:E,abs:function(){return lt(this.n,this.d)},neg:function(){return lt(-this.s*this.n,this.d)},add:function(t,e){return wt(t,e),lt(this.s*this.n*M.d+M.s*this.d*M.n,this.d*M.d)},sub:function(t,e){return wt(t,e),lt(this.s*this.n*M.d-M.s*this.d*M.n,this.d*M.d)},mul:function(t,e){return wt(t,e),lt(this.s*M.s*this.n*M.n,this.d*M.d)},div:function(t,e){return wt(t,e),lt(this.s*M.s*this.n*M.d,this.d*M.n)},clone:function(){return lt(this.s*this.n,this.d)},mod:function(t,e){if(t===void 0)return lt(this.s*this.n%this.d,E);if(wt(t,e),B===M.n*this.d)throw ls();return lt(this.s*(M.d*this.n)%(M.n*this.d),M.d*this.d)},gcd:function(t,e){return wt(t,e),lt(We(M.n,this.n)*We(M.d,this.d),M.d*this.d)},lcm:function(t,e){return wt(t,e),M.n===B&&this.n===B?lt(B,E):lt(M.n*this.n,We(M.n,this.n)*We(M.d,this.d))},inverse:function(){return lt(this.s*this.d,this.n)},pow:function(t,e){if(wt(t,e),M.d===E)return M.s<B?lt((this.s*this.d)**M.n,this.n**M.n):lt((this.s*this.n)**M.n,this.d**M.n);if(this.s<B)return null;let n=Te(this.n),s=Te(this.d),o=E,c=E;for(let i in n)if(i!=="1"){if(i==="0"){o=B;break}if(n[i]*=M.n,n[i]%M.d===B)n[i]/=M.d;else return null;o*=BigInt(i)**n[i]}for(let i in s)if(i!=="1"){if(s[i]*=M.n,s[i]%M.d===B)s[i]/=M.d;else return null;c*=BigInt(i)**s[i]}return M.s<B?lt(c,o):lt(o,c)},log:function(t,e){if(wt(t,e),this.s<=B||M.s<=B)return null;const n={},s=Te(M.n),o=Te(M.d),c=Te(this.n),i=Te(this.d);for(const l in o)s[l]=(s[l]||B)-o[l];for(const l in i)c[l]=(c[l]||B)-i[l];for(const l in s)l!=="1"&&(n[l]=!0);for(const l in c)l!=="1"&&(n[l]=!0);let u=null,a=null;for(const l in n){const p=s[l]||B,f=c[l]||B;if(p===B){if(f!==B)return null;continue}let b=f,g=p;const X=We(b,g);if(b/=X,g/=X,u===null&&a===null)u=b,a=g;else if(b*a!==u*g)return null}return u!==null&&a!==null?lt(u,a):null},equals:function(t,e){return wt(t,e),this.s*this.n*M.d===M.s*M.n*this.d},lt:function(t,e){return wt(t,e),this.s*this.n*M.d<M.s*M.n*this.d},lte:function(t,e){return wt(t,e),this.s*this.n*M.d<=M.s*M.n*this.d},gt:function(t,e){return wt(t,e),this.s*this.n*M.d>M.s*M.n*this.d},gte:function(t,e){return wt(t,e),this.s*this.n*M.d>=M.s*M.n*this.d},compare:function(t,e){wt(t,e);let n=this.s*this.n*M.d-M.s*M.n*this.d;return(B<n)-(n<B)},ceil:function(t){return t=vt**BigInt(t||0),lt(Ot(this.s*t*this.n/this.d)+(t*this.n%this.d>B&&this.s>=B?E:B),t)},floor:function(t){return t=vt**BigInt(t||0),lt(Ot(this.s*t*this.n/this.d)-(t*this.n%this.d>B&&this.s<B?E:B),t)},round:function(t){return t=vt**BigInt(t||0),lt(Ot(this.s*t*this.n/this.d)+this.s*((this.s>=B?E:B)+ln*(t*this.n%this.d)>this.d?E:B),t)},roundTo:function(t,e){wt(t,e);const n=this.n*M.d,s=this.d*M.n,o=n%s;let c=Ot(n/s);return o+o>=s&&c++,lt(this.s*c*M.n,M.d)},divisible:function(t,e){return wt(t,e),!(!(M.n*this.d)||this.n*M.d%(M.n*this.d))},valueOf:function(){return Number(this.s*this.n)/Number(this.d)},toString:function(t){let e=this.n,n=this.d;t=t||15;let s=Zh(e,n),o=wh(e,n,s),c=this.s<B?"-":"";if(c+=Ot(e/n),e%=n,e*=vt,e&&(c+="."),s){for(let i=o;i--;)c+=Ot(e/n),e%=n,e*=vt;c+="(";for(let i=s;i--;)c+=Ot(e/n),e%=n,e*=vt;c+=")"}else for(let i=t;e&&i--;)c+=Ot(e/n),e%=n,e*=vt;return c},toFraction:function(t){let e=this.n,n=this.d,s=this.s<B?"-":"";if(n===E)s+=e;else{let o=Ot(e/n);t&&o>B&&(s+=o,s+=" ",e%=n),s+=e,s+="/",s+=n}return s},toLatex:function(t){let e=this.n,n=this.d,s=this.s<B?"-":"";if(n===E)s+=e;else{let o=Ot(e/n);t&&o>B&&(s+=o,e%=n),s+="\\frac{",s+=e,s+="}{",s+=n,s+="}"}return s},toContinued:function(){let t=this.n,e=this.d,n=[];do{n.push(Ot(t/e));let s=t%e;t=e,e=s}while(t!==E);return n},simplify:function(t){const e=BigInt(1/(t||.001)|0),n=this.abs(),s=n.toContinued();for(let o=1;o<s.length;o++){let c=lt(s[o-1],E);for(let u=o-2;u>=0;u--)c=c.inverse().add(s[u]);let i=c.sub(n);if(i.n*e<i.d)return c.mul(this.s)}return this}};const ds="strudel.log";let Wh=1e3,xo,vo;function Sn(t,e="cyclist"){process.env.NODE_ENV==="development"&&console.error(t),Yt(`[${e}] error: ${t.message}`)}function Yt(t,e,n={}){let s=performance.now();xo===t&&s-vo<Wh||(xo=t,vo=s,console.log(`%c${t}`,"background-color: black;color:white;border-radius:15px"),typeof document<"u"&&typeof CustomEvent<"u"&&document.dispatchEvent(new CustomEvent(ds,{detail:{message:t,type:e,data:n}})))}Yt.key=ds;const Fh=t=>/^[a-gA-G][#bsf]*[0-9]*$/.test(t),Bn=t=>/^[a-gA-G][#bsf]*-?[0-9]*$/.test(t),Yo=t=>{if(typeof t!="string")return[];const[e,n="",s]=t.match(/^([a-gA-G])([#bsf]*)(-?[0-9]*)$/)?.slice(1)||[];return e?[e,n,s?Number(s):void 0]:[]},Vh={c:0,d:2,e:4,f:5,g:7,a:9,b:11},Ch={"#":1,b:-1,s:1,f:-1},So=t=>t?.split("").reduce((e,n)=>e+Ch[n],0)||0,Ae=(t,e=3)=>{const[n,s,o=e]=Yo(t);if(!n)throw new Error('not a note: "'+t+'"');const c=Vh[n.toLowerCase()],i=So(s);return(Number(o)+1)*12+c+i},Fe=t=>Math.pow(2,(t-69)/12)*440,ps=t=>12*Math.log(t/440)/Math.LN2+69,Lh=(t,e)=>{if(typeof t!="object")throw new Error("valueToMidi: expected object value");let{freq:n,note:s}=t;if(typeof n=="number")return ps(n);if(typeof s=="string")return Ae(s);if(typeof s=="number")return s;if(!e)throw new Error("valueToMidi: expected freq or note to be set");return e},zh=(t,e)=>(t-e)*1e3,Bo=t=>Fe(typeof t=="number"?t:Ae(t)),Mh=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],Rh=t=>{const e=Math.floor(t/12)-1;return Mh[t%12]+e},dn=(t,e)=>(t%e+e)%e,ko=t=>t.reduce((e,n)=>e+n)/t.length;function To(t,e=0){return isNaN(Number(t))?(Yt(`"${t}" is not a number, falling back to ${e}`,"warning"),e):t}const xh=(t,e)=>dn(Math.round(To(t??0,0)),e),vh=t=>{let{value:e,context:n}=t,s=e;if(typeof s=="object"&&!Array.isArray(s)&&(s=s.note||s.n||s.value,s===void 0))throw new Error(`cannot find a playable note for ${JSON.stringify(e)}`);if(typeof s=="number"&&n.type!=="frequency")s=Fe(t.value);else if(typeof s=="number"&&n.type==="frequency")s=t.value;else if(typeof s!="string"||!Bn(s))throw new Error("not a note: "+JSON.stringify(s));return s},Ao=t=>{let{value:e,context:n}=t;if(typeof e=="object")return e.freq?e.freq:Bo(e.note||e.n||e.value);if(typeof e=="number"&&n.type!=="frequency")e=Fe(t.value);else if(typeof e=="string"&&Bn(e))e=Fe(Ae(t.value));else if(typeof e!="number")throw new Error("not a note or frequency: "+e);return e},No=(t,e)=>t.slice(e).concat(t.slice(0,e)),Ko=(...t)=>t.reduce((e,n)=>(...s)=>e(n(...s)),e=>e),Yh=(...t)=>Ko(...t.reverse()),Ne=t=>t.filter(e=>e!=null),ue=t=>[].concat(...t),Ke=t=>t,Sh=(t,e)=>t,pn=(t,e)=>Array.from({length:e-t+1},(n,s)=>s+t);function D(t,e,n=t.length){const s=function o(...c){if(c.length>=n)return t.apply(this,c);{const i=function(...u){return o.apply(this,c.concat(u))};return e&&e(i,c),i}};return e&&e(s,[]),s}function hs(t){const e=Number(t);if(!isNaN(e))return e;if(Bn(t))return Ae(t);throw new Error(`cannot parse as numeral: "${t}"`)}function fs(t,e){return(...n)=>t(...n.map(e))}function Tt(t){return fs(t,hs)}function Ho(t){const e=Number(t);if(!isNaN(e))return e;const n={pi:Math.PI,w:1,h:.5,q:.25,e:.125,s:.0625,t:1/3,f:.2,x:1/6}[t];if(typeof n<"u")return n;throw new Error(`cannot parse as fractional: "${t}"`)}const Bh=t=>fs(t,Ho),ms=function(t,e){return[e.slice(0,t),e.slice(t)]},kn=(t,e,n)=>e.map((s,o)=>t(s,n[o])),Po=function(t){const e=[];for(let n=0;n<t.length-1;++n)e.push([t[n],t[n+1]]);return e},Tn=(t,e,n)=>Math.min(Math.max(t,e),n),kh=["Do","Reb","Re","Mib","Mi","Fa","Solb","Sol","Lab","La","Sib","Si"],Th=["Sa","Re","Ga","Ma","Pa","Dha","Ni"],Ah=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Hb","H"],Nh=["Ni","Pab","Pa","Voub","Vou","Ga","Dib","Di","Keb","Ke","Zob","Zo"],Kh=["I","Ro","Ha","Ni","Ho","He","To"],Hh=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],Ph=(t,e="letters")=>{const s=(e==="solfeggio"?kh:e==="indian"?Th:e==="german"?Ah:e==="byzantine"?Nh:e==="japanese"?Kh:Hh)[t%12],o=Math.floor(t/12)-1;return s+o};function Eh(t){var e={};return t.filter(function(n){return e.hasOwn(n)?!1:e[n]=!0})}function Dh(t){return t.sort().filter(function(e,n,s){return!n||e!=s[n-1]})}function Eo(t){return t.sort((e,n)=>e.compare(n)).filter(function(e,n,s){return!n||e.ne(s[n-1])})}function Do(t){const e=new TextEncoder().encode(t);return btoa(String.fromCharCode(...e))}function Jo(t){const e=new Uint8Array(atob(t).split("").map(s=>s.charCodeAt(0)));return new TextDecoder().decode(e)}function Jh(t){return encodeURIComponent(Do(t))}function Ih(t){return Jo(decodeURIComponent(t))}function Io(t,e){return Array.isArray(t)?t.map(e):Object.fromEntries(Object.entries(t).map(([n,s],o)=>[n,e(s,n,o)]))}function ys(t,e){return t/e}class jo{constructor({getTargetClockTime:e=Oh,weight:n=16,offsetDelta:s=.005,checkAfterTime:o=2,resetAfterTime:c=8}){this.offsetTime,this.timeAtPrevOffsetSample,this.prevOffsetTimes=[],this.getTargetClockTime=e,this.weight=n,this.offsetDelta=s,this.checkAfterTime=o,this.resetAfterTime=c,this.reset=()=>{this.prevOffsetTimes=[],this.offsetTime=null,this.timeAtPrevOffsetSample=null}}calculateOffset(e){const n=this.getTargetClockTime(),s=n-this.timeAtPrevOffsetSample,o=n-e;if(s>this.resetAfterTime&&this.reset(),this.offsetTime==null&&(this.offsetTime=o),this.prevOffsetTimes.push(o),this.prevOffsetTimes.length>this.weight&&this.prevOffsetTimes.shift(),this.timeAtPrevOffsetSample==null||s>this.checkAfterTime){this.timeAtPrevOffsetSample=n;const c=ko(this.prevOffsetTimes);Math.abs(c-this.offsetTime)>this.offsetDelta&&(this.offsetTime=c)}return this.offsetTime}calculateTimestamp(e,n){return this.calculateOffset(e)+n}}function jh(){return performance.now()*.001}function Oh(){return Date.now()*.001}const Oo=new Map([["control","Control"],["ctrl","Control"],["alt","Alt"],["shift","Shift"],["down","ArrowDown"],["up","ArrowUp"],["left","ArrowLeft"],["right","ArrowRight"]]);let hn;function Uo(){if(hn==null){if(typeof window>"u")return;hn={},window.addEventListener("keydown",t=>{hn[t.key]=!0}),window.addEventListener("keyup",t=>{hn[t.key]=!1})}return{...hn}}function bs(t,e=!1){return typeof t=="object"?e?JSON.stringify(t).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(t):t}ct.prototype.sam=function(){return this.floor()},ct.prototype.nextSam=function(){return this.sam().add(1)},ct.prototype.wholeCycle=function(){return new yt(this.sam(),this.nextSam())},ct.prototype.cyclePos=function(){return this.sub(this.sam())},ct.prototype.lt=function(t){return this.compare(t)<0},ct.prototype.gt=function(t){return this.compare(t)>0},ct.prototype.lte=function(t){return this.compare(t)<=0},ct.prototype.gte=function(t){return this.compare(t)>=0},ct.prototype.eq=function(t){return this.compare(t)==0},ct.prototype.ne=function(t){return this.compare(t)!=0},ct.prototype.max=function(t){return this.gt(t)?this:t},ct.prototype.maximum=function(...t){return t=t.map(e=>new ct(e)),t.reduce((e,n)=>n.max(e),this)},ct.prototype.min=function(t){return this.lt(t)?this:t},ct.prototype.mulmaybe=function(t){return t!==void 0?this.mul(t):void 0},ct.prototype.divmaybe=function(t){return t!==void 0?this.div(t):void 0},ct.prototype.addmaybe=function(t){return t!==void 0?this.add(t):void 0},ct.prototype.submaybe=function(t){return t!==void 0?this.sub(t):void 0},ct.prototype.show=function(){return this.s*this.n+"/"+this.d},ct.prototype.or=function(t){return this.eq(0)?t:this};const gs=t=>ct(t),Uh=(...t)=>{if(t=Ne(t),t.length!==0)return t.reduce((e,n)=>e.gcd(n),gs(1))},Ut=(...t)=>{if(t=Ne(t),t.length===0)return;const e=t.pop();return t.reduce((n,s)=>n===void 0||s===void 0?void 0:n.lcm(s),e)},_h=t=>t instanceof ct;gs._original=ct;const C=gs;class yt{constructor(e,n){this.begin=C(e),this.end=C(n)}get spanCycles(){const e=[];var n=this.begin;const s=this.end,o=s.sam();if(n.equals(s))return[new yt(n,s)];for(;s.gt(n);){if(n.sam().equals(o)){e.push(new yt(n,this.end));break}const c=n.nextSam();e.push(new yt(n,c)),n=c}return e}get duration(){return this.end.sub(this.begin)}cycleArc(){const e=this.begin.cyclePos(),n=e.add(this.duration);return new yt(e,n)}withTime(e){return new yt(e(this.begin),e(this.end))}withEnd(e){return new yt(this.begin,e(this.end))}withCycle(e){const n=this.begin.sam(),s=n.add(e(this.begin.sub(n))),o=n.add(e(this.end.sub(n)));return new yt(s,o)}intersection(e){const n=this.begin.max(e.begin),s=this.end.min(e.end);if(!n.gt(s)&&!(n.equals(s)&&(n.equals(this.end)&&this.begin.lt(this.end)||n.equals(e.end)&&e.begin.lt(e.end))))return new yt(n,s)}intersection_e(e){const n=this.intersection(e);if(n==null)throw"TimeSpans do not intersect";return n}midpoint(){return this.begin.add(this.duration.div(C(2)))}equals(e){return this.begin.equals(e.begin)&&this.end.equals(e.end)}show(){return this.begin.show()+" → "+this.end.show()}}class bt{constructor(e,n,s,o={},c=!1){this.whole=e,this.part=n,this.value=s,this.context=o,this.stateful=c,c&&console.assert(typeof this.value=="function","Stateful values must be functions")}get duration(){let e;return typeof this.value?.duration=="number"?e=C(this.value.duration):e=this.whole.end.sub(this.whole.begin),typeof this.value?.clip=="number"?e.mul(this.value.clip):e}get endClipped(){return this.whole.begin.add(this.duration)}isActive(e){return this.whole.begin<=e&&this.endClipped>=e}isInPast(e){return e>this.endClipped}isInNearPast(e,n){return n-e<=this.endClipped}isInFuture(e){return e<this.whole.begin}isInNearFuture(e,n){return n<this.whole.begin&&n>this.whole.begin-e}isWithinTime(e,n){return this.whole.begin<=n&&this.endClipped>=e}wholeOrPart(){return this.whole?this.whole:this.part}withSpan(e){const n=this.whole?e(this.whole):void 0;return new bt(n,e(this.part),this.value,this.context)}withValue(e){return new bt(this.whole,this.part,e(this.value),this.context)}hasOnset(){return this.whole!=null&&this.whole.begin.equals(this.part.begin)}hasTag(e){return this.context.tags?.includes(e)}resolveState(e){if(this.stateful&&this.hasOnset()){console.log("stateful");const n=this.value,[s,o]=n(e);return[s,new bt(this.whole,this.part,o,this.context,!1)]}return[e,this]}spanEquals(e){return this.whole==null&&e.whole==null||this.whole.equals(e.whole)}equals(e){return this.spanEquals(e)&&this.part.equals(e.part)&&this.value===e.value}show(e=!1){const n=typeof this.value=="object"?e?JSON.stringify(this.value).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(this.value):this.value;var s="";if(this.whole==null)s="~"+this.part.show;else{var o=this.whole.begin.equals(this.part.begin)&&this.whole.end.equals(this.part.end);this.whole.begin.equals(this.part.begin)||(s=this.whole.begin.show()+" ⇜ "),o||(s+="("),s+=this.part.show(),o||(s+=")"),this.whole.end.equals(this.part.end)||(s+=" ⇝ "+this.whole.end.show())}return"[ "+s+" | "+n+" ]"}showWhole(e=!1){return`${this.whole==null?"~":this.whole.show()}: ${bs(this.value,e)}`}combineContext(e){const n=this;return{...n.context,...e.context,locations:(n.context.locations||[]).concat(e.context.locations||[])}}setContext(e){return new bt(this.whole,this.part,this.value,e)}ensureObjectValue(){if(typeof this.value!="object")throw new Error(`expected hap.value to be an object, but got "${this.value}". Hint: append .note() or .s() to the end`,"error")}}class He{constructor(e,n={}){this.span=e,this.controls=n}setSpan(e){return new He(e,this.controls)}withSpan(e){return this.setSpan(e(this.span))}setControls(e){return new He(this.span,{...this.controls,...e})}}function Qh(t,e,n){if(e?.value!==void 0&&Object.keys(e).length===1)return Yt("[warn]: Can't do arithmetic on control pattern."),t;const s=Object.keys(t).filter(o=>Object.keys(e).includes(o));return Object.assign({},t,e,Object.fromEntries(s.map(o=>[o,n(t[o],e[o])])))}D((t,e)=>t*e),D((t,e)=>e.map(t));function _o(t,e=60){let n=0,s=C(0),o=[""],c="";for(;o[0].length<e;){const i=t.queryArc(n,n+1),u=i.filter(p=>p.hasOnset()).map(p=>p.duration),a=Uh(...u),l=a.inverse();o=o.map(p=>p+"|"),c+="|";for(let p=0;p<l;p++){const[f,b]=[s,s.add(a)],g=i.filter(Z=>Z.whole.begin.lte(f)&&Z.whole.end.gte(b)),X=g.length-o.length;X>0&&(o=o.concat(Array(X).fill(c))),o=o.map((Z,W)=>{const F=g[W];if(F){const v=F.whole.begin.eq(f)?""+F.value:"-";return Z+v}return Z+"."}),c+=".",s=s.add(a)}n++}return o.join(`
`)}let Xs,At=!0;const qh=function(t){At=!!t},Qo=t=>Xs=t;let L=class Ft{constructor(e,n=void 0){this.query=e,this._Pattern=!0,this._steps=n}get _steps(){return this.__steps}set _steps(e){this.__steps=e===void 0?void 0:C(e)}setSteps(e){return this._steps=e,this}withSteps(e){return At?new Ft(this.query,this._steps===void 0?void 0:e(this._steps)):this}get hasSteps(){return this._steps!==void 0}withValue(e){const n=new Ft(s=>this.query(s).map(o=>o.withValue(e)));return n._steps=this._steps,n}withState(e){return new Ft(n=>this.query(e(n)))}fmap(e){return this.withValue(e)}appWhole(e,n){const s=this,o=function(c){const i=s.query(c),u=n.query(c),a=function(l,p){const f=l.part.intersection(p.part);if(f!=null)return new bt(e(l.whole,p.whole),f,l.value(p.value),p.combineContext(l))};return ue(i.map(l=>Ne(u.map(p=>a(l,p)))))};return new Ft(o)}appBoth(e){const n=this,s=function(c,i){if(!(c==null||i==null))return c.intersection_e(i)},o=n.appWhole(s,e);return At&&(o._steps=Ut(e._steps,n._steps)),o}appLeft(e){const n=this,s=function(c){const i=[];for(const u of n.query(c)){const a=e.query(c.setSpan(u.wholeOrPart()));for(const l of a){const p=u.whole,f=u.part.intersection(l.part);if(f){const b=u.value(l.value),g=l.combineContext(u),X=new bt(p,f,b,g);i.push(X)}}}return i},o=new Ft(s);return o._steps=this._steps,o}appRight(e){const n=this,s=function(c){const i=[];for(const u of e.query(c)){const a=n.query(c.setSpan(u.wholeOrPart()));for(const l of a){const p=u.whole,f=l.part.intersection(u.part);if(f){const b=l.value(u.value),g=u.combineContext(l),X=new bt(p,f,b,g);i.push(X)}}}return i},o=new Ft(s);return o._steps=e._steps,o}bindWhole(e,n){const s=this,o=function(c){const i=function(a,l){return new bt(e(a.whole,l.whole),l.part,l.value,Object.assign({},a.context,l.context,{locations:(a.context.locations||[]).concat(l.context.locations||[])}))},u=function(a){return n(a.value).query(c.setSpan(a.part)).map(l=>i(a,l))};return ue(s.query(c).map(a=>u(a)))};return new Ft(o)}bind(e){const n=function(s,o){if(!(s==null||o==null))return s.intersection_e(o)};return this.bindWhole(n,e)}join(){return this.bind(Ke)}outerBind(e){return this.bindWhole(n=>n,e).setSteps(this._steps)}outerJoin(){return this.outerBind(Ke)}innerBind(e){return this.bindWhole((n,s)=>s,e)}innerJoin(){return this.innerBind(Ke)}resetJoin(e=!1){const n=this;return new Ft(s=>n.discreteOnly().query(s).map(o=>o.value.late(e?o.whole.begin:o.whole.begin.cyclePos()).query(s).map(c=>new bt(c.whole?c.whole.intersection(o.whole):void 0,c.part.intersection(o.part),c.value).setContext(o.combineContext(c))).filter(c=>c.part)).flat())}restartJoin(){return this.resetJoin(!0)}squeezeJoin(){const e=this;function n(s){const o=e.discreteOnly().query(s);function c(u){const l=u.value._focusSpan(u.wholeOrPart()).query(s.setSpan(u.part));function p(f,b){let g;if(b.whole&&f.whole&&(g=b.whole.intersection(f.whole),!g))return;const X=b.part.intersection(f.part);if(!X)return;const Z=b.combineContext(f);return new bt(g,X,b.value,Z)}return l.map(f=>p(u,f))}return ue(o.map(c)).filter(u=>u)}return new Ft(n)}squeezeBind(e){return this.fmap(e).squeezeJoin()}polyJoin=function(){const e=this;return e.fmap(n=>n.extend(e._steps.div(n._steps))).outerJoin()};polyBind(e){return this.fmap(e).polyJoin()}queryArc(e,n,s={}){try{return this.query(new He(new yt(e,n),s))}catch(o){return Sn(o,"query"),[]}}splitQueries(){const e=this,n=s=>ue(s.span.spanCycles.map(o=>e.query(s.setSpan(o))));return new Ft(n)}withQuerySpan(e){return new Ft(n=>this.query(n.withSpan(e)))}withQuerySpanMaybe(e){const n=this;return new Ft(s=>{const o=s.withSpan(e);return o.span?n.query(o):[]})}withQueryTime(e){return new Ft(n=>this.query(n.withSpan(s=>s.withTime(e))))}withHapSpan(e){return new Ft(n=>this.query(n).map(s=>s.withSpan(e)))}withHapTime(e){return this.withHapSpan(n=>n.withTime(e))}withHaps(e){const n=new Ft(s=>e(this.query(s),s));return n._steps=this._steps,n}withHap(e){return this.withHaps(n=>n.map(e))}setContext(e){return this.withHap(n=>n.setContext(e))}withContext(e){const n=this.withHap(s=>s.setContext(e(s.context)));return this.__pure!==void 0&&(n.__pure=this.__pure,n.__pure_loc=this.__pure_loc),n}stripContext(){return this.withHap(e=>e.setContext({}))}withLoc(e,n){const s={start:e,end:n},o=this.withContext(c=>{const i=(c.locations||[]).concat([s]);return{...c,locations:i}});return this.__pure&&(o.__pure=this.__pure,o.__pure_loc=s),o}filterHaps(e){return new Ft(n=>this.query(n).filter(e))}filterValues(e){return new Ft(n=>this.query(n).filter(s=>e(s.value))).setSteps(this._steps)}removeUndefineds(){return this.filterValues(e=>e!=null)}onsetsOnly(){return this.filterHaps(e=>e.hasOnset())}discreteOnly(){return this.filterHaps(e=>e.whole)}defragmentHaps(){return this.discreteOnly().withHaps(n=>{const s=[];for(var o=0;o<n.length;++o){for(var c=!0,i=n[o];c;){const l=JSON.stringify(n[o].value);for(var u=!1,a=o+1;a<n.length;a++){const p=n[a];if(i.whole.equals(p.whole)){if(i.part.begin.eq(p.part.end)){if(l===JSON.stringify(p.value)){i=new bt(i.whole,new yt(p.part.begin,i.part.end),i.value),n.splice(a,1),u=!0;break}}else if(p.part.begin.eq(i.part.end)&&l==JSON.stringify(p.value)){i=new bt(i.whole,new yt(i.part.begin,p.part.end),i.value),n.splice(a,1),u=!0;break}}}c=u}s.push(i)}return s})}firstCycle(e=!1){var n=this;return e||(n=n.stripContext()),n.query(new He(new yt(C(0),C(1))))}get firstCycleValues(){return this.firstCycle().map(e=>e.value)}get showFirstCycle(){return this.firstCycle().map(e=>`${e.value}: ${e.whole.begin.toFraction()} - ${e.whole.end.toFraction()}`)}sortHapsByPart(){return this.withHaps(e=>e.sort((n,s)=>n.part.begin.sub(s.part.begin).or(n.part.end.sub(s.part.end)).or(n.whole.begin.sub(s.whole.begin).or(n.whole.end.sub(s.whole.end)))))}asNumber(){return this.fmap(hs)}_opIn(e,n){return this.fmap(n).appLeft(V(e))}_opOut(e,n){return this.fmap(n).appRight(V(e))}_opMix(e,n){return this.fmap(n).appBoth(V(e))}_opSqueeze(e,n){const s=V(e);return this.fmap(o=>s.fmap(c=>n(o)(c))).squeezeJoin()}_opSqueezeOut(e,n){const s=this;return V(e).fmap(c=>s.fmap(i=>n(i)(c))).squeezeJoin()}_opReset(e,n){return V(e).fmap(o=>this.fmap(c=>n(c)(o))).resetJoin()}_opRestart(e,n){return V(e).fmap(o=>this.fmap(c=>n(c)(o))).restartJoin()}_opPoly(e,n){const s=V(e);return this.fmap(o=>s.fmap(c=>n(c)(o))).polyJoin()}layer(...e){return ft(...e.map(n=>n(this)))}superimpose(...e){return this.stack(...e.map(n=>n(this)))}stack(...e){return ft(this,...e)}sequence(...e){return _t(this,...e)}seq(...e){return _t(this,...e)}cat(...e){return fn(this,...e)}fastcat(...e){return Ct(this,...e)}slowcat(...e){return be(this,...e)}onTrigger(e,n=!0){return this.withHap(s=>s.setContext({...s.context,onTrigger:(...o)=>{s.context.onTrigger?.(...o),e(...o)},dominantTrigger:s.context.dominantTrigger||n}))}log(e=s=>`[hap] ${s.showWhole(!0)}`,n=s=>({hap:s})){return this.onTrigger((...s)=>{Yt(e(...s),void 0,n(...s))},!1)}logValues(e=n=>`[hap] ${bs(n,!0)}`){return this.log(n=>e(n.value))}drawLine(){return console.log(_o(this)),this}unjoin(e,n=Ke){return e.withHap(s=>s.withValue(o=>o?n(this.ribbon(s.whole.begin,s.whole.duration)):this))}into(e,n){return this.unjoin(e,n).innerJoin()}};function $h(t,e){let n=[];return e.forEach(s=>{const o=n.findIndex(([c])=>t(s,c));o===-1?n.push([s]):n[o].push(s)}),n}const tf=(t,e)=>t.spanEquals(e);L.prototype.collect=function(){return this.withHaps(t=>$h(tf,t).map(e=>new bt(e[0].whole,e[0].part,e,{})))};const ef=G("arpWith",(t,e)=>e.collect().fmap(n=>V(t(n))).innerJoin().withHap(n=>new bt(n.whole,n.part,n.value.value,n.combineContext(n.value)))),nf=G("arp",(t,e)=>e.arpWith(n=>V(t).fmap(s=>n[s%n.length])),!1);function An(t){return!Array.isArray(t)&&typeof t=="object"&&!_h(t)}function sf(t,e,n){return An(t)||An(e)?(An(t)||(t={value:t}),An(e)||(e={value:e}),Qh(t,e,n)):n(t,e)}(function(){const t={set:[(n,s)=>s],keep:[n=>n],keepif:[(n,s)=>s?n:void 0],add:[Tt((n,s)=>n+s)],sub:[Tt((n,s)=>n-s)],mul:[Tt((n,s)=>n*s)],div:[Tt((n,s)=>n/s)],mod:[Tt(dn)],pow:[Tt(Math.pow)],log2:[Tt(Math.log2)],band:[Tt((n,s)=>n&s)],bor:[Tt((n,s)=>n|s)],bxor:[Tt((n,s)=>n^s)],blshift:[Tt((n,s)=>n<<s)],brshift:[Tt((n,s)=>n>>s)],lt:[(n,s)=>n<s],gt:[(n,s)=>n>s],lte:[(n,s)=>n<=s],gte:[(n,s)=>n>=s],eq:[(n,s)=>n==s],eqt:[(n,s)=>n===s],ne:[(n,s)=>n!=s],net:[(n,s)=>n!==s],and:[(n,s)=>n&&s],or:[(n,s)=>n||s],func:[(n,s)=>s(n)]},e=["In","Out","Mix","Squeeze","SqueezeOut","Reset","Restart","Poly"];for(const[n,[s,o]]of Object.entries(t)){L.prototype["_"+n]=function(c){return this.fmap(i=>s(i,c))},Object.defineProperty(L.prototype,n,{get:function(){const c=this,i=(...u)=>c[n].in(...u);for(const u of e)i[u.toLowerCase()]=function(...a){var l=c;a=_t(a),o&&(l=o(l),a=o(a));var p;return n==="keepif"?(p=l["_op"+u](a,f=>b=>s(f,b)),p=p.removeUndefineds()):p=l["_op"+u](a,f=>b=>sf(f,b,s)),p};return i.squeezein=i.squeeze,i}});for(const c of e)L.prototype[c.toLowerCase()]=function(...i){return this.set[c.toLowerCase()](i)}}L.prototype.struct=function(...n){return this.keepif.out(...n)},L.prototype.structAll=function(...n){return this.keep.out(...n)},L.prototype.mask=function(...n){return this.keepif.in(...n)},L.prototype.maskAll=function(...n){return this.keep.in(...n)},L.prototype.reset=function(...n){return this.keepif.reset(...n)},L.prototype.resetAll=function(...n){return this.keep.reset(...n)},L.prototype.restart=function(...n){return this.keepif.restart(...n)},L.prototype.restartAll=function(...n){return this.keep.restart(...n)}})();const of=ft,cf=ft,rf=Nn,Pe=t=>new L(()=>[],t),nt=Pe(1),Nt=Pe(0);function gt(t){function e(s){return s.span.spanCycles.map(o=>new bt(C(o.begin).wholeCycle(),o,t))}const n=new L(e,1);return n.__pure=t,n}function Gs(t){return t instanceof L||t?._Pattern}function V(t){return Gs(t)?t:Xs&&typeof t=="string"?Xs(t):gt(t)}function qo(t){let e=gt([]);for(const n of t)e=e.bind(s=>n.fmap(o=>s.concat([o])));return e}function ft(...t){t=t.map(s=>Array.isArray(s)?_t(...s):V(s));const e=s=>ue(t.map(o=>o.query(s))),n=new L(e);return At&&(n._steps=Ut(...t.map(s=>s._steps))),n}function Zs(t,e){if(e=e.map(c=>Array.isArray(c)?_t(...c):V(c)),e.length===0)return nt;if(e.length===1)return e[0];const[n,...s]=e.map(c=>c._steps),o=At?n.maximum(...s):void 0;return ft(...t(o,e))}function $o(...t){return Zs((e,n)=>n.map(s=>s._steps.eq(e)?s:St(s,Pe(e.sub(s._steps)))),t)}function tc(...t){return Zs((e,n)=>n.map(s=>s._steps.eq(e)?s:St(Pe(e.sub(s._steps)),s)),t)}function ec(...t){return Zs((e,n)=>n.map(s=>{if(s._steps.eq(e))return s;const o=Pe(e.sub(s._steps).div(2));return St(o,s,o)}),t)}function uf(t,...e){const[n,...s]=e.map(i=>i._steps),o=n.maximum(...s),c={centre:ec,left:$o,right:tc,expand:ft,repeat:(...i)=>Nn(...i).steps(o)};return t.inhabit(c).fmap(i=>i(...e)).innerJoin().setSteps(o)}function be(...t){if(t=t.map(s=>Array.isArray(s)?Ct(...s):V(s)),t.length==1)return t[0];const e=function(s){const o=s.span,c=dn(o.begin.sam(),t.length),i=t[c];if(!i)return[];const u=o.begin.floor().sub(o.begin.div(t.length).floor());return i.withHapTime(a=>a.add(u)).query(s.setSpan(o.withTime(a=>a.sub(u))))},n=At?Ut(...t.map(s=>s._steps)):void 0;return new L(e).splitQueries().setSteps(n)}function ws(...t){t=t.map(V);const e=function(n){const s=Math.floor(n.span.begin)%t.length;return t[s]?.query(n)||[]};return new L(e).splitQueries()}function fn(...t){return be(...t)}function af(...t){const e=t.reduce((n,[s])=>n+s,0);return t=t.map(([n,s])=>[n,s.fast(n)]),St(...t).slow(e)}function lf(...t){let e=C(0);for(let n of t)n.length==2&&n.unshift(e),e=n[1];return ft(...t.map(([n,s,o])=>gt(V(o)).compress(C(n).div(e),C(s).div(e)))).slow(e).innerJoin()}function Ct(...t){let e=be(...t);return t.length>1&&(e=e._fast(t.length),e._steps=t.length),t.length==1&&t[0].__steps_source&&(t._steps=t[0]._steps),e}function _t(...t){return Ct(...t)}function nc(...t){return Ct(...t)}function Ws(t){return Array.isArray(t)?t.length==0?[nt,0]:t.length==1?Ws(t[0]):[Ct(...t.map(e=>Ws(e)[0])),t.length]:[V(t),1]}const df=D((t,e)=>V(e).mask(t)),pf=D((t,e)=>V(e).struct(t)),hf=D((t,e)=>V(e).superimpose(...t)),ff=D((t,e)=>V(e).withValue(t)),mf=D((t,e)=>V(e).bind(t)),yf=D((t,e)=>V(e).innerBind(t)),bf=D((t,e)=>V(e).outerBind(t)),gf=D((t,e)=>V(e).squeezeBind(t)),Xf=D((t,e)=>V(e).stepBind(t)),Gf=D((t,e)=>V(e).polyBind(t)),Zf=D((t,e)=>V(e).set(t)),wf=D((t,e)=>V(e).keep(t)),Wf=D((t,e)=>V(e).keepif(t)),Ff=D((t,e)=>V(e).add(t)),Vf=D((t,e)=>V(e).sub(t)),Cf=D((t,e)=>V(e).mul(t)),Lf=D((t,e)=>V(e).div(t)),zf=D((t,e)=>V(e).mod(t)),Mf=D((t,e)=>V(e).pow(t)),Rf=D((t,e)=>V(e).band(t)),xf=D((t,e)=>V(e).bor(t)),vf=D((t,e)=>V(e).bxor(t)),Yf=D((t,e)=>V(e).blshift(t)),Sf=D((t,e)=>V(e).brshift(t)),Bf=D((t,e)=>V(e).lt(t)),kf=D((t,e)=>V(e).gt(t)),Tf=D((t,e)=>V(e).lte(t)),Af=D((t,e)=>V(e).gte(t)),Nf=D((t,e)=>V(e).eq(t)),Kf=D((t,e)=>V(e).eqt(t)),Hf=D((t,e)=>V(e).ne(t)),Pf=D((t,e)=>V(e).net(t)),Ef=D((t,e)=>V(e).and(t)),Df=D((t,e)=>V(e).or(t)),Jf=D((t,e)=>V(e).func(t));function G(t,e,n=!0,s=!1,o=c=>c.innerJoin()){if(Array.isArray(t)){const u={};for(const a of t)u[a]=G(a,e,n,s,o);return u}const c=e.length;var i;return n?i=function(...u){u=u.map(V);const a=u[u.length-1];let l;if(c===1)l=e(a);else{const p=u.slice(0,-1);if(p.every(f=>f.__pure!=null)){const f=p.map(g=>g.__pure),b=p.filter(g=>g.__pure_loc).map(g=>g.__pure_loc);l=e(...f,a),l=l.withContext(g=>{const X=(g.locations||[]).concat(b);return{...g,locations:X}})}else{const[f,...b]=p;let g=(...X)=>e(...X,a);g=D(g,null,c-1),l=o(b.reduce((X,Z)=>X.appLeft(Z),f.fmap(g)))}}return s&&(l._steps=a._steps),l}:i=function(...u){u=u.map(V);const a=e(...u);return s&&(a._steps=u[u.length-1]._steps),a},L.prototype[t]=function(...u){if(c===2&&u.length!==1)u=[_t(...u)];else if(c!==u.length+1)throw new Error(`.${t}() expects ${c-1} inputs but got ${u.length}.`);return u=u.map(V),i(...u,this)},c>1&&(L.prototype["_"+t]=function(...u){const a=e(...u,this);return s&&a.setSteps(this._steps),a}),D(i,null,c)}function Ee(t,e,n=!0,s=!1,o=c=>c.stepJoin()){return G(t,e,n,s,o)}const If=G("round",function(t){return t.asNumber().fmap(e=>Math.round(e))}),jf=G("floor",function(t){return t.asNumber().fmap(e=>Math.floor(e))}),Of=G("ceil",function(t){return t.asNumber().fmap(e=>Math.ceil(e))}),Uf=G("toBipolar",function(t){return t.fmap(e=>e*2-1)}),_f=G("fromBipolar",function(t){return t.fmap(e=>(e+1)/2)}),Qf=G("range",function(t,e,n){return n.mul(e-t).add(t)}),qf=G("rangex",function(t,e,n){return n._range(Math.log(t),Math.log(e)).fmap(Math.exp)}),$f=G("range2",function(t,e,n){return n.fromBipolar()._range(t,e)}),tm=G("ratio",t=>t.fmap(e=>Array.isArray(e)?e.slice(1).reduce((n,s)=>n/s,e[0]):e)),em=G("compress",function(t,e,n){return t=C(t),e=C(e),t.gt(e)||t.gt(1)||e.gt(1)||t.lt(0)||e.lt(0)?nt:n._fastGap(C(1).div(e.sub(t)))._late(t)}),{compressSpan:nm,compressspan:sm}=G(["compressSpan","compressspan"],function(t,e){return e._compress(t.begin,t.end)}),{fastGap:om,fastgap:cm}=G(["fastGap","fastgap"],function(t,e){const n=function(o){const c=o.begin.sam(),i=o.begin.sub(c).mul(t).min(1),u=o.end.sub(c).mul(t).min(1);if(!(i>=1))return new yt(c.add(i),c.add(u))},s=function(o){const c=o.part.begin,i=o.part.end,u=c.sam(),a=c.sub(u).div(t).min(1),l=i.sub(u).div(t).min(1),p=new yt(u.add(a),u.add(l)),f=o.whole?new yt(p.begin.sub(c.sub(o.whole.begin).div(t)),p.end.add(o.whole.end.sub(i).div(t))):void 0;return new bt(f,p,o.value,o.context)};return e.withQuerySpanMaybe(n).withHap(s).splitQueries()}),rm=G("focus",function(t,e,n){return t=C(t),e=C(e),n._early(t.sam())._fast(C(1).div(e.sub(t)))._late(t)}),{focusSpan:im,focusspan:um}=G(["focusSpan","focusspan"],function(t,e){return e._focus(t.begin,t.end)}),am=G("ply",function(t,e){const n=e.fmap(s=>gt(s)._fast(t)).squeezeJoin();return At&&(n._steps=C(t).mulmaybe(e._steps)),n}),{fast:lm,density:rG}=G(["fast","density"],function(t,e){return t===0?nt:(t=C(t),e.withQueryTime(s=>s.mul(t)).withHapTime(s=>s.div(t)).setSteps(e._steps))},!0,!0),dm=G("hurry",function(t,e){return e._fast(t).mul(gt({speed:t}))}),{slow:pm,sparsity:hm}=G(["slow","sparsity"],function(t,e){return t===0?nt:e._fast(C(1).div(t))}),fm=G("inside",function(t,e,n){return e(n._slow(t))._fast(t)}),mm=G("outside",function(t,e,n){return e(n._fast(t))._slow(t)}),ym=G("lastOf",function(t,e,n){const s=Array(t-1).fill(n);return s.push(e(n)),ws(...s)}),{firstOf:bm,every:gm}=G(["firstOf","every"],function(t,e,n){const s=Array(t-1).fill(n);return s.unshift(e(n)),ws(...s)}),Xm=G("apply",function(t,e){return t(e)}),Gm=G("cpm",function(t,e){return e._fast(t/60/1)}),Zm=G("early",function(t,e){return t=C(t),e.withQueryTime(n=>n.add(t)).withHapTime(n=>n.sub(t))},!0,!0),sc=G("late",function(t,e){return t=C(t),e._early(C(0).sub(t))},!0,!0),wm=G("zoom",function(t,e,n){if(e=C(e),t=C(t),t.gte(e))return Nt;const s=e.sub(t),o=At?n._steps?.mulmaybe(s):void 0;return n.withQuerySpan(c=>c.withCycle(i=>i.mul(s).add(t))).withHapSpan(c=>c.withCycle(i=>i.sub(t).div(s))).splitQueries().setSteps(o)}),{zoomArc:Wm,zoomarc:Fm}=G(["zoomArc","zoomarc"],function(t,e){return e.zoom(t.begin,t.end)}),Vm=G("bite",(t,e,n)=>e.fmap(s=>o=>{const c=C(s).div(o).mod(1),i=c.add(C(1).div(o));return n.zoom(c,i)}).appLeft(t).squeezeJoin(),!1),Cm=G("linger",function(t,e){return t==0?nt:t<0?e._zoom(t.add(1),1)._slow(t):e._zoom(0,t)._slow(t)},!0,!0),{segment:Lm,seg:zm}=G(["segment","seg"],function(t,e){return e.struct(gt(!0)._fast(t)).setSteps(t)}),Mm=G("swingBy",(t,e,n)=>n.inside(e,sc(nc(0,t/2)))),Rm=G("swing",(t,e)=>e.swingBy(1/3,t)),{invert:xm,inv:vm}=G(["invert","inv"],function(t){return t.fmap(e=>!e)},!0,!0),Ym=G("when",function(t,e,n){return t?e(n):n}),Sm=G("off",function(t,e,n){return ft(n,e(n.late(t)))}),Bm=G("brak",function(t){return t.when(be(!1,!0),e=>Ct(e,nt)._late(.25))}),oc=G("rev",function(t){const e=function(n){const s=n.span,o=s.begin.sam(),c=s.begin.nextSam(),i=function(a){const l=a.withTime(f=>o.add(c.sub(f))),p=l.begin;return l.begin=l.end,l.end=p,l};return t.query(n.setSpan(i(s))).map(a=>a.withSpan(i))};return new L(e).splitQueries()},!1,!0),km=G("revv",function(t){const e=n=>new yt(C(0).sub(n.end),C(0).sub(n.begin));return t.withQuerySpan(e).withHapSpan(e)}),Tm=G("pressBy",function(t,e){return e.fmap(n=>gt(n).compress(t,1)).squeezeJoin()}),Am=G("press",function(t){return t._pressBy(.5)});L.prototype.hush=function(){return nt};const Nm=G("palindrome",function(t){return t.lastOf(2,oc)},!0,!0),{juxBy:Km,juxby:Hm}=G(["juxBy","juxby"],function(t,e,n){t/=2;const s=function(i,u,a){return u in i?i[u]:a},o=n.withValue(i=>Object.assign({},i,{pan:s(i,"pan",.5)-t})),c=e(n.withValue(i=>Object.assign({},i,{pan:s(i,"pan",.5)+t})));return ft(o,c).setSteps(At?Ut(o._steps,c._steps):void 0)}),Pm=G("jux",function(t,e){return e._juxBy(1,t,e)}),{echoWith:Em,echowith:Dm,stutWith:Jm,stutwith:Im}=G(["echoWith","echowith","stutWith","stutwith"],function(t,e,n,s){return ft(...pn(0,t-1).map(o=>n(s.late(C(e).mul(o)),o)))}),jm=G("echo",function(t,e,n,s){return s._echoWith(t,e,(o,c)=>o.gain(Math.pow(n,c)))}),Om=G("stut",function(t,e,n,s){return s._echoWith(t,n,(o,c)=>o.gain(Math.pow(e,c)))}),cc=G("applyN",function(t,e,n){let s=n;for(let o=0;o<t;o++)s=e(s);return s}),Um=G(["plyWith","plywith"],function(t,e,n){const s=n.fmap(o=>fn(...pn(0,t-1).map(c=>cc(c,e,o)))._fast(t)).squeezeJoin();return At&&(s._steps=C(t).mulmaybe(n._steps)),s}),_m=G(["plyForEach","plyforeach"],function(t,e,n){const s=n.fmap(o=>fn(fn(gt(o),...pn(1,t-1).map(c=>e(gt(o),c))))._fast(t)).squeezeJoin();return At&&(s._steps=C(t).mulmaybe(n._steps)),s}),Fs=function(t,e,n=!1){return t=C(t),be(...pn(0,t.sub(1)).map(s=>n?e.late(C(s).div(t)):e.early(C(s).div(t))))},Qm=G("iter",function(t,e){return Fs(t,e,!1)},!0,!0),{iterBack:qm,iterback:$m}=G(["iterBack","iterback"],function(t,e){return Fs(t,e,!0)},!0,!0),{repeatCycles:t1}=G("repeatCycles",function(t,e){return new L(function(n){const s=n.span.begin.sam(),o=s.div(t).sam(),c=s.sub(o);return n=n.withSpan(i=>i.withTime(u=>u.sub(c))),e.query(n).map(i=>i.withSpan(u=>u.withTime(a=>a.add(c))))}).splitQueries()},!0,!0),Vs=function(t,e,n,s=!1,o=!1){const c=Array(t-1).fill(!1);c.unshift(!0);const i=Fs(t,_t(...c),!s);return o||(n=n.repeatCycles(t)),n.when(i,e)},{chunk:e1,slowchunk:n1,slowChunk:s1}=G(["chunk","slowchunk","slowChunk"],function(t,e,n){return Vs(t,e,n,!1,!1)},!0,!0),{chunkBack:o1,chunkback:c1}=G(["chunkBack","chunkback"],function(t,e,n){return Vs(t,e,n,!0)},!0,!0),{fastchunk:r1,fastChunk:i1}=G(["fastchunk","fastChunk"],function(t,e,n){return Vs(t,e,n,!1,!0)},!0,!0),{chunkinto:u1,chunkInto:a1}=G(["chunkinto","chunkInto"],function(t,e,n){return n.into(Ct(!0,...Array(t-1).fill(!1))._iterback(t),e)}),{chunkbackinto:l1,chunkBackInto:d1}=G(["chunkbackinto","chunkBackInto"],function(t,e,n){return n.into(Ct(!0,...Array(t-1).fill(!1))._iter(t)._early(1),e)}),p1=G("bypass",function(t,e){return t=!!parseInt(t),t?nt:e},!0,!0),{ribbon:h1,rib:f1}=G(["ribbon","rib"],(t,e,n)=>n.early(t).restart(gt(1).slow(e))),m1=G("hsla",(t,e,n,s,o)=>o.color(`hsla(${t}turn,${e*100}%,${n*100}%,${s})`)),y1=G("hsl",(t,e,n,s)=>s.color(`hsl(${t}turn,${e*100}%,${n*100}%)`));L.prototype.tag=function(t){return this.withContext(e=>({...e,tags:(e.tags||[]).concat([t])}))};const b1=G("filter",(t,e)=>e.withHaps(n=>n.filter(t))),g1=G("filterWhen",(t,e)=>e.filter(n=>t(n.whole.begin))),X1=G("within",(t,e,n,s)=>ft(n(s.filterWhen(o=>o.cyclePos()>=t&&o.cyclePos()<=e)),s.filterWhen(o=>o.cyclePos()<t||o.cyclePos()>e)));L.prototype.stepJoin=function(){const t=this,e=St(...Cs(Ls(t.queryArc(0,1))))._steps,n=function(s){const c=t.early(s.span.begin.sam()).query(s.setSpan(new yt(C(0),C(1))));return St(...Cs(Ls(c))).query(s)};return new L(n,e)},L.prototype.stepBind=function(t){return this.fmap(t).stepJoin()};function Cs(t){const e=t.filter((c,i)=>i.hasSteps).reduce((c,i)=>c.add(i),C(0)),n=Ne(t.map((c,i)=>i._steps)).reduce((c,i)=>c.add(i),C(0)),s=e.eq(0)?void 0:n.div(e);function o(c,i){return i._steps===void 0?[c.mulmaybe(s),i]:[i._steps,i]}return t.map(c=>o(...c))}function Ls(t){const e=ue(t.map(o=>[o.part.begin,o.part.end])),n=Eo([C(0),C(1),...e]);return Po(n).map(o=>[o[1].sub(o[0]),ft(...rc(new yt(...o),t).map(c=>c.value.withHap(i=>i.setContext(i.combineContext(c)))))])}function rc(t,e){return Ne(e.map(n=>ic(t,n)))}function ic(t,e){const n=t.intersection(e.part);if(n!=null)return new bt(e.whole,n,e.value,e.context)}const uc=G("pace",function(t,e){return e._steps===void 0?e:e._steps.eq(C(0))?Nt:e._fast(C(t).div(e._steps)).setSteps(t)});function ac(t,...e){const n=e.map(o=>Ws(o));if(n.length==0)return nt;t==0&&(t=n[0][1]);const s=[];for(const o of n)o[1]!=0&&(t==o[1]?s.push(o[0]):s.push(o[0]._fast(C(t).div(C(o[1])))));return ft(...s)}function Nn(...t){if(Array.isArray(t[0]))return ac(0,...t);if(t=t.filter(s=>s.hasSteps),t.length==0)return nt;const e=Ut(...t.map(s=>s._steps));if(e.eq(C(0)))return Nt;const n=ft(...t.map(s=>s.pace(e)));return n._steps=e,n}function St(...t){if(t.length===0)return Nt;const e=i=>Array.isArray(i)?i:[i._steps??1,i];if(t=t.map(e),t.find(i=>i[0]===void 0)){const i=t.map(a=>a[0]).filter(a=>a!==void 0);if(i.length===0)return Ct(...t.map(a=>a[1]));if(i.length===t.length)return Nt;const u=i.reduce((a,l)=>a.add(l),C(0)).div(i.length);for(let a of t)a[0]===void 0&&(a[0]=u)}if(t.length==1)return V(t[0][1]).withSteps(u=>t[0][0]);const n=t.map(i=>i[0]).reduce((i,u)=>i.add(u),C(0));let s=C(0);const o=[];for(const[i,u]of t){if(C(i).eq(0))continue;const a=s.add(i);o.push(V(u)._compress(s.div(n),a.div(n))),s=a}const c=ft(...o);return c._steps=n,c}function lc(...t){t=t.map(o=>Array.isArray(o)?o.map(V):[V(o)]);const e=Ut(...t.map(o=>C(o.length)));let n=[];for(let o=0;o<e;++o)n.push(...t.map(c=>c.length==0?nt:c[o%c.length]));n=n.filter(o=>o.hasSteps&&o._steps>0);const s=n.reduce((o,c)=>o.add(c._steps),C(0));return n=St(...n),n._steps=s,n}const dc=Ee("take",function(t,e){if(!e.hasSteps||e._steps.lte(0)||(t=C(t),t.eq(0)))return Nt;const n=t<0;n&&(t=t.abs());const s=t.div(e._steps);return s.lte(0)?Nt:s.gte(1)?e:n?e.zoom(C(1).sub(s),1):e.zoom(0,s)}),pc=Ee("drop",function(t,e){return e.hasSteps?(t=C(t),t.lt(0)?e.take(e._steps.add(t)):e.take(C(0).sub(e._steps.sub(t)))):Nt}),hc=Ee("extend",function(t,e){return e.fast(t).expand(t)}),G1=Ee("replicate",function(t,e){return e.repeatCycles(t).fast(t).expand(t)}),fc=Ee("expand",function(t,e){return e.withSteps(n=>n.mul(C(t)))}),mc=Ee("contract",function(t,e){return e.withSteps(n=>n.div(C(t)))});L.prototype.shrinklist=function(t){const e=this;if(!e.hasSteps)return[e];let[n,s]=Array.isArray(t)?t:[t,e._steps];if(n=C(n),s===0||n===0)return[e];const o=n>0,c=[];if(o){const i=C(1).div(e._steps).mul(n);for(let u=0;u<s;++u){const a=i.mul(u);if(a.gt(1))break;c.push([a,1])}}else{n=C(0).sub(n);const i=C(1).div(e._steps).mul(n);for(let u=0;u<s;++u){const a=C(1).sub(i.mul(u));if(a.lt(0))break;c.push([C(0),a])}}return c.map(i=>e.zoom(...i))};const yc=(t,e)=>e.shrinklist(t),bc=G("shrink",function(t,e){if(!e.hasSteps)return Nt;const n=e.shrinklist(t),s=St(...n);return s._steps=n.reduce((o,c)=>o.add(c._steps),C(0)),s},!0,!1,t=>t.stepJoin()),Z1=G("grow",function(t,e){if(!e.hasSteps)return Nt;const n=e.shrinklist(C(0).sub(t));n.reverse();const s=St(...n);return s._steps=n.reduce((o,c)=>o.add(c._steps),C(0)),s},!0,!1,t=>t.stepJoin()),gc=function(t,...e){return t.tour(...e)};L.prototype.tour=function(...t){return St(...[].concat(...t.map((e,n)=>[...t.slice(0,t.length-n),this,...t.slice(t.length-n)]),this,...t))};const Xc=function(...t){t=t.filter(s=>s.hasSteps);const e=be(...t.map(s=>s._slow(s._steps))),n=Ut(...t.map(s=>s._steps));return e._fast(n).setSteps(n)},w1=St,zs=St,W1=St,F1=lc,V1=Nn;L.prototype.s_polymeter=L.prototype.polymeter;const C1=bc;L.prototype.s_taper=L.prototype.shrink;const L1=yc;L.prototype.s_taperlist=L.prototype.shrinklist;const z1=dc;L.prototype.s_add=L.prototype.take;const M1=pc;L.prototype.s_sub=L.prototype.drop;const R1=fc;L.prototype.s_expand=L.prototype.expand;const x1=hc;L.prototype.s_extend=L.prototype.extend;const v1=mc;L.prototype.s_contract=L.prototype.contract;const Y1=gc;L.prototype.s_tour=L.prototype.tour;const S1=Xc;L.prototype.s_zip=L.prototype.zip;const B1=uc;L.prototype.steps=L.prototype.pace;const k1=G("chop",function(t,e){const s=Array.from({length:t},(i,u)=>u).map(i=>({begin:i/t,end:(i+1)/t})),o=function(i,u){if("begin"in i&&"end"in i&&i.begin!==void 0&&i.end!==void 0){const a=i.end-i.begin;u={begin:i.begin+u.begin*a,end:i.begin+u.end*a}}return Object.assign({},i,u)},c=function(i){return _t(s.map(u=>o(i,u)))};return e.squeezeBind(c).setSteps(At?C(t).mulmaybe(e._steps):void 0)}),T1=G("striate",function(t,e){const s=Array.from({length:t},(c,i)=>i).map(c=>({begin:c/t,end:(c+1)/t})),o=be(...s);return e.set(o)._fast(t).setSteps(At?C(t).mulmaybe(e._steps):void 0)}),Gc=function(t,e,n=.5){return e.speed(1/t*n).unit("c").slow(t)},Zc=G("slice",function(t,e,n){return t.innerBind(s=>e.outerBind(o=>n.outerBind(c=>{c=c instanceof Object?c:{s:c};const i=Array.isArray(s)?s[o]:o/s,u=Array.isArray(s)?s[o+1]:(o+1)/s;return gt({begin:i,end:u,_slices:s,...c})}))).setSteps(e._steps)},!1);L.prototype.onTriggerTime=function(t){return this.onTrigger((e,n,s,o)=>{const c=o-n;window.setTimeout(()=>{t(e)},c*1e3)},!1)};const A1=G("splice",function(t,e,n){const s=Zc(t,e,n);return new L(o=>{const c=o.controls._cps||1;return s.query(o).map(u=>u.withValue(a=>({speed:c/a._slices/u.whole.duration*(a.speed||1),unit:"c",...a})))}).setSteps(e._steps)},!1),{loopAt:N1,loopat:K1}=G(["loopAt","loopat"],function(t,e){const n=e._steps?e._steps.div(t):void 0;return new L(s=>Gc(t,e,s.controls._cps).query(s),n)}),H1=G("fit",t=>t.withHaps((e,n)=>e.map(s=>s.withValue(o=>{const c=("end"in o?o.end:1)-("begin"in o?o.begin:0);return{...o,speed:(n.controls._cps||1)/s.whole.duration*c,unit:"c"}})))),{loopAtCps:P1,loopatcps:E1}=G(["loopAtCps","loopatcps"],function(t,e,n){return Gc(t,n,e)}),D1=t=>gt(1).withValue(()=>V(t())).innerJoin();let wc=t=>t<.5?1:1-(t-.5)/.5,Wc=(t,e,n)=>{e=V(e),t=V(t),n=V(n);let s=e.fmap(c=>({gain:wc(c)})),o=e.fmap(c=>({gain:wc(1-c)}));return ft(t.mul(s),n.mul(o))};L.prototype.xfade=function(t,e){return Wc(this,t,e)};const J1=t=>(e,n,s)=>{e=C(e).mod(n),n=C(n);const o=e.div(n),c=e.add(1).div(n);return t(s.fmap(i=>gt(i)._compress(o,c)))},{beat:I1}=G(["beat"],J1(t=>t.innerJoin())),Ms=(t,e,n)=>{n=C(n);const s=C(1).div(t.length),o=u=>{const a=[];for(const[l,p]of u.entries())p&&a.push([C(l).div(u.length),p]);return a},c=kn(([u,a],[l,p])=>{const f=n.mul(l-u).add(u),b=f.add(s);return new yt(f,b)},o(t),o(e));function i(u){const a=u.span.begin.sam(),l=u.span.cycleArc(),p=[];for(const f of c){const b=f.intersection(l);b!==void 0&&p.push(new bt(f.withTime(g=>g.add(a)),b.withTime(g=>g.add(a)),!0))}return p}return new L(i).splitQueries()},j1=(t,e,n)=>(t=V(t),e=V(e),n=V(n),t.innerBind(s=>e.innerBind(o=>n.innerBind(c=>Ms(s,o,c))))),O1=["scurve","soft","hard","cubic","diode","asym","fold","sinefold","chebyshev"];for(const t of O1)L.prototype[t]=function(e){const n=V(e).fmap(s=>Array.isArray(s)?[...s,t]:[s,1,t]);return this.distort(n)};const Fc=t=>{let n=gt(D((...s)=>s,null,t.length));for(const s of t)n=n.appBoth(V(s));return n},Kn=t=>Array.isArray(t)?Fc(t):V(t);L.prototype.partials=function(t){return this.withValue(e=>n=>({...e,partials:n})).appLeft(Kn(t))};const U1=t=>Kn(t).as("partials");L.prototype.phases=function(t){return this.withValue(e=>n=>({...e,phases:n})).appLeft(Kn(t))};const _1=t=>Kn(t).as("phases");function Hn(t){let e=Array.isArray(t);t=e?t:[t];const n=t[0],s=c=>{let i;if(typeof c=="object"&&c.value!==void 0&&(i={...c},c=c.value,delete i.value),e&&Array.isArray(c)){const u=i||{};return c.forEach((a,l)=>{l<t.length&&(u[t[l]]=a)}),u}else return i?(i[n]=c,i):{[n]:c}},o=function(c,i){return i?typeof c>"u"?i.fmap(s):i.set(V(c).withValue(s)):V(c).withValue(s)};return L.prototype[n]=function(c){return o(c,this)},o}const mn=new Map;function Vc(t){return mn.has(t)}function h(t,...e){const n=Array.isArray(t)?t[0]:t;let s={};return s[n]=Hn(t),mn.set(n,n),e.forEach(o=>{s[o]=s[n],mn.set(o,n),L.prototype[o]=L.prototype[n]}),s}const{s:Cc,sound:Lc}=h(["s","n","gain"],"sound"),{wt:zc,wavetablePosition:Mc}=h("wt","wavetablePosition"),{wtenv:Rc}=h("wtenv"),{wtattack:xc,wtatt:vc}=h("wtattack","wtatt"),{wtdecay:Yc,wtdec:Sc}=h("wtdecay","wtdec"),{wtsustain:Bc,wtsus:kc}=h("wtsustain","wtsus"),{wtrelease:Tc,wtrel:Ac}=h("wtrelease","wtrel"),{wtrate:Nc}=h("wtrate"),{wtsync:Kc}=h("wtsync"),{wtdepth:Hc}=h("wtdepth"),{wtshape:Pc}=h("wtshape"),{wtdc:Ec}=h("wtdc"),{wtskew:Dc}=h("wtskew"),{warp:Jc,wavetableWarp:Ic}=h("warp","wavetableWarp"),{warpattack:jc,warpatt:Oc}=h("warpattack","warpatt"),{warpdecay:Uc,warpdec:_c}=h("warpdecay","warpdec"),{warpsustain:Qc,warpsus:qc}=h("warpsustain","warpsus"),{warprelease:$c,warprel:tr}=h("warprelease","warprel"),{warprate:er}=h("warprate"),{warpdepth:nr}=h("warpdepth"),{warpshape:sr}=h("warpshape"),{warpdc:or}=h("warpdc"),{warpskew:cr}=h("warpskew"),{warpmode:rr,wavetableWarpMode:ir}=h("warpmode","wavetableWarpMode"),{wtphaserand:ur,wavetablePhaseRand:ar}=h("wtphaserand","wavetablePhaseRand"),{warpenv:lr}=h("warpenv"),{warpsync:dr}=h("warpsync"),{source:pr,src:hr}=h("source","src"),{n:fr}=h("n"),{note:mr}=h(["note","n"]),{accelerate:yr}=h("accelerate"),{velocity:br}=h("velocity"),{gain:gr}=h("gain"),{postgain:Xr}=h("postgain"),{amp:Gr}=h("amp"),{attack:Zr,att:wr}=h("attack","att"),{fmh:Wr}=h(["fmh","fmi"],"fmh"),{fmi:Fr,fm:Vr}=h(["fmi","fmh"],"fm"),{fmenv:Cr}=h("fmenv"),{fmattack:Lr}=h("fmattack"),{fmwave:zr}=h("fmwave"),{fmdecay:Mr}=h("fmdecay"),{fmsustain:Rr}=h("fmsustain"),{fmrelease:xr}=h("fmrelease"),{fmvelocity:vr}=h("fmvelocity"),{bank:Yr}=h("bank"),{chorus:Sr}=h("chorus"),{analyze:Br}=h("analyze"),{fft:kr}=h("fft"),{decay:Tr,dec:Ar}=h("decay","dec"),{sustain:Nr,sus:Kr}=h("sustain","sus"),{release:Hr,rel:Pr}=h("release","rel"),{hold:Er}=h("hold"),{bandf:Dr,bpf:Jr,bp:Ir}=h(["bandf","bandq","bpenv"],"bpf","bp"),{bandq:jr,bpq:Or}=h("bandq","bpq"),{begin:Ur}=h("begin"),{end:_r}=h("end"),{loop:Qr}=h("loop"),{loopBegin:qr,loopb:$r}=h("loopBegin","loopb"),{loopEnd:ti,loope:ei}=h("loopEnd","loope"),{crush:ni}=h("crush"),{coarse:si}=h("coarse"),{tremolo:oi}=h(["tremolo","tremolodepth","tremoloskew","tremolophase"],"trem"),{tremolosync:ci}=h(["tremolosync","tremolodepth","tremoloskew","tremolophase"],"tremsync"),{tremolodepth:ri}=h("tremolodepth","tremdepth"),{tremoloskew:ii}=h("tremoloskew","tremskew"),{tremolophase:ui}=h("tremolophase","tremphase"),{tremoloshape:ai}=h("tremoloshape","tremshape"),{drive:li}=h("drive"),{duck:di}=h("duckorbit","duck"),{duckdepth:pi}=h("duckdepth"),{duckonset:hi}=h("duckonset","duckons"),{duckattack:fi}=h("duckattack","duckatt"),{byteBeatExpression:mi,bbexpr:yi}=h("byteBeatExpression","bbexpr"),{byteBeatStartTime:bi,bbst:gi}=h("byteBeatStartTime","bbst"),{channels:Xi,ch:Gi}=h("channels","ch"),{pw:Zi}=h(["pw","pwrate","pwsweep"]),{pwrate:wi}=h("pwrate"),{pwsweep:Wi}=h("pwsweep"),{phaserrate:Fi,ph:Vi,phaser:Ci}=h(["phaserrate","phaserdepth","phasercenter","phasersweep"],"ph","phaser"),{phasersweep:Li,phs:zi}=h("phasersweep","phs"),{phasercenter:Mi,phc:Ri}=h("phasercenter","phc"),{phaserdepth:xi,phd:vi,phasdp:Yi}=h("phaserdepth","phd","phasdp"),{channel:Si}=h("channel"),{cut:Bi}=h("cut"),{cutoff:ki,ctf:Ti,lpf:Ai,lp:Ni}=h(["cutoff","resonance","lpenv"],"ctf","lpf","lp"),{lpenv:Ki,lpe:Hi}=h("lpenv","lpe"),{hpenv:Pi,hpe:Ei}=h("hpenv","hpe"),{bpenv:Di,bpe:Ji}=h("bpenv","bpe"),{lpattack:Ii,lpa:ji}=h("lpattack","lpa"),{hpattack:Oi,hpa:Ui}=h("hpattack","hpa"),{bpattack:_i,bpa:Qi}=h("bpattack","bpa"),{lpdecay:qi,lpd:$i}=h("lpdecay","lpd"),{hpdecay:tu,hpd:eu}=h("hpdecay","hpd"),{bpdecay:nu,bpd:su}=h("bpdecay","bpd"),{lpsustain:ou,lps:cu}=h("lpsustain","lps"),{hpsustain:ru,hps:iu}=h("hpsustain","hps"),{bpsustain:uu,bps:au}=h("bpsustain","bps"),{lprelease:lu,lpr:du}=h("lprelease","lpr"),{hprelease:pu,hpr:hu}=h("hprelease","hpr"),{bprelease:fu,bpr:mu}=h("bprelease","bpr"),{ftype:yu}=h("ftype"),{fanchor:bu}=h("fanchor"),{lprate:gu}=h("lprate"),{lpsync:Xu}=h("lpsync"),{lpdepth:Gu}=h("lpdepth"),{lpdepthfrequency:Zu}=h("lpdepthfrequency","lpdepthfreq"),{lpshape:wu}=h("lpshape"),{lpdc:Wu}=h("lpdc"),{lpskew:Fu}=h("lpskew"),{bprate:Vu}=h("bprate"),{bpsync:Cu}=h("bpsync"),{bpdepth:Lu}=h("bpdepth"),{bpdepthfrequency:zu}=h("bpdepthfrequency","bpdepthfreq"),{bpshape:Mu}=h("bpshape"),{bpdc:Ru}=h("bpdc"),{bpskew:xu}=h("bpskew"),{hprate:vu}=h("hprate"),{hpsync:Yu}=h("hpsync"),{hpdepth:Su,hpdepthfreq:Bu}=h("hpdepth"),{hpdepthfrequency:ku}=h("hpdepthfrequency","hpdepthfreq"),{hpshape:Tu}=h("hpshape"),{hpdc:Au}=h("hpdc"),{hpskew:Nu}=h("hpskew"),{vib:Ku,vibrato:Hu,v:Pu}=h(["vib","vibmod"],"vibrato","v"),{noise:Eu}=h("noise"),{vibmod:Du,vmod:Ju}=h(["vibmod","vib"],"vmod"),{hcutoff:Iu,hpf:ju,hp:Ou}=h(["hcutoff","hresonance","hpenv"],"hpf","hp"),{hresonance:Uu,hpq:_u}=h("hresonance","hpq"),{resonance:Qu,lpq:qu}=h("resonance","lpq"),{djf:$u}=h("djf"),{delay:ta}=h(["delay","delaytime","delayfeedback"]),{delayfeedback:ea,delayfb:na,dfb:sa}=h("delayfeedback","delayfb","dfb"),{delayspeed:oa}=h("delayspeed"),{delaytime:ca,delayt:ra,dt:ia}=h("delaytime","delayt","dt"),{delaysync:ua}=h("delaysync"),{lock:aa}=h("lock"),{detune:la,det:da}=h("detune","det"),{unison:pa}=h("unison"),{spread:ha}=h("spread"),{dry:fa}=h("dry"),{fadeTime:ma,fadeOutTime:ya}=h("fadeTime","fadeOutTime"),{fadeInTime:ba}=h("fadeInTime"),{freq:ga}=h("freq"),{pattack:Xa,patt:Ga}=h("pattack","patt"),{pdecay:Za,pdec:wa}=h("pdecay","pdec"),{psustain:Wa,psus:Fa}=h("psustain","psus"),{prelease:Va,prel:Ca}=h("prelease","prel"),{penv:La}=h("penv"),{pcurve:za}=h("pcurve"),{panchor:Ma}=h("panchor"),{gate:Ra,gat:xa}=h("gate","gat"),{leslie:va}=h("leslie"),{lrate:Ya}=h("lrate"),{lsize:Sa}=h("lsize"),{activeLabel:Ba}=h("activeLabel"),{label:ka}=h(["label","activeLabel"]),{degree:Ta}=h("degree"),{mtranspose:Aa}=h("mtranspose"),{ctranspose:Na}=h("ctranspose"),{harmonic:Ka}=h("harmonic"),{stepsPerOctave:Ha}=h("stepsPerOctave"),{octaveR:Pa}=h("octaveR"),{nudge:Ea}=h("nudge"),{octave:Da,oct:Ja}=h("octave","oct"),{orbit:Ia}=h("orbit","o"),{overgain:ja}=h("overgain"),{overshape:Oa}=h("overshape"),{pan:Ua}=h("pan"),{panspan:_a}=h("panspan"),{pansplay:Qa}=h("pansplay"),{panwidth:qa}=h("panwidth"),{panorient:$a}=h("panorient"),{rate:tl}=h("rate"),{slide:el}=h("slide"),{semitone:nl}=h("semitone"),{voice:sl}=h("voice"),{chord:ol}=h("chord"),{dictionary:cl,dict:rl}=h("dictionary","dict"),{anchor:il}=h("anchor"),{offset:ul}=h("offset"),{octaves:al}=h("octaves"),{mode:ll}=h(["mode","anchor"]),{room:dl}=h(["room","size"]),{roomlp:pl,rlp:hl}=h("roomlp","rlp"),{roomdim:fl,rdim:ml}=h("roomdim","rdim"),{roomfade:yl,rfade:bl}=h("roomfade","rfade"),{ir:gl,iresponse:Xl}=h(["ir","i"],"iresponse"),{irspeed:Gl}=h("irspeed"),{irbegin:Zl}=h("irbegin"),{roomsize:wl,size:Wl,sz:Fl,rsize:Vl}=h("roomsize","size","sz","rsize"),{shape:Cl}=h(["shape","shapevol"]),{distort:Ll,dist:zl}=h(["distort","distortvol","distorttype"],"dist"),{distortvol:Ml}=h("distortvol","distvol"),{distorttype:Rl}=h("distorttype","disttype"),{compressor:xl}=h(["compressor","compressorRatio","compressorKnee","compressorAttack","compressorRelease"]),{compressorKnee:vl}=h("compressorKnee"),{compressorRatio:Yl}=h("compressorRatio"),{compressorAttack:Sl}=h("compressorAttack"),{compressorRelease:Bl}=h("compressorRelease"),{speed:Rs}=h("speed"),{stretch:kl}=h("stretch"),{unit:Tl}=h("unit"),{squiz:Al}=h("squiz"),{vowel:Nl}=h("vowel"),{waveloss:Kl}=h("waveloss"),{density:Q1}=h("density"),{expression:Hl}=h("expression"),{sustainpedal:Pl}=h("sustainpedal"),{fshift:El}=h("fshift"),{fshiftnote:Dl}=h("fshiftnote"),{fshiftphase:Jl}=h("fshiftphase"),{triode:Il}=h("triode"),{krush:jl}=h("krush"),{kcutoff:Ol}=h("kcutoff"),{octer:Ul}=h("octer"),{octersub:_l}=h("octersub"),{octersubsub:Ql}=h("octersubsub"),{ring:ql}=h("ring"),{ringf:$l}=h("ringf"),{ringdf:td}=h("ringdf"),{freeze:ed}=h("freeze"),{xsdelay:nd}=h("xsdelay"),{tsdelay:sd}=h("tsdelay"),{real:od}=h("real"),{imag:cd}=h("imag"),{enhance:rd}=h("enhance"),{comb:id}=h("comb"),{smear:ud}=h("smear"),{scram:ad}=h("scram"),{binshift:ld}=h("binshift"),{hbrick:dd}=h("hbrick"),{lbrick:pd}=h("lbrick"),{frameRate:hd}=h("frameRate"),{frames:fd}=h("frames"),{hours:md}=h("hours"),{minutes:yd}=h("minutes"),{seconds:bd}=h("seconds"),{songPtr:gd}=h("songPtr"),{uid:Xd}=h("uid"),{val:Gd}=h("val"),{cps:Zd}=h("cps"),{clip:wd,legato:Wd}=h("clip","legato"),{duration:Fd,dur:Vd}=h("duration","dur"),{zrand:Cd}=h("zrand"),{curve:Ld}=h("curve"),{deltaSlide:zd}=h("deltaSlide"),{pitchJump:Md}=h("pitchJump"),{pitchJumpTime:Rd}=h("pitchJumpTime"),{lfo:xd,repeatTime:vd}=h("lfo","repeatTime"),{znoise:Yd}=h("znoise"),{zmod:Sd}=h("zmod"),{zcrush:Bd}=h("zcrush"),{zdelay:kd}=h("zdelay"),{zzfx:Td}=h("zzfx"),{color:Ad,colour:Nd}=h(["color","colour"]);let xs=(...t)=>t.reduce((e,n)=>Object.assign(e,{[n]:Hn(n)}),{});const Kd=G("adsr",(t,e)=>{t=Array.isArray(t)?t:[t];const[n,s,o,c]=t;return e.set({attack:n,decay:s,sustain:o,release:c})}),Hd=G("ad",(t,e)=>{t=Array.isArray(t)?t:[t];const[n,s=n]=t;return e.attack(n).decay(s)}),Pd=G("ds",(t,e)=>{t=Array.isArray(t)?t:[t];const[n,s=0]=t;return e.set({decay:n,sustain:s})}),Ed=G("ar",(t,e)=>{t=Array.isArray(t)?t:[t];const[n,s=n]=t;return e.set({attack:n,release:s})}),{midichan:Dd}=h("midichan"),{midimap:Jd}=h("midimap"),{midiport:Id}=h("midiport"),{midicmd:jd}=h("midicmd"),Od=G("control",(t,e)=>{if(!Array.isArray(t))throw new Error("control expects an array of [ccn, ccv]");const[n,s]=t;return e.ccn(n).ccv(s)}),{ccn:Ud}=h("ccn"),{ccv:_d}=h("ccv"),{ctlNum:Qd}=h("ctlNum"),{nrpnn:qd}=h("nrpnn"),{nrpv:$d}=h("nrpv"),{progNum:t0}=h("progNum"),e0=G("sysex",(t,e)=>{if(!Array.isArray(t))throw new Error("sysex expects an array of [id, data]");const[n,s]=t;return e.sysexid(n).sysexdata(s)}),{sysexid:n0}=h("sysexid"),{sysexdata:s0}=h("sysexdata"),{midibend:o0}=h("midibend"),{miditouch:c0}=h("miditouch"),{polyTouch:r0}=h("polyTouch"),{oschost:i0}=h("oschost"),{oscport:u0}=h("oscport"),vs=t=>mn.has(t)?mn.get(t):t,a0=G("as",(t,e)=>(t=Array.isArray(t)?t:[t],e.fmap(n=>(n=Array.isArray(n)?n:[n],n=Object.fromEntries(t.map((s,o)=>[vs(s),n[o]])),n)))),l0=G("scrub",(t,e)=>t.outerBind(n=>{Array.isArray(n)||(n=[n]);const[s,o=1]=n;return e.begin(s).mul(Rs(o)).clip(1)}),!1),q1=Object.freeze(Object.defineProperty({__proto__:null,accelerate:yr,activeLabel:Ba,ad:Hd,adsr:Kd,amp:Gr,analyze:Br,anchor:il,ar:Ed,as:a0,att:wr,attack:Zr,bandf:Dr,bandq:jr,bank:Yr,bbexpr:yi,bbst:gi,begin:Ur,binshift:ld,bp:Ir,bpa:Qi,bpattack:_i,bpd:su,bpdc:Ru,bpdecay:nu,bpdepth:Lu,bpdepthfrequency:zu,bpe:Ji,bpenv:Di,bpf:Jr,bpq:Or,bpr:mu,bprate:Vu,bprelease:fu,bps:au,bpshape:Mu,bpskew:xu,bpsustain:uu,bpsync:Cu,byteBeatExpression:mi,byteBeatStartTime:bi,ccn:Ud,ccv:_d,ch:Gi,channel:Si,channels:Xi,chord:ol,chorus:Sr,clip:wd,coarse:si,color:Ad,colour:Nd,comb:id,compressor:xl,compressorAttack:Sl,compressorKnee:vl,compressorRatio:Yl,compressorRelease:Bl,control:Od,cps:Zd,createParam:Hn,createParams:xs,crush:ni,ctf:Ti,ctlNum:Qd,ctranspose:Na,curve:Ld,cut:Bi,cutoff:ki,dec:Ar,decay:Tr,degree:Ta,delay:ta,delayfb:na,delayfeedback:ea,delayspeed:oa,delaysync:ua,delayt:ra,delaytime:ca,deltaSlide:zd,density:Q1,det:da,detune:la,dfb:sa,dict:rl,dictionary:cl,dist:zl,distort:Ll,distorttype:Rl,distortvol:Ml,djf:$u,drive:li,dry:fa,ds:Pd,dt:ia,duck:di,duckattack:fi,duckdepth:pi,duckonset:hi,dur:Vd,duration:Fd,end:_r,enhance:rd,expression:Hl,fadeInTime:ba,fadeOutTime:ya,fadeTime:ma,fanchor:bu,fft:kr,fm:Vr,fmattack:Lr,fmdecay:Mr,fmenv:Cr,fmh:Wr,fmi:Fr,fmrelease:xr,fmsustain:Rr,fmvelocity:vr,fmwave:zr,frameRate:hd,frames:fd,freeze:ed,freq:ga,fshift:El,fshiftnote:Dl,fshiftphase:Jl,ftype:yu,gain:gr,gat:xa,gate:Ra,getControlName:vs,harmonic:Ka,hbrick:dd,hcutoff:Iu,hold:Er,hours:md,hp:Ou,hpa:Ui,hpattack:Oi,hpd:eu,hpdc:Au,hpdecay:tu,hpdepth:Su,hpdepthfreq:Bu,hpdepthfrequency:ku,hpe:Ei,hpenv:Pi,hpf:ju,hpq:_u,hpr:hu,hprate:vu,hprelease:pu,hps:iu,hpshape:Tu,hpskew:Nu,hpsustain:ru,hpsync:Yu,hresonance:Uu,imag:cd,ir:gl,irbegin:Zl,iresponse:Xl,irspeed:Gl,isControlName:Vc,kcutoff:Ol,krush:jl,label:ka,lbrick:pd,legato:Wd,leslie:va,lfo:xd,lock:aa,loop:Qr,loopBegin:qr,loopEnd:ti,loopb:$r,loope:ei,lp:Ni,lpa:ji,lpattack:Ii,lpd:$i,lpdc:Wu,lpdecay:qi,lpdepth:Gu,lpdepthfrequency:Zu,lpe:Hi,lpenv:Ki,lpf:Ai,lpq:qu,lpr:du,lprate:gu,lprelease:lu,lps:cu,lpshape:wu,lpskew:Fu,lpsustain:ou,lpsync:Xu,lrate:Ya,lsize:Sa,midibend:o0,midichan:Dd,midicmd:jd,midimap:Jd,midiport:Id,miditouch:c0,minutes:yd,mode:ll,mtranspose:Aa,n:fr,noise:Eu,note:mr,nrpnn:qd,nrpv:$d,nudge:Ea,oct:Ja,octave:Da,octaveR:Pa,octaves:al,octer:Ul,octersub:_l,octersubsub:Ql,offset:ul,orbit:Ia,oschost:i0,oscport:u0,overgain:ja,overshape:Oa,pan:Ua,panchor:Ma,panorient:$a,panspan:_a,pansplay:Qa,panwidth:qa,patt:Ga,pattack:Xa,pcurve:za,pdec:wa,pdecay:Za,penv:La,ph:Vi,phasdp:Yi,phaser:Ci,phasercenter:Mi,phaserdepth:xi,phaserrate:Fi,phasersweep:Li,phc:Ri,phd:vi,phs:zi,pitchJump:Md,pitchJumpTime:Rd,polyTouch:r0,postgain:Xr,prel:Ca,prelease:Va,progNum:t0,psus:Fa,psustain:Wa,pw:Zi,pwrate:wi,pwsweep:Wi,rate:tl,rdim:ml,real:od,registerControl:h,rel:Pr,release:Hr,repeatTime:vd,resonance:Qu,rfade:bl,ring:ql,ringdf:td,ringf:$l,rlp:hl,room:dl,roomdim:fl,roomfade:yl,roomlp:pl,roomsize:wl,rsize:Vl,s:Cc,scram:ad,scrub:l0,seconds:bd,semitone:nl,shape:Cl,size:Wl,slide:el,smear:ud,songPtr:gd,sound:Lc,source:pr,speed:Rs,spread:ha,squiz:Al,src:hr,stepsPerOctave:Ha,stretch:kl,sus:Kr,sustain:Nr,sustainpedal:Pl,sysex:e0,sysexdata:s0,sysexid:n0,sz:Fl,tremolo:oi,tremolodepth:ri,tremolophase:ui,tremoloshape:ai,tremoloskew:ii,tremolosync:ci,triode:Il,tsdelay:sd,uid:Xd,unison:pa,unit:Tl,v:Pu,val:Gd,velocity:br,vib:Ku,vibmod:Du,vibrato:Hu,vmod:Ju,voice:sl,vowel:Nl,warp:Jc,warpatt:Oc,warpattack:jc,warpdc:or,warpdec:_c,warpdecay:Uc,warpdepth:nr,warpenv:lr,warpmode:rr,warprate:er,warprel:tr,warprelease:$c,warpshape:sr,warpskew:cr,warpsus:qc,warpsustain:Qc,warpsync:dr,waveloss:Kl,wavetablePhaseRand:ar,wavetablePosition:Mc,wavetableWarp:Ic,wavetableWarpMode:ir,wt:zc,wtatt:vc,wtattack:xc,wtdc:Ec,wtdec:Sc,wtdecay:Yc,wtdepth:Hc,wtenv:Rc,wtphaserand:ur,wtrate:Nc,wtrel:Ac,wtrelease:Tc,wtshape:Pc,wtskew:Dc,wtsus:kc,wtsustain:Bc,wtsync:Kc,xsdelay:nd,zcrush:Bd,zdelay:kd,zmod:Sd,znoise:Yd,zrand:Cd,zzfx:Td},Symbol.toStringTag,{value:"Module"})),$1=function(t,e){const[n,s]=t,[o,c]=e,[i,u]=ms(s,o);return[[s,n-s],[kn((a,l)=>a.concat(l),i,c),u]]},ty=function(t,e){const[n,s]=t,[o,c]=e,[i,u]=ms(n,c);return[[n,s-n],[kn((l,p)=>l.concat(p),o,i),u]]},d0=function(t,e){const[n,s]=t;return Math.min(n,s)<=1?[t,e]:d0(...n>s?$1(t,e):ty(t,e))},Ys=function(t,e){const n=t<0,s=Math.abs(t),o=e-s,c=Array(s).fill([1]),i=Array(o).fill([0]),u=d0([s,o],[c,i]),a=ue(u[1][0]).concat(ue(u[1][1]));return n?a.map(l=>1-l):a},Pn=function(t,e,n){const s=Ys(t,e);return n?No(s,-n):s},ey=G("euclid",function(t,e,n){return n.struct(Pn(t,e,0))}),ny=G("bjork",function(t,e){Array.isArray(t)||(t=[t]);const[n,s=n,o=0]=t;return e.struct(Pn(n,s,o))}),{euclidrot:sy,euclidRot:oy}=G(["euclidrot","euclidRot"],function(t,e,n,s){return s.struct(Pn(t,e,n))}),p0=function(t,e,n,s){if(t<1)return nt;const c=Pn(t,e,0).join("").split("1").slice(1).map(i=>[i.length+1,!0]);return s.struct(zs(...c)).late(C(n).div(e))},cy=G(["euclidLegato"],function(t,e,n){return p0(t,e,0,n)}),ry=G(["euclidLegatoRot"],function(t,e,n,s){return p0(t,e,n,s)}),{euclidish:iy,eish:uy}=G(["euclidish","eish"],function(t,e,n,s){const o=Ms(Ys(t,e),new Array(t).fill(1),n);return s.struct(o).setSteps(e)});function h0(t,e,n=.05,s=.1,o=.1,c=globalThis.setInterval,i=globalThis.clearInterval,u=!0){let a=0,l=0,p=10**4,f=.01;const b=x=>n=x(n);o=o||s/2;const g=()=>{const x=t(),R=x+s+o;for(l===0&&(l=x+f);l<R;)l=u?Math.round(l*p)/p:l,e(l,n,a,x),l+=n,a++};let X;const Z=()=>{W(),g(),X=c(g,s*1e3)},W=()=>{X!==void 0&&i(X),X=void 0};return{setDuration:b,start:Z,stop:()=>{a=0,l=0,W()},pause:()=>W(),duration:n,interval:s,getPhase:()=>l,minLatency:f}}function ay(t){return new L(e=>[new bt(void 0,e.span,t)])}const Kt=t=>{const e=n=>[new bt(void 0,n.span,t(n.span.begin))];return new L(e)},yn=Kt(t=>t%1),Ss=yn.toBipolar(),En=Kt(t=>1-t%1),Bs=En.toBipolar(),ks=Kt(t=>Math.sin(Math.PI*2*t)),f0=ks.fromBipolar(),ly=f0._early(C(1).div(4)),dy=ks._early(C(1).div(4)),m0=Kt(t=>Math.floor(t*2%2)),py=m0.toBipolar(),hy=Ct(yn,En),fy=Ct(Ss,Bs),my=Ct(En,yn),yy=Ct(Bs,Ss),Ts=Kt(Ke);let As=0,Ns=0;typeof window<"u"&&document.addEventListener("mousemove",t=>{As=t.clientY/document.body.clientHeight,Ns=t.clientX/document.body.clientWidth});const by=Kt(()=>As),gy=Kt(()=>As),Xy=Kt(()=>Ns),Gy=Kt(()=>Ns),y0=t=>{const e=t<<13^t,n=e>>17^e;return n<<5^n},Zy=t=>t-Math.trunc(t),b0=t=>y0(Math.trunc(Zy(t/300)*536870912)),g0=t=>t%536870912/536870912,bn=t=>Math.abs(g0(b0(t))),wy=(t,e)=>{const n=[];for(let s=0;s<e;++s)n.push(g0(t)),t=y0(t);return n},X0=(t,e)=>wy(b0(t),e),G0=t=>yn.range(0,t).round().segment(t),Wy=t=>{const e=V(t).log2(0).floor().add(1);return Z0(t,e)},Z0=(t,e=16)=>{e=V(e);const n=G0(e).mul(-1).add(e.sub(1));return V(t).segment(e).brshift(n).band(gt(1))},Fy=t=>{const e=V(t).log2(0).floor().add(1);return w0(t,e)},w0=(t,e=16)=>V(t).withValue(n=>s=>{const o=[];for(let c=s-1;c>=0;c--)o.push(n>>c&1);return o}).appLeft(V(e)),Vy=t=>Kt(e=>n=>X0(e,n).map(Math.abs)).appLeft(V(t)),W0=t=>Kt(e=>{const s=X0(e.floor().add(.5),t).map((c,i)=>[c,i]).sort((c,i)=>(c[0]>i[0])-(c[0]<i[0])).map(c=>c[1]),o=e.cyclePos().mul(t).floor()%t;return s[o]})._segment(t),F0=(t,e,n)=>{const s=[...Array(e).keys()].map(o=>n.zoom(C(o).div(e),C(o+1).div(e)));return t.fmap(o=>s[o].repeatCycles(e)._fast(e)).innerJoin()},Cy=G("shuffle",(t,e)=>F0(W0(t),t,e)),Ly=G("scramble",(t,e)=>F0(Hs(t)._segment(t),t,e)),Mt=Kt(bn),zy=Mt.toBipolar(),Ks=t=>Mt.fmap(e=>e<t),My=t=>V(t).fmap(Ks).innerJoin(),Ry=Ks(.5),Hs=t=>Mt.fmap(e=>Math.trunc(e*t)),xy=t=>V(t).fmap(Hs).innerJoin(),Ps=(t,e)=>(e=e.map(V),e.length==0?nt:t.range(0,e.length).fmap(n=>{const s=Math.min(Math.max(Math.floor(n),0),e.length-1);return e[s]})),Dn=(t,e)=>Ps(t,e).outerJoin(),Jn=(t,e)=>Ps(t,e).innerJoin(),V0=(...t)=>Dn(Mt,t),vy=(...t)=>Jn(Mt,t),Yy=V0;L.prototype.choose=function(...t){return Dn(this,t)},L.prototype.choose2=function(...t){return Dn(this.fromBipolar(),t)};const C0=(...t)=>Jn(Mt.segment(1),t),Sy=C0,L0=function(t,...e){const n=e.map(u=>V(u[0])),s=[];let o=gt(0);for(const u of e)o=o.add(u[1]),s.push(o);const c=qo(s),i=function(u){const a=o.mul(u);return c.fmap(l=>p=>n[l.findIndex(f=>f>p,l)]).appLeft(a)};return t.bind(i)},By=(...t)=>L0(...t).outerJoin(),ky=(...t)=>By(Mt,...t),z0=(...t)=>L0(Mt.segment(1),...t).innerJoin(),Ty=z0;function Ay(t){let e=Math.floor(t),n=e+1;const s=i=>6*i**5-15*i**4+10*i**3;return(i=>u=>a=>u+s(i)*(a-u))(t-e)(bn(e))(bn(n))}const M0=t=>t.fmap(Ay);function Ny(t){const e=Math.floor(t),n=e+1,s=bn(e),o=bn(n)+s,c=(t-e)/(n-e);return((u,a,l)=>u+(a-u)*l)(s,o,c)/2}const R0=t=>t.fmap(Ny),Ky=M0(Ts.fmap(t=>Number(t))),Hy=R0(Ts.fmap(t=>Number(t))),Py=G("degradeByWith",(t,e,n)=>n.fmap(s=>o=>s).appLeft(t.filterValues(s=>s>e)),!0,!0),Ey=G("degradeBy",function(t,e){return e._degradeByWith(Mt,t)},!0,!0),Dy=G("degrade",t=>t._degradeBy(.5),!0,!0),Jy=G("undegradeBy",function(t,e){return e._degradeByWith(Mt.fmap(n=>1-n),t)},!0,!0),Iy=G("undegrade",t=>t._undegradeBy(.5),!0,!0),jy=G("sometimesBy",function(t,e,n){return V(t).fmap(s=>ft(n._degradeBy(s),e(n._undegradeBy(1-s)))).innerJoin()}),Oy=G("sometimes",function(t,e){return e._sometimesBy(.5,t)}),Uy=G("someCyclesBy",function(t,e,n){return V(t).fmap(s=>ft(n._degradeByWith(Mt._segment(1),s),e(n._degradeByWith(Mt.fmap(o=>1-o)._segment(1),1-s)))).innerJoin()}),_y=G("someCycles",function(t,e){return e._someCyclesBy(.5,t)}),Qy=G("often",function(t,e){return e.sometimesBy(.75,t)}),qy=G("rarely",function(t,e){return e.sometimesBy(.25,t)}),$y=G("almostNever",function(t,e){return e.sometimesBy(.1,t)}),tb=G("almostAlways",function(t,e){return e.sometimesBy(.9,t)}),eb=G("never",function(t,e){return e}),nb=G("always",function(t,e){return t(e)});function Es(t){Array.isArray(t)===!1&&(t=[t]);const e=Uo();return t.every(n=>{const s=Oo.get(n)??n;return e[s]})}const sb=G("whenKey",function(t,e,n){return n.when(Es(t),e)}),ob=G("keyDown",function(t){return t.fmap(Es)}),ne=function(t,e,n=!0){const s=Array.isArray(t),o=Object.keys(t).length;return t=Io(t,V),o===0?nt:e.fmap(c=>{let i=c;return s&&(i=n?Math.round(i)%o:Tn(Math.round(i),0,t.length-1)),t[i]})},x0=function(t,e){return Array.isArray(e)&&([e,t]=[t,e]),cb(t,e)},cb=G("pick",function(t,e){return ne(t,e,!1).innerJoin()}),v0=G("pickmod",function(t,e){return ne(t,e,!0).innerJoin()}),rb=G("pickF",function(t,e,n){return n.apply(x0(t,e))}),ib=G("pickmodF",function(t,e,n){return n.apply(v0(t,e))}),ub=G("pickOut",function(t,e){return ne(t,e,!1).outerJoin()}),ab=G("pickmodOut",function(t,e){return ne(t,e,!0).outerJoin()}),lb=G("pickRestart",function(t,e){return ne(t,e,!1).restartJoin()}),db=G("pickmodRestart",function(t,e){return ne(t,e,!0).restartJoin()}),pb=G("pickReset",function(t,e){return ne(t,e,!1).resetJoin()}),hb=G("pickmodReset",function(t,e){return ne(t,e,!0).resetJoin()}),{inhabit:fb,pickSqueeze:mb}=G(["inhabit","pickSqueeze"],function(t,e){return ne(t,e,!1).squeezeJoin()}),{inhabitmod:yb,pickmodSqueeze:bb}=G(["inhabitmod","pickmodSqueeze"],function(t,e){return ne(t,e,!0).squeezeJoin()}),gb=(t,e)=>(e=e.map(V),e.length==0?nt:t.fmap(n=>{const s=dn(Math.round(n),e.length);return e[s]}).squeezeJoin());let In;try{In=window?.speechSynthesis}catch{console.warn("cannot use window: not in browser?")}let Y0=In?.getVoices();function Xb(t,e,n){In.cancel();const s=new SpeechSynthesisUtterance(t);s.lang=e,Y0=In.getVoices();const o=Y0.filter(c=>c.lang.includes(e));typeof n=="number"?s.voice=o[n%o.length]:typeof n=="string"&&(s.voice=o.find(c=>c.name===c)),speechSynthesis.speak(s)}const Gb=G("speak",function(t,e,n){return n.onTrigger(s=>{Xb(s.value,t,e)})}),S0={},B0=async(...t)=>{const e=await Promise.allSettled(t),n=e.filter(s=>s.status==="fulfilled").map(s=>s.value);return e.forEach((s,o)=>{s.status==="rejected"&&console.warn(`evalScope: module with index ${o} could not be loaded:`,s.reason)}),n.forEach(s=>{Object.entries(s).forEach(([o,c])=>{globalThis[o]=c,S0[o]=c})}),n};function Zb(t,e={}){const{wrapExpression:n=!0,wrapAsync:s=!0}=e;n&&(t=`{${t}}`),s&&(t=`(async ()=>${t})()`);const o=`"use strict";return (${t})`;return Function(o)()}const k0=async(t,e,n)=>{let s={};if(e){const i=e(t,n);t=i.output,s=i}return{mode:"javascript",pattern:await Zb(t,{wrapExpression:!!e}),meta:s}},T0=`(function(){"use strict";function L(){return performance.now()*.001}let _=0,r=0,o=.5;const h=new Map,m=.1,M=new BroadcastChannel("strudeltick"),b=(s,e)=>{M.postMessage({type:s,payload:e})},C=E(L,(s,e,t,n)=>{const i=r*e,d=s-n,c=n+d,u=i*o,l=_+u,g=n-c-e,f=e*o,p=l+f,y=l+g*o;b("tick",{begin:l,end:p,cps:o,time:n,cycle:y}),r++},m);let k=!1;const I=s=>{h.set(s,{started:!0}),!k&&(C.start(),k=!0)},A=async s=>{h.set(s,{started:!1});const e=Array.from(h.values()).some(t=>t.started);!k||e||(C.stop(),w(0),k=!1)},w=s=>{r=0,_=s},D=s=>{const{type:e,payload:t}=s;switch(e){case"cpschange":{if(t.cps!==o){const n=r*m;_=_+n*o,o=t.cps,r=0}break}case"setcycle":{w(t.cycle);break}case"toggle":{t.started?I(s.id):A(s.id);break}}};self.onconnect=function(s){const e=s.ports[0];e.addEventListener("message",function(t){D(t.data)}),e.start()};function E(s,e,t=.05,n=.1,i=.1){let d=0,c=0,u=10**4,l=.01;const g=a=>t=a(t);i=i||n/2;const f=()=>{const a=s(),O=a+n+i;for(c===0&&(c=a+l);c<O;)c=Math.round(c*u)/u,c>=a&&e(c,t,d,a),c<a&&console.log("TOO LATE",c),c+=t,d++};let p;const y=()=>{T(),f(),p=setInterval(f,n*1e3)},T=()=>p!==void 0&&clearInterval(p);return{setDuration:g,start:y,stop:()=>{d=0,c=0,T()},pause:()=>T(),duration:t,interval:n,getPhase:()=>c,minLatency:l}}})();
`,A0=typeof self<"u"&&self.Blob&&new Blob(["(self.URL || self.webkitURL).revokeObjectURL(self.location.href);",T0],{type:"text/javascript;charset=utf-8"});function wb(t){let e;try{if(e=A0&&(self.URL||self.webkitURL).createObjectURL(A0),!e)throw"";const n=new Worker(e,{name:t?.name});return n.addEventListener("error",()=>{(self.URL||self.webkitURL).revokeObjectURL(e)}),n}catch{return new Worker("data:text/javascript;charset=utf-8,"+encodeURIComponent(T0),{name:t?.name})}}class Wb{constructor({onTrigger:e,onToggle:n,getTime:s}){this.started=!1,this.cps=.5,this.getTime=s,this.time_at_last_tick_message=0,this.collator=new jo({getTargetClockTime:s}),this.onToggle=n,this.latency=.1,this.cycle=0,this.id=Math.round(Date.now()*Math.random()),this.worker=new SharedWorker(wb),this.worker.port.start(),this.channel=new BroadcastChannel("strudeltick");const o=i=>{const{cps:u,begin:a,end:l,cycle:p,time:f}=i;this.cps=u,this.cycle=p;const b=this.collator.calculateOffset(f)+f;c(a,l,b),this.time_at_last_tick_message=b},c=(i,u,a)=>{if(this.started===!1)return;this.pattern.queryArc(i,u,{_cps:this.cps,cyclist:"neocyclist"}).forEach(p=>{if(p.hasOnset()){const b=ys(p.whole.begin-this.cycle,this.cps)+a+this.latency,g=ys(p.duration,this.cps);e?.(p,0,g,this.cps,b)}})};this.channel.onmessage=i=>{if(!this.started)return;const{payload:u,type:a}=i.data;switch(a){case"tick":o(u)}}}sendMessage(e,n){this.worker.port.postMessage({type:e,payload:n,id:this.id})}now(){const e=(this.getTime()-this.time_at_last_tick_message)*this.cps;return this.cycle+e}setCps(e=1){this.sendMessage("cpschange",{cps:e})}setCycle(e){this.sendMessage("setcycle",{cycle:e})}setStarted(e){this.sendMessage("toggle",{started:e}),this.started=e,this.onToggle?.(e)}start(){Yt("[cyclist] start"),this.setStarted(!0)}stop(){Yt("[cyclist] stop"),this.collator.reset(),this.setStarted(!1)}setPattern(e,n=!1){this.pattern=e,n&&!this.started&&this.start()}log(e,n,s){const o=s.filter(c=>c.hasOnset());console.log(`${e.toFixed(4)} - ${n.toFixed(4)} ${Array(o.length).fill("I").join("")}`)}}class N0{constructor({interval:e,onTrigger:n,onToggle:s,onError:o,getTime:c,latency:i=.1,setInterval:u,clearInterval:a,beforeStart:l}){this.started=!1,this.beforeStart=l,this.cps=.5,this.num_ticks_since_cps_change=0,this.lastTick=0,this.lastBegin=0,this.lastEnd=0,this.getTime=c,this.num_cycles_at_cps_change=0,this.seconds_at_cps_change,this.onToggle=s,this.latency=i,this.clock=h0(c,(p,f,b,g)=>{this.num_ticks_since_cps_change===0&&(this.num_cycles_at_cps_change=this.lastEnd,this.seconds_at_cps_change=p),this.num_ticks_since_cps_change++;const Z=this.num_ticks_since_cps_change*f*this.cps;try{const W=this.lastEnd;this.lastBegin=W;const F=this.num_cycles_at_cps_change+Z;if(this.lastEnd=F,this.lastTick=p,p<g){console.log("skip query: too late");return}this.pattern.queryArc(W,F,{_cps:this.cps,cyclist:"cyclist"}).forEach(v=>{if(v.hasOnset()){const x=(v.whole.begin-this.num_cycles_at_cps_change)/this.cps+this.seconds_at_cps_change+i,R=v.duration/this.cps,A=x-p;n?.(v,A,R,this.cps,x),v.value.cps!==void 0&&this.cps!=v.value.cps&&(this.cps=v.value.cps,this.num_ticks_since_cps_change=0)}})}catch(W){Sn(W),o?.(W)}},e,.1,.1,u,a)}now(){if(!this.started)return 0;const e=this.getTime()-this.lastTick-this.clock.duration;return this.lastBegin+e*this.cps}setStarted(e){this.started=e,this.onToggle?.(e)}async start(){if(await this.beforeStart?.(),this.num_ticks_since_cps_change=0,this.num_cycles_at_cps_change=0,!this.pattern)throw new Error("Scheduler: no pattern set! call .setPattern first.");Yt("[cyclist] start"),this.clock.start(),this.setStarted(!0)}pause(){Yt("[cyclist] pause"),this.clock.pause(),this.setStarted(!1)}stop(){Yt("[cyclist] stop"),this.clock.stop(),this.lastEnd=0,this.setStarted(!1)}async setPattern(e,n=!1){this.pattern=e,n&&!this.started&&await this.start()}setCps(e=.5){this.cps!==e&&(this.cps=e,this.num_ticks_since_cps_change=0)}log(e,n,s){const o=s.filter(c=>c.hasOnset());console.log(`${e.toFixed(4)} - ${n.toFixed(4)} ${Array(o.length).fill("I").join("")}`)}}let Ds;function Js(){if(!Ds)throw new Error("no time set! use setTime to define a time source");return Ds()}function Is(t){Ds=t}function Fb({defaultOutput:t,onEvalError:e,beforeEval:n,beforeStart:s,afterEval:o,getTime:c,transpiler:i,onToggle:u,editPattern:a,onUpdateState:l,sync:p=!1,setInterval:f,clearInterval:b,id:g,mondo:X=!1}){const Z={schedulerError:void 0,evalError:void 0,code:"// LOADING",activeCode:"// LOADING",pattern:void 0,miniLocations:[],widgets:[],pending:!1,started:!1},W={id:g},F=K=>{Object.assign(Z,K),Z.isDirty=Z.code!==Z.activeCode,Z.error=Z.evalError||Z.schedulerError,l?.(Z)},z={onTrigger:K0({defaultOutput:t,getTime:c}),getTime:c,onToggle:K=>{F({started:K}),u?.(K)},setInterval:f,clearInterval:b,beforeStart:s},v=p&&typeof SharedWorker<"u"?new Wb(z):new N0(z);let x={},R=0,A;const O=function(){return x={},R=0,A=void 0,nt};function j(K){return K._Pattern?K.__pure:K}const tt=async(K,J=!0)=>(K=a?.(K)||K,await v.setPattern(K,J),K);Is(()=>v.now());const k=()=>v.stop(),it=()=>v.start(),H=()=>v.pause(),Q=()=>v.toggle(),U=K=>(v.setCps(j(K)),nt),dt=K=>(v.setCps(j(K)/60),nt);let q=[];const st=function(K){return q.push(K),nt},pt=function(K){return A=K,nt},Vt=()=>{L.prototype.p=function(J){return typeof J=="string"&&(J.startsWith("_")||J.endsWith("_"))?nt:(J.includes("$")&&(J=`${J}${R}`,R++),x[J]=this,this)},L.prototype.q=function(J){return nt};try{for(let J=1;J<10;++J)Object.defineProperty(L.prototype,`d${J}`,{get(){return this.p(J)},configurable:!0}),Object.defineProperty(L.prototype,`p${J}`,{get(){return this.p(J)},configurable:!0}),L.prototype[`q${J}`]=nt}catch(J){console.warn("injectPatternMethods: error:",J)}const K=G("cpm",function(J,$t){return $t._fast(J/60/v.cps)});return B0({all:st,each:pt,hush:O,cpm:K,setCps:U,setcps:U,setCpm:dt,setcpm:dt})};return{scheduler:v,evaluate:async(K,J=!0,$t=!0)=>{if(!K)throw new Error("no code to evaluate");try{F({code:K,pending:!0}),await Vt(),Is(()=>v.now()),await n?.({code:K}),q=[],$t&&O(),X&&(K=`mondolang\`${K}\``);let{pattern:rt,meta:oe}=await k0(K,i,W);if(Object.keys(x).length){let Lt=[],$=!1;for(const[ot,Jt]of Object.entries(x)){const It=ot.length>1&&ot.startsWith("S");if(It&&$===!1&&(Lt=[],$=!0),!$||$&&It){const Zt=Jt.withState(Ge=>Ge.setControls({id:ot}));Lt.push(Zt)}}A&&(Lt=Lt.map(ot=>A(ot))),rt=ft(...Lt)}else A&&(rt=A(rt));if(q.length)for(const Lt of q)rt=Lt(rt);return Gs(rt)||(rt=nt),Yt("[eval] code updated"),rt=await tt(rt,J),F({miniLocations:oe?.miniLocations||[],widgets:oe?.widgets||[],activeCode:K,pattern:rt,evalError:void 0,schedulerError:void 0,pending:!1}),o?.({code:K,pattern:rt,meta:oe}),rt}catch(rt){Yt(`[eval] error: ${rt.message}`,"error"),console.error(rt),F({evalError:rt,pending:!1}),e?.(rt)}},start:it,stop:k,pause:H,setCps:U,setPattern:tt,setCode:K=>F({code:K}),toggle:Q,state:Z}}const K0=({getTime:t,defaultOutput:e})=>async(n,s,o,c,i)=>{try{(!n.context.onTrigger||!n.context.dominantTrigger)&&await e(n,s,o,c,i),n.context.onTrigger&&await n.context.onTrigger(n,t(),c,i)}catch(u){Sn(u,"getTrigger")}},Vb=function(t,e={}){const n=document.getElementById("code"),s="background-image:url("+t+");background-size:contain;";n.style=s;const{className:o}=n,c=(a,l)=>{({style:()=>n.style=s+";"+l,className:()=>n.className=l+" "+o})[a]()},i=Object.entries(e).filter(([a,l])=>typeof l=="function");Object.entries(e).filter(([a,l])=>typeof l=="string").forEach(([a,l])=>c(a,l)),i.length},Cb=()=>{const t=document.getElementById("code");t&&(t.style="")};Yt("🌀 @strudel/core loaded 🌀"),globalThis._strudelLoaded&&console.warn(`@strudel/core was loaded more than once...
This might happen when you have multiple versions of strudel installed. 
Please check with "npm ls @strudel/core".`),globalThis._strudelLoaded=!0;const js=Object.freeze(Object.defineProperty({__proto__:null,ClockCollator:jo,Cyclist:N0,Fraction:C,Hap:bt,Pattern:L,State:He,TimeSpan:yt,__chooseWith:Ps,_brandBy:Ks,_fitslice:rc,_irand:Hs,_keyDown:Es,_match:ic,_mod:dn,_morph:Ms,_polymeterListSteps:ac,_retime:Cs,_slices:Ls,accelerate:yr,activeLabel:Ba,ad:Hd,add:Ff,adsr:Kd,almostAlways:tb,almostNever:$y,always:nb,amp:Gr,analyze:Br,anchor:il,and:Ef,apply:Xm,applyN:cc,ar:Ed,arp:nf,arpWith:ef,arrange:af,as:a0,att:wr,attack:Zr,averageArray:ko,backgroundImage:Vb,band:Rf,bandf:Dr,bandq:jr,bank:Yr,base64ToUnicode:Jo,bbexpr:yi,bbst:gi,beat:I1,begin:Ur,berlin:Hy,berlinWith:R0,binary:Wy,binaryL:Fy,binaryN:Z0,binaryNL:w0,bind:mf,binshift:ld,bite:Vm,bjork:ny,bjorklund:Ys,blshift:Yf,bor:xf,bp:Ir,bpa:Qi,bpattack:_i,bpd:su,bpdc:Ru,bpdecay:nu,bpdepth:Lu,bpdepthfrequency:zu,bpe:Ji,bpenv:Di,bpf:Jr,bpq:Or,bpr:mu,bprate:Vu,bprelease:fu,bps:au,bpshape:Mu,bpskew:xu,bpsustain:uu,bpsync:Cu,brak:Bm,brand:Ry,brandBy:My,brshift:Sf,bxor:vf,bypass:p1,byteBeatExpression:mi,byteBeatStartTime:bi,calculateSteps:qh,cat:fn,ccn:Ud,ccv:_d,ceil:Of,ch:Gi,channel:Si,channels:Xi,choose:V0,chooseCycles:C0,chooseIn:vy,chooseInWith:Jn,chooseOut:Yy,chooseWith:Dn,chop:k1,chord:ol,chorus:Sr,chunk:e1,chunkBack:o1,chunkBackInto:d1,chunkInto:a1,chunkback:c1,chunkbackinto:l1,chunkinto:u1,clamp:Tn,cleanupUi:Cb,clip:wd,coarse:si,code2hash:Jh,color:Ad,colour:Nd,comb:id,compose:Yh,compress:em,compressSpan:nm,compressor:xl,compressorAttack:Sl,compressorKnee:vl,compressorRatio:Yl,compressorRelease:Bl,compressspan:sm,constant:Sh,contract:mc,control:Od,controls:q1,cosine:ly,cosine2:dy,cpm:Gm,cps:Zd,createClock:h0,createParam:Hn,createParams:xs,crush:ni,ctf:Ti,ctlNum:Qd,ctranspose:Na,curry:D,curve:Ld,cut:Bi,cutoff:ki,cycleToSeconds:ys,dec:Ar,decay:Tr,degrade:Dy,degradeBy:Ey,degradeByWith:Py,degree:Ta,delay:ta,delayfb:na,delayfeedback:ea,delayspeed:oa,delaysync:ua,delayt:ra,delaytime:ca,deltaSlide:zd,det:da,detune:la,dfb:sa,dict:rl,dictionary:cl,dist:zl,distort:Ll,distorttype:Rl,distortvol:Ml,div:Lf,djf:$u,drawLine:_o,drive:li,drop:pc,dry:fa,ds:Pd,dt:ia,duck:di,duckattack:fi,duckdepth:pi,duckonset:hi,dur:Vd,duration:Fd,early:Zm,echo:jm,echoWith:Em,echowith:Dm,eish:uy,end:_r,enhance:rd,eq:Nf,eqt:Kf,errorLogger:Sn,euclid:ey,euclidLegato:cy,euclidLegatoRot:ry,euclidRot:oy,euclidish:iy,euclidrot:sy,evalScope:B0,evaluate:k0,every:gm,expand:fc,expression:Hl,extend:hc,fadeInTime:ba,fadeOutTime:ya,fadeTime:ma,fanchor:bu,fast:lm,fastChunk:i1,fastGap:om,fastcat:Ct,fastchunk:r1,fastgap:cm,fft:kr,filter:b1,filterWhen:g1,firstOf:bm,fit:H1,flatten:ue,floor:jf,fm:Vr,fmattack:Lr,fmdecay:Mr,fmenv:Cr,fmh:Wr,fmi:Fr,fmrelease:xr,fmsustain:Rr,fmvelocity:vr,fmwave:zr,focus:rm,focusSpan:im,focusspan:um,fractionalArgs:Bh,frameRate:hd,frames:fd,freeze:ed,freq:ga,freqToMidi:ps,fromBipolar:_f,fshift:El,fshiftnote:Dl,fshiftphase:Jl,ftype:yu,func:Jf,gain:gr,gap:Pe,gat:xa,gate:Ra,getAccidentalsOffset:So,getControlName:vs,getCurrentKeyboardState:Uo,getEventOffsetMs:zh,getFreq:Bo,getFrequency:Ao,getPerformanceTimeSeconds:jh,getPlayableNoteValue:vh,getSoundIndex:xh,getTime:Js,getTrigger:K0,grow:Z1,gt:kf,gte:Af,harmonic:Ka,hash2code:Ih,hbrick:dd,hcutoff:Iu,hold:Er,hours:md,hp:Ou,hpa:Ui,hpattack:Oi,hpd:eu,hpdc:Au,hpdecay:tu,hpdepth:Su,hpdepthfreq:Bu,hpdepthfrequency:ku,hpe:Ei,hpenv:Pi,hpf:ju,hpq:_u,hpr:hu,hprate:vu,hprelease:pu,hps:iu,hpshape:Tu,hpskew:Nu,hpsustain:ru,hpsync:Yu,hresonance:Uu,hsl:y1,hsla:m1,hurry:dm,id:Ke,imag:cd,inhabit:fb,inhabitmod:yb,innerBind:yf,inside:fm,inv:vm,invert:xm,ir:gl,irand:xy,irbegin:Zl,iresponse:Xl,irspeed:Gl,isControlName:Vc,isNote:Bn,isNoteWithOctave:Fh,isPattern:Gs,isaw:En,isaw2:Bs,iter:Qm,iterBack:qm,iterback:$m,itri:my,itri2:yy,jux:Pm,juxBy:Km,juxby:Hm,kcutoff:Ol,keep:wf,keepif:Wf,keyAlias:Oo,keyDown:ob,krush:jl,label:ka,lastOf:ym,late:sc,lbrick:pd,legato:Wd,leslie:va,lfo:xd,linger:Cm,listRange:pn,lock:aa,logKey:ds,logger:Yt,loop:Qr,loopAt:N1,loopAtCps:P1,loopBegin:qr,loopEnd:ti,loopat:K1,loopatcps:E1,loopb:$r,loope:ei,lp:Ni,lpa:ji,lpattack:Ii,lpd:$i,lpdc:Wu,lpdecay:qi,lpdepth:Gu,lpdepthfrequency:Zu,lpe:Hi,lpenv:Ki,lpf:Ai,lpq:qu,lpr:du,lprate:gu,lprelease:lu,lps:cu,lpshape:wu,lpskew:Fu,lpsustain:ou,lpsync:Xu,lrate:Ya,lsize:Sa,lt:Bf,lte:Tf,mapArgs:fs,mask:df,midi2note:Rh,midiToFreq:Fe,midibend:o0,midichan:Dd,midicmd:jd,midimap:Jd,midiport:Id,miditouch:c0,minutes:yd,mod:zf,mode:ll,morph:j1,mouseX:Gy,mouseY:gy,mousex:Xy,mousey:by,mtranspose:Aa,mul:Cf,n:fr,nanFallback:To,ne:Hf,net:Pf,never:eb,noise:Eu,note:mr,noteToMidi:Ae,nothing:Nt,nrpnn:qd,nrpv:$d,nudge:Ea,numeralArgs:Tt,objectMap:Io,oct:Ja,octave:Da,octaveR:Pa,octaves:al,octer:Ul,octersub:_l,octersubsub:Ql,off:Sm,offset:ul,often:Qy,or:Df,orbit:Ia,oschost:i0,oscport:u0,outerBind:bf,outside:mm,overgain:ja,overshape:Oa,pace:uc,pairs:Po,palindrome:Nm,pan:Ua,panchor:Ma,panorient:$a,panspan:_a,pansplay:Qa,panwidth:qa,parray:Fc,parseFractional:Ho,parseNumeral:hs,partials:U1,patt:Ga,pattack:Xa,pcurve:za,pdec:wa,pdecay:Za,penv:La,perlin:Ky,perlinWith:M0,ph:Vi,phasdp:Yi,phaser:Ci,phasercenter:Mi,phaserdepth:xi,phaserrate:Fi,phasersweep:Li,phases:_1,phc:Ri,phd:vi,phs:zi,pick:x0,pickF:rb,pickOut:ub,pickReset:pb,pickRestart:lb,pickSqueeze:mb,pickmod:v0,pickmodF:ib,pickmodOut:ab,pickmodReset:hb,pickmodRestart:db,pickmodSqueeze:bb,pipe:Ko,pitchJump:Md,pitchJumpTime:Rd,ply:am,plyForEach:_m,plyWith:Um,pm:rf,polyBind:Gf,polyTouch:r0,polymeter:Nn,polyrhythm:of,postgain:Xr,pow:Mf,pr:cf,prel:Ca,prelease:Va,press:Am,pressBy:Tm,progNum:t0,psus:Fa,psustain:Wa,pure:gt,pw:Zi,pwrate:wi,pwsweep:Wi,rand:Mt,rand2:zy,randL:Vy,randcat:Sy,randrun:W0,range:Qf,range2:$f,rangex:qf,rarely:qy,rate:tl,ratio:tm,rdim:ml,real:od,ref:D1,register:G,registerControl:h,reify:V,rel:Pr,release:Hr,removeUndefineds:Ne,repeatCycles:t1,repeatTime:vd,repl:Fb,replicate:G1,resonance:Qu,rev:oc,revv:km,rfade:bl,rib:f1,ribbon:h1,ring:ql,ringdf:td,ringf:$l,rlp:hl,room:dl,roomdim:fl,roomfade:yl,roomlp:pl,roomsize:wl,rotate:No,round:If,rsize:Vl,run:G0,s:Cc,s_add:z1,s_alt:F1,s_cat:W1,s_contract:v1,s_expand:R1,s_extend:x1,s_polymeter:V1,s_sub:M1,s_taper:C1,s_taperlist:L1,s_tour:Y1,s_zip:S1,saw:yn,saw2:Ss,scram:ad,scramble:Ly,scrub:l0,seconds:bd,seg:zm,segment:Lm,semitone:nl,seq:nc,seqPLoop:lf,sequence:_t,sequenceP:qo,set:Zf,setStringParser:Qo,setTime:Is,shape:Cl,shrink:bc,shrinklist:yc,shuffle:Cy,signal:Kt,silence:nt,sine:f0,sine2:ks,size:Wl,slice:Zc,slide:el,slow:pm,slowChunk:s1,slowcat:be,slowcatPrime:ws,slowchunk:n1,smear:ud,sol2note:Ph,someCycles:_y,someCyclesBy:Uy,sometimes:Oy,sometimesBy:jy,songPtr:gd,sound:Lc,source:pr,sparsity:hm,speak:Gb,speed:Rs,splice:A1,splitAt:ms,spread:ha,square:m0,square2:py,squeeze:gb,squeezeBind:gf,squiz:Al,src:hr,stack:ft,stackBy:uf,stackCentre:ec,stackLeft:$o,stackRight:tc,steady:ay,stepBind:Xf,stepalt:lc,stepcat:St,steps:B1,stepsPerOctave:Ha,stretch:kl,striate:T1,stringifyValues:bs,struct:pf,strudelScope:S0,stut:Om,stutWith:Jm,stutwith:Im,sub:Vf,superimpose:hf,sus:Kr,sustain:Nr,sustainpedal:Pl,swing:Rm,swingBy:Mm,sysex:e0,sysexdata:s0,sysexid:n0,sz:Fl,take:dc,time:Ts,timeCat:zs,timecat:w1,toBipolar:Uf,tokenizeNote:Yo,tour:gc,tremolo:oi,tremolodepth:ri,tremolophase:ui,tremoloshape:ai,tremoloskew:ii,tremolosync:ci,tri:hy,tri2:fy,triode:Il,tsdelay:sd,uid:Xd,undegrade:Iy,undegradeBy:Jy,unicodeToBase64:Do,uniq:Eh,uniqsort:Dh,uniqsortr:Eo,unison:pa,unit:Tl,v:Pu,val:Gd,valueToMidi:Lh,velocity:br,vib:Ku,vibmod:Du,vibrato:Hu,vmod:Ju,voice:sl,vowel:Nl,warp:Jc,warpatt:Oc,warpattack:jc,warpdc:or,warpdec:_c,warpdecay:Uc,warpdepth:nr,warpenv:lr,warpmode:rr,warprate:er,warprel:tr,warprelease:$c,warpshape:sr,warpskew:cr,warpsus:qc,warpsustain:Qc,warpsync:dr,waveloss:Kl,wavetablePhaseRand:ar,wavetablePosition:Mc,wavetableWarp:Ic,wavetableWarpMode:ir,wchoose:ky,wchooseCycles:z0,when:Ym,whenKey:sb,withValue:ff,within:X1,wrandcat:Ty,wt:zc,wtatt:vc,wtattack:xc,wtdc:Ec,wtdec:Sc,wtdecay:Yc,wtdepth:Hc,wtenv:Rc,wtphaserand:ur,wtrate:Nc,wtrel:Ac,wtrelease:Tc,wtshape:Pc,wtskew:Dc,wtsus:kc,wtsustain:Bc,wtsync:Kc,xfade:Wc,xsdelay:nd,zcrush:Bd,zdelay:kd,zip:Xc,zipWith:kn,zmod:Sd,znoise:Yd,zoom:wm,zoomArc:Wm,zoomarc:Fm,zrand:Cd,zzfx:Td},Symbol.toStringTag,{value:"Module"}));function Lb(t,e){function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n}function Ve(t,e,n,s){var o=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(o,Ve.prototype),o.expected=e,o.found=n,o.location=s,o.name="SyntaxError",o}Lb(Ve,Error);function Os(t,e,n){return n=n||" ",t.length>e?t:(e-=t.length,n+=n.repeat(e),t+n.slice(0,e))}Ve.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var n=null,s;for(s=0;s<t.length;s++)if(t[s].source===this.location.source){n=t[s].text.split(/\r\n|\n|\r/g);break}var o=this.location.start,c=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(o):o,i=this.location.source+":"+c.line+":"+c.column;if(n){var u=this.location.end,a=Os("",c.line.toString().length," "),l=n[o.line-1],p=o.line===u.line?u.column:l.length+1,f=p-o.column||1;e+=`
 --> `+i+`
`+a+` |
`+c.line+" | "+l+`
`+a+" | "+Os("",o.column-1," ")+Os("",f,"^")}else e+=`
 at `+i}return e},Ve.buildMessage=function(t,e){var n={literal:function(l){return'"'+o(l.text)+'"'},class:function(l){var p=l.parts.map(function(f){return Array.isArray(f)?c(f[0])+"-"+c(f[1]):c(f)});return"["+(l.inverted?"^":"")+p.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(l){return l.description}};function s(l){return l.charCodeAt(0).toString(16).toUpperCase()}function o(l){return l.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(p){return"\\x0"+s(p)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(p){return"\\x"+s(p)})}function c(l){return l.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(p){return"\\x0"+s(p)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(p){return"\\x"+s(p)})}function i(l){return n[l.type](l)}function u(l){var p=l.map(i),f,b;if(p.sort(),p.length>0){for(f=1,b=1;f<p.length;f++)p[f-1]!==p[f]&&(p[b]=p[f],b++);p.length=b}switch(p.length){case 1:return p[0];case 2:return p[0]+" or "+p[1];default:return p.slice(0,-1).join(", ")+", or "+p[p.length-1]}}function a(l){return l?'"'+o(l)+'"':"end of input"}return"Expected "+u(t)+" but "+a(e)+" found."};function H0(t,e){e=e!==void 0?e:{};var n={},s=e.grammarSource,o={start:dh},c=dh,i=".",u="-",a="0",l=",",p="|",f="[",b="]",g="{",X="}",Z="%",W="<",F=">",z="!",v="(",x=")",R="/",A="*",O="?",j=":",tt="..",k="^",it="struct",H="target",Q="euclid",U="slow",dt="rotL",q="rotR",st="fast",pt="scale",Vt="//",Ht="cat",kt="$",K="setcps",J="setbpm",$t="hush",rt=/^[1-9]/,oe=/^[eE]/,Lt=/^[+\-]/,$=/^[0-9]/,ot=/^[ \n\r\t\xA0]/,Jt=/^["']/,It=/^[#\--.0-9A-Z\^-_a-z~\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376-\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E-\u066F\u0671-\u06D3\u06D5\u06E5-\u06E6\u06EE-\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4-\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F-\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC-\u09DD\u09DF-\u09E1\u09F0-\u09F1\u09FC\u0A05-\u0A0A\u0A0F-\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32-\u0A33\u0A35-\u0A36\u0A38-\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2-\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0-\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F-\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32-\u0B33\u0B35-\u0B39\u0B3D\u0B5C-\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99-\u0B9A\u0B9C\u0B9E-\u0B9F\u0BA3-\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60-\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0-\u0CE1\u0CF1-\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32-\u0E33\u0E40-\u0E46\u0E81-\u0E82\u0E84\u0E87-\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA-\u0EAB\u0EAD-\u0EB0\u0EB2-\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065-\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE-\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5-\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEF\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A-\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7B9\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD-\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5-\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40-\uFB41\uFB43-\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,Zt=/^[@_]/,Ge=/^[^\n]/,Ln=Vo("number"),Ze=_(".",!1),qe=fe([["1","9"]],!1,!1),he=fe(["e","E"],!1,!1),Re=fe(["+","-"],!1,!1),xe=_("-",!1),ve=_("0",!1),$e=fe([["0","9"]],!1,!1),Ye=Vo("whitespace"),ce=fe([" ",`
`,"\r","	"," "],!1,!1),zn=_(",",!1),tn=_("|",!1),Mn=fe(['"',"'"],!1,!1),ns=Vo('a letter, a number, "-", "#", ".", "^", "_"'),Rn=fe(["#",["-","."],["0","9"],["A","Z"],["^","_"],["a","z"],"~","ª","µ","º",["À","Ö"],["Ø","ö"],["ø","ˁ"],["ˆ","ˑ"],["ˠ","ˤ"],"ˬ","ˮ",["Ͱ","ʹ"],["Ͷ","ͷ"],["ͺ","ͽ"],"Ϳ","Ά",["Έ","Ί"],"Ό",["Ύ","Ρ"],["Σ","ϵ"],["Ϸ","ҁ"],["Ҋ","ԯ"],["Ա","Ֆ"],"ՙ",["ՠ","ֈ"],["א","ת"],["ׯ","ײ"],["ؠ","ي"],["ٮ","ٯ"],["ٱ","ۓ"],"ە",["ۥ","ۦ"],["ۮ","ۯ"],["ۺ","ۼ"],"ۿ","ܐ",["ܒ","ܯ"],["ݍ","ޥ"],"ޱ",["ߊ","ߪ"],["ߴ","ߵ"],"ߺ",["ࠀ","ࠕ"],"ࠚ","ࠤ","ࠨ",["ࡀ","ࡘ"],["ࡠ","ࡪ"],["ࢠ","ࢴ"],["ࢶ","ࢽ"],["ऄ","ह"],"ऽ","ॐ",["क़","ॡ"],["ॱ","ঀ"],["অ","ঌ"],["এ","ঐ"],["ও","ন"],["প","র"],"ল",["শ","হ"],"ঽ","ৎ",["ড়","ঢ়"],["য়","ৡ"],["ৰ","ৱ"],"ৼ",["ਅ","ਊ"],["ਏ","ਐ"],["ਓ","ਨ"],["ਪ","ਰ"],["ਲ","ਲ਼"],["ਵ","ਸ਼"],["ਸ","ਹ"],["ਖ਼","ੜ"],"ਫ਼",["ੲ","ੴ"],["અ","ઍ"],["એ","ઑ"],["ઓ","ન"],["પ","ર"],["લ","ળ"],["વ","હ"],"ઽ","ૐ",["ૠ","ૡ"],"ૹ",["ଅ","ଌ"],["ଏ","ଐ"],["ଓ","ନ"],["ପ","ର"],["ଲ","ଳ"],["ଵ","ହ"],"ଽ",["ଡ଼","ଢ଼"],["ୟ","ୡ"],"ୱ","ஃ",["அ","ஊ"],["எ","ஐ"],["ஒ","க"],["ங","ச"],"ஜ",["ஞ","ட"],["ண","த"],["ந","ப"],["ம","ஹ"],"ௐ",["అ","ఌ"],["ఎ","ఐ"],["ఒ","న"],["ప","హ"],"ఽ",["ౘ","ౚ"],["ౠ","ౡ"],"ಀ",["ಅ","ಌ"],["ಎ","ಐ"],["ಒ","ನ"],["ಪ","ಳ"],["ವ","ಹ"],"ಽ","ೞ",["ೠ","ೡ"],["ೱ","ೲ"],["അ","ഌ"],["എ","ഐ"],["ഒ","ഺ"],"ഽ","ൎ",["ൔ","ൖ"],["ൟ","ൡ"],["ൺ","ൿ"],["අ","ඖ"],["ක","න"],["ඳ","ර"],"ල",["ව","ෆ"],["ก","ะ"],["า","ำ"],["เ","ๆ"],["ກ","ຂ"],"ຄ",["ງ","ຈ"],"ຊ","ຍ",["ດ","ທ"],["ນ","ຟ"],["ມ","ຣ"],"ລ","ວ",["ສ","ຫ"],["ອ","ະ"],["າ","ຳ"],"ຽ",["ເ","ໄ"],"ໆ",["ໜ","ໟ"],"ༀ",["ཀ","ཇ"],["ཉ","ཬ"],["ྈ","ྌ"],["က","ဪ"],"ဿ",["ၐ","ၕ"],["ၚ","ၝ"],"ၡ",["ၥ","ၦ"],["ၮ","ၰ"],["ၵ","ႁ"],"ႎ",["Ⴀ","Ⴥ"],"Ⴧ","Ⴭ",["ა","ჺ"],["ჼ","ቈ"],["ቊ","ቍ"],["ቐ","ቖ"],"ቘ",["ቚ","ቝ"],["በ","ኈ"],["ኊ","ኍ"],["ነ","ኰ"],["ኲ","ኵ"],["ኸ","ኾ"],"ዀ",["ዂ","ዅ"],["ወ","ዖ"],["ዘ","ጐ"],["ጒ","ጕ"],["ጘ","ፚ"],["ᎀ","ᎏ"],["Ꭰ","Ᏽ"],["ᏸ","ᏽ"],["ᐁ","ᙬ"],["ᙯ","ᙿ"],["ᚁ","ᚚ"],["ᚠ","ᛪ"],["ᛮ","ᛸ"],["ᜀ","ᜌ"],["ᜎ","ᜑ"],["ᜠ","ᜱ"],["ᝀ","ᝑ"],["ᝠ","ᝬ"],["ᝮ","ᝰ"],["ក","ឳ"],"ៗ","ៜ",["ᠠ","ᡸ"],["ᢀ","ᢄ"],["ᢇ","ᢨ"],"ᢪ",["ᢰ","ᣵ"],["ᤀ","ᤞ"],["ᥐ","ᥭ"],["ᥰ","ᥴ"],["ᦀ","ᦫ"],["ᦰ","ᧉ"],["ᨀ","ᨖ"],["ᨠ","ᩔ"],"ᪧ",["ᬅ","ᬳ"],["ᭅ","ᭋ"],["ᮃ","ᮠ"],["ᮮ","ᮯ"],["ᮺ","ᯥ"],["ᰀ","ᰣ"],["ᱍ","ᱏ"],["ᱚ","ᱽ"],["ᲀ","ᲈ"],["Ა","Ჺ"],["Ჽ","Ჿ"],["ᳩ","ᳬ"],["ᳮ","ᳱ"],["ᳵ","ᳶ"],["ᴀ","ᶿ"],["Ḁ","ἕ"],["Ἐ","Ἕ"],["ἠ","ὅ"],["Ὀ","Ὅ"],["ὐ","ὗ"],"Ὑ","Ὓ","Ὕ",["Ὗ","ώ"],["ᾀ","ᾴ"],["ᾶ","ᾼ"],"ι",["ῂ","ῄ"],["ῆ","ῌ"],["ῐ","ΐ"],["ῖ","Ί"],["ῠ","Ῥ"],["ῲ","ῴ"],["ῶ","ῼ"],"ⁱ","ⁿ",["ₐ","ₜ"],"ℂ","ℇ",["ℊ","ℓ"],"ℕ",["ℙ","ℝ"],"ℤ","Ω","ℨ",["K","ℭ"],["ℯ","ℹ"],["ℼ","ℿ"],["ⅅ","ⅉ"],"ⅎ",["Ⅰ","ↈ"],["Ⰰ","Ⱞ"],["ⰰ","ⱞ"],["Ⱡ","ⳤ"],["Ⳬ","ⳮ"],["Ⳳ","ⳳ"],["ⴀ","ⴥ"],"ⴧ","ⴭ",["ⴰ","ⵧ"],"ⵯ",["ⶀ","ⶖ"],["ⶠ","ⶦ"],["ⶨ","ⶮ"],["ⶰ","ⶶ"],["ⶸ","ⶾ"],["ⷀ","ⷆ"],["ⷈ","ⷎ"],["ⷐ","ⷖ"],["ⷘ","ⷞ"],"ⸯ",["々","〇"],["〡","〩"],["〱","〵"],["〸","〼"],["ぁ","ゖ"],["ゝ","ゟ"],["ァ","ヺ"],["ー","ヿ"],["ㄅ","ㄯ"],["ㄱ","ㆎ"],["ㆠ","ㆺ"],["ㇰ","ㇿ"],["㐀","䶵"],["一","鿯"],["ꀀ","ꒌ"],["ꓐ","ꓽ"],["ꔀ","ꘌ"],["ꘐ","ꘟ"],["ꘪ","ꘫ"],["Ꙁ","ꙮ"],["ꙿ","ꚝ"],["ꚠ","ꛯ"],["ꜗ","ꜟ"],["Ꜣ","ꞈ"],["Ꞌ","ꞹ"],["ꟷ","ꠁ"],["ꠃ","ꠅ"],["ꠇ","ꠊ"],["ꠌ","ꠢ"],["ꡀ","ꡳ"],["ꢂ","ꢳ"],["ꣲ","ꣷ"],"ꣻ",["ꣽ","ꣾ"],["ꤊ","ꤥ"],["ꤰ","ꥆ"],["ꥠ","ꥼ"],["ꦄ","ꦲ"],"ꧏ",["ꧠ","ꧤ"],["ꧦ","ꧯ"],["ꧺ","ꧾ"],["ꨀ","ꨨ"],["ꩀ","ꩂ"],["ꩄ","ꩋ"],["ꩠ","ꩶ"],"ꩺ",["ꩾ","ꪯ"],"ꪱ",["ꪵ","ꪶ"],["ꪹ","ꪽ"],"ꫀ","ꫂ",["ꫛ","ꫝ"],["ꫠ","ꫪ"],["ꫲ","ꫴ"],["ꬁ","ꬆ"],["ꬉ","ꬎ"],["ꬑ","ꬖ"],["ꬠ","ꬦ"],["ꬨ","ꬮ"],["ꬰ","ꭚ"],["ꭜ","ꭥ"],["ꭰ","ꯢ"],["가","힣"],["ힰ","ퟆ"],["ퟋ","ퟻ"],["豈","舘"],["並","龎"],["ﬀ","ﬆ"],["ﬓ","ﬗ"],"יִ",["ײַ","ﬨ"],["שׁ","זּ"],["טּ","לּ"],"מּ",["נּ","סּ"],["ףּ","פּ"],["צּ","ﮱ"],["ﯓ","ﴽ"],["ﵐ","ﶏ"],["ﶒ","ﷇ"],["ﷰ","ﷻ"],["ﹰ","ﹴ"],["ﹶ","ﻼ"],["Ａ","Ｚ"],["ａ","ｚ"],["ｦ","ﾾ"],["ￂ","ￇ"],["ￊ","ￏ"],["ￒ","ￗ"],["ￚ","ￜ"]],!1,!1),jt=_("[",!1),Se=_("]",!1),ss=_("{",!1),os=_("}",!1),zt=_("%",!1),en=_("<",!1),ut=_(">",!1),xn=fe(["@","_"],!1,!1),Be=_("!",!1),et=_("(",!1),at=_(")",!1),mt=_("/",!1),Xt=_("*",!1),Pt=_("?",!1),ke=_(":",!1),re=_("..",!1),f2=_("^",!1),m2=_("struct",!1),y2=_("target",!1),b2=_("euclid",!1),g2=_("slow",!1),X2=_("rotL",!1),G2=_("rotR",!1),Z2=_("fast",!1),w2=_("scale",!1),W2=_("//",!1),ih=fe([`
`],!0,!1),F2=_("cat",!1),V2=_("$",!1),C2=_("setcps",!1),L2=_("setbpm",!1),z2=_("hush",!1),M2=function(){return parseFloat(fX())},R2=function(r){const d=r.join("");return d==="."||d==="_"},x2=function(r){return new sG(r.join(""))},v2=function(r){return r},Y2=function(r,d){return r.arguments_.stepsPerCycle=d,r},S2=function(r){return r},B2=function(r){return r.arguments_.alignment="polymeter_slowcat",r},k2=function(r){return d=>d.options_.weight=(d.options_.weight??1)+(r??2)-1},T2=function(r){return d=>{const y=(d.options_.reps??1)+(r??2)-1;d.options_.reps=y,d.options_.ops=d.options_.ops.filter(w=>w.type_!=="replicate"),d.options_.ops.push({type_:"replicate",arguments_:{amount:y}}),d.options_.weight=y}},A2=function(r,d,y){return w=>w.options_.ops.push({type_:"bjorklund",arguments_:{pulse:r,step:d,rotation:y}})},N2=function(r){return d=>d.options_.ops.push({type_:"stretch",arguments_:{amount:r,type:"slow"}})},K2=function(r){return d=>d.options_.ops.push({type_:"stretch",arguments_:{amount:r,type:"fast"}})},H2=function(r){return d=>d.options_.ops.push({type_:"degradeBy",arguments_:{amount:r,seed:Mo++}})},P2=function(r){return d=>d.options_.ops.push({type_:"tail",arguments_:{element:r}})},E2=function(r){return d=>d.options_.ops.push({type_:"range",arguments_:{element:r}})},D2=function(r,d){const y=new cG(r,{ops:[],weight:1,reps:1});for(const w of d)w(y);return y},J2=function(r,d){return new us(d,"fastcat",void 0,!!r)},I2=function(r){return{alignment:"stack",list:r}},j2=function(r){return{alignment:"rand",list:r,seed:Mo++}},O2=function(r){return{alignment:"feet",list:r,seed:Mo++}},U2=function(r,d){return d&&d.list.length>0?new us([r,...d.list],d.alignment,d.seed):r},_2=function(r,d){return new us(d?[r,...d.list]:[r],"polymeter")},Q2=function(r){return r},q2=function(r){return{name:"struct",args:{mini:r}}},$2=function(r){return{name:"target",args:{name:r}}},tX=function(r,d,y){return{name:"bjorklund",args:{pulse:r,step:parseInt(d)}}},eX=function(r){return{name:"stretch",args:{amount:r}}},nX=function(r){return{name:"shift",args:{amount:"-"+r}}},sX=function(r){return{name:"shift",args:{amount:r}}},oX=function(r){return{name:"stretch",args:{amount:"1/"+r}}},cX=function(r){return{name:"scale",args:{scale:r.join("")}}},uh=function(r,d){return d},rX=function(r,d){return d.unshift(r),new us(d,"slowcat")},iX=function(r){return r},uX=function(r,d){return new oG(r.name,r.args,d)},aX=function(r){return r},lX=function(r){return r},dX=function(r){return new zo("setcps",{value:r})},pX=function(r){return new zo("setcps",{value:r/120/2})},hX=function(){return new zo("hush")},m=e.peg$currPos|0,P=m,nn=[{line:1,column:1}],te=m,cs=e.peg$maxFailExpected||[],Y=e.peg$silentFails|0,vn;if(e.startRule){if(!(e.startRule in o))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');c=o[e.startRule]}function fX(){return t.substring(P,m)}function ah(){return Co(P,m)}function _(r,d){return{type:"literal",text:r,ignoreCase:d}}function fe(r,d,y){return{type:"class",parts:r,inverted:d,ignoreCase:y}}function mX(){return{type:"end"}}function Vo(r){return{type:"other",description:r}}function lh(r){var d=nn[r],y;if(d)return d;if(r>=nn.length)y=nn.length-1;else for(y=r;!nn[--y];);for(d=nn[y],d={line:d.line,column:d.column};y<r;)t.charCodeAt(y)===10?(d.line++,d.column=1):d.column++,y++;return nn[r]=d,d}function Co(r,d,y){var w=lh(r),S=lh(d),ht={source:s,start:{offset:r,line:w.line,column:w.column},end:{offset:d,line:S.line,column:S.column}};return ht}function T(r){m<te||(m>te&&(te=m,cs=[]),cs.push(r))}function yX(r,d,y){return new Ve(Ve.buildMessage(r,d),r,d,y)}function dh(){var r;return r=nG(),r}function me(){var r,d;return Y++,r=m,wX(),d=rs(),d!==n?(ZX(),GX(),P=r,r=M2()):(m=r,r=n),Y--,r===n&&Y===0&&T(Ln),r}function bX(){var r;return t.charCodeAt(m)===46?(r=i,m++):(r=n,Y===0&&T(Ze)),r}function gX(){var r;return r=t.charAt(m),rt.test(r)?m++:(r=n,Y===0&&T(qe)),r}function XX(){var r;return r=t.charAt(m),oe.test(r)?m++:(r=n,Y===0&&T(he)),r}function GX(){var r,d,y,w,S;if(r=m,d=XX(),d!==n){if(y=t.charAt(m),Lt.test(y)?m++:(y=n,Y===0&&T(Re)),y===n&&(y=null),w=[],S=sn(),S!==n)for(;S!==n;)w.push(S),S=sn();else w=n;w!==n?(d=[d,y,w],r=d):(m=r,r=n)}else m=r,r=n;return r}function ZX(){var r,d,y,w;if(r=m,d=bX(),d!==n){if(y=[],w=sn(),w!==n)for(;w!==n;)y.push(w),w=sn();else y=n;y!==n?(d=[d,y],r=d):(m=r,r=n)}else m=r,r=n;return r}function rs(){var r,d,y,w;if(r=WX(),r===n)if(r=m,d=gX(),d!==n){for(y=[],w=sn();w!==n;)y.push(w),w=sn();d=[d,y],r=d}else m=r,r=n;return r}function wX(){var r;return t.charCodeAt(m)===45?(r=u,m++):(r=n,Y===0&&T(xe)),r}function WX(){var r;return t.charCodeAt(m)===48?(r=a,m++):(r=n,Y===0&&T(ve)),r}function sn(){var r;return r=t.charAt(m),$.test(r)?m++:(r=n,Y===0&&T($e)),r}function N(){var r,d;for(Y++,r=[],d=t.charAt(m),ot.test(d)?m++:(d=n,Y===0&&T(ce));d!==n;)r.push(d),d=t.charAt(m),ot.test(d)?m++:(d=n,Y===0&&T(ce));return Y--,d=n,Y===0&&T(Ye),r}function on(){var r,d,y,w;return r=m,d=N(),t.charCodeAt(m)===44?(y=l,m++):(y=n,Y===0&&T(zn)),y!==n?(w=N(),d=[d,y,w],r=d):(m=r,r=n),r}function ph(){var r,d,y,w;return r=m,d=N(),t.charCodeAt(m)===124?(y=p,m++):(y=n,Y===0&&T(tn)),y!==n?(w=N(),d=[d,y,w],r=d):(m=r,r=n),r}function hh(){var r,d,y,w;return r=m,d=N(),t.charCodeAt(m)===46?(y=i,m++):(y=n,Y===0&&T(Ze)),y!==n?(w=N(),d=[d,y,w],r=d):(m=r,r=n),r}function cn(){var r;return r=t.charAt(m),Jt.test(r)?m++:(r=n,Y===0&&T(Mn)),r}function is(){var r;return Y++,r=t.charAt(m),It.test(r)?m++:(r=n,Y===0&&T(Rn)),Y--,r===n&&Y===0&&T(ns),r}function fh(){var r,d,y,w;if(r=m,N(),d=[],y=is(),y!==n)for(;y!==n;)d.push(y),y=is();else d=n;return d!==n?(y=N(),P=m,w=R2(d),w?w=n:w=void 0,w!==n?(P=r,r=x2(d)):(m=r,r=n)):(m=r,r=n),r}function FX(){var r,d,y,w;return r=m,N(),t.charCodeAt(m)===91?(d=f,m++):(d=n,Y===0&&T(jt)),d!==n?(N(),y=bh(),y!==n?(N(),t.charCodeAt(m)===93?(w=b,m++):(w=n,Y===0&&T(Se)),w!==n?(N(),P=r,r=v2(y)):(m=r,r=n)):(m=r,r=n)):(m=r,r=n),r}function VX(){var r,d,y,w,S;return r=m,N(),t.charCodeAt(m)===123?(d=g,m++):(d=n,Y===0&&T(ss)),d!==n?(N(),y=gh(),y!==n?(N(),t.charCodeAt(m)===125?(w=X,m++):(w=n,Y===0&&T(os)),w!==n?(S=CX(),S===n&&(S=null),N(),P=r,r=Y2(y,S)):(m=r,r=n)):(m=r,r=n)):(m=r,r=n),r}function CX(){var r,d,y;return r=m,t.charCodeAt(m)===37?(d=Z,m++):(d=n,Y===0&&T(zt)),d!==n?(y=rn(),y!==n?(P=r,r=S2(y)):(m=r,r=n)):(m=r,r=n),r}function LX(){var r,d,y,w;return r=m,N(),t.charCodeAt(m)===60?(d=W,m++):(d=n,Y===0&&T(en)),d!==n?(N(),y=gh(),y!==n?(N(),t.charCodeAt(m)===62?(w=F,m++):(w=n,Y===0&&T(ut)),w!==n?(N(),P=r,r=B2(y)):(m=r,r=n)):(m=r,r=n)):(m=r,r=n),r}function rn(){var r;return r=fh(),r===n&&(r=FX(),r===n&&(r=VX(),r===n&&(r=LX()))),r}function mh(){var r;return r=zX(),r===n&&(r=RX(),r===n&&(r=xX(),r===n&&(r=vX(),r===n&&(r=MX(),r===n&&(r=YX(),r===n&&(r=SX(),r===n&&(r=BX()))))))),r}function zX(){var r,d,y;return r=m,N(),d=t.charAt(m),Zt.test(d)?m++:(d=n,Y===0&&T(xn)),d!==n?(y=me(),y===n&&(y=null),P=r,r=k2(y)):(m=r,r=n),r}function MX(){var r,d,y;return r=m,N(),t.charCodeAt(m)===33?(d=z,m++):(d=n,Y===0&&T(Be)),d!==n?(y=me(),y===n&&(y=null),P=r,r=T2(y)):(m=r,r=n),r}function RX(){var r,d,y,w,S,ht,ee;return r=m,t.charCodeAt(m)===40?(d=v,m++):(d=n,Y===0&&T(et)),d!==n?(N(),y=Yn(),y!==n?(N(),w=on(),w!==n?(N(),S=Yn(),S!==n?(N(),on(),N(),ht=Yn(),ht===n&&(ht=null),N(),t.charCodeAt(m)===41?(ee=x,m++):(ee=n,Y===0&&T(at)),ee!==n?(P=r,r=A2(y,S,ht)):(m=r,r=n)):(m=r,r=n)):(m=r,r=n)):(m=r,r=n)):(m=r,r=n),r}function xX(){var r,d,y;return r=m,t.charCodeAt(m)===47?(d=R,m++):(d=n,Y===0&&T(mt)),d!==n?(y=rn(),y!==n?(P=r,r=N2(y)):(m=r,r=n)):(m=r,r=n),r}function vX(){var r,d,y;return r=m,t.charCodeAt(m)===42?(d=A,m++):(d=n,Y===0&&T(Xt)),d!==n?(y=rn(),y!==n?(P=r,r=K2(y)):(m=r,r=n)):(m=r,r=n),r}function YX(){var r,d,y;return r=m,t.charCodeAt(m)===63?(d=O,m++):(d=n,Y===0&&T(Pt)),d!==n?(y=me(),y===n&&(y=null),P=r,r=H2(y)):(m=r,r=n),r}function SX(){var r,d,y;return r=m,t.charCodeAt(m)===58?(d=j,m++):(d=n,Y===0&&T(ke)),d!==n?(y=rn(),y!==n?(P=r,r=P2(y)):(m=r,r=n)):(m=r,r=n),r}function BX(){var r,d,y;return r=m,t.substr(m,2)===tt?(d=tt,m+=2):(d=n,Y===0&&T(re)),d!==n?(y=rn(),y!==n?(P=r,r=E2(y)):(m=r,r=n)):(m=r,r=n),r}function Yn(){var r,d,y,w;if(r=m,d=rn(),d!==n){for(y=[],w=mh();w!==n;)y.push(w),w=mh();P=r,r=D2(d,y)}else m=r,r=n;return r}function we(){var r,d,y,w;if(r=m,t.charCodeAt(m)===94?(d=k,m++):(d=n,Y===0&&T(f2)),d===n&&(d=null),y=[],w=Yn(),w!==n)for(;w!==n;)y.push(w),w=Yn();else y=n;return y!==n?(P=r,r=J2(d,y)):(m=r,r=n),r}function yh(){var r,d,y,w,S;if(r=m,d=[],y=m,w=on(),w!==n?(S=we(),S!==n?y=S:(m=y,y=n)):(m=y,y=n),y!==n)for(;y!==n;)d.push(y),y=m,w=on(),w!==n?(S=we(),S!==n?y=S:(m=y,y=n)):(m=y,y=n);else d=n;return d!==n&&(P=r,d=I2(d)),r=d,r}function kX(){var r,d,y,w,S;if(r=m,d=[],y=m,w=ph(),w!==n?(S=we(),S!==n?y=S:(m=y,y=n)):(m=y,y=n),y!==n)for(;y!==n;)d.push(y),y=m,w=ph(),w!==n?(S=we(),S!==n?y=S:(m=y,y=n)):(m=y,y=n);else d=n;return d!==n&&(P=r,d=j2(d)),r=d,r}function TX(){var r,d,y,w,S;if(r=m,d=[],y=m,w=hh(),w!==n?(S=we(),S!==n?y=S:(m=y,y=n)):(m=y,y=n),y!==n)for(;y!==n;)d.push(y),y=m,w=hh(),w!==n?(S=we(),S!==n?y=S:(m=y,y=n)):(m=y,y=n);else d=n;return d!==n&&(P=r,d=O2(d)),r=d,r}function bh(){var r,d,y;return r=m,d=we(),d!==n?(y=yh(),y===n&&(y=kX(),y===n&&(y=TX())),y===n&&(y=null),P=r,r=U2(d,y)):(m=r,r=n),r}function gh(){var r,d,y;return r=m,d=we(),d!==n?(y=yh(),y===n&&(y=null),P=r,r=_2(d,y)):(m=r,r=n),r}function AX(){var r,d,y,w;return r=m,N(),d=cn(),d!==n?(N(),y=bh(),y!==n?(N(),w=cn(),w!==n?(P=r,r=Q2(y)):(m=r,r=n)):(m=r,r=n)):(m=r,r=n),r}function NX(){var r;return r=jX(),r===n&&(r=EX(),r===n&&(r=IX(),r===n&&(r=HX(),r===n&&(r=PX(),r===n&&(r=KX(),r===n&&(r=JX(),r===n&&(r=DX()))))))),r}function KX(){var r,d,y;return r=m,t.substr(m,6)===it?(d=it,m+=6):(d=n,Y===0&&T(m2)),d!==n?(N(),y=un(),y!==n?(P=r,r=q2(y)):(m=r,r=n)):(m=r,r=n),r}function HX(){var r,d,y,w,S;return r=m,t.substr(m,6)===H?(d=H,m+=6):(d=n,Y===0&&T(y2)),d!==n?(N(),y=cn(),y!==n?(w=fh(),w!==n?(S=cn(),S!==n?(P=r,r=$2(w)):(m=r,r=n)):(m=r,r=n)):(m=r,r=n)):(m=r,r=n),r}function PX(){var r,d,y,w;return r=m,t.substr(m,6)===Q?(d=Q,m+=6):(d=n,Y===0&&T(b2)),d!==n?(N(),y=rs(),y!==n?(N(),w=rs(),w!==n?(N(),rs(),P=r,r=tX(y,w)):(m=r,r=n)):(m=r,r=n)):(m=r,r=n),r}function EX(){var r,d,y;return r=m,t.substr(m,4)===U?(d=U,m+=4):(d=n,Y===0&&T(g2)),d!==n?(N(),y=me(),y!==n?(P=r,r=eX(y)):(m=r,r=n)):(m=r,r=n),r}function DX(){var r,d,y;return r=m,t.substr(m,4)===dt?(d=dt,m+=4):(d=n,Y===0&&T(X2)),d!==n?(N(),y=me(),y!==n?(P=r,r=nX(y)):(m=r,r=n)):(m=r,r=n),r}function JX(){var r,d,y;return r=m,t.substr(m,4)===q?(d=q,m+=4):(d=n,Y===0&&T(G2)),d!==n?(N(),y=me(),y!==n?(P=r,r=sX(y)):(m=r,r=n)):(m=r,r=n),r}function IX(){var r,d,y;return r=m,t.substr(m,4)===st?(d=st,m+=4):(d=n,Y===0&&T(Z2)),d!==n?(N(),y=me(),y!==n?(P=r,r=oX(y)):(m=r,r=n)):(m=r,r=n),r}function jX(){var r,d,y,w,S;if(r=m,t.substr(m,5)===pt?(d=pt,m+=5):(d=n,Y===0&&T(w2)),d!==n)if(N(),y=cn(),y!==n){if(w=[],S=is(),S!==n)for(;S!==n;)w.push(S),S=is();else w=n;w!==n?(S=cn(),S!==n?(P=r,r=cX(w)):(m=r,r=n)):(m=r,r=n)}else m=r,r=n;else m=r,r=n;return r}function Lo(){var r,d,y,w;if(r=m,t.substr(m,2)===Vt?(d=Vt,m+=2):(d=n,Y===0&&T(W2)),d!==n){for(y=[],w=t.charAt(m),Ge.test(w)?m++:(w=n,Y===0&&T(ih));w!==n;)y.push(w),w=t.charAt(m),Ge.test(w)?m++:(w=n,Y===0&&T(ih));d=[d,y],r=d}else m=r,r=n;return r}function OX(){var r,d,y,w,S,ht,ee,an;if(r=m,t.substr(m,3)===Ht?(d=Ht,m+=3):(d=n,Y===0&&T(F2)),d!==n)if(N(),t.charCodeAt(m)===91?(y=f,m++):(y=n,Y===0&&T(jt)),y!==n)if(N(),w=un(),w!==n){for(S=[],ht=m,ee=on(),ee!==n?(an=un(),an!==n?(P=ht,ht=uh(w,an)):(m=ht,ht=n)):(m=ht,ht=n);ht!==n;)S.push(ht),ht=m,ee=on(),ee!==n?(an=un(),an!==n?(P=ht,ht=uh(w,an)):(m=ht,ht=n)):(m=ht,ht=n);ht=N(),t.charCodeAt(m)===93?(ee=b,m++):(ee=n,Y===0&&T(Se)),ee!==n?(P=r,r=rX(w,S)):(m=r,r=n)}else m=r,r=n;else m=r,r=n;else m=r,r=n;return r}function UX(){var r;return r=OX(),r===n&&(r=AX()),r}function un(){var r,d,y,w,S;if(r=m,d=UX(),d!==n){for(N(),y=[],w=Lo();w!==n;)y.push(w),w=Lo();P=r,r=iX(d)}else m=r,r=n;return r===n&&(r=m,d=NX(),d!==n?(N(),t.charCodeAt(m)===36?(y=kt,m++):(y=n,Y===0&&T(V2)),y!==n?(w=N(),S=un(),S!==n?(P=r,r=uX(d,S)):(m=r,r=n)):(m=r,r=n)):(m=r,r=n)),r}function _X(){var r,d;return r=m,d=un(),d!==n&&(P=r,d=aX(d)),r=d,r===n&&(r=Lo()),r}function QX(){var r;return r=_X(),r}function qX(){var r,d;return r=m,N(),d=$X(),d===n&&(d=tG(),d===n&&(d=eG())),d!==n?(N(),P=r,r=lX(d)):(m=r,r=n),r}function $X(){var r,d,y;return r=m,t.substr(m,6)===K?(d=K,m+=6):(d=n,Y===0&&T(C2)),d!==n?(N(),y=me(),y!==n?(P=r,r=dX(y)):(m=r,r=n)):(m=r,r=n),r}function tG(){var r,d,y;return r=m,t.substr(m,6)===J?(d=J,m+=6):(d=n,Y===0&&T(L2)),d!==n?(N(),y=me(),y!==n?(P=r,r=pX(y)):(m=r,r=n)):(m=r,r=n),r}function eG(){var r,d;return r=m,t.substr(m,4)===$t?(d=$t,m+=4):(d=n,Y===0&&T(z2)),d!==n&&(P=r,d=hX()),r=d,r}function nG(){var r;return r=QX(),r===n&&(r=qX()),r}var sG=function(r){this.type_="atom",this.source_=r,this.location_=ah()},us=function(r,d,y,w){this.type_="pattern",this.arguments_={alignment:d,_steps:w},y!==void 0&&(this.arguments_.seed=y),this.source_=r},oG=function(r,d,y){this.type_=r,this.arguments_=d,this.source_=y},cG=function(r,d){this.type_="element",this.source_=r,this.options_=d,this.location_=ah()},zo=function(r,d){this.type_="command",this.name_=r,this.options_=d},Mo=0;if(vn=c(),e.peg$library)return{peg$result:vn,peg$currPos:m,peg$FAILED:n,peg$maxFailExpected:cs,peg$maxFailPos:te};if(vn!==n&&m===t.length)return vn;throw vn!==n&&m<t.length&&T(mX()),yX(cs,te<t.length?t.charAt(te):null,te<t.length?Co(te,te+1):Co(te,te))}const zb=["start"],P0=3e-4,Mb=(t,e)=>(n,s)=>{const i=t.source_[s].options_?.ops,u=n.__steps_source;if(i)for(const a of i)switch(a.type_){case"stretch":{const l=["fast","slow"],{type:p,amount:f}=a.arguments_;if(!l.includes(p))throw new Error(`mini: stretch: type must be one of ${l.join("|")} but got ${p}`);n=V(n)[p](e(f));break}case"replicate":{const{amount:l}=a.arguments_;n=V(n),n=n._repeatCycles(l)._fast(l);break}case"bjorklund":{a.arguments_.rotation?n=n.euclidRot(e(a.arguments_.pulse),e(a.arguments_.step),e(a.arguments_.rotation)):n=n.euclid(e(a.arguments_.pulse),e(a.arguments_.step));break}case"degradeBy":{n=V(n)._degradeByWith(Mt.early(P0*a.arguments_.seed),a.arguments_.amount??.5);break}case"tail":{const l=e(a.arguments_.element);n=n.fmap(p=>f=>Array.isArray(p)?[...p,f]:[p,f]).appLeft(l);break}case"range":{const l=e(a.arguments_.element);n=V(n);const p=(b,g,X=1)=>Array.from({length:Math.abs(g-b)/X+1},(Z,W)=>b<g?b+W*X:b-W*X);n=((b,g)=>b.squeezeBind(X=>g.bind(Z=>Ct(...p(X,Z)))))(n,l);break}default:console.warn(`operator "${a.type_}" not implemented`)}return n.__steps_source=n.__steps_source||u,n};function De(t,e,n,s=0){n?.(t);const o=c=>De(c,e,n,s);switch(t.type_){case"pattern":{const c=t.source_.map(l=>o(l)).map(Mb(t,o)),i=t.arguments_.alignment,u=c.filter(l=>l.__steps_source);let a;switch(i){case"stack":{a=ft(...c),u.length&&(a._steps=Ut(...u.map(l=>C(l._steps))));break}case"polymeter_slowcat":{a=ft(...c.map(l=>l._slow(l.__weight))),u.length&&(a._steps=Ut(...u.map(l=>C(l._steps))));break}case"polymeter":{const l=t.arguments_.stepsPerCycle?o(t.arguments_.stepsPerCycle).fmap(f=>C(f)):gt(C(c.length>0?c[0].__weight:1)),p=c.map(f=>f.fast(l.fmap(b=>b.div(f.__weight))));a=ft(...p);break}case"rand":{a=Jn(Mt.early(P0*t.arguments_.seed).segment(1),c),u.length&&(a._steps=Ut(...u.map(l=>C(l._steps))));break}case"feet":{a=Ct(...c);break}default:{if(t.source_.some(p=>!!p.options_?.weight)){const p=t.source_.reduce((f,b)=>f.add(b.options_?.weight||C(1)),C(0));a=zs(...t.source_.map((f,b)=>[f.options_?.weight||C(1),c[b]])),a.__weight=p,a._steps=p,u.length&&(a._steps=a._steps.mul(Ut(...u.map(f=>C(f._steps)))))}else a=_t(...c),a._steps=c.length;t.arguments_._steps&&(a.__steps_source=!0)}}return u.length&&(a.__steps_source=!0),a}case"element":return o(t.source_);case"atom":{if(t.source_==="~"||t.source_==="-")return nt;if(!t.location_)return console.warn("no location for",t),t.source_;const c=isNaN(Number(t.source_))?t.source_:Number(t.source_);if(s===-1)return gt(c);const[i,u]=Us(e,t,s);return gt(c).withLoc(i,u)}case"stretch":return o(t.source_).slow(o(t.arguments_.amount));default:return console.warn(`node type "${t.type_}" not implemented -> returning silence`),nt}}const Us=(t,e,n=0)=>{const{start:s,end:o}=e.location_,c=t?.split("").slice(s.offset,o.offset).join(""),[i=0,u=0]=c?c.split(e.source_).map(a=>a.split("").filter(l=>l===" ").length):[];return[s.offset+i+n,o.offset-u+n]},gn=(t,e=0,n=t)=>{try{return H0(t)}catch(s){const o=[s.location.start.offset+e,s.location.end.offset+e],c=n.slice(0,o[0]).split(`
`).length;throw new Error(`[mini] parse error at line ${c}: ${s.message}`)}},E0=(t,e,n)=>{const s=gn(t,e,n);let o=[];return De(s,t,c=>{c.type_==="atom"&&o.push(c)},-1),o},Rb=(t,e=0,n)=>E0(t,e,n).map(s=>Us(t,s,e)),_s=(...t)=>{const e=t.map(n=>{const s=`"${n}"`,o=gn(s);return De(o,s)});return _t(...e)},xb=(t,e)=>{const n=`"${t}"`,s=gn(n);return De(s,n,null,e)},vb=t=>{const e=gn(t);return De(e,t)};function Yb(t){return typeof t=="string"?_s(t):V(t)}function D0(){Qo(_s)}const Sb=Object.freeze(Object.defineProperty({__proto__:null,StartRules:zb,SyntaxError:Ve,getLeafLocation:Us,getLeafLocations:Rb,getLeaves:E0,h:vb,m:xb,mini:_s,mini2ast:gn,miniAllStrings:D0,minify:Yb,parse:H0,patternifyAST:De},Symbol.toStringTag,{value:"Module"}));if(typeof DelayNode<"u"){class t extends DelayNode{constructor(n,s,o,c){super(n),s=Math.abs(s),this.delayTime.value=o;const i=n.createGain();i.gain.value=Math.min(Math.abs(c),.995),this.feedback=i.gain;const u=n.createGain();return u.gain.value=s,this.delayGain=u,this.connect(i),this.connect(u),i.connect(this),this.connect=a=>u.connect(a),this}start(n){this.delayGain.gain.setValueAtTime(this.delayGain.gain.value,n+this.delayTime.value)}}AudioContext.prototype.createFeedbackDelay=function(e,n,s){return new t(this,e,n,s)}}var Qs={};Qs.generateReverb=function(t,e){for(var n=t.audioContext||new AudioContext,s=n.sampleRate,o=t.numChannels||2,c=t.decayTime*1.5,i=Math.round(t.decayTime*s),u=Math.round(c*s),a=Math.round((t.fadeInTime||0)*s),l=Math.pow(1/1e3,1/i),p=n.createBuffer(o,u,s),f=0;f<o;f++){for(var b=p.getChannelData(f),g=0;g<u;g++)b[g]=Tb()*Math.pow(l,g);for(var g=0;g<a;g++)b[g]*=g/a}Bb(p,t.lpFreqStart||0,t.lpFreqEnd||0,t.decayTime,e)},Qs.generateGraph=function(t,e,n,s,o){var c=document.createElement("canvas");c.width=e,c.height=n;var i=c.getContext("2d");i.fillStyle="#000",i.fillRect(0,0,c.width,c.height),i.fillStyle="#fff";for(var u=e/t.length,a=n/(o-s),l=0;l<t.length;l++)i.fillRect(l*u,n-(t[l]-s)*a,1,1);return c};var Bb=function(t,e,n,s,o){if(e==0){o(t);return}var c=kb(t),i=new OfflineAudioContext(t.numberOfChannels,c[0].length,t.sampleRate),u=i.createBufferSource();u.buffer=t;var a=i.createBiquadFilter();e=Math.min(e,t.sampleRate/2),n=Math.min(n,t.sampleRate/2),a.type="lowpass",a.Q.value=1e-4,a.frequency.setValueAtTime(e,0),a.frequency.linearRampToValueAtTime(n,s),u.connect(a),a.connect(i.destination),u.start(),i.oncomplete=function(l){o(l.renderedBuffer),a.disconnect(),u.disconnect()},i.startRendering(),window.filterNode=a},kb=function(t){for(var e=[],n=0;n<t.numberOfChannels;n++)e[n]=t.getChannelData(n);return e},Tb=function(){return Math.random()*2-1};let J0=t=>console.log(t);function I0(t,e="superdough"){process.env.NODE_ENV==="development"&&console.error(t),Gt(`[${e}] error: ${t.message}`)}const Gt=(...t)=>J0(...t),j0=t=>{J0=t},Ab=t=>{if(typeof t!="string")return[];const[e,n="",s]=t.match(/^([a-gA-G])([#bsf]*)(-?[0-9]*)$/)?.slice(1)||[];return e?[e,n,s?Number(s):void 0]:[]},Nb={c:0,d:2,e:4,f:5,g:7,a:9,b:11},Kb={"#":1,b:-1,s:1,f:-1},Hb=t=>t?.split("").reduce((e,n)=>e+Kb[n],0)||0,jn=(t,e=3)=>{const[n,s,o=e]=Ab(t);if(!n)throw new Error('not a note: "'+t+'"');const c=Nb[n.toLowerCase()],i=Hb(s);return(Number(o)+1)*12+c+i},O0=t=>Math.pow(2,(t-69)/12)*440,ge=(t,e,n)=>Math.min(Math.max(t,e),n),Pb=t=>12*Math.log(t/440)/Math.LN2+69,Eb=(t,e)=>{if(typeof t!="object")throw new Error("valueToMidi: expected object value");let{freq:n,note:s}=t;return typeof n=="number"?Pb(n):typeof s=="string"?jn(s):typeof s=="number"?s:e};function ae(t,e=0,n){return isNaN(Number(t))?(!n&&Gt(`"${t}" is not a number, falling back to ${e}`,"warning"),e):t}const U0=(t,e)=>(t%e+e)%e,_0=(t,e)=>U0(Math.round(ae(t,0)),e);function Db(t,e){return t/e}function Q0(t,e){const{s:n,n:s=0}=t;let o=Eb(t,36),c=o-36,i,u=0;if(Array.isArray(e))u=_0(s,e.length),i=e[u];else{const l=f=>jn(f)-o,p=Object.keys(e).filter(f=>!f.startsWith("_")).reduce((f,b,g)=>!f||Math.abs(l(b))<Math.abs(l(f))?b:f,null);c=-l(p),u=_0(s,e[p].length),i=e[p][u]}const a=`${n}:${u}`;return{transpose:c,url:i,index:u,midi:o,label:a}}const qs=(t,e)=>Object.fromEntries(Object.entries(e).map(([n,s])=>[n,t[s]])),q0=t=>{try{return new URL(".",new URL(t)).href.replace(/\/$/,"")}catch{return t.split("/").slice(0,-1).join("/")}};typeof AudioContext<"u"&&(AudioContext.prototype.adjustLength=function(t,e,n=1,s=0){const o=Math.floor(ge(s,0,1)*e.length),c=e.sampleRate*t,i=this.createBuffer(e.numberOfChannels,e.length,e.sampleRate);for(let u=0;u<e.numberOfChannels;u++){let a=e.getChannelData(u),l=i.getChannelData(u);for(let p=0;p<c;p++){let f=(o+p*Math.abs(n))%a.length;n<1&&(f=f*-1),l[p]=a.at(f)||0}}return i},AudioContext.prototype.createReverb=function(t,e,n,s,o,c,i){const u=this.createConvolver();return u.generate=(a=2,l=.1,p=15e3,f=1e3,b,g,X)=>{u.duration=a,u.fade=l,u.lp=p,u.dim=f,u.ir=b,u.irspeed=g,u.irbegin=X,b?u.buffer=this.adjustLength(a,b,g,X):Qs.generateReverb({audioContext:this,numChannels:2,decayTime:a,fadeInTime:l,lpFreqStart:p,lpFreqEnd:f},Z=>{u.buffer=Z})},u.generate(t,e,n,s,o,c,i),u});var $0={a:{freqs:[660,1120,2750,3e3,3350],gains:[1,.5012,.0708,.0631,.0126],qs:[80,90,120,130,140]},e:{freqs:[440,1800,2700,3e3,3300],gains:[1,.1995,.1259,.1,.1],qs:[70,80,100,120,120]},i:{freqs:[270,1850,2900,3350,3590],gains:[1,.0631,.0631,.0158,.0158],qs:[40,90,100,120,120]},o:{freqs:[430,820,2700,3e3,3300],gains:[1,.3162,.0501,.0794,.01995],qs:[40,80,100,120,120]},u:{freqs:[370,630,2750,3e3,3400],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]},ae:{freqs:[650,1515,2400,3e3,3350],gains:[1,.5,.1008,.0631,.0126],qs:[80,90,120,130,140]},aa:{freqs:[560,900,2570,3e3,3300],gains:[1,.5,.0708,.0631,.0126],qs:[80,90,120,130,140]},oe:{freqs:[500,1430,2300,3e3,3300],gains:[1,.2,.0708,.0316,.01995],qs:[40,60,100,120,120]},ue:{freqs:[250,1750,2150,3200,3300],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]},y:{freqs:[400,1460,2400,3e3,3300],gains:[1,.2,.0708,.0316,.02995],qs:[40,60,100,120,120]},uh:{freqs:[600,1250,2100,3100,3500],gains:[1,.3,.0608,.0316,.01995],qs:[40,70,100,120,130]},un:{freqs:[500,1240,2280,3e3,3500],gains:[1,.1,.1708,.0216,.02995],qs:[40,60,100,120,120]},en:{freqs:[600,1480,2450,3200,3300],gains:[1,.15,.0708,.0316,.02995],qs:[40,60,100,120,120]},an:{freqs:[700,1050,2500,3e3,3300],gains:[1,.1,.0708,.0316,.02995],qs:[40,60,100,120,120]},on:{freqs:[500,1080,2350,3e3,3300],gains:[1,.1,.0708,.0316,.02995],qs:[40,60,100,120,120]},get æ(){return this.ae},get ø(){return this.oe},get ɑ(){return this.aa},get å(){return this.aa},get ö(){return this.oe},get ü(){return this.ue},get ı(){return this.y}};if(typeof GainNode<"u"){class t extends GainNode{constructor(n,s){if(super(n),!$0[s])throw new Error("vowel: unknown vowel "+s);const{gains:o,qs:c,freqs:i}=$0[s];this.makeupGain=n.createGain(),this.audioNodes=[];for(let u=0;u<5;u++){const a=n.createGain();a.gain.value=o[u];const l=n.createBiquadFilter();l.type="bandpass",l.Q.value=c[u],l.frequency.value=i[u],super.connect(l),l.connect(a),this.audioNodes.push(l),a.connect(this.makeupGain),this.audioNodes.push(a)}return this.makeupGain.gain.value=8,this}connect(n){this.makeupGain.connect(n)}disconnect(){this.makeupGain.disconnect(),this.audioNodes.forEach(n=>n.disconnect()),super.disconnect(),this.makeupGain=null,this.audioNodes=null}}AudioContext.prototype.createVowelFilter=function(e){return new t(this,e)}}const Jb="data:text/javascript;base64,dmFyIF89KGZ1bmN0aW9uKGZ0KXsidXNlIHN0cmljdCI7Y2xhc3Mga3QgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3J7Y29uc3RydWN0b3IodCl7c3VwZXIodCksdGhpcy5zdGFydGVkPSExLHRoaXMubmJJbnB1dHM9dC5udW1iZXJPZklucHV0cyx0aGlzLm5iT3V0cHV0cz10Lm51bWJlck9mT3V0cHV0cyx0aGlzLmJsb2NrU2l6ZT10LnByb2Nlc3Nvck9wdGlvbnMuYmxvY2tTaXplLHRoaXMuaG9wU2l6ZT0xMjgsdGhpcy5uYk92ZXJsYXBzPXRoaXMuYmxvY2tTaXplL3RoaXMuaG9wU2l6ZSx0aGlzLmlucHV0QnVmZmVycz1uZXcgQXJyYXkodGhpcy5uYklucHV0cyksdGhpcy5pbnB1dEJ1ZmZlcnNIZWFkPW5ldyBBcnJheSh0aGlzLm5iSW5wdXRzKSx0aGlzLmlucHV0QnVmZmVyc1RvU2VuZD1uZXcgQXJyYXkodGhpcy5uYklucHV0cyk7Zm9yKGxldCBlPTA7ZTx0aGlzLm5iSW5wdXRzO2UrKyl0aGlzLmFsbG9jYXRlSW5wdXRDaGFubmVscyhlLDEpO3RoaXMub3V0cHV0QnVmZmVycz1uZXcgQXJyYXkodGhpcy5uYk91dHB1dHMpLHRoaXMub3V0cHV0QnVmZmVyc1RvUmV0cmlldmU9bmV3IEFycmF5KHRoaXMubmJPdXRwdXRzKTtmb3IobGV0IGU9MDtlPHRoaXMubmJPdXRwdXRzO2UrKyl0aGlzLmFsbG9jYXRlT3V0cHV0Q2hhbm5lbHMoZSwxKX1yZWFsbG9jYXRlQ2hhbm5lbHNJZk5lZWRlZCh0LGUpe2ZvcihsZXQgcz0wO3M8dGhpcy5uYklucHV0cztzKyspe2xldCByPXRbc10ubGVuZ3RoO3IhPXRoaXMuaW5wdXRCdWZmZXJzW3NdLmxlbmd0aCYmdGhpcy5hbGxvY2F0ZUlucHV0Q2hhbm5lbHMocyxyKX1mb3IobGV0IHM9MDtzPHRoaXMubmJPdXRwdXRzO3MrKyl7bGV0IHI9ZVtzXS5sZW5ndGg7ciE9dGhpcy5vdXRwdXRCdWZmZXJzW3NdLmxlbmd0aCYmdGhpcy5hbGxvY2F0ZU91dHB1dENoYW5uZWxzKHMscil9fWFsbG9jYXRlSW5wdXRDaGFubmVscyh0LGUpe3RoaXMuaW5wdXRCdWZmZXJzW3RdPW5ldyBBcnJheShlKTtmb3IobGV0IHM9MDtzPGU7cysrKXRoaXMuaW5wdXRCdWZmZXJzW3RdW3NdPW5ldyBGbG9hdDMyQXJyYXkodGhpcy5ibG9ja1NpemUrMTI4KSx0aGlzLmlucHV0QnVmZmVyc1t0XVtzXS5maWxsKDApO3RoaXMuaW5wdXRCdWZmZXJzSGVhZFt0XT1uZXcgQXJyYXkoZSksdGhpcy5pbnB1dEJ1ZmZlcnNUb1NlbmRbdF09bmV3IEFycmF5KGUpO2ZvcihsZXQgcz0wO3M8ZTtzKyspdGhpcy5pbnB1dEJ1ZmZlcnNIZWFkW3RdW3NdPXRoaXMuaW5wdXRCdWZmZXJzW3RdW3NdLnN1YmFycmF5KDAsdGhpcy5ibG9ja1NpemUpLHRoaXMuaW5wdXRCdWZmZXJzVG9TZW5kW3RdW3NdPW5ldyBGbG9hdDMyQXJyYXkodGhpcy5ibG9ja1NpemUpfWFsbG9jYXRlT3V0cHV0Q2hhbm5lbHModCxlKXt0aGlzLm91dHB1dEJ1ZmZlcnNbdF09bmV3IEFycmF5KGUpO2ZvcihsZXQgcz0wO3M8ZTtzKyspdGhpcy5vdXRwdXRCdWZmZXJzW3RdW3NdPW5ldyBGbG9hdDMyQXJyYXkodGhpcy5ibG9ja1NpemUpLHRoaXMub3V0cHV0QnVmZmVyc1t0XVtzXS5maWxsKDApO3RoaXMub3V0cHV0QnVmZmVyc1RvUmV0cmlldmVbdF09bmV3IEFycmF5KGUpO2ZvcihsZXQgcz0wO3M8ZTtzKyspdGhpcy5vdXRwdXRCdWZmZXJzVG9SZXRyaWV2ZVt0XVtzXT1uZXcgRmxvYXQzMkFycmF5KHRoaXMuYmxvY2tTaXplKSx0aGlzLm91dHB1dEJ1ZmZlcnNUb1JldHJpZXZlW3RdW3NdLmZpbGwoMCl9cmVhZElucHV0cyh0KXtpZih0WzBdLmxlbmd0aCYmdFswXVswXS5sZW5ndGg9PTApe2ZvcihsZXQgZT0wO2U8dGhpcy5uYklucHV0cztlKyspZm9yKGxldCBzPTA7czx0aGlzLmlucHV0QnVmZmVyc1tlXS5sZW5ndGg7cysrKXRoaXMuaW5wdXRCdWZmZXJzW2VdW3NdLmZpbGwoMCx0aGlzLmJsb2NrU2l6ZSk7cmV0dXJufWZvcihsZXQgZT0wO2U8dGhpcy5uYklucHV0cztlKyspZm9yKGxldCBzPTA7czx0aGlzLmlucHV0QnVmZmVyc1tlXS5sZW5ndGg7cysrKXtsZXQgcj10W2VdW3NdO3RoaXMuaW5wdXRCdWZmZXJzW2VdW3NdLnNldChyLHRoaXMuYmxvY2tTaXplKX19d3JpdGVPdXRwdXRzKHQpe2ZvcihsZXQgZT0wO2U8dGhpcy5uYklucHV0cztlKyspZm9yKGxldCBzPTA7czx0aGlzLmlucHV0QnVmZmVyc1tlXS5sZW5ndGg7cysrKXtsZXQgcj10aGlzLm91dHB1dEJ1ZmZlcnNbZV1bc10uc3ViYXJyYXkoMCwxMjgpO3RbZV1bc10uc2V0KHIpfX1zaGlmdElucHV0QnVmZmVycygpe2ZvcihsZXQgdD0wO3Q8dGhpcy5uYklucHV0czt0KyspZm9yKGxldCBlPTA7ZTx0aGlzLmlucHV0QnVmZmVyc1t0XS5sZW5ndGg7ZSsrKXRoaXMuaW5wdXRCdWZmZXJzW3RdW2VdLmNvcHlXaXRoaW4oMCwxMjgpfXNoaWZ0T3V0cHV0QnVmZmVycygpe2ZvcihsZXQgdD0wO3Q8dGhpcy5uYk91dHB1dHM7dCsrKWZvcihsZXQgZT0wO2U8dGhpcy5vdXRwdXRCdWZmZXJzW3RdLmxlbmd0aDtlKyspdGhpcy5vdXRwdXRCdWZmZXJzW3RdW2VdLmNvcHlXaXRoaW4oMCwxMjgpLHRoaXMub3V0cHV0QnVmZmVyc1t0XVtlXS5zdWJhcnJheSh0aGlzLmJsb2NrU2l6ZS0xMjgpLmZpbGwoMCl9cHJlcGFyZUlucHV0QnVmZmVyc1RvU2VuZCgpe2ZvcihsZXQgdD0wO3Q8dGhpcy5uYklucHV0czt0KyspZm9yKGxldCBlPTA7ZTx0aGlzLmlucHV0QnVmZmVyc1t0XS5sZW5ndGg7ZSsrKXRoaXMuaW5wdXRCdWZmZXJzVG9TZW5kW3RdW2VdLnNldCh0aGlzLmlucHV0QnVmZmVyc0hlYWRbdF1bZV0pfWhhbmRsZU91dHB1dEJ1ZmZlcnNUb1JldHJpZXZlKCl7Zm9yKGxldCB0PTA7dDx0aGlzLm5iT3V0cHV0czt0KyspZm9yKGxldCBlPTA7ZTx0aGlzLm91dHB1dEJ1ZmZlcnNbdF0ubGVuZ3RoO2UrKylmb3IobGV0IHM9MDtzPHRoaXMuYmxvY2tTaXplO3MrKyl0aGlzLm91dHB1dEJ1ZmZlcnNbdF1bZV1bc10rPXRoaXMub3V0cHV0QnVmZmVyc1RvUmV0cmlldmVbdF1bZV1bc10vdGhpcy5uYk92ZXJsYXBzfXByb2Nlc3ModCxlLHMpe2NvbnN0IGk9dFswXVswXSE9PXZvaWQgMDtyZXR1cm4gdGhpcy5zdGFydGVkJiYhaT8hMToodGhpcy5zdGFydGVkPWksdGhpcy5yZWFsbG9jYXRlQ2hhbm5lbHNJZk5lZWRlZCh0LGUpLHRoaXMucmVhZElucHV0cyh0KSx0aGlzLnNoaWZ0SW5wdXRCdWZmZXJzKCksdGhpcy5wcmVwYXJlSW5wdXRCdWZmZXJzVG9TZW5kKCksdGhpcy5wcm9jZXNzT0xBKHRoaXMuaW5wdXRCdWZmZXJzVG9TZW5kLHRoaXMub3V0cHV0QnVmZmVyc1RvUmV0cmlldmUscyksdGhpcy5oYW5kbGVPdXRwdXRCdWZmZXJzVG9SZXRyaWV2ZSgpLHRoaXMud3JpdGVPdXRwdXRzKGUpLHRoaXMuc2hpZnRPdXRwdXRCdWZmZXJzKCksITApfXByb2Nlc3NPTEEodCxlLHMpe2NvbnNvbGUuYXNzZXJ0KCExLCJOb3Qgb3ZlcnJpZGVuIil9fWNsYXNzIEV0e2NvbnN0cnVjdG9yKHQpe2lmKHRoaXMuc2l6ZT10fDAsdGhpcy5zaXplPD0xfHwodGhpcy5zaXplJnRoaXMuc2l6ZS0xKSE9PTApdGhyb3cgbmV3IEVycm9yKCJGRlQgc2l6ZSBtdXN0IGJlIGEgcG93ZXIgb2YgdHdvIGFuZCBiaWdnZXIgdGhhbiAxIik7dGhpcy5fY3NpemU9dDw8MTtmb3IodmFyIGU9bmV3IEFycmF5KHRoaXMuc2l6ZSoyKSxzPTA7czxlLmxlbmd0aDtzKz0yKXtjb25zdCBjPU1hdGguUEkqcy90aGlzLnNpemU7ZVtzXT1NYXRoLmNvcyhjKSxlW3MrMV09LU1hdGguc2luKGMpfXRoaXMudGFibGU9ZTtmb3IodmFyIHI9MCxpPTE7dGhpcy5zaXplPmk7aTw8PTEpcisrO3RoaXMuX3dpZHRoPXIlMj09PTA/ci0xOnIsdGhpcy5fYml0cmV2PW5ldyBBcnJheSgxPDx0aGlzLl93aWR0aCk7Zm9yKHZhciBvPTA7bzx0aGlzLl9iaXRyZXYubGVuZ3RoO28rKyl7dGhpcy5fYml0cmV2W29dPTA7Zm9yKHZhciBhPTA7YTx0aGlzLl93aWR0aDthKz0yKXt2YXIgdT10aGlzLl93aWR0aC1hLTI7dGhpcy5fYml0cmV2W29dfD0obz4+PmEmMyk8PHV9fXRoaXMuX291dD1udWxsLHRoaXMuX2RhdGE9bnVsbCx0aGlzLl9pbnY9MH1mcm9tQ29tcGxleEFycmF5KHQsZSl7Zm9yKHZhciBzPWV8fG5ldyBBcnJheSh0Lmxlbmd0aD4+PjEpLHI9MDtyPHQubGVuZ3RoO3IrPTIpc1tyPj4+MV09dFtyXTtyZXR1cm4gc31jcmVhdGVDb21wbGV4QXJyYXkoKXtjb25zdCB0PW5ldyBBcnJheSh0aGlzLl9jc2l6ZSk7Zm9yKHZhciBlPTA7ZTx0Lmxlbmd0aDtlKyspdFtlXT0wO3JldHVybiB0fXRvQ29tcGxleEFycmF5KHQsZSl7Zm9yKHZhciBzPWV8fHRoaXMuY3JlYXRlQ29tcGxleEFycmF5KCkscj0wO3I8cy5sZW5ndGg7cis9MilzW3JdPXRbcj4+PjFdLHNbcisxXT0wO3JldHVybiBzfWNvbXBsZXRlU3BlY3RydW0odCl7Zm9yKHZhciBlPXRoaXMuX2NzaXplLHM9ZT4+PjEscj0yO3I8cztyKz0yKXRbZS1yXT10W3JdLHRbZS1yKzFdPS10W3IrMV19dHJhbnNmb3JtKHQsZSl7aWYodD09PWUpdGhyb3cgbmV3IEVycm9yKCJJbnB1dCBhbmQgb3V0cHV0IGJ1ZmZlcnMgbXVzdCBiZSBkaWZmZXJlbnQiKTt0aGlzLl9vdXQ9dCx0aGlzLl9kYXRhPWUsdGhpcy5faW52PTAsdGhpcy5fdHJhbnNmb3JtNCgpLHRoaXMuX291dD1udWxsLHRoaXMuX2RhdGE9bnVsbH1yZWFsVHJhbnNmb3JtKHQsZSl7aWYodD09PWUpdGhyb3cgbmV3IEVycm9yKCJJbnB1dCBhbmQgb3V0cHV0IGJ1ZmZlcnMgbXVzdCBiZSBkaWZmZXJlbnQiKTt0aGlzLl9vdXQ9dCx0aGlzLl9kYXRhPWUsdGhpcy5faW52PTAsdGhpcy5fcmVhbFRyYW5zZm9ybTQoKSx0aGlzLl9vdXQ9bnVsbCx0aGlzLl9kYXRhPW51bGx9aW52ZXJzZVRyYW5zZm9ybSh0LGUpe2lmKHQ9PT1lKXRocm93IG5ldyBFcnJvcigiSW5wdXQgYW5kIG91dHB1dCBidWZmZXJzIG11c3QgYmUgZGlmZmVyZW50Iik7dGhpcy5fb3V0PXQsdGhpcy5fZGF0YT1lLHRoaXMuX2ludj0xLHRoaXMuX3RyYW5zZm9ybTQoKTtmb3IodmFyIHM9MDtzPHQubGVuZ3RoO3MrKyl0W3NdLz10aGlzLnNpemU7dGhpcy5fb3V0PW51bGwsdGhpcy5fZGF0YT1udWxsfV90cmFuc2Zvcm00KCl7dmFyIHQ9dGhpcy5fb3V0LGU9dGhpcy5fY3NpemUscz10aGlzLl93aWR0aCxyPTE8PHMsaT1lL3I8PDEsbyxhLHU9dGhpcy5fYml0cmV2O2lmKGk9PT00KWZvcihvPTAsYT0wO288ZTtvKz1pLGErKyl7Y29uc3QgbT11W2FdO3RoaXMuX3NpbmdsZVRyYW5zZm9ybTIobyxtLHIpfWVsc2UgZm9yKG89MCxhPTA7bzxlO28rPWksYSsrKXtjb25zdCBtPXVbYV07dGhpcy5fc2luZ2xlVHJhbnNmb3JtNChvLG0scil9dmFyIGM9dGhpcy5faW52Py0xOjEsaD10aGlzLnRhYmxlO2ZvcihyPj49MjtyPj0yO3I+Pj0yKXtpPWUvcjw8MTt2YXIgZj1pPj4+Mjtmb3Iobz0wO288ZTtvKz1pKWZvcih2YXIgZD1vK2YsbD1vLHA9MDtsPGQ7bCs9MixwKz1yKXtjb25zdCBtPWwsST1tK2YsZz1JK2Ysdj1nK2Ysdz10W21dLFA9dFttKzFdLFM9dFtJXSxWPXRbSSsxXSxNPXRbZ10seD10W2crMV0seT10W3ZdLEE9dFt2KzFdLFc9dyxOPVAsRT1oW3BdLE89YypoW3ArMV0sRj1TKkUtVipPLEQ9UypPK1YqRSxMPWhbMipwXSxDPWMqaFsyKnArMV0sZXQ9TSpMLXgqQyxzdD1NKkMreCpMLHJ0PWhbMypwXSxudD1jKmhbMypwKzFdLGl0PXkqcnQtQSpudCxvdD15Km50K0EqcnQsYXQ9VytldCwkPU4rc3QsRz1XLWV0LGN0PU4tc3QsdXQ9RitpdCxRPUQrb3QsSj1jKihGLWl0KSxodD1jKihELW90KSxsdD1hdCt1dCxidD0kK1EsSXQ9YXQtdXQsX3Q9JC1RLEJ0PUcraHQsd3Q9Y3QtSixUdD1HLWh0LFB0PWN0K0o7dFttXT1sdCx0W20rMV09YnQsdFtJXT1CdCx0W0krMV09d3QsdFtnXT1JdCx0W2crMV09X3QsdFt2XT1UdCx0W3YrMV09UHR9fX1fc2luZ2xlVHJhbnNmb3JtMih0LGUscyl7Y29uc3Qgcj10aGlzLl9vdXQsaT10aGlzLl9kYXRhLG89aVtlXSxhPWlbZSsxXSx1PWlbZStzXSxjPWlbZStzKzFdLGg9byt1LGY9YStjLGQ9by11LGw9YS1jO3JbdF09aCxyW3QrMV09ZixyW3QrMl09ZCxyW3QrM109bH1fc2luZ2xlVHJhbnNmb3JtNCh0LGUscyl7Y29uc3Qgcj10aGlzLl9vdXQsaT10aGlzLl9kYXRhLG89dGhpcy5faW52Py0xOjEsYT1zKjIsdT1zKjMsYz1pW2VdLGg9aVtlKzFdLGY9aVtlK3NdLGQ9aVtlK3MrMV0sbD1pW2UrYV0scD1pW2UrYSsxXSxtPWlbZSt1XSxJPWlbZSt1KzFdLGc9YytsLHY9aCtwLHc9Yy1sLFA9aC1wLFM9ZittLFY9ZCtJLE09byooZi1tKSx4PW8qKGQtSSkseT1nK1MsQT12K1YsVz13K3gsTj1QLU0sRT1nLVMsTz12LVYsRj13LXgsRD1QK007clt0XT15LHJbdCsxXT1BLHJbdCsyXT1XLHJbdCszXT1OLHJbdCs0XT1FLHJbdCs1XT1PLHJbdCs2XT1GLHJbdCs3XT1EfV9yZWFsVHJhbnNmb3JtNCgpe3ZhciB0PXRoaXMuX291dCxlPXRoaXMuX2NzaXplLHM9dGhpcy5fd2lkdGgscj0xPDxzLGk9ZS9yPDwxLG8sYSx1PXRoaXMuX2JpdHJldjtpZihpPT09NClmb3Iobz0wLGE9MDtvPGU7bys9aSxhKyspe2NvbnN0IE10PXVbYV07dGhpcy5fc2luZ2xlUmVhbFRyYW5zZm9ybTIobyxNdD4+PjEscj4+PjEpfWVsc2UgZm9yKG89MCxhPTA7bzxlO28rPWksYSsrKXtjb25zdCBNdD11W2FdO3RoaXMuX3NpbmdsZVJlYWxUcmFuc2Zvcm00KG8sTXQ+Pj4xLHI+Pj4xKX12YXIgYz10aGlzLl9pbnY/LTE6MSxoPXRoaXMudGFibGU7Zm9yKHI+Pj0yO3I+PTI7cj4+PTIpe2k9ZS9yPDwxO3ZhciBmPWk+Pj4xLGQ9Zj4+PjEsbD1kPj4+MTtmb3Iobz0wO288ZTtvKz1pKWZvcih2YXIgcD0wLG09MDtwPD1sO3ArPTIsbSs9cil7dmFyIEk9bytwLGc9SStkLHY9ZytkLHc9ditkLFA9dFtJXSxTPXRbSSsxXSxWPXRbZ10sTT10W2crMV0seD10W3ZdLHk9dFt2KzFdLEE9dFt3XSxXPXRbdysxXSxOPVAsRT1TLE89aFttXSxGPWMqaFttKzFdLEQ9VipPLU0qRixMPVYqRitNKk8sQz1oWzIqbV0sZXQ9YypoWzIqbSsxXSxzdD14KkMteSpldCxydD14KmV0K3kqQyxudD1oWzMqbV0saXQ9YypoWzMqbSsxXSxvdD1BKm50LVcqaXQsYXQ9QSppdCtXKm50LCQ9TitzdCxHPUUrcnQsY3Q9Ti1zdCx1dD1FLXJ0LFE9RCtvdCxKPUwrYXQsaHQ9YyooRC1vdCksbHQ9YyooTC1hdCksYnQ9JCtRLEl0PUcrSixfdD1jdCtsdCxCdD11dC1odDtpZih0W0ldPWJ0LHRbSSsxXT1JdCx0W2ddPV90LHRbZysxXT1CdCxwPT09MCl7dmFyIHd0PSQtUSxUdD1HLUo7dFt2XT13dCx0W3YrMV09VHQ7Y29udGludWV9aWYocCE9PWwpe3ZhciBQdD1jdCxnZT0tdXQsYmU9JCxJZT0tRyxfZT0tYypsdCxCZT0tYypodCx3ZT0tYypKLFRlPS1jKlEsUGU9UHQrX2UsTWU9Z2UrQmUsU2U9YmUrVGUsVmU9SWUtd2UsQ3Q9bytkLXAsUnQ9bytmLXA7dFtDdF09UGUsdFtDdCsxXT1NZSx0W1J0XT1TZSx0W1J0KzFdPVZlfX19fV9zaW5nbGVSZWFsVHJhbnNmb3JtMih0LGUscyl7Y29uc3Qgcj10aGlzLl9vdXQsaT10aGlzLl9kYXRhLG89aVtlXSxhPWlbZStzXSx1PW8rYSxjPW8tYTtyW3RdPXUsclt0KzFdPTAsclt0KzJdPWMsclt0KzNdPTB9X3NpbmdsZVJlYWxUcmFuc2Zvcm00KHQsZSxzKXtjb25zdCByPXRoaXMuX291dCxpPXRoaXMuX2RhdGEsbz10aGlzLl9pbnY/LTE6MSxhPXMqMix1PXMqMyxjPWlbZV0saD1pW2Urc10sZj1pW2UrYV0sZD1pW2UrdV0sbD1jK2YscD1jLWYsbT1oK2QsST1vKihoLWQpLGc9bCttLHY9cCx3PS1JLFA9bC1tLFM9cCxWPUk7clt0XT1nLHJbdCsxXT0wLHJbdCsyXT12LHJbdCszXT13LHJbdCs0XT1QLHJbdCs1XT0wLHJbdCs2XT1TLHJbdCs3XT1WfX1sZXQgRHQ9bj0+Y29uc29sZS5sb2cobik7Y29uc3QgenQ9KC4uLm4pPT5EdCguLi5uKSxXdD0obix0LGUpPT5NYXRoLm1pbihNYXRoLm1heChuLHQpLGUpLFN0PW49Pm4vKDErbikscXQ9KG4sdCk9PihuJXQrdCkldCxMdD0obix0KT0+KDErdCkqbi8oMSt0Kk1hdGguYWJzKG4pKSxZPShuLHQpPT5NYXRoLnRhbmgobiooMSt0KSksWXQ9KG4sdCk9Pld0KCgxK3QpKm4sLTEsMSksVnQ9KG4sdCk9PntsZXQgZT0oMSsuNSp0KSpuO2NvbnN0IHM9cXQoZSsxLDQpO3JldHVybiAxLU1hdGguYWJzKHMtMil9LGp0PShuLHQpPT5NYXRoLnNpbihNYXRoLlBJLzIqVnQobix0KSksSHQ9KG4sdCk9Pntjb25zdCBlPVN0KE1hdGgubG9nMXAodCkpLHM9KG4tZS8zKm4qbipuKS8oMS1lLzMpO3JldHVybiBZKHMsdCl9LHh0PShuLHQsZT0hMSk9Pntjb25zdCBzPTErMip0LGk9LjA3KlN0KE1hdGgubG9nMXAodCkpLG89WShuK2ksMip0KSxhPVkoZT9pOi1uK2ksMip0KSx1PW8tYSxjPTEvTWF0aC5jb3NoKHMqaSksaD1jKmMsZj1NYXRoLm1heCgxZS04LChlPzE6MikqcypoKTtyZXR1cm4gWSh1L2YsdCl9LHl0PXtzY3VydmU6THQsc29mdDpZLGhhcmQ6WXQsY3ViaWM6SHQsZGlvZGU6eHQsYXN5bToobix0KT0+eHQobix0LCEwKSxmb2xkOlZ0LHNpbmVmb2xkOmp0LGNoZWJ5c2hldjoobix0KT0+e2NvbnN0IGU9MTAqTWF0aC5sb2cxcCh0KTtsZXQgcz0xLHI9bixpLG89MDtmb3IobGV0IGE9MTthPDY0O2ErKyl7aWYoYTwyKXtvKz1hPT0wP3M6cjtjb250aW51ZX1pPTIqbipzLXIscj1zLHM9aSxhJTI9PT0wJiYobys9TWF0aC5taW4oMS4zKmUvYSwyKSppKX1yZXR1cm4gWShvLGUvMjApfX0sWD1PYmplY3QuZnJlZXplKE9iamVjdC5rZXlzKHl0KSksS3Q9bj0+e2xldCB0PW47dHlwZW9mIG49PSJzdHJpbmciJiYodD1YLmluZGV4T2YobiksdD09PS0xJiYoenQoYFtzdXBlcmRvdWdoXSBDb3VsZCBub3QgZmluZCB3YXZlc2hhcGluZyBhbGdvcml0aG0gJHtufS4KICAgICAgICBBdmFpbGFibGUgb3B0aW9ucyBhcmUgJHtYLmpvaW4oIiwgIil9LgogICAgICAgIERlZmF1bHRpbmcgdG8gJHtYWzBdfS5gKSx0PTApKTtjb25zdCBlPVhbdCVYLmxlbmd0aF07cmV0dXJuIHl0W2VdfSxqPTEyOCxSPU1hdGguUEksaz0yKlIscT0xL3NhbXBsZVJhdGUsVD0obix0LGUpPT5NYXRoLm1pbihNYXRoLm1heChuLHQpLGUpLFV0PShuLHQsZSk9PmUqKHQtbikrbixiPShuLHQpPT5uW3RdPz9uWzBdLEg9bj0+bi1NYXRoLmZsb29yKG4pLEs9bj0+bnwwLFU9bj0+SyhuKy41KSxadD1uPT5LKG4rMSksQXQ9bj0+bi1LKG4pLHo9bj0+e2NvbnN0IHQ9bioqMjtyZXR1cm4gbiooMjcrdCkvKDI3KzkqdCl9LE50PShuLHQpPT57aWYobjwyKXJldHVybiByPT4wO2NvbnN0IGU9dC8obi0xKSxzPXQqLjU7cmV0dXJuIHI9PnIqZS1zfSxaPShuLHQpPT5uKk1hdGgucG93KDIsdC8xMik7ZnVuY3Rpb24gJHQobix0KXt0PU1hdGgubWluKHQsMS10KTtjb25zdCBlPTEvdDtyZXR1cm4gbjx0PyhuKj1lLDIqbi1uKioyLTEpOm4+MS10PyhuPShuLTEpKmUsbioqMisyKm4rMSk6MH1jb25zdCBkdD17dHJpKG4sdD0uNSl7Y29uc3QgZT0xLXQ7cmV0dXJuIG4+PXQ/MS9lLW4vZTpuL3R9LHNpbmUobil7cmV0dXJuIE1hdGguc2luKGsqbikqLjUrLjV9LHJhbXAobil7cmV0dXJuIG59LHNhdyhuKXtyZXR1cm4gMS1ufSxzcXVhcmUobix0PS41KXtyZXR1cm4gbj49dD8wOjF9LGN1c3RvbShuLHQ9WzAsMV0pe2NvbnN0IGU9dC5sZW5ndGgtMSxzPU1hdGguZmxvb3IobiplKSxyPTEvZSxpPVQodFtzXSwwLDEpLGE9VCh0W3MrMV0sMCwxKSx1PWksYz0wLGg9cjtyZXR1cm4oYS11KS8oaC1jKSoobi1yKnMpK2l9LHNhd2JsZXAobix0KXtyZXR1cm4gMipuLTEtJHQobix0KX19LEd0PU9iamVjdC5rZXlzKGR0KTtjbGFzcyBRdCBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3NvcntzdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCl7cmV0dXJuW3tuYW1lOiJiZWdpbiIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJ0aW1lIixkZWZhdWx0VmFsdWU6MH0se25hbWU6ImVuZCIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJmcmVxdWVuY3kiLGRlZmF1bHRWYWx1ZTouNX0se25hbWU6InNrZXciLGRlZmF1bHRWYWx1ZTouNX0se25hbWU6ImRlcHRoIixkZWZhdWx0VmFsdWU6MX0se25hbWU6InBoYXNlb2Zmc2V0IixkZWZhdWx0VmFsdWU6MH0se25hbWU6InNoYXBlIixkZWZhdWx0VmFsdWU6MH0se25hbWU6ImN1cnZlIixkZWZhdWx0VmFsdWU6MX0se25hbWU6ImRjb2Zmc2V0IixkZWZhdWx0VmFsdWU6MH0se25hbWU6Im1pbiIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJtYXgiLGRlZmF1bHRWYWx1ZToxfV19Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMucGhhc2V9aW5jcmVtZW50UGhhc2UodCl7dGhpcy5waGFzZSs9dCx0aGlzLnBoYXNlPjEmJih0aGlzLnBoYXNlPXRoaXMucGhhc2UtMSl9cHJvY2Vzcyh0LGUscyl7Y29uc3Qgcj1zLmJlZ2luWzBdO2lmKGN1cnJlbnRUaW1lPj1zLmVuZFswXSlyZXR1cm4hMTtpZihjdXJyZW50VGltZTw9cilyZXR1cm4hMDtjb25zdCBpPWVbMF0sbz1zLmZyZXF1ZW5jeVswXSxhPXMudGltZVswXSx1PXMuZGVwdGhbMF0sYz1zLnNrZXdbMF0saD1zLnBoYXNlb2Zmc2V0WzBdLGY9cy5jdXJ2ZVswXSxkPXMuZGNvZmZzZXRbMF0sbD1zLm1pblswXSxwPXMubWF4WzBdLG09R3Rbcy5zaGFwZVswXV0sST1pWzBdLmxlbmd0aD8/MDt0aGlzLnBoYXNlPT1udWxsJiYodGhpcy5waGFzZT1BdChhKm8raCkpO2NvbnN0IGc9bypxO2ZvcihsZXQgdj0wO3Y8STt2Kyspe2ZvcihsZXQgdz0wO3c8aS5sZW5ndGg7dysrKXtsZXQgUD0oZHRbbV0odGhpcy5waGFzZSxjKStkKSp1O1A9TWF0aC5wb3coUCxmKSxpW3ddW3ZdPVQoUCxsLHApfXRoaXMuaW5jcmVtZW50UGhhc2UoZyl9cmV0dXJuITB9fXJlZ2lzdGVyUHJvY2Vzc29yKCJsZm8tcHJvY2Vzc29yIixRdCk7Y2xhc3MgSnQgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3J7c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToiY29hcnNlIixkZWZhdWx0VmFsdWU6MX1dfWNvbnN0cnVjdG9yKCl7c3VwZXIoKSx0aGlzLnN0YXJ0ZWQ9ITF9cHJvY2Vzcyh0LGUscyl7Y29uc3Qgcj10WzBdLGk9ZVswXSxvPXJbMF0hPT12b2lkIDA7aWYodGhpcy5zdGFydGVkJiYhbylyZXR1cm4hMTt0aGlzLnN0YXJ0ZWQ9bztsZXQgYT1zLmNvYXJzZVswXT8/MDthPU1hdGgubWF4KDEsYSk7Zm9yKGxldCB1PTA7dTxqO3UrKylmb3IobGV0IGM9MDtjPHIubGVuZ3RoO2MrKylpW2NdW3VdPXUlYT09PTA/cltjXVt1XTppW2NdW3UtMV07cmV0dXJuITB9fXJlZ2lzdGVyUHJvY2Vzc29yKCJjb2Fyc2UtcHJvY2Vzc29yIixKdCk7Y2xhc3MgWHQgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3J7c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToiY3J1c2giLGRlZmF1bHRWYWx1ZTowfV19Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMuc3RhcnRlZD0hMX1wcm9jZXNzKHQsZSxzKXtjb25zdCByPXRbMF0saT1lWzBdLG89clswXSE9PXZvaWQgMDtpZih0aGlzLnN0YXJ0ZWQmJiFvKXJldHVybiExO3RoaXMuc3RhcnRlZD1vO2xldCBhPXMuY3J1c2hbMF0/Pzg7YT1NYXRoLm1heCgxLGEpO2ZvcihsZXQgdT0wO3U8ajt1KyspZm9yKGxldCBjPTA7YzxyLmxlbmd0aDtjKyspe2NvbnN0IGg9TWF0aC5wb3coMixhLTEpO2lbY11bdV09TWF0aC5yb3VuZChyW2NdW3VdKmgpL2h9cmV0dXJuITB9fXJlZ2lzdGVyUHJvY2Vzc29yKCJjcnVzaC1wcm9jZXNzb3IiLFh0KTtjbGFzcyB0ZSBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3NvcntzdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCl7cmV0dXJuW3tuYW1lOiJzaGFwZSIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJwb3N0Z2FpbiIsZGVmYXVsdFZhbHVlOjF9XX1jb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5zdGFydGVkPSExfXByb2Nlc3ModCxlLHMpe2NvbnN0IHI9dFswXSxpPWVbMF0sbz1yWzBdIT09dm9pZCAwO2lmKHRoaXMuc3RhcnRlZCYmIW8pcmV0dXJuITE7dGhpcy5zdGFydGVkPW87bGV0IGE9cy5zaGFwZVswXTthPWE8MT9hOi45OTk5OTk5OTk2LGE9MiphLygxLWEpO2NvbnN0IHU9TWF0aC5tYXgoLjAwMSxNYXRoLm1pbigxLHMucG9zdGdhaW5bMF0pKTtmb3IobGV0IGM9MDtjPGo7YysrKWZvcihsZXQgaD0wO2g8ci5sZW5ndGg7aCsrKWlbaF1bY109KDErYSkqcltoXVtjXS8oMSthKk1hdGguYWJzKHJbaF1bY10pKSp1O3JldHVybiEwfX1yZWdpc3RlclByb2Nlc3Nvcigic2hhcGUtcHJvY2Vzc29yIix0ZSk7Y2xhc3MgT3R7czA9MDtzMT0wO3VwZGF0ZSh0LGUscz0wKXtzPVQocywwLDEpLGU9VChlLDAsc2FtcGxlUmF0ZS8yLTEpO2NvbnN0IHI9VCgyKk1hdGguc2luKGUqUipxKSwwLDEuMTQpLG89MS1NYXRoLnBvdyguNSw4KnMrMSkqcjtyZXR1cm4gdGhpcy5zMD1vKnRoaXMuczAtcip0aGlzLnMxK3IqdCx0aGlzLnMxPW8qdGhpcy5zMStyKnRoaXMuczAsdGhpcy5zMX19Y2xhc3MgZWUgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3J7c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToidmFsdWUiLGRlZmF1bHRWYWx1ZTouNX1dfWNvbnN0cnVjdG9yKCl7c3VwZXIoKSx0aGlzLmZpbHRlcnM9W25ldyBPdCxuZXcgT3RdfXByb2Nlc3ModCxlLHMpe2NvbnN0IHI9dFswXSxpPWVbMF0sbz1yWzBdIT09dm9pZCAwO3RoaXMuc3RhcnRlZD1vO2NvbnN0IGE9VChzLnZhbHVlWzBdLDAsMSk7bGV0IHU9Im5vbmUiLGMsaD0xO2E+LjUxPyh1PSJoaXBhc3MiLGg9KGEtLjUpKjIpOmE8LjQ5JiYodT0ibG9wYXNzIixoPWEqMiksYz1NYXRoLnBvdyhoKjExLDQpO2ZvcihsZXQgZj0wO2Y8ci5sZW5ndGg7ZisrKWZvcihsZXQgZD0wO2Q8ajtkKyspdT09Im5vbmUiP2lbZl1bZF09cltmXVtkXToodGhpcy5maWx0ZXJzW2ZdLnVwZGF0ZShyW2ZdW2RdLGMsLjEpLHU9PT0ibG9wYXNzIj9pW2ZdW2RdPXRoaXMuZmlsdGVyc1tmXS5zMTp1PT09ImhpcGFzcyI/aVtmXVtkXT1yW2ZdW2RdLXRoaXMuZmlsdGVyc1tmXS5zMTppW2ZdW2RdPXJbZl1bZF0pO3JldHVybiEwfX1yZWdpc3RlclByb2Nlc3NvcigiZGpmLXByb2Nlc3NvciIsZWUpO2NsYXNzIHNlIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29ye3N0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKXtyZXR1cm5be25hbWU6ImZyZXF1ZW5jeSIsZGVmYXVsdFZhbHVlOjUwMH0se25hbWU6InEiLGRlZmF1bHRWYWx1ZToxfSx7bmFtZToiZHJpdmUiLGRlZmF1bHRWYWx1ZTouNjl9XX1jb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5zdGFydGVkPSExLHRoaXMucDA9WzAsMF0sdGhpcy5wMT1bMCwwXSx0aGlzLnAyPVswLDBdLHRoaXMucDM9WzAsMF0sdGhpcy5wMzI9WzAsMF0sdGhpcy5wMzM9WzAsMF0sdGhpcy5wMzQ9WzAsMF19cHJvY2Vzcyh0LGUscyl7Y29uc3Qgcj10WzBdLGk9ZVswXSxvPXJbMF0hPT12b2lkIDA7aWYodGhpcy5zdGFydGVkJiYhbylyZXR1cm4hMTt0aGlzLnN0YXJ0ZWQ9bztjb25zdCBhPXMucVswXSx1PVQoTWF0aC5leHAocy5kcml2ZVswXSksLjEsMmUzKTtsZXQgYz1zLmZyZXF1ZW5jeVswXTtjPWMqaypxLGM9Yz4xPzE6Yztjb25zdCBoPU1hdGgubWluKDgsYSouMTMpO2xldCBmPTEvdSpNYXRoLm1pbigxLjc1LDEraCk7Zm9yKGxldCBkPTA7ZDxqO2QrKylmb3IobGV0IGw9MDtsPHIubGVuZ3RoO2wrKyl7Y29uc3QgcD10aGlzLnAzW2xdKi4zNjA4OTErdGhpcy5wMzJbbF0qLjQxNzI5K3RoaXMucDMzW2xdKi4xNzc4OTYrdGhpcy5wMzRbbF0qLjA0Mzk3MjU7dGhpcy5wMzRbbF09dGhpcy5wMzNbbF0sdGhpcy5wMzNbbF09dGhpcy5wMzJbbF0sdGhpcy5wMzJbbF09dGhpcy5wM1tsXSx0aGlzLnAwW2xdKz0oeihyW2xdW2RdKnUtaCpwKS16KHRoaXMucDBbbF0pKSpjLHRoaXMucDFbbF0rPSh6KHRoaXMucDBbbF0pLXoodGhpcy5wMVtsXSkpKmMsdGhpcy5wMltsXSs9KHoodGhpcy5wMVtsXSkteih0aGlzLnAyW2xdKSkqYyx0aGlzLnAzW2xdKz0oeih0aGlzLnAyW2xdKS16KHRoaXMucDNbbF0pKSpjLGlbbF1bZF09cCpmfXJldHVybiEwfX1yZWdpc3RlclByb2Nlc3NvcigibGFkZGVyLXByb2Nlc3NvciIsc2UpO2NsYXNzIHJlIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29ye3N0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKXtyZXR1cm5be25hbWU6ImRpc3RvcnQiLGRlZmF1bHRWYWx1ZTowfSx7bmFtZToicG9zdGdhaW4iLGRlZmF1bHRWYWx1ZToxfV19Y29uc3RydWN0b3Ioe3Byb2Nlc3Nvck9wdGlvbnM6dH0pe3N1cGVyKCksdGhpcy5zdGFydGVkPSExLHRoaXMuYWxnb3JpdGhtPUt0KHQuYWxnb3JpdGhtKX1wcm9jZXNzKHQsZSxzKXtjb25zdCByPXRbMF0saT1lWzBdLG89clswXSE9PXZvaWQgMDtpZih0aGlzLnN0YXJ0ZWQmJiFvKXJldHVybiExO3RoaXMuc3RhcnRlZD1vO2ZvcihsZXQgYT0wO2E8ajthKyspe2NvbnN0IHU9VChiKHMucG9zdGdhaW4sYSksLjAwMSwxKSxjPU1hdGguZXhwbTEoYihzLmRpc3RvcnQsYSkpO2ZvcihsZXQgaD0wO2g8ci5sZW5ndGg7aCsrKXtjb25zdCBmPXJbaF1bYV07aVtoXVthXT11KnRoaXMuYWxnb3JpdGhtKGYsYyl9fXJldHVybiEwfX1yZWdpc3RlclByb2Nlc3NvcigiZGlzdG9ydC1wcm9jZXNzb3IiLHJlKTtjbGFzcyBuZSBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3Nvcntjb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5waGFzZT1bXX1zdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCl7cmV0dXJuW3tuYW1lOiJiZWdpbiIsZGVmYXVsdFZhbHVlOjAsbWF4Ok51bWJlci5QT1NJVElWRV9JTkZJTklUWSxtaW46MH0se25hbWU6ImVuZCIsZGVmYXVsdFZhbHVlOjAsbWF4Ok51bWJlci5QT1NJVElWRV9JTkZJTklUWSxtaW46MH0se25hbWU6ImZyZXF1ZW5jeSIsZGVmYXVsdFZhbHVlOjQ0MCxtaW46TnVtYmVyLkVQU0lMT059LHtuYW1lOiJwYW5zcHJlYWQiLGRlZmF1bHRWYWx1ZTouNCxtaW46MCxtYXg6MX0se25hbWU6ImZyZXFzcHJlYWQiLGRlZmF1bHRWYWx1ZTouMixtaW46MH0se25hbWU6ImRldHVuZSIsZGVmYXVsdFZhbHVlOjAsbWluOjB9LHtuYW1lOiJ2b2ljZXMiLGRlZmF1bHRWYWx1ZTo1LG1pbjoxLGF1dG9tYXRpb25SYXRlOiJrLXJhdGUifV19cHJvY2Vzcyh0LGUscyl7aWYoY3VycmVudFRpbWU8PXMuYmVnaW5bMF0pcmV0dXJuITA7aWYoY3VycmVudFRpbWU+PXMuZW5kWzBdKXJldHVybiExO2NvbnN0IHI9ZVswXSxpPXMudm9pY2VzWzBdO2ZvcihsZXQgbz0wO288clswXS5sZW5ndGg7bysrKXtjb25zdCBhPWIocy5kZXR1bmUsbyksdT1iKHMuZnJlcXNwcmVhZCxvKSxjPWIocy5wYW5zcHJlYWQsbykqLjUrLjU7bGV0IGg9TWF0aC5zcXJ0KDEtYyksZj1NYXRoLnNxcnQoYyksZD1iKHMuZnJlcXVlbmN5LG8pO2Q9WihkLGEvMTAwKTtjb25zdCBsPU50KGksdSk7Zm9yKGxldCBwPTA7cDxpO3ArKyl7Y29uc3QgbT1aKGQsbChwKSksST1IKG0qcSk7dGhpcy5waGFzZVtwXT10aGlzLnBoYXNlW3BdPz9NYXRoLnJhbmRvbSgpO2NvbnN0IGc9ZHQuc2F3YmxlcCh0aGlzLnBoYXNlW3BdLEkpO3JbMF1bb10rPWcqaCxyWzFdW29dKz1nKmY7bGV0IHY9dGhpcy5waGFzZVtwXStJO3Y+PTEmJih2LT0xKSx0aGlzLnBoYXNlW3BdPXY7Y29uc3Qgdz1oO2g9ZixmPXd9fXJldHVybiEwfX1yZWdpc3RlclByb2Nlc3Nvcigic3VwZXJzYXctb3NjaWxsYXRvciIsbmUpO2NvbnN0IGllPTIwNDgscHQ9bmV3IE1hcDtmdW5jdGlvbiBvZShuKXtpZighcHQuaGFzKG4pKXtjb25zdCB0PW5ldyBGbG9hdDMyQXJyYXkobik7Zm9yKGxldCBlPTA7ZTxuO2UrKyl0W2VdPS41KigxLU1hdGguY29zKGsqZS9uKSk7cHQuc2V0KG4sdCl9cmV0dXJuIHB0LmdldChuKX1jbGFzcyBhZSBleHRlbmRzIGt0e3N0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKXtyZXR1cm5be25hbWU6InBpdGNoRmFjdG9yIixkZWZhdWx0VmFsdWU6MX1dfWNvbnN0cnVjdG9yKHQpe3QucHJvY2Vzc29yT3B0aW9ucz17YmxvY2tTaXplOmllfSxzdXBlcih0KSx0aGlzLnRpbWVDdXJzb3I9MCx0aGlzLmZmdFNpemU9dGhpcy5ibG9ja1NpemUsdGhpcy5pbnZmZnRTaXplPTEvdGhpcy5mZnRTaXplLHRoaXMuaGFubldpbmRvdz1vZSh0aGlzLmZmdFNpemUpLHRoaXMuZmZ0PW5ldyBFdCh0aGlzLmZmdFNpemUpLHRoaXMuZnJlcUNvbXBsZXhCdWZmZXI9dGhpcy5mZnQuY3JlYXRlQ29tcGxleEFycmF5KCksdGhpcy5mcmVxQ29tcGxleEJ1ZmZlclNoaWZ0ZWQ9dGhpcy5mZnQuY3JlYXRlQ29tcGxleEFycmF5KCksdGhpcy50aW1lQ29tcGxleEJ1ZmZlcj10aGlzLmZmdC5jcmVhdGVDb21wbGV4QXJyYXkoKSx0aGlzLm1hZ25pdHVkZXM9bmV3IEZsb2F0MzJBcnJheSh0aGlzLmZmdFNpemUvMisxKSx0aGlzLnBlYWtJbmRleGVzPW5ldyBJbnQzMkFycmF5KHRoaXMubWFnbml0dWRlcy5sZW5ndGgpLHRoaXMubmJQZWFrcz0wfXByb2Nlc3NPTEEodCxlLHMpe2xldCByPXMucGl0Y2hGYWN0b3Jbcy5waXRjaEZhY3Rvci5sZW5ndGgtMV07cjwwJiYocj1yKi4yNSkscj1NYXRoLm1heCgwLHIrMSk7Zm9yKGxldCBpPTA7aTx0aGlzLm5iSW5wdXRzO2krKylmb3IobGV0IG89MDtvPHRbaV0ubGVuZ3RoO28rKyl7Y29uc3QgYT10W2ldW29dLHU9ZVtpXVtvXTt0aGlzLmFwcGx5SGFubldpbmRvdyhhKSx0aGlzLmZmdC5yZWFsVHJhbnNmb3JtKHRoaXMuZnJlcUNvbXBsZXhCdWZmZXIsYSksdGhpcy5jb21wdXRlTWFnbml0dWRlcygpLHRoaXMuZmluZFBlYWtzKCksdGhpcy5zaGlmdFBlYWtzKHIpLHRoaXMuZmZ0LmNvbXBsZXRlU3BlY3RydW0odGhpcy5mcmVxQ29tcGxleEJ1ZmZlclNoaWZ0ZWQpLHRoaXMuZmZ0LmludmVyc2VUcmFuc2Zvcm0odGhpcy50aW1lQ29tcGxleEJ1ZmZlcix0aGlzLmZyZXFDb21wbGV4QnVmZmVyU2hpZnRlZCksdGhpcy5mZnQuZnJvbUNvbXBsZXhBcnJheSh0aGlzLnRpbWVDb21wbGV4QnVmZmVyLHUpLHRoaXMuYXBwbHlIYW5uV2luZG93KHUpfXRoaXMudGltZUN1cnNvcis9dGhpcy5ob3BTaXplfWFwcGx5SGFubldpbmRvdyh0KXtmb3IobGV0IGU9MDtlPHRoaXMuYmxvY2tTaXplO2UrKyl0W2VdKj10aGlzLmhhbm5XaW5kb3dbZV0qMS42Mn1jb21wdXRlTWFnbml0dWRlcygpe2xldCB0PTAsZT0wO2Zvcig7dDx0aGlzLm1hZ25pdHVkZXMubGVuZ3RoOyl7Y29uc3Qgcz10aGlzLmZyZXFDb21wbGV4QnVmZmVyW2VdLHI9dGhpcy5mcmVxQ29tcGxleEJ1ZmZlcltlKzFdO3RoaXMubWFnbml0dWRlc1t0XT1zKioyK3IqKjIsdCs9MSxlKz0yfX1maW5kUGVha3MoKXt0aGlzLm5iUGVha3M9MDtsZXQgdD0yO2NvbnN0IGU9dGhpcy5tYWduaXR1ZGVzLmxlbmd0aC0yO2Zvcig7dDxlOyl7Y29uc3Qgcz10aGlzLm1hZ25pdHVkZXNbdF07aWYodGhpcy5tYWduaXR1ZGVzW3QtMV0+PXN8fHRoaXMubWFnbml0dWRlc1t0LTJdPj1zKXt0Kys7Y29udGludWV9aWYodGhpcy5tYWduaXR1ZGVzW3QrMV0+PXN8fHRoaXMubWFnbml0dWRlc1t0KzJdPj1zKXt0Kys7Y29udGludWV9dGhpcy5wZWFrSW5kZXhlc1t0aGlzLm5iUGVha3NdPXQsdGhpcy5uYlBlYWtzKyssdCs9Mn19c2hpZnRQZWFrcyh0KXt0aGlzLmZyZXFDb21wbGV4QnVmZmVyU2hpZnRlZC5maWxsKDApO2ZvcihsZXQgZT0wO2U8dGhpcy5uYlBlYWtzO2UrKyl7Y29uc3Qgcz10aGlzLnBlYWtJbmRleGVzW2VdLHI9VShzKnQpO2lmKHI+dGhpcy5tYWduaXR1ZGVzLmxlbmd0aClicmVhaztsZXQgaT0wLG89dGhpcy5mZnRTaXplO2U+MCYmKGk9cy1VKChzLXRoaXMucGVha0luZGV4ZXNbZS0xXSkvMikpLGU8dGhpcy5uYlBlYWtzLTEmJihvPXMrWnQoKHRoaXMucGVha0luZGV4ZXNbZSsxXS1zKS8yKSk7Y29uc3QgYT1pLXMsdT1vLXMsYz1rKnRoaXMuaW52ZmZ0U2l6ZSooci1zKSxoPU1hdGguY29zKGMqdGhpcy50aW1lQ3Vyc29yKSxmPU1hdGguc2luKGMqdGhpcy50aW1lQ3Vyc29yKTtmb3IobGV0IGQ9YTtkPHU7ZCsrKXtjb25zdCBsPXMrZCxwPXIrZDtpZihwPj10aGlzLm1hZ25pdHVkZXMubGVuZ3RoKWJyZWFrO2NvbnN0IG09MipsLEk9bSsxLGc9dGhpcy5mcmVxQ29tcGxleEJ1ZmZlclttXSx2PXRoaXMuZnJlcUNvbXBsZXhCdWZmZXJbSV0sdz1nKmgtdipmLFA9ZypmK3YqaCxTPTIqcCxWPVMrMTt0aGlzLmZyZXFDb21wbGV4QnVmZmVyU2hpZnRlZFtTXSs9dyx0aGlzLmZyZXFDb21wbGV4QnVmZmVyU2hpZnRlZFtWXSs9UH19fX1yZWdpc3RlclByb2Nlc3NvcigicGhhc2Utdm9jb2Rlci1wcm9jZXNzb3IiLGFlKTtjbGFzcyBjZSBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3Nvcntjb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5waGk9LVIsdGhpcy5ZMD0wLHRoaXMuWTE9MCx0aGlzLlBXPVIsdGhpcy5CPTIuMyx0aGlzLmRwaGlmPTAsdGhpcy5lbnZmPTB9c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToiYmVnaW4iLGRlZmF1bHRWYWx1ZTowLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksbWluOjB9LHtuYW1lOiJlbmQiLGRlZmF1bHRWYWx1ZTowLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksbWluOjB9LHtuYW1lOiJmcmVxdWVuY3kiLGRlZmF1bHRWYWx1ZTo0NDAsbWluOk51bWJlci5FUFNJTE9OfSx7bmFtZToiZGV0dW5lIixkZWZhdWx0VmFsdWU6MCxtaW46TnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFl9LHtuYW1lOiJwdWxzZXdpZHRoIixkZWZhdWx0VmFsdWU6MSxtaW46MCxtYXg6TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZfV19cHJvY2Vzcyh0LGUscyl7aWYodGhpcy5kaXNjb25uZWN0ZWQpcmV0dXJuITE7aWYoY3VycmVudFRpbWU8PXMuYmVnaW5bMF0pcmV0dXJuITA7aWYoY3VycmVudFRpbWU+PXMuZW5kWzBdKXJldHVybiExO2NvbnN0IHI9ZVswXTtsZXQgaT0xLG87Zm9yKGxldCBhPTA7YTwoclswXS5sZW5ndGg/PzApO2ErKyl7Y29uc3QgdT0oMS1UKGIocy5wdWxzZXdpZHRoLGEpLC0uOTksLjk5KSkqUixjPWIocy5kZXR1bmUsYSksaD1aKGIocy5mcmVxdWVuY3ksYSksYy8xMDApO289aCprKnEsdGhpcy5kcGhpZis9LjEqKG8tdGhpcy5kcGhpZiksaSo9Ljk5OTgsdGhpcy5lbnZmKz0uMSooaS10aGlzLmVudmYpLHRoaXMuQj0yLjMqKDEtMWUtNCpoKSx0aGlzLkI8MCYmKHRoaXMuQj0wKSx0aGlzLnBoaSs9dGhpcy5kcGhpZix0aGlzLnBoaT49UiYmKHRoaXMucGhpLT1rKTtsZXQgZj1NYXRoLmNvcyh0aGlzLnBoaSt0aGlzLkIqdGhpcy5ZMCk7dGhpcy5ZMD0uNSooZit0aGlzLlkwKTtsZXQgZD1NYXRoLmNvcyh0aGlzLnBoaSt0aGlzLkIqdGhpcy5ZMSt1KTt0aGlzLlkxPS41KihkK3RoaXMuWTEpO2ZvcihsZXQgbD0wO2w8ci5sZW5ndGg7bCsrKXJbbF1bYV09LjE1KihmLWQpKnRoaXMuZW52Zn1yZXR1cm4hMH19cmVnaXN0ZXJQcm9jZXNzb3IoInB1bHNlLW9zY2lsbGF0b3IiLGNlKTtjb25zdCBtdD17Yml0QzpmdW5jdGlvbihuLHQsZSl7cmV0dXJuIG4mdD9lOjB9LGJyOmZ1bmN0aW9uKG4sdD04KXtpZih0PjMyKXRocm93IG5ldyBFcnJvcigiYnIoKSBTaXplIGNhbm5vdCBiZSBncmVhdGVyIHRoYW4gMzIiKTtsZXQgZT0wO2ZvcihsZXQgcz0wO3M8dDtzKyspZXw9bXQuYml0QyhuLDE8PHMsMTw8dC0ocysxKSk7cmV0dXJuIGV9LHNpbmY6ZnVuY3Rpb24obil7cmV0dXJuIE1hdGguc2luKG4qUi8xMjgpfSxjb3NmOmZ1bmN0aW9uKG4pe3JldHVybiBNYXRoLmNvcyhuKlIvMTI4KX0sdGFuZjpmdW5jdGlvbihuKXtyZXR1cm4gTWF0aC50YW4obipSLzEyOCl9LHJlZ0c6ZnVuY3Rpb24obix0KXtyZXR1cm4gdC50ZXN0KG4udG9TdHJpbmcoMikpfX07bGV0IHR0LHZ0O2Z1bmN0aW9uIHVlKG4pe2lmKHR0PT1udWxsKXt0dD1PYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhNYXRoKSx2dD10dC5tYXAocz0+TWF0aFtzXSk7Y29uc3QgdD1PYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhtdCksZT10Lm1hcChzPT5tdFtzXSk7dHQucHVzaCgiaW50Iiwid2luZG93IiwuLi50KSx2dC5wdXNoKE1hdGguZmxvb3IsZ2xvYmFsVGhpcywuLi5lKX1yZXR1cm4gbmV3IEZ1bmN0aW9uKC4uLnR0LCJ0IixgcmV0dXJuIDAsCiR7bnx8MH07YCkuYmluZChnbG9iYWxUaGlzLC4uLnZ0KX1jbGFzcyBoZSBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3Nvcntjb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5wb3J0Lm9ubWVzc2FnZT10PT57bGV0e2NvZGVUZXh0OmV9PXQuZGF0YTtjb25zdHtieXRlQmVhdFN0YXJ0VGltZTpzfT10LmRhdGE7cyE9bnVsbCYmKHRoaXMudD0wLHRoaXMuaW5pdGlhbE9mZnNldD1NYXRoLmZsb29yKHMpKSxlPWUudHJpbSgpLnJlcGxhY2UoL15ldmFsXCh1bmVzY2FwZVwoZXNjYXBlKD86YHxcKCd8XCgifFwoYCkoLio/KSg/OmB8J1wpfCJcKXxgXCkpLnJlcGxhY2VcKFwvdVwoXC5cLlwpXC9nLFsiJ2BdXCQxJVsiJ2BdXClcKVwpJC8sKHIsaSk9PnVuZXNjYXBlKGVzY2FwZShpKS5yZXBsYWNlKC91KC4uKS9nLCIkMSUiKSkpLHRoaXMuZnVuYz11ZShlKX0sdGhpcy5pbml0aWFsT2Zmc2V0PTAsdGhpcy50PW51bGwsdGhpcy5mdW5jPW51bGx9c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToiYmVnaW4iLGRlZmF1bHRWYWx1ZTowLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksbWluOjB9LHtuYW1lOiJmcmVxdWVuY3kiLGRlZmF1bHRWYWx1ZTo0NDAsbWluOk51bWJlci5FUFNJTE9OfSx7bmFtZToiZGV0dW5lIixkZWZhdWx0VmFsdWU6MCxtaW46TnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFl9LHtuYW1lOiJlbmQiLGRlZmF1bHRWYWx1ZTowLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksbWluOjB9XX1wcm9jZXNzKHQsZSxzKXtpZih0aGlzLmRpc2Nvbm5lY3RlZClyZXR1cm4hMTtpZihjdXJyZW50VGltZTw9cy5iZWdpblswXSlyZXR1cm4hMDtpZihjdXJyZW50VGltZT49cy5lbmRbMF0pcmV0dXJuITE7dGhpcy50PT1udWxsJiYodGhpcy50PXMuYmVnaW5bMF0qc2FtcGxlUmF0ZSk7Y29uc3Qgcj1lWzBdLGk9MjU2KnE7Zm9yKGxldCBvPTA7bzxyWzBdLmxlbmd0aDtvKyspe2NvbnN0IGE9YihzLmRldHVuZSxvKSx1PVooYihzLmZyZXF1ZW5jeSxvKSxhLzEwMCksYz1pKnUqdGhpcy50K3RoaXMuaW5pdGlhbE9mZnNldCxmPSh0aGlzLmZ1bmMoYykmMjU1KS8xMjcuNS0xLGQ9VChmKi4yLC0uNCwuNCk7Zm9yKGxldCBsPTA7bDxyLmxlbmd0aDtsKyspcltsXVtvXT1kO3RoaXMudCsrfXJldHVybiEwfX1yZWdpc3RlclByb2Nlc3NvcigiYnl0ZS1iZWF0LXByb2Nlc3NvciIsaGUpO2NsYXNzIGxlIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29ye3N0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKXtyZXR1cm5be25hbWU6ImJlZ2luIixkZWZhdWx0VmFsdWU6MH0se25hbWU6ImVuZCIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJhdHRhY2siLGRlZmF1bHRWYWx1ZTouMDA1LG1pblZhbHVlOjB9LHtuYW1lOiJkZWNheSIsZGVmYXVsdFZhbHVlOi4xNCxtaW5WYWx1ZTowfSx7bmFtZToic3VzdGFpbiIsZGVmYXVsdFZhbHVlOjAsbWluVmFsdWU6MCxtYXhWYWx1ZToxfSx7bmFtZToicmVsZWFzZSIsZGVmYXVsdFZhbHVlOi4xLG1pblZhbHVlOjB9LHtuYW1lOiJhdHRhY2tDdXJ2ZSIsZGVmYXVsdFZhbHVlOjAsbWluVmFsdWU6LTEsbWF4VmFsdWU6MX0se25hbWU6ImRlY2F5Q3VydmUiLGRlZmF1bHRWYWx1ZTowLG1pblZhbHVlOi0xLG1heFZhbHVlOjF9LHtuYW1lOiJyZWxlYXNlQ3VydmUiLGRlZmF1bHRWYWx1ZTowLG1pblZhbHVlOi0xLG1heFZhbHVlOjF9LHtuYW1lOiJwZWFrIixkZWZhdWx0VmFsdWU6MX0se25hbWU6InJldHJpZ2dlciIsZGVmYXVsdFZhbHVlOjEsbWluVmFsdWU6MCxtYXhWYWx1ZToxfV19Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMudmFsPTAsdGhpcy5zZWdJZHg9MCx0aGlzLnN0YXRlPTAsdGhpcy5iZWdpblRpbWU9MCx0aGlzLmVuZFRpbWU9MCx0aGlzLmF0dGFja1N0YXJ0PTB9X3dhcnAodCxlLHM9OCl7aWYodD09PTB8fHQ9PT0xKXJldHVybiB0O2lmKGU+MCl7Y29uc3Qgcj0xK3MqZTtyZXR1cm4gMS1NYXRoLnBvdygxLXQscil9ZWxzZXtjb25zdCByPTEtcyplO3JldHVybiBNYXRoLnBvdyh0LHIpfX1fYWR2YW5jZSh0LGUscyxyKXtpZihzPT09MHx8dD09PWUpdGhpcy52YWw9ZTtlbHNle2NvbnN0IGk9TWF0aC5taW4oMSwoY3VycmVudFRpbWUtdGhpcy5iZWdpblRpbWUpL3MpLG89dGhpcy5fd2FycChpLHIpO3RoaXMudmFsPXQrKGUtdCkqb319cHJvY2Vzcyh0LGUscyl7Y29uc3Qgcj1lWzBdWzBdO2lmKCFyKXJldHVybiEwO2NvbnN0IGk9YihzLmJlZ2luLDApLG89YihzLnJldHJpZ2dlciwwKT49LjU7aSE9PXRoaXMuYmVnaW5UaW1lJiYodGhpcy5zdGF0ZT09PTB8fG8pJiYodGhpcy5iZWdpblRpbWU9aSx0aGlzLnN0YXRlPTEsdGhpcy5lbmRUaW1lPWIocy5lbmQsMCksdGhpcy5hdHRhY2tTdGFydD10aGlzLnZhbCk7Y29uc3QgYT10aGlzLmVuZFRpbWUtdGhpcy5iZWdpblRpbWU7Zm9yKGxldCB1PTA7dTxyLmxlbmd0aDt1Kyspe2NvbnN0IGM9YihzLmF0dGFjayx1KSxoPWIocy5kZWNheSx1KSxmPWIocy5zdXN0YWluLHUpLGQ9YihzLnJlbGVhc2UsdSksbD1iKHMuYXR0YWNrQ3VydmUsdSkscD1iKHMuZGVjYXlDdXJ2ZSx1KSxtPWIocy5yZWxlYXNlQ3VydmUsdSksST1iKHMucGVhayx1KSxnPVt7dGltZTpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksc3RhcnQ6MCx0YXJnZXQ6MH0se3RpbWU6YyxzdGFydDp0aGlzLmF0dGFja1N0YXJ0LHRhcmdldDoxLGN1cnZlOmx9LHt0aW1lOmMraCxzdGFydDoxLHRhcmdldDpmLGN1cnZlOnB9LHt0aW1lOmEsc3RhcnQ6Zix0YXJnZXQ6Zn0se3RpbWU6YStkLHN0YXJ0OmYsdGFyZ2V0OjAsY3VydmU6bX1dO2xldHt0aW1lOnYsc3RhcnQ6dyx0YXJnZXQ6UCxjdXJ2ZTpTfT1nW3RoaXMuc3RhdGVdO2Zvcih0aGlzLl9hZHZhbmNlKHcsUCx2LFMpO2N1cnJlbnRUaW1lLXRoaXMuYmVnaW5UaW1lPj12Oyl0aGlzLnN0YXRlPSh0aGlzLnN0YXRlKzEpJWcubGVuZ3RoLHY9Z1t0aGlzLnN0YXRlXS50aW1lO3JbdV09dGhpcy52YWwqSX1yZXR1cm4hMH19cmVnaXN0ZXJQcm9jZXNzb3IoImVudmVsb3BlLXByb2Nlc3NvciIsbGUpO2NvbnN0IEI9T2JqZWN0LmZyZWV6ZSh7Tk9ORTowLEFTWU06MSxNSVJST1I6MixCRU5EUDozLEJFTkRNOjQsQkVORE1QOjUsU1lOQzo2LFFVQU5UOjcsRk9MRDo4LFBXTTo5LE9SQklUOjEwLFNQSU46MTEsQ0hBT1M6MTIsUFJJTUVTOjEzLEJJTkFSWToxNCxCUk9XTklBTjoxNSxSRUNJUFJPQ0FMOjE2LFdPUk1IT0xFOjE3LExPR0lTVElDOjE4LFNJR01PSUQ6MTksRlJBQ1RBTDoyMCxGTElQOjIxfSk7ZnVuY3Rpb24gZmUobil7cmV0dXJuIG49bisyMTI3OTEyMjE0KyhuPDwxMiksbj1uXjMzNDUwNzI3MDBebj4+PjE5LG49biszNzQ3NjEzOTMrKG48PDUpLG49biszNTUwNjM1MTE2Xm48PDksbj1uKzQyNTE5OTM3OTcrKG48PDMpLG49bl4zMDQyNTk0NTY5Xm4+Pj4xNixuPj4+MH1jb25zdCBGdD1uPT4oZmUobik+Pj44KS8xNjc3NzIxNjtmdW5jdGlvbiBkZShuLHQpe2xldCBlPTA7Zm9yKGxldCBzPTA7czx0O3MrKyllPWU8PDF8biYxLG4+Pj49MTtyZXR1cm4gZX1mdW5jdGlvbiBwZShuKXtjb25zdCB0PU1hdGguZmxvb3IobiksZT1uLXQscz1GdCh0KSxyPUZ0KHQrMSk7cmV0dXJuIHMrKHItcykqZX1mdW5jdGlvbiBtZShuLHQ9NCl7bGV0IGU9LjUscz0wLHI9MCxpPTE7Zm9yKGxldCBvPTA7bzx0O28rKylzKz1lKnBlKG4qaSkscis9ZSxlKj0uNSxpKj0yO3JldHVybiBzL3IqMi0xfWNvbnN0IGd0PXt9O2NsYXNzIHZlIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29ye3N0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKXtyZXR1cm5be25hbWU6ImJlZ2luIixkZWZhdWx0VmFsdWU6MCxtaW46MCxtYXg6TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZfSx7bmFtZToiZW5kIixkZWZhdWx0VmFsdWU6MCxtaW46MCxtYXg6TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZfSx7bmFtZToiZnJlcXVlbmN5IixkZWZhdWx0VmFsdWU6NDQwLG1pbjpOdW1iZXIuRVBTSUxPTn0se25hbWU6ImRldHVuZSIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJmcmVxc3ByZWFkIixkZWZhdWx0VmFsdWU6LjE4LG1pbjowfSx7bmFtZToicG9zaXRpb24iLGRlZmF1bHRWYWx1ZTowLG1pbjowLG1heDoxfSx7bmFtZToid2FycCIsZGVmYXVsdFZhbHVlOjAsbWluOjAsbWF4OjF9LHtuYW1lOiJ3YXJwTW9kZSIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJ2b2ljZXMiLGRlZmF1bHRWYWx1ZToxLG1pbjoxLGF1dG9tYXRpb25SYXRlOiJrLXJhdGUifSx7bmFtZToicGFuc3ByZWFkIixkZWZhdWx0VmFsdWU6LjcsbWluOjAsbWF4OjF9LHtuYW1lOiJwaGFzZXJhbmQiLGRlZmF1bHRWYWx1ZTowLG1pbjowLG1heDoxfV19Y29uc3RydWN0b3IodCl7c3VwZXIodCksdGhpcy5mcmFtZUxlbj0wLHRoaXMubnVtRnJhbWVzPTAsdGhpcy5waGFzZT1bXSx0aGlzLnBvcnQub25tZXNzYWdlPWU9Pntjb25zdHt0eXBlOnMscGF5bG9hZDpyfT1lLmRhdGF8fHt9O2lmKHM9PT0idGFibGUiKXtjb25zdCBpPXIua2V5O2lmKHRoaXMuZnJhbWVMZW49ci5mcmFtZUxlbiwhZ3RbaV0pe2NvbnN0IG89W3IuZnJhbWVzXTtsZXQgYT1vWzBdO2ZvcihsZXQgdT0xO3U8MTt1Kyspe2NvbnN0IGM9YS5sZW5ndGg+PjEsaD1hLm1hcChmPT57Y29uc3QgZD1uZXcgRmxvYXQzMkFycmF5KGMpO2ZvcihsZXQgbD0wO2w8YztsKyspZFtsXT0oZlsyKmxdK2ZbMipsKzFdKS8yO3JldHVybiBkfSk7aWYoby5wdXNoKGgpLGE9aCxjPD0zMilicmVha31ndFtpXT1vfXRoaXMudGFibGVzPWd0W2ldLHRoaXMubnVtRnJhbWVzPXRoaXMudGFibGVzWzBdLmxlbmd0aH19fV9taXJyb3IodCl7cmV0dXJuIDEtTWF0aC5hYnMoMip0LTEpfV90b0JpdHModCxlPTIscz0xMil7Y29uc3Qgcj1zKyhlLXMpKnQ7cmV0dXJue2I6cixuOlUoTWF0aC5wb3coMixyKSl9fV93YXJwUGhhc2UodCxlLHMpe3N3aXRjaChzKXtjYXNlIEIuTk9ORTpyZXR1cm4gdDtjYXNlIEIuQVNZTTp7Y29uc3Qgcj0uMDErLjk5KmU7cmV0dXJuIHQ8cj8uNSp0L3I6LjUrLjUqKHQtcikvKDEtcil9Y2FzZSBCLk1JUlJPUjpyZXR1cm4gdGhpcy5fbWlycm9yKHRoaXMuX3dhcnBQaGFzZSh0LGUsQi5BU1lNKSk7Y2FzZSBCLkJFTkRQOnJldHVybiBNYXRoLnBvdyh0LDErMyplKTtjYXNlIEIuQkVORE06cmV0dXJuIE1hdGgucG93KHQsMS8oMSszKmUpKTtjYXNlIEIuQkVORE1QOnJldHVybiBlPC41P3RoaXMuX3dhcnBQaGFzZSh0LDEtMiplLDMpOnRoaXMuX3dhcnBQaGFzZSh0LDIqZS0xLDIpO2Nhc2UgQi5TWU5DOntjb25zdCByPU1hdGgucG93KDE2LGUqKjIpO3JldHVybiB0KnIlMX1jYXNlIEIuUVVBTlQ6e2NvbnN0e246cn09dGhpcy5fdG9CaXRzKGUpO3JldHVybiBLKHQqcikvcn1jYXNlIEIuRk9MRDp7Y29uc3QgaT0xK01hdGgubWF4KDEsVSg3KmUpKTtyZXR1cm4gTWF0aC5hYnMoQXQoaSp0KS0uNSkqMn1jYXNlIEIuUFdNOntjb25zdCByPVQoLjUrLjQ5KigyKmUtMSksMCwxKTtyZXR1cm4gdDxyP3QvciouNTouNSsodC1yKS8oMS1yKSouNX1jYXNlIEIuT1JCSVQ6e2NvbnN0IHI9LjUqZTtyZXR1cm4gSCh0K3IqTWF0aC5zaW4oayozKnQpKX1jYXNlIEIuU1BJTjp7Y29uc3Qgcj0uNSplLHtuOml9PXRoaXMuX3RvQml0cyhlLDEsNik7cmV0dXJuIEgodCtyKk1hdGguc2luKGsqaSp0KSl9Y2FzZSBCLkNIQU9TOntjb25zdCBpPSgzLjcrLjMqZSkqdCooMS10KTtyZXR1cm4gVCgoMS1lKSp0K2UqaSwwLDEpfWNhc2UgQi5QUklNRVM6e2NvbnN0IHI9bz0+e2lmKG88MilyZXR1cm4hMTtpZihvJTI9PT0wKXJldHVybiBvPT09Mjtmb3IobGV0IGE9MzthKioyPD1vO2ErPTIpaWYobyVhPT09MClyZXR1cm4hMTtyZXR1cm4hMH07bGV0e246aX09dGhpcy5fdG9CaXRzKGUsMyk7Zm9yKDshcihpKTspaSsrO3JldHVybiBLKHQqaSkvaX1jYXNlIEIuQklOQVJZOntsZXR7YjpyfT10aGlzLl90b0JpdHMoZSwzKTtyPVUocik7Y29uc3QgaT0xPDxyLG89Syh0KmkpO3JldHVybiBkZShvLHIpL2l9Y2FzZSBCLkJST1dOSUFOOntjb25zdCByPS4yNSplKm1lKDY0KnQsNCk7cmV0dXJuIEgodCtyKX1jYXNlIEIuUkVDSVBST0NBTDp7Y29uc3Qgcj0yKzQqZSxpPXQqcixvPXQrKDEtdCkqcixhPW8+MWUtMTI/aS9vOjA7cmV0dXJuIFQoYSwwLDEpfWNhc2UgQi5XT1JNSE9MRTp7Y29uc3Qgcj1UKC44KmUsMCwxKSxpPS41KigxLXIpLG89LjUqKDErcik7cmV0dXJuIHQ8aT90L2kqLjU6dD5vPy41KigxKyh0LW8pLygxLW8pKTouNX1jYXNlIEIuTE9HSVNUSUM6e2xldCByPXQ7Y29uc3QgaT0zLjYrLjQqZSxvPTErVSgyKmUpO2ZvcihsZXQgYT0wO2E8bzthKyspcj1pKnIqKDEtcik7cmV0dXJuIFQociwwLDEpfWNhc2UgQi5TSUdNT0lEOntjb25zdCByPTErMTAqZSxpPXQtLjUsbz0xLygxK01hdGguZXhwKC1yKmkpKSxhPTEvKDErTWF0aC5leHAoLjUqcikpLHU9MS8oMStNYXRoLmV4cCgtLjUqcikpO3JldHVybihvLWEpLyh1LWEpfWNhc2UgQi5GUkFDVEFMOntjb25zdCByPS41Kk1hdGguc2luKGsqdCkqZTtyZXR1cm4gSCh0K3IpfWNhc2UgQi5GTElQOnJldHVybiB0O2RlZmF1bHQ6cmV0dXJuIHR9fV9zYW1wbGVGcmFtZSh0LGUpe2NvbnN0IHM9dC5sZW5ndGgscj1lKnM7bGV0IGk9cnwwO2k+PXMmJihpPTApO2NvbnN0IG89ci1pLGE9dFtpXTtsZXQgdT1pKzE7dT49cyYmKHU9MCk7Y29uc3QgYz10W3VdO3JldHVybiBhKyhjLWEpKm99X2Nob29zZU1pcCh0KXtjb25zdCBlPVQodCwxZS02LDY0KTtsZXQgcz0wO2Zvcig7cysxPCh0aGlzLnRhYmxlcz8ubGVuZ3RofHwxKSYmZTx0aGlzLnRhYmxlc1tzXVswXS5sZW5ndGgvODspcysrO3JldHVybiBzfXByb2Nlc3ModCxlLHMpe2lmKGN1cnJlbnRUaW1lPj1zLmVuZFswXSlyZXR1cm4hMTtpZihjdXJyZW50VGltZTw9cy5iZWdpblswXSlyZXR1cm4hMDtjb25zdCByPWVbMF1bMF0saT1lWzBdWzFdfHxlWzBdWzBdO2lmKCF0aGlzLnRhYmxlcylyZXR1cm4gci5maWxsKDApLGkhPT1yJiZpLnNldChyKSwhMDtjb25zdCBvPXMudm9pY2VzWzBdO2ZvcihsZXQgYT0wO2E8ci5sZW5ndGg7YSsrKXtjb25zdCB1PWIocy5kZXR1bmUsYSksYz1iKHMuZnJlcXNwcmVhZCxhKSxmPVQoYihzLnBvc2l0aW9uLGEpLDAsMSkqKHRoaXMubnVtRnJhbWVzLTEpLGQ9ZnwwLGw9Zi1kLHA9VChiKHMud2FycCxhKSwwLDEpLG09YihzLndhcnBNb2RlLGEpLEk9VChiKHMucGhhc2VyYW5kLGEpLDAsMSksZz1vPjE/VChiKHMucGFuc3ByZWFkLGEpLDAsMSk6MCx2PU1hdGguc3FydCguNS0uNSpnKSx3PU1hdGguc3FydCguNSsuNSpnKTtsZXQgUD1iKHMuZnJlcXVlbmN5LGEpO1A9WihQLHUvMTAwKTtjb25zdCBTPTEvTWF0aC5zcXJ0KG8pLFY9TnQobyxjKTtmb3IobGV0IE09MDtNPG87TSsrKXtjb25zdCB4PShNJjEpPT0xO2xldCB5PXYsQT13O3gmJih5PXcsQT12KTtjb25zdCBOPVooUCxWKE0pKSpxLEU9dGhpcy5fY2hvb3NlTWlwKE4pLE89dGhpcy50YWJsZXNbRV07dGhpcy5waGFzZVtNXT10aGlzLnBoYXNlW01dPz9NYXRoLnJhbmRvbSgpKkk7Y29uc3QgRj10aGlzLl93YXJwUGhhc2UodGhpcy5waGFzZVtNXSxwLG0pLEQ9dGhpcy5fc2FtcGxlRnJhbWUoT1tkXSxGKSxMPXRoaXMuX3NhbXBsZUZyYW1lKE9bTWF0aC5taW4odGhpcy5udW1GcmFtZXMtMSxkKzEpXSxGKTtsZXQgQz1VdChELEwsbCk7bT09PUIuRkxJUCYmdGhpcy5waGFzZVtNXTxwJiYoQz0tQyksclthXSs9Qyp5KlMsaVthXSs9QypBKlMsdGhpcy5waGFzZVtNXT1IKHRoaXMucGhhc2VbTV0rTil9fXJldHVybiEwfX1yZXR1cm4gcmVnaXN0ZXJQcm9jZXNzb3IoIndhdmV0YWJsZS1vc2NpbGxhdG9yLXByb2Nlc3NvciIsdmUpLGZ0LldhcnBNb2RlPUIsT2JqZWN0LmRlZmluZVByb3BlcnR5KGZ0LFN5bWJvbC50b1N0cmluZ1RhZyx7dmFsdWU6Ik1vZHVsZSJ9KSxmdH0pKHt9KTsK";let On;const tp=()=>(On=new AudioContext,On),I=()=>On||tp();function Ib(){return I().currentTime}let $s={};function ep(t,e){const n=I();if($s[t])return $s[t];const s=2*n.sampleRate,o=n.createBuffer(1,s,n.sampleRate),c=o.getChannelData(0);let i=0,u,a,l,p,f,b,g;u=a=l=p=f=b=g=0;for(let X=0;X<s;X++)if(t==="white")c[X]=Math.random()*2-1;else if(t==="brown"){let Z=Math.random()*2-1;c[X]=(i+.02*Z)/1.02,i=c[X]}else if(t==="pink"){let Z=Math.random()*2-1;u=.99886*u+Z*.0555179,a=.99332*a+Z*.0750759,l=.969*l+Z*.153852,p=.8665*p+Z*.3104856,f=.55*f+Z*.5329522,b=-.7616*b-Z*.016898,c[X]=u+a+l+p+f+b+g+Z*.5362,c[X]*=.11,g=Z*.115926}else if(t==="crackle"){const Z=e*.01;Math.random()<Z?c[X]=Math.random()*2-1:c[X]=0}return t!=="crackle"&&($s[t]=o),o}function to(t="white",e,n=.02){const o=I().createBufferSource();return o.buffer=ep(t,n),o.loop=!0,o.start(e),{node:o,stop:c=>o.stop(c)}}function jb(t,e,n){const s=to("pink",n),o=cp(t,s.node,e);return s.node.onended=()=>o.onended(),{node:o.node,stop:c=>s?.stop(c)}}const eo=["pink","white","brown","crackle"];function Rt(t){const e=I().createGain();return e.gain.value=t,e}function Un(t,e,n){const s=Rt(n);return t.connect(s),s.connect(e),s}const np=(t,e,n,s)=>s-n===0?0:(e-t)/(s-n);function Bt(t,e,n,s){const o=new AudioWorkletNode(t,e,s);return Object.entries(n).forEach(([c,i])=>{i!==void 0&&(o.parameters.get(c).value=i)}),o}const Et=(t,e,n,s,o,c,i,u,a,l="exponential")=>{e=ae(e),n=ae(n),s=ae(s),o=ae(o);const p=l==="exponential"?"exponentialRampToValueAtTime":"linearRampToValueAtTime";l==="exponential"&&(c=c===0?.001:c,i=i===0?.001:i);const f=i-c,b=i,g=c+s*f,X=a-u,Z=W=>{let F;if(e>W){let z=np(c,b,0,e);F=W*z+(c>b?c:0)}else F=(W-e)*np(b,g,0,n)+b;return l==="exponential"&&(F=F||.001),F};t.setValueAtTime(c,u),e>X?t[p](Z(X),a):e+n>X?(t[p](Z(e),u+e),t[p](Z(X),a)):(t[p](Z(e),u+e),t[p](Z(e+n),u+e+n),t.setValueAtTime(g,a)),t[p](c,a+o)};function Ob(t){return typeof t=="number"?t%5:{tri:0,triangle:0,sine:1,ramp:2,saw:3,square:4}[t]??0}function Xn(t,e,n,s={}){const{shape:o=0,...c}=s,{dcoffset:i=-.5,depth:u=1}=s,a={frequency:1,depth:u,skew:.5,phaseoffset:0,time:e,begin:e,end:n,shape:Ob(o),dcoffset:i,min:i*u,max:i*u+u,curve:1,...c};return Bt(t,"lfo-processor",a)}function sp(t,e,n,s,o,c){const i={threshold:e??-3,ratio:n??10,knee:s??10,attack:o??.005,release:c??.05};return new DynamicsCompressorNode(t,i)}const Dt=(t,e="linear",n)=>{const[i,u,a,l]=t;if(i==null&&u==null&&a==null&&l==null)return n??[.001,.001,1,.01];const p=a??(i!=null&&u==null||i==null&&u==null?1:.001);return[Math.max(i??0,.001),Math.max(u??0,.001),Math.min(p,1),Math.max(l??0,.01)]};function no(t,e,n,s,o){let{defaultDepth:c=1,depth:i,dcoffset:u,...a}=o;i==null&&(i=Object.values(a).some(f=>f!=null)?c:0);let l;return i&&(l=Xn(t,n,s,{depth:i,dcoffset:u,...a}),l.connect(e)),l}function so(t,e,n,s,o,c){let{amount:i,offset:u,defaultAmount:a=1,curve:l="linear",values:p,holdEnd:f,defaultValues:b}=o;i==null&&(i=p.some(z=>z!=null)?a:0);const g=u??0,X=i+g;if(Math.abs(X-g)){const[F,z,v,x]=Dt(p,l,b);Et(e,F,z,v,x,g,X,n,f,l)}const W=no(t,e,n,s,c);return{lfo:W,disconnect:()=>W?.disconnect()}}function _n(t,e,n,s,o,c){let{frequency:i,anchor:u,env:a,type:l,model:p,q:f=1,drive:b=.69,depth:g,depthfrequency:X,dcoffset:Z=-.5,skew:W,shape:F,rate:z,sync:v}=s,x,R;p==="ladder"?(R=Bt(t,"ladder-processor",{frequency:i,q:f,drive:b}),x=R.parameters.get("frequency")):(R=t.createBiquadFilter(),R.type=l,R.Q.value=f,R.frequency.value=i,x=R.frequency);const A=[s.attack,s.decay,s.sustain,s.release],[O,j,tt,k]=Dt(A,"exponential",[.005,.14,0,.1]);if([...A,a].some(U=>U!==void 0)){a=ae(a,1,!0),u=ae(u,0,!0);const U=Math.abs(a),dt=U*u;let q=ge(2**-dt*i,0,2e4),st=ge(2**(U-dt)*i,0,2e4);a<0&&([q,st]=[st,q]),Et(x,O,j,tt,k,q,st,e,n,"exponential")}v!=null&&(z=o*v);const H=[g,X,W,F,z].some(U=>U!==void 0);let Q;if(H){g=g??1;const U=c/o,q={depth:X??(g??1)*i,dcoffset:Z,skew:W,shape:F,frequency:z??o,min:-i+30,max:2e4-i,time:U,curve:1};Q=no(t,x,e,n,q)}return{filter:R,lfo:Q}}let op=t=>t<.5?1:1-(t-.5)/.5;function cp(t,e,n=0){const s=I();if(!n)return t;let o=s.createGain(),c=s.createGain();t.connect(o),e.connect(c),o.gain.value=op(n),c.gain.value=op(1-n);let i=s.createGain();return o.connect(i),c.connect(i),{node:i,onended:()=>{o.disconnect(i),c.disconnect(i),t.disconnect(o),e.disconnect(c)}}}let Ub=["linear","exponential"];function Je(t,e,n,s){if((e.pattack??e.pdecay??e.psustain??e.prelease??e.penv)===void 0)return;const c=ae(e.penv,1,!0),i=Ub[e.pcurve??0];let[u,a,l,p]=Dt([e.pattack,e.pdecay,e.psustain,e.prelease],i,[.2,.001,1,.001]),f=e.panchor??l;const b=c*100,g=0-b*f,X=b-b*f;Et(t,u,a,l,p,g,X,n,s,i)}function Ie(t,e,n){const{vibmod:s=.5,vib:o}=e;let c;if(o>0){c=I().createOscillator(),c.frequency.value=o;const i=I().createGain();return i.gain.value=s*100,c.connect(i),i.connect(t),c.onended=()=>{i.disconnect(t),c.disconnect(i)},c.start(n),c}}function _b(t,e,n=I()){const s=n.currentTime;Ce(n,t,s,e)}function Ce(t,e,n,s){const o=new ConstantSourceNode(t),c=Rt(0);return c.connect(t.destination),o.connect(c),o.onended=()=>{try{c.disconnect()}catch{}try{o.disconnect()}catch{}e()},o.start(n),o.stop(s),o}const Qb=(t,e=1,n="sine")=>{const s=I();let o;eo.includes(n)?(o=s.createBufferSource(),o.buffer=ep(n,2),o.loop=!0):(o=s.createOscillator(),o.type=n,o.frequency.value=t),o.start();const c=Rt(e);return o.connect(c),{node:c,stop:i=>o.stop(i),osc:o}},qb=(t,e,n,s="sine")=>{const c=t.value*e,i=c*n;return Qb(c,i,s)};function Gn(t,e,n){const{fmh:s=1,fmi:o,fmenv:c="exp",fmattack:i,fmdecay:u,fmsustain:a,fmrelease:l,fmvelocity:p,fmwave:f="sine",duration:b}=e;let g,X=()=>{};if(o){const W=I().createGain(),F=qb(t,s,o,f);if(g=F.node,X=F.stop,![i,u,a,l,p].some(z=>z!==void 0))g.connect(t);else{const[z,v,x,R]=Dt([i,u,a,l]),A=n+b;Et(W.gain,z,v,x,R,0,1,n,A,c==="exp"?"exponential":"linear"),g.connect(W),W.connect(t)}F.osc.onended=()=>{W.disconnect(),g.disconnect(),F.osc.disconnect()}}return{stop:X}}const rp=t=>t/(1+t),$b=(t,e)=>(t%e+e)%e,tg=(t,e)=>(1+e)*t/(1+e*Math.abs(t)),je=(t,e)=>Math.tanh(t*(1+e)),eg=(t,e)=>ge((1+e)*t,-1,1),ip=(t,e)=>{let n=(1+.5*e)*t;const s=$b(n+1,4);return 1-Math.abs(s-2)},ng=(t,e)=>Math.sin(Math.PI/2*ip(t,e)),sg=(t,e)=>{const n=rp(Math.log1p(e)),s=(t-n/3*t*t*t)/(1-n/3);return je(s,e)},up=(t,e,n=!1)=>{const s=1+2*e,c=.07*rp(Math.log1p(e)),i=je(t+c,2*e),u=je(n?c:-t+c,2*e),a=i-u,l=1/Math.cosh(s*c),p=l*l,f=Math.max(1e-8,(n?1:2)*s*p);return je(a/f,e)},oo={scurve:tg,soft:je,hard:eg,cubic:sg,diode:up,asym:(t,e)=>up(t,e,!0),fold:ip,sinefold:ng,chebyshev:(t,e)=>{const n=10*Math.log1p(e);let s=1,o=t,c,i=0;for(let u=1;u<64;u++){if(u<2){i+=u==0?s:o;continue}c=2*t*s-o,o=s,s=c,u%2===0&&(i+=Math.min(1.3*n/u,2)*c)}return je(i,n/20)}},Zn=Object.freeze(Object.keys(oo)),og=t=>{let e=t;typeof t=="string"&&(e=Zn.indexOf(t),e===-1&&(Gt(`[superdough] Could not find waveshaping algorithm ${t}.
        Available options are ${Zn.join(", ")}.
        Defaulting to ${Zn[0]}.`),e=0));const n=Zn[e%Zn.length];return oo[n]},ap=(t,e,n)=>Bt(I(),"distort-processor",{distort:t,postgain:e},{processorOptions:{algorithm:n}}),Le=(t,e=36)=>{let{note:n,freq:s,octave:o=0}=t;return n=n||e,typeof n=="string"&&(n=jn(n)),!s&&typeof n=="number"&&(s=O0(n)),s*=Math.pow(2,o),Number(s)},Oe=t=>{t!=null&&(t.disconnect(),t.parameters.get("end")?.setValueAtTime(0,0))};let cg=Symbol("clean"),Qt=[],Xe=0;const Qn=4;let rg=t=>{let e=[],n={get(){return n.lc||n.listen(()=>{})(),n.value},lc:0,listen(s){return n.lc=e.push(s),()=>{for(let c=Xe+Qn;c<Qt.length;)Qt[c]===s?Qt.splice(c,Qn):c+=Qn;let o=e.indexOf(s);~o&&(e.splice(o,1),--n.lc||n.off())}},notify(s,o){let c=!Qt.length;for(let i of e)Qt.push(i,n.value,s,o);if(c){for(Xe=0;Xe<Qt.length;Xe+=Qn)Qt[Xe](Qt[Xe+1],Qt[Xe+2],Qt[Xe+3]);Qt.length=0}},off(){},set(s){let o=n.value;o!==s&&(n.value=s,n.notify(o))},subscribe(s){let o=n.listen(s);return s(n.value),o},value:t};return process.env.NODE_ENV!=="production"&&(n[cg]=()=>{e=[],n.lc=0,n.off()}),n},ig=(t={})=>{let e=rg(t);return e.setKey=function(n,s){let o=e.value;typeof s>"u"&&n in e.value?(e.value={...e.value},delete e.value[n],e.notify(o,n)):e.value[n]!==s&&(e.value={...e.value,[n]:s},e.notify(o,n))},e};const co={},ro={},ug=t=>co[t];function ag(t,e){var n=1024;if(t<n)return t+" B";var s=["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],o=-1;do t/=n,++o;while(t>=n);return t.toFixed(1)+" "+s[o]}function lp(t,e){const{speed:n=1}=t,{transpose:s,url:o,index:c,midi:i,label:u}=Q0(t,e);let a=Math.abs(n)*Math.pow(2,s/12);return{transpose:s,url:o,index:c,midi:i,label:u,playbackRate:a}}const dp=async(t,e,n)=>{let{url:s,label:o,playbackRate:c}=lp(t,e);n&&(s=await n(s));const i=I(),u=await io(s,i,o);return t.unit==="c"&&(c=c*u.duration),{buffer:u,playbackRate:c}},pp=async(t,e,n)=>{let{buffer:s,playbackRate:o}=await dp(t,e,n);t.speed<0&&(s=hp(s));const i=I().createBufferSource();i.buffer=s,i.playbackRate.value=o;const{loopBegin:u=0,loopEnd:a=1,begin:l=0,end:p=1}=t,f=l*i.buffer.duration;t.loop&&(i.loop=!0,i.loopStart=u*i.buffer.duration-f,i.loopEnd=a*i.buffer.duration-f);const g=i.buffer.duration/i.playbackRate.value,X=(p-l)*g;return{bufferSource:i,offset:f,bufferDuration:g,sliceDuration:X}},io=(t,e,n,s=0)=>{const o=n?`sound "${n}:${s}"`:"sample";if(t=t.replace("#","%23"),!ro[t]){Gt(`[sampler] load ${o}..`,"load-sample",{url:t});const c=Date.now();ro[t]=fetch(t).then(i=>i.arrayBuffer()).then(async i=>{const u=Date.now()-c,a=ag(i.byteLength);Gt(`[sampler] load ${o}... done! loaded ${a} in ${u}ms`,"loaded-sample",{url:t});const l=await e.decodeAudioData(i);return co[t]=l,l})}return ro[t]};function hp(t){const e=I(),n=e.createBuffer(t.numberOfChannels,t.length,e.sampleRate);for(let s=0;s<t.numberOfChannels;s++)n.copyToChannel(t.getChannelData(s).slice().reverse(),s,s);return n}const lg=t=>co[t];function fp(t){if(t.startsWith("bubo:")){const[e,n]=t.split(":");t=`github:Bubobubobubobubo/dough-${n}`}return t}function mp(t,e=""){if(!t.startsWith("github:"))throw new Error('expected "github:" at the start of pseudoUrl');let n=t.slice(7);n=n.endsWith("/")?n.slice(0,-1):n;let s=n.split("/"),o=s[0],c=s.length>=2?s[1]:"samples",i=s.length>=3?s[2]:"main",u=s.slice(3);return u.push(e||""),u=u.join("/"),`https://raw.githubusercontent.com/${o}/${c}/${i}/${u}`}const yp=(t,e,n=t._base||"")=>Object.entries(t).forEach(([s,o])=>{if(typeof o=="string"&&(o=[o]),typeof o!="object")throw new Error("wrong sample map format for "+s);n=o._base||n,n=fp(n),n.startsWith("github:")&&(n=mp(n,""));const c=i=>n+i;Array.isArray(o)?o=o.map(c):o=Object.fromEntries(Object.entries(o).map(([i,u])=>[i,(typeof u=="string"?[u]:u).map(c)])),e(s,o)});let bp={};function dg(t,e){bp[t]=e}function pg(t){const e=Object.entries(bp).find(([n])=>t.startsWith(n));if(e)return e[1]}async function hg(t){const e=pg(t);if(e)return e(t);if(t=fp(t),t.startsWith("github:")&&(t=mp(t,"strudel.json")),t.startsWith("local:")&&(t="http://localhost:5432"),t.startsWith("shabda:")){let[o,c]=t.split("shabda:");t=`https://shabda.ndre.gr/${c}.json?strudel=1`}if(t.startsWith("shabda/speech")){let[o,c]=t.split("shabda/speech");c=c.startsWith("/")?c.substring(1):c;let[i,u]=c.split(":"),a="f",l="en-GB";i&&([l,a]=i.split("/")),t=`https://shabda.ndre.gr/speech/${u}.json?gender=${a}&language=${l}&strudel=1'`}if(typeof fetch!="function")return;const n=q0(t);if(typeof fetch>"u")return;const s=await fetch(t).then(o=>o.json()).catch(o=>{throw console.error(o),new Error(`error loading "${t}"`)});return[s,s._base||n]}const uo=async(t,e=t._base||"",n={})=>{if(typeof t=="string"){const[c,i]=await hg(t);return uo(c,e||i,n)}const{prebake:s,tag:o}=n;yp(t,(c,i)=>{Gp(c,i,{baseUrl:e,prebake:s,tag:o})},e)},gp=[];async function Xp(t,e,n,s,o){let{s:c,nudge:i=0,cut:u,loop:a,clip:l=void 0,n:p=0,speed:f=1,duration:b}=e;if(f===0)return;const g=I();let[X,Z,W,F]=Dt([e.attack,e.decay,e.sustain,e.release]);const{bufferSource:z,sliceDuration:v,offset:x}=await pp(e,s,o);if(g.currentTime>t){Gt(`[sampler] still loading sound "${c}:${p}"`,"highlight");return}if(!z){Gt(`[sampler] could not load "${c}:${p}"`,"error");return}let R=Ie(z.detune,e,t);const A=t+i;z.start(A,x);const O=g.createGain(),j=z.connect(O);l==null&&a==null&&e.release==null&&(b=v);let tt=t+b;Et(j.gain,X,Z,W,F,0,1,t,tt,"linear"),Je(z.detune,e,t,tt);const k=g.createGain();j.connect(k),z.onended=function(){z.disconnect(),R?.stop(),j.disconnect(),k.disconnect(),n()};let it=tt+F+.01;z.stop(it);const Q={node:k,bufferSource:z,stop:U=>{z.stop(U)}};if(u!==void 0){const U=gp[u];U&&(U.node.gain.setValueAtTime(1,A),U.node.gain.linearRampToValueAtTime(0,A+.01)),gp[u]=Q}return Q}function fg(t,e,n){se(t,(s,o,c)=>Xp(s,o,c,e),{type:"sample",samples:e,...n})}function Gp(t,e,n){t.startsWith("wt_")?wo(t,e,n):fg(t,e,n)}let Ue=(t,e)=>t!==void 0&&t!==e;class mg{reverbNode;delayNode;output;summingNode;djfNode;audioContext;constructor(e){this.audioContext=e,this.output=new GainNode(e,{gain:1,channelCount:2,channelCountMode:"explicit"}),this.summingNode=new GainNode(e,{gain:1,channelCount:2,channelCountMode:"explicit"}),this.summingNode.connect(this.output)}disconnect(){this.output.disconnect(),this.summingNode.disconnect(),this.delayNode?.disconnect(),this.reverbNode?.disconnect()}getDjf(e,n=0){this.djfNode==null&&(this.djfNode=Bt(this.audioContext,"djf-processor",{value:e}),this.summingNode.disconnect(),this.summingNode.connect(this.djfNode),this.djfNode.connect(this.output)),this.djfNode.parameters.get("value").setValueAtTime(e,n)}getDelay(e=0,n=.5,s){return n=ge(n,0,.98),this.delayNode==null&&(this.delayNode=this.audioContext.createFeedbackDelay(1,e,n),this.delayNode.connect(this.summingNode),this.delayNode.start?.(s)),this.delayNode.delayTime.value!==e&&this.delayNode.delayTime.setValueAtTime(e,s),this.delayNode.feedback.value!==n&&this.delayNode.feedback.setValueAtTime(n,s),this.delayNode}getReverb(e,n,s,o,c,i,u){return this.reverbNode==null&&(this.reverbNode=this.audioContext.createReverb(e,n,s,o,c,i,u),this.reverbNode.connect(this.summingNode)),(Ue(e,this.reverbNode.duration)||Ue(n,this.reverbNode.fade)||Ue(s,this.reverbNode.lp)||Ue(o,this.reverbNode.dim)||Ue(i,this.reverbNode.irspeed)||Ue(u,this.reverbNode.irbegin)||this.reverbNode.ir!==c)&&this.reverbNode.generate(e,n,s,o,c,i,u),this.reverbNode}sendReverb(e,n){return Un(e,this.reverbNode,n)}sendDelay(e,n){return Un(e,this.delayNode,n)}duck(e,n=0,s=.1,o=1){const c=n,i=Math.max(s,.002),u=this.output.gain;Ce(this.audioContext,()=>{const a=this.audioContext.currentTime,l=u.value;u.cancelScheduledValues(a),u.setValueAtTime(l,a);const p=Math.max(e,a),f=ge(1-Math.sqrt(o),.01,l);u.exponentialRampToValueAtTime(f,p+c),u.exponentialRampToValueAtTime(1,p+c+i)},0,e-.01)}connectToOutput(e){e.connect(this.summingNode)}}class yg{channelMerger;destinationGain;constructor(e){this.audioContext=e,this.initializeAudio()}initializeAudio(){const e=this.audioContext,n=e.destination.maxChannelCount;this.audioContext.destination.channelCount=n,this.channelMerger=new ChannelMergerNode(e,{numberOfInputs:e.destination.channelCount}),this.destinationGain=new GainNode(e),this.channelMerger.connect(this.destinationGain),this.destinationGain.connect(e.destination)}reset(){this.disconnect(),this.initializeAudio()}disconnect(){this.channelMerger.disconnect(),this.destinationGain.disconnect(),this.destinationGain=null,this.channelMerger=null}connectToDestination=(e,n=[0,1])=>{const s=new StereoPannerNode(this.audioContext);e.connect(s);const o=new ChannelSplitterNode(this.audioContext,{numberOfOutputs:s.channelCount});s.connect(o),n.forEach((c,i)=>{o.connect(this.channelMerger,i%s.channelCount,c%this.audioContext.destination.channelCount)})}}class bg{audioContext;output;nodes={};constructor(e){this.audioContext=e,this.output=new yg(e)}reset(){Array.from(this.nodes).forEach(e=>{e.disconnect()}),this.nodes={},this.output.reset()}duck(e,n,s=0,o=.1,c=1){const i=[e].flat(),u=[s].flat(),a=[o].flat(),l=[c].flat();i.forEach((p,f)=>{const b=this.nodes[p];if(b==null){I0(new Error(`duck target orbit ${p} does not exist`),"superdough");return}const g=u[f]??u[0],X=Math.max(a[f]??a[0],.002),Z=l[f]??l[0];b.duck(n,g,X,Z)})}getOrbit(e,n){return this.nodes[e]==null&&(this.nodes[e]=new mg(this.audioContext),this.output.connectToDestination(this.nodes[e].output,n)),this.nodes[e]}}const ao=128,lo="System Standard";let Zp=ao;function wp(t){Zp=parseInt(t)??ao}let Wp=!1;function Fp(t){Wp=t==!0}const qt=ig();function se(t,e,n={}){t=t.toLowerCase().replace(/\s+/g,"_"),qt.setKey(t,{onTrigger:e,data:n})}let Vp=t=>t;function le(t){return Vp(t)}function gg(t){Vp=t}function po(t){for(const n in t)t[n.toLowerCase()]=t[n];const e=qt.get();for(const n in e){const[s,o]=n.split("_");if(!o)continue;const c=t[s];if(c){if(typeof c=="string")e[`${c}_${o}`.toLowerCase()]=e[n];else if(Array.isArray(c))for(const i of c)e[`${i}_${o}`.toLowerCase()]=e[n]}}qt.set({...e})}async function Xg(t){const n=await(await fetch(t)).json();po(n)}async function Gg(...t){switch(t.length){case 1:return typeof t[0]=="string"?Xg(t[0]):po(t[0]);case 2:return po({[t[0]]:t[1]});default:throw new Error("aliasMap expects 1 or 2 arguments, received "+t.length)}}function Zg(t,e){if(_e(t)==null){Gt("soundAlias: original sound not found");return}qt.setKey(e,_e(t))}function _e(t){return typeof t!="string"?(console.warn(`getSound: expected string got "${t}". fall back to triangle`),qt.get().triangle):qt.get()[t.toLowerCase()]}const Cp=async()=>{await navigator.mediaDevices.getUserMedia({audio:!0});let t=await navigator.mediaDevices.enumerateDevices();t=t.filter(n=>n.kind==="audiooutput"&&n.deviceId!=="default");const e=new Map;return e.set(lo,""),t.forEach(n=>{e.set(n.label,n.deviceId)}),e};let wn={s:"triangle",gain:.8,postgain:1,density:".03",channels:[1,2],phaserdepth:.75,shapevol:1,distortvol:1,distorttype:0,delay:0,byteBeatExpression:"0",delayfeedback:.5,delaysync:3/16,orbit:1,i:1,velocity:1,fft:8};const wg=Object.freeze({...wn});function Wg(t,e){wn[t]=e}function Fg(){wn={...wg}}let ho=new Map(Object.entries(wn));function fo(t,e){ho.set(t,e)}function Wt(t){return ho.get(t)}function Vg(t){Object.keys(t).forEach(e=>{fo(e,t[e])})}function Lp(){ho=new Map(Object.entries(wn))}function Cg(t){Lp(),t==="1.0"&&fo("fanchor",.5)}const Lg=()=>qt.set({});let zp=[];function Mp(t){zp.push(t)}let mo;function zg(){if(!mo){const t=I(),e=zp.concat([Jb]);mo=Promise.all(e.map(n=>t.audioWorklet.addModule(n)))}return mo}async function yo(t={}){const{disableWorklets:e=!1,maxPolyphony:n,audioDeviceName:s=lo,multiChannelOrbits:o=!1}=t;if(wp(n),Fp(o),typeof window>"u")return;const c=I();if(s!=null&&s!=lo)try{const u=(await Cp()).get(s),a=(u??"").length>0;c.sinkId!==u&&a&&await c.setSinkId(u),Gt(`[superdough] Audio Device set to ${s}, it might take a few seconds before audio plays on all output channels`)}catch{Gt("[superdough] failed to set audio interface","warning")}if(await c.resume(),e){Gt("[superdough]: AudioWorklets disabled with disableWorklets");return}try{await zg(),Gt("[superdough] AudioWorklets loaded")}catch(i){console.warn("could not load AudioWorklet effects",i)}Gt("[superdough] ready")}let bo;async function Mg(t){return bo||(bo=new Promise(e=>{document.addEventListener("mousedown",async function n(){document.removeEventListener("mousedown",n),await yo(t),e()})})),bo}let qn;function go(){return qn==null&&(qn=new bg(I())),qn}function Rp(t,e){go().output.connectToDestination(t,e)}function Rg(t,e,n=1,s=.5,o=1e3,c=2e3){const i=I(),u=Xn(i,t,e,{frequency:n,depth:c*2}),a=2;let l=0;const p=[];for(let f=0;f<a;f++){const b=i.createBiquadFilter();b.type="notch",b.gain.value=1,b.frequency.value=o+l,b.Q.value=2-Math.min(Math.max(s*2,0),1.9),u.connect(b.detune),l+=282,f>0&&p[f-1].connect(b),p.push(b)}return{phaser:p[p.length-1],lfo:u}}function xg(t){t=t??0;const e=["12db","ladder","24db"];return typeof t=="number"?e[Math.floor(U0(t,e.length))]:t}let xt={},ze={};function xp(t,e=1024,n=.5){if(!xt[t]){const s=I().createAnalyser();s.fftSize=e,s.smoothingTimeConstant=n,xt[t]=s,ze[t]=new Float32Array(xt[t].frequencyBinCount)}return xt[t].fftSize!==e&&(xt[t].fftSize=e,ze[t]=new Float32Array(xt[t].frequencyBinCount)),xt[t]}function $n(t="time",e=1){const n={time:()=>xt[e]?.getFloatTimeDomainData(ze[e]),frequency:()=>xt[e]?.getFloatFrequencyData(ze[e])}[t];if(!n)throw new Error(`getAnalyzerData: ${t} not supported. use one of ${Object.keys(n).join(", ")}`);return n(),ze[e]}function vg(){qn?.reset(),xt={},ze={}}let Wn=new Map;function vp(t){return(Array.isArray(t)?t:[t]).map(e=>e-1)}const Xo=async(t,e,n,s=.5,o=.5)=>{const c=I(),i=go();let{stretch:u}=t;if(u!=null&&(e=e-.04),typeof t!="object")throw new Error(`expected hap.value to be an object, but got "${t}". Hint: append .note() or .s() to the end`,"error");if(t.duration=n,e<c.currentTime){console.warn(`[superdough]: cannot schedule sounds in the past (target: ${e.toFixed(2)}, now: ${c.currentTime.toFixed(2)})`);return}let{tremolo:a,tremolosync:l,tremolodepth:p=1,tremoloskew:f,tremolophase:b=0,tremoloshape:g,s:X=Wt("s"),bank:Z,source:W,gain:F=Wt("gain"),postgain:z=Wt("postgain"),density:v=Wt("density"),duckorbit:x,duckonset:R,duckattack:A,duckdepth:O,djf:j,fanchor:tt=Wt("fanchor"),release:k=0,phaserrate:it,phaserdepth:H=Wt("phaserdepth"),phasersweep:Q,phasercenter:U,coarse:dt,crush:q,dry:st,shape:pt,shapevol:Vt=Wt("shapevol"),distort:Ht,distortvol:kt=Wt("distortvol"),distorttype:K=Wt("distorttype"),pan:J,vowel:$t,delay:rt=Wt("delay"),delayfeedback:oe=Wt("delayfeedback"),delaysync:Lt=Wt("delaysync"),delaytime:$,orbit:ot=Wt("orbit"),room:Jt,roomfade:It,roomlp:Zt,roomdim:Ge,roomsize:Ln,ir:Ze,irspeed:qe,irbegin:he,i:Re=Wt("i"),velocity:xe=Wt("velocity"),analyze:ve,fft:$e=Wt("fft"),compressor:Ye,compressorRatio:ce,compressorKnee:zn,compressorAttack:tn,compressorRelease:Mn}=t;$=$??Db(Lt,s);const ns=vp(Wp&&ot>0?[ot*2-1,ot*2]:Wt("channels")),Rn=t.channels!=null?vp(t.channels):ns,jt=i.getOrbit(ot,Rn);x!=null&&i.duck(x,e,R,A,O),F=le(ae(F,1)),z=le(z),Vt=le(Vt),kt=le(kt),rt=le(rt),xe=le(xe),p=le(p),F*=xe;const Se=e+n,ss=Se+k,os=Math.round(Math.random()*1e6);for(let et=0;et<=Wn.size-Zp;et++){const at=Wn.entries().next(),mt=at.value[1].deref(),Xt=at.value[0],Pt=e+.25;mt?.node?.gain?.linearRampToValueAtTime(0,Pt),mt?.stop?.(Pt),Wn.delete(Xt)}let zt=[];if(["-","~","_"].includes(X))return;Z&&X&&(X=`${Z}_${X}`,t.s=X);let en;if(W)en=W(e,t,n,s);else if(_e(X)){const{onTrigger:et}=_e(X),mt=await et(e,t,()=>{zt.forEach(Xt=>Xt?.disconnect()),Wn.delete(os)},s);mt&&(en=mt.node,Wn.set(os,new WeakRef(mt)))}else throw new Error(`sound ${X} not found! Is it loaded?`);if(!en)return;if(c.currentTime>e){Gt("[webaudio] skip hap: still loading",c.currentTime-e);return}const ut=[];ut.push(en),u!==void 0&&ut.push(Bt(c,"phase-vocoder-processor",{pitchFactor:u})),ut.push(Rt(F));const xn=xg(t.ftype);if(t.cutoff!==void 0){const at=qs(t,{frequency:"cutoff",q:"resonance",attack:"lpattack",decay:"lpdecay",sustain:"lpsustain",release:"lprelease",env:"lpenv",anchor:"fanchor",model:"ftype",drive:"drive",rate:"lprate",sync:"lpsync",depth:"lpdepth",depthfrequency:"lpdepthfrequency",shape:"lpshape",dcoffset:"lpdc",skew:"lpskew"});at.type="lowpass";const mt=()=>_n(c,e,Se,at,s,o),{filter:Xt,lfo:Pt}=mt();if(ut.push(Xt),Pt&&zt.push(Pt),xn==="24db"){const{filter:ke,lfo:re}=mt();ut.push(ke),re&&zt.push(re)}}if(t.hcutoff!==void 0){const at=qs(t,{frequency:"hcutoff",q:"hresonance",attack:"hpattack",decay:"hpdecay",sustain:"hpsustain",release:"hprelease",env:"hpenv",anchor:"fanchor",model:"ftype",drive:"drive",rate:"hprate",sync:"hpsync",depth:"hpdepth",depthfrequency:"hpdepthfrequency",shape:"hpshape",dcoffset:"hpdc",skew:"hpskew"});at.type="highpass";const mt=()=>_n(c,e,Se,at,s,o),{filter:Xt,lfo:Pt}=mt();if(ut.push(Xt),Pt&&zt.push(Pt),xn==="24db"){const{filter:ke,lfo:re}=mt();ut.push(ke),re&&zt.push(re)}}if(t.bandf!==void 0){const at=qs(t,{frequency:"bandf",q:"bandq",attack:"bpattack",decay:"bpdecay",sustain:"bpsustain",release:"bprelease",env:"bpenv",anchor:"fanchor",model:"ftype",drive:"drive",rate:"bprate",sync:"bpsync",depth:"bpdepth",depthfrequency:"bpdepthfrequency",shape:"bpshape",dcoffset:"bpdc",skew:"bpskew"});at.type="bandpass";const mt=()=>_n(c,e,Se,at,s,o),{filter:Xt,lfo:Pt}=mt();if(ut.push(Xt),Pt&&zt.push(Pt),xn==="24db"){const{filter:ke,lfo:re}=mt();ut.push(ke),re&&zt.push(re)}}if($t!==void 0){const et=c.createVowelFilter($t);ut.push(et)}if(dt!==void 0&&ut.push(Bt(c,"coarse-processor",{coarse:dt})),q!==void 0&&ut.push(Bt(c,"crush-processor",{crush:q})),pt!==void 0&&ut.push(Bt(c,"shape-processor",{shape:pt,postgain:Vt})),Ht!==void 0&&ut.push(ap(Ht,kt,K)),l!=null&&(a=s*l),t.wtPosSynced!=null&&(t.wtPosRate/=s),t.wtWarpSynced!=null&&(t.wtWarpRate/=s),a!==void 0){const et=Math.max(1-p,0),at=new GainNode(c,{gain:et}),mt=o/s,Xt=Xn(c,e,ss,{skew:f??(g!=null?.5:1),frequency:a,depth:p,time:mt,dcoffset:0,shape:g,phaseoffset:b,min:0,max:1,curve:1.5});Xt.connect(at.gain),zt.push(Xt),ut.push(at)}if(Ye!==void 0&&ut.push(sp(c,Ye,ce,zn,tn,Mn)),J!==void 0){const et=c.createStereoPanner();et.pan.value=2*J-1,ut.push(et)}if(it!==void 0&&H>0){const{phaser:et,lfo:at}=Rg(e,ss,it,H,U,Q);zt.push(at),ut.push(et)}const Be=new GainNode(c,{gain:z});if(ut.push(Be),rt>0&&$>0&&oe>0){jt.getDelay($,oe,e);const et=jt.sendDelay(Be,rt);zt.push(et)}if(Jt>0){let et;if(Ze!==void 0){let mt,Xt=_e(Ze);Array.isArray(Xt)?mt=Xt.data.samples[Re%Xt.data.samples.length]:typeof Xt=="object"&&(mt=Object.values(Xt.data.samples).flat()[Re%Object.values(Xt.data.samples).length]),et=await io(mt,c,Ze,0)}jt.getReverb(Ln,It,Zt,Ge,et,qe,he);const at=jt.sendReverb(Be,Jt);zt.push(at)}if(j!=null&&jt.getDjf(j,e),ve){const et=xp(ve,2**($e+5)),at=Un(Be,et,1);zt.push(at)}if(st!=null){st=le(st);const et=new GainNode(c,{gain:st});ut.push(et),jt.connectToOutput(et)}else jt.connectToOutput(Be);ut.slice(1).reduce((et,at)=>et.connect(at),ut[0]),zt=zt.concat(ut)},Yg=(t,e,n,s)=>{Xo(e,t-n,e.duration/s,s)},Sg=["triangle","square","sawtooth","sine","user"],Bg=[["tri","triangle"],["sqr","square"],["saw","sawtooth"],["sin","sine"]];function kg(t,e){const n=t,s=new Float32Array(e);for(let o=0;o<e;o++){const c=o*2/e-1;s[o]=Math.tanh(c*n)}return s}function Tg(){[...Sg].forEach(t=>{se(t,(e,n,s)=>{const[o,c,i,u]=Dt([n.attack,n.decay,n.sustain,n.release],"linear",[.001,.05,.6,.01]),a=Rt(.3);let l=Bp(t,e,n,()=>{a.disconnect(),s()}),{node:p,stop:f,triggerRelease:b}=l;const{duration:g}=n,X=Rt(1);let Z=p.connect(a).connect(X);const W=e+g;Et(Z.gain,o,c,i,u,0,1,e,W,"linear");const F=W+u+.01;return b?.(F),f(F),{node:Z,stop:z=>{f(z)}}},{type:"synth",prebake:!0})}),se("sbd",(t,e,n)=>{const{duration:s,decay:o=.5,pdecay:c=.5,penv:i=36,clip:u}=e,a=I(),l=.02,p=1.2,f=.025,b=1,g=a.createOscillator();g.type="triangle",g.frequency.value=Le(e,29),g.detune.setValueAtTime(i*100,0),g.detune.setValueAtTime(i*100,t),g.detune.exponentialRampToValueAtTime(.001,t+c);const X=Rt(1);X.gain.setValueAtTime(1,t+l),X.gain.exponentialRampToValueAtTime(.001,t+l+o),g.start(t);const Z=to("brown",t,2),W=Rt(1);W.gain.setValueAtTime(p,t),W.gain.exponentialRampToValueAtTime(.001,t+f);const F=new WaveShaperNode(a);F.curve=kg(2,a.sampleRate);const z=Rt(b);g.onended=()=>{g.disconnect(),X.disconnect(),F.disconnect(),Z.node.disconnect(),W.disconnect(),z.disconnect(),n()};const v=g.connect(F).connect(X).connect(z);Z.node.connect(W).connect(z);let R=t+o+.01;return u!=null&&(R=Math.min(t+u*s,R)),z.gain.setValueAtTime(b,R-.01),z.gain.linearRampToValueAtTime(0,R),g.stop(R),Z.stop(R),{node:v,stop:A=>{g.stop(A)}}},{type:"synth",prebake:!0}),se("supersaw",(t,e,n)=>{const s=I();let{duration:o,n:c,unison:i=5,spread:u=.6,detune:a}=e;a=a??c??.18;const l=Le(e),[p,f,b,g]=Dt([e.attack,e.decay,e.sustain,e.release],"linear",[.001,.05,.6,.01]),X=t+o,Z=X+g+.01,W=ge(i,1,100);let F=W>1?ge(u,0,1):0,z=Bt(s,"supersaw-oscillator",{frequency:l,begin:t,end:Z,freqspread:a,voices:W,panspread:F},{outputChannelCount:[2]});const v=1/Math.sqrt(W);Je(z.parameters.get("detune"),e,t,X);const x=Ie(z.parameters.get("detune"),e,t),R=Gn(z.parameters.get("frequency"),e,t);let A=Rt(1);A=z.connect(A),Et(A.gain,p,f,b,g,0,.3*v,t,X,"linear");let O=Ce(s,()=>{Oe(z),A.disconnect(),n(),R?.stop(),x?.stop()},t,Z);return{node:A,stop:j=>{O.stop(j)}}},{prebake:!0,type:"synth"}),se("bytebeat",(t,e,n)=>{const s=["(t%255 >= t/255%255)*255","(t*(t*8%60 <= 300)|(-t)*(t*4%512 < 256))+t/400","t","t*(t >> 10^t)","t&128","t&t>>8","((t%255+t%128+t%64+t%32+t%16+t%127.8+t%64.8+t%32.8+t%16.8)/3)","((t%64+t%63.8+t%64.15+t%64.35+t%63.5)/1.25)","(t&(t>>7)-t)","(sin(t*PI/128)*127+127)","((t^t/2+t+64*(sin((t*PI/64)+(t*PI/32768))+64))%128*2)","((t^t/2+t+64*(cos >> 0))%127.85*2)","((t^t/2+t+64)%128*2)","(((t * .25)^(t * .25)/100+(t * .25))%128)*2","((t^t/2+t+64)%7 * 24)"],{n:o=0}=e,c=Le(e),{byteBeatExpression:i=s[o%s.length],byteBeatStartTime:u}=e,a=I();let{duration:l}=e;const[p,f,b,g]=Dt([e.attack,e.decay,e.sustain,e.release],"linear",[.001,.05,.6,.01]),X=t+l,Z=X+g+.01;let W=Bt(a,"byte-beat-processor",{frequency:c,begin:t,end:Z},{outputChannelCount:[2]});W.port.postMessage({codeText:i,byteBeatStartTime:u,frequency:c});let F=Rt(1);F=W.connect(F),Et(F.gain,p,f,b,g,0,1,t,X,"linear");let z=Ce(a,()=>{Oe(W),F.disconnect(),n()},t,Z);return{node:F,stop:v=>{z.stop(v)}}},{prebake:!0,type:"synth"}),se("pulse",(t,e,n)=>{const s=I();let{pwrate:o,pwsweep:c}=e;c==null&&(o!=null?c=.3:c=0),o==null&&c!=null&&(o=1);let{duration:i,pw:u=.5}=e;const a=Le(e),[l,p,f,b]=Dt([e.attack,e.decay,e.sustain,e.release],"linear",[.001,.05,.6,.01]),g=t+i,X=g+b+.01;let Z=Bt(s,"pulse-oscillator",{frequency:a,begin:t,end:X,pulsewidth:u},{outputChannelCount:[2]});Je(Z.parameters.get("detune"),e,t,g);const W=Ie(Z.parameters.get("detune"),e,t),F=Gn(Z.parameters.get("frequency"),e,t);let z=Rt(1);z=Z.connect(z),Et(z.gain,l,p,f,b,0,1,t,g,"linear");let v;c!=0&&(v=Xn(s,t,X,{frequency:o,depth:c}),v.connect(Z.parameters.get("pulsewidth")));let x=Ce(s,()=>{Oe(Z),Oe(v),z.disconnect(),n(),F?.stop(),W?.stop()},t,X);return{node:z,stop:R=>{x.stop(R)}}},{prebake:!0,type:"synth"}),[...eo].forEach(t=>{se(t,(e,n,s)=>{const[o,c,i,u]=Dt([n.attack,n.decay,n.sustain,n.release],"linear",[.001,.05,.6,.01]);let a,{density:l}=n;a=to(t,e,l);let{node:p,stop:f,triggerRelease:b}=a;const g=Rt(.3),{duration:X}=n;p.onended=()=>{p.disconnect(),g.disconnect(),s()};const Z=Rt(1);let W=p.connect(g).connect(Z);const F=e+X;Et(W.gain,o,c,i,u,0,1,e,F,"linear");const z=F+u+.01;return b?.(z),f(z),{node:W,stop:v=>{f(v)}}},{type:"synth",prebake:!0})}),Bg.forEach(([t,e])=>qt.set({...qt.get(),[t]:qt.get()[e]}))}const Yp=2*Math.PI;function Sp(t,e,n){t=typeof t=="object"?t:new Float32Array(t).fill(1);const o=t.length,c=new Float32Array(o+1),i=new Float32Array(o+1),u=I(),a=u.createOscillator(),l={sawtooth:f=>[0,-1/f],square:f=>[0,f%2===0?0:1/f],triangle:f=>[f%2===0?0:1/(f*f),0],user:f=>[0,1]};if(!l[n])throw new Error(`unknown wave type ${n}`);for(let f=0;f<o;f++){const b=t[f],[g,X]=l[n](f+1),Z=e?.[f]??0;let W=g*b,F=X*b;if(Z!==0){const z=Math.cos(Yp*Z),v=Math.sin(Yp*Z);W=z*W-v*F,F=v*W+z*F}c[f+1]=W,i[f+1]=F}const p=u.createPeriodicWave(c,i);return a.setPeriodicWave(p),a}function Bp(t,e,n,s){const{duration:o,noise:c=0}=n,i=n.partials??n.n;let u;t==="user"&&!i&&(Gt("[superdough] Synth 'user' was selected, but partials not specified. Defaulting to triangle. Use pat.partials to setup custom waveform"),t="triangle"),t=t==="user"&&!i?"triangle":t,!i||i?.length===0||t==="sine"?(u=I().createOscillator(),u.type=t||"triangle"):u=Sp(i,n.phases,t),u.frequency.value=Le(n);let a=Ie(u.detune,n,e);Je(u.detune,n,e,e+o);const l=Gn(u.frequency,n,e);let p;return c&&(p=jb(u,c,e)),u.onended=()=>{p||u.disconnect(),p?.node.disconnect(),s()},u.start(e),{node:p?.node||u,stop:f=>{l.stop(f),a?.stop(f),p?.stop(f),u.stop(f)},triggerRelease:f=>{}}}function Ag(t=1,e=.05,n=220,s=0,o=0,c=.1,i=0,u=1,a=0,l=0,p=0,f=0,b=0,g=0,X=0,Z=0,W=0,F=1,z=0,v=0){let x=Math.PI*2,R=I().sampleRate,A=Vt=>Vt>0?1:-1,O=a*=500*x/R/R,j=n*=(1+e*2*Math.random()-e)*x/R,tt=[],k=0,it=0,H=0,Q=1,U=0,dt=0,q=0,st,pt;for(s=s*R+9,z*=R,o*=R,c*=R,W*=R,l*=500*x/R**3,X*=x/R,p*=x/R,f*=R,b=b*R|0,pt=s+z+o+c+W|0;H<pt;tt[H++]=q)++dt%(Z*100|0)||(q=i?i>1?i>2?i>3?Math.sin((k%x)**3):Math.max(Math.min(Math.tan(k),1),-1):1-(2*k/x%2+2)%2:1-4*Math.abs(Math.round(k/x)-k/x):Math.sin(k),q=(b?1-v+v*Math.sin(x*H/b):1)*A(q)*Math.abs(q)**u*t*1*(H<s?H/s:H<s+z?1-(H-s)/z*(1-F):H<s+z+o?F:H<pt-W?(pt-H-W)/c*F:0),q=W?q/2+(W>H?0:(H<pt-W?1:(pt-H)/W)*tt[H-W|0]/2):q),st=(n+=a+=l)*Math.cos(X*it++),k+=st-st*g*(1-(Math.sin(H)+1)*1e9%2),Q&&++Q>f&&(n+=p,j+=p,Q=0),b&&!(++U%b)&&(n=j,a=O,Q||=1);return tt}const kp=(t,e)=>{let{s:n,note:s=36,freq:o,zrand:c=0,attack:i=0,decay:u=0,sustain:a=.8,release:l=.1,curve:p=1,slide:f=0,deltaSlide:b=0,pitchJump:g=0,pitchJumpTime:X=0,lfo:Z=0,znoise:W=0,zmod:F=0,zcrush:z=0,zdelay:v=0,tremolo:x=0,duration:R=.2,zzfx:A}=t;const O=Math.max(R-i-u,0);typeof s=="string"&&(s=jn(s)),!o&&typeof s=="number"&&(o=O0(s)),n=n.replace("z_","");const j=["sine","triangle","sawtooth","tan","noise"].indexOf(n)||0;p=n==="square"?0:p;const k=Ag(...A||[.25,c,o,i,O,l,j,p,f,b,g,X,Z,W,F,z,v,a,u,x]),it=I(),H=it.createBuffer(1,k.length,it.sampleRate);H.getChannelData(0).set(k);const Q=I().createBufferSource();return Q.buffer=H,Q.start(e),{node:Q}};function Ng(){["zzfx","z_sine","z_sawtooth","z_triangle","z_square","z_tan","z_noise"].forEach(t=>{se(t,(e,n,s)=>{const{node:o}=kp({s:t,...n},e);return o.onended=()=>{o.disconnect(),s()},{node:o,stop:()=>{}}},{type:"synth",prebake:!0})})}let Qe;async function Tp(t,e){const n=`dsp-worklet-${Date.now()}`,s=`${e}
let __q = []; // trigger queue
class MyProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.t = 0;
    this.stopped = false;
    this.port.onmessage = (e) => {
      if(e.data==='stop') {
        this.stopped = true;
      } else if(e.data?.dough) {
        __q.push(e.data)
      } else {
        msg?.(e.data)
      }
    };
  }
  process(inputs, outputs, parameters) {
    const output = outputs[0];
    if(__q.length) {
      for(let i=0;i<__q.length;++i) {
        const deadline = __q[i].time-currentTime;
        if(deadline<=0) {
          trigger(__q[i].dough)
          __q.splice(i,1)
        }
      }
    }
    for (let i = 0; i < output[0].length; i++) {
      const out = dsp(this.t / sampleRate);
      output.forEach((channel) => {
        channel[i] = out;
      });
      this.t++;
    }
  return !this.stopped;
  }
}
registerProcessor('${n}', MyProcessor);
`,c=`data:text/javascript;base64,${btoa(s)}`;await t.audioWorklet.addModule(c);const i=new AudioWorkletNode(t,n);return{node:i,stop:()=>i.port.postMessage("stop")}}const Ap=()=>{Qe&&(Qe?.stop(),Qe?.node?.disconnect())};typeof window<"u"&&window.addEventListener("message",t=>{t.data==="strudel-stop"?Ap():t.data?.dough&&Qe?.node.port.postMessage(t.data)});const Kg=async t=>{const e=I();Ap(),Qe=await Tp(e,t),Qe.node.connect(e.destination)};function Np(t,e,n,s){window.postMessage({time:s,dough:t.value,currentTime:e,duration:t.duration,cps:n})}const Go=Object.freeze({NONE:0,ASYM:1,MIRROR:2,BENDP:3,BENDM:4,BENDMP:5,SYNC:6,QUANT:7,FOLD:8,PWM:9,ORBIT:10,SPIN:11,CHAOS:12,PRIMES:13,BINARY:14,BROWNIAN:15,RECIPROCAL:16,WORMHOLE:17,LOGISTIC:18,SIGMOID:19,FRACTAL:20,FLIP:21}),Kp=new Set;async function Hg(t,e,n=2048){const s=`${t},${n}`;if(!Kp.has(s)){const c=(await Jg(t,e)).getChannelData(0),i=c.length,u=Math.max(1,Math.floor(i/n)),a=new Array(u);for(let l=0;l<u;l++){const p=l*n;a[l]=c.subarray(p,p+n)}return Kp.add(s),{frames:a,frameLen:n,numFrames:u,key:s}}return{frameLen:n,key:s}}function Pg(t,e){var n=1024;if(t<n)return t+" B";var s=["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],o=-1;do t/=n,++o;while(t>=n);return t.toFixed(1)+" "+s[o]}function Eg(t){const e=new DataView(t);let n=12;for(;n+8<=e.byteLength;){const s=String.fromCharCode(e.getUint8(n),e.getUint8(n+1),e.getUint8(n+2),e.getUint8(n+3)),o=e.getUint32(n+4,!0);if(s==="fmt ")return e.getUint32(n+12,!0);n+=8+o+(o&1)}return null}async function Dg(t){const e=Eg(t)||44100;return await new OfflineAudioContext(1,1,e).decodeAudioData(t)}const Zo={},Jg=(t,e)=>{if(t=t.replace("#","%23"),!Zo[t]){Gt(`[wavetable] load table ${e}..`,"load-table",{url:t});const n=Date.now();Zo[t]=fetch(t).then(s=>s.arrayBuffer()).then(async s=>{const o=Date.now()-n,c=Pg(s.byteLength);return Gt(`[wavetable] load table ${e}... done! loaded ${c} in ${o}ms`,"loaded-table",{url:t}),await Dg(s)})}return Zo[t]};function Hp(t,e=""){if(!t.startsWith("github:"))throw new Error('expected "github:" at the start of pseudoUrl');let[n,s]=t.split("github:");return s=s.endsWith("/")?s.slice(0,-1):s,s.split("/").length===2&&(s+="/main"),`https://raw.githubusercontent.com/${s}/${e}`}const Pp=(t,e,n,s={})=>(e=t._base||e,Object.entries(t).forEach(([o,c])=>{if(o==="_base")return!1;if(typeof c=="string"&&(c=[c]),typeof c!="object")throw new Error("wrong json format for "+o);let i=e;i.startsWith("github:")&&(i=Hp(i,"")),c=c.map(u=>i+u).filter(u=>u.toLowerCase().endsWith(".wav")?!0:(Gt(`[wavetable] skipping ${u} -- wavetables must be ".wav" format`),!1)),c.length&&wo(o,c,{baseUrl:e,frameLen:n})}));function wo(t,e,n){se(t,(s,o,c,i)=>Ep(s,o,c,e,i,n?.frameLen??2048),{type:"wavetable",tables:e,...n})}const Ig=async(t,e,n,s={})=>{if(n!==void 0)return Pp(n,t,e);t.startsWith("github:")&&(t=Hp(t,"strudel.json")),t.startsWith("local:")&&(t="http://localhost:5432");const o=q0(t);if(typeof fetch=="function"&&!(typeof fetch>"u"))return fetch(t).then(c=>c.json()).then(c=>Pp(c,o,e,s)).catch(c=>{throw console.error(c),new Error(`error loading "${t}"`)})};async function Ep(t,e,n,s,o,c){const{s:i,n:u=0,duration:a,clip:l}=e,p=I(),[f,b,g,X]=Dt([e.attack,e.decay,e.sustain,e.release]);let{warpmode:Z}=e;typeof Z=="string"&&(Z=Go[Z.toUpperCase()]??Go.NONE);const W=Le(e),{url:F,label:z}=Q0(e,s),v=await Hg(F,z,c);let x=t+a;l!==void 0&&(x=Math.min(t+l*a,x));const R=x+X,A=R+.01,O=Bt(p,"wavetable-oscillator-processor",{begin:t,end:A,frequency:W,freqspread:e.detune,position:e.wt,warp:e.warp,warpMode:Z,voices:Math.max(e.unison??1,1),panspread:e.spread,phaserand:e.wtphaserand??e.unison>1?1:0},{outputChannelCount:[2]});if(O.port.postMessage({type:"table",payload:v}),p.currentTime>t){Gt(`[wavetable] still loading sound "${i}:${u}"`,"highlight");return}const j=[e.wtattack,e.wtdecay,e.wtsustain,e.wtrelease],tt=[e.warpattack,e.warpdecay,e.warpsustain,e.warprelease],k=O.parameters,it=k.get("position"),H=k.get("warp");let Q=e.wtrate;e.wtsync!=null&&(Q=o*e.wtsync);const U=so(p,it,t,R,{offset:e.wt,amount:e.wtenv,defaultAmount:.5,values:j,holdEnd:x,defaultValues:[0,.5,0,.1]},{frequency:Q,depth:e.wtdepth,defaultDepth:.5,shape:e.wtshape,skew:e.wtskew,dcoffset:e.wtdc??0});let dt=e.warprate;e.warpsync!=null&&(dt=dt=o*e.warpsync);const q=so(p,H,t,R,{offset:e.warp,amount:e.warpenv,defaultAmount:.5,values:tt,holdEnd:x,defaultValues:[0,.5,0,.1]},{frequency:dt,depth:e.warpdepth,defaultDepth:.5,shape:e.warpshape,skew:e.warpskew,dcoffset:e.warpdc??0}),st=Ie(O.parameters.get("detune"),e,t),pt=Gn(O.parameters.get("frequency"),e,t),Vt=p.createGain(),Ht=O.connect(Vt);Et(Ht.gain,f,b,g,X,0,.3,t,x,"linear"),Je(O.parameters.get("detune"),e,t,x);const kt={node:Ht,source:O},K=Ce(p,()=>{Oe(O),st?.stop(),pt?.stop(),Ht.disconnect(),U?.disconnect(),q?.disconnect(),n()},t,A);return kt.stop=J=>{K.stop(J)},kt}let Fn;function jg(){const t=I();Fn=Bt(t,"dough-processor",{},{outputChannelCount:[2]}),Rp(Fn)}const ts=new Map,Dp=new Map;L.prototype.supradough=function(){return this.onTrigger((t,e,n,s)=>{t.value._begin=s,t.value._duration=t.duration/n,!Fn&&jg();const o=(t.value.bank?t.value.bank+"_":"")+t.value.s,c=t.value.n??0,i=`${o}:${c}`;if(ts.has(o)&&(t.value.s=i),ts.has(o)&&!Dp.has(i)){const u=ts.get(o),a=u[c%u.length];console.log(`load ${i} from ${a}`);const l=_g(a);Dp.set(i,l),l.then(({channels:p,sampleRate:f})=>Fn.port.postMessage({sample:i,channels:p,sampleRate:f}))}Fn.port.postMessage({spawn:t.value})},1)};function Og(t,e=""){if(!t.startsWith("github:"))throw new Error('expected "github:" at the start of pseudoUrl');let[n,s]=t.split("github:");return s=s.endsWith("/")?s.slice(0,-1):s,s.split("/").length===2&&(s+="/main"),`https://raw.githubusercontent.com/${s}/${e}`}async function Ug(t){if(t.startsWith("github:")&&(t=Og(t,"strudel.json")),t.startsWith("local:")&&(t="http://localhost:5432"),t.startsWith("shabda:")){let[s,o]=t.split("shabda:");t=`https://shabda.ndre.gr/${o}.json?strudel=1`}if(t.startsWith("shabda/speech")){let[s,o]=t.split("shabda/speech");o=o.startsWith("/")?o.substring(1):o;let[c,i]=o.split(":"),u="f",a="en-GB";c&&([a,u]=c.split("/")),t=`https://shabda.ndre.gr/speech/${i}.json?gender=${u}&language=${a}&strudel=1'`}if(typeof fetch!="function")return;const e=t.split("/").slice(0,-1).join("/");if(typeof fetch>"u")return;const n=await fetch(t).then(s=>s.json()).catch(s=>{throw console.error(s),new Error(`error loading "${t}"`)});return[n,n._base||e]}async function _g(t){const e=await fetch(t).then(s=>s.arrayBuffer()).then(s=>I().decodeAudioData(s));let n=[];for(let s=0;s<e.numberOfChannels;s++)n.push(e.getChannelData(s));return{channels:n,sampleRate:e.sampleRate}}async function Jp(t,e){if(typeof t=="string"){const[n,s]=await Ug(t);return Jp(n,s)}Object.entries(t).map(async([n,s])=>{n!=="_base"&&(s=s.map(o=>e+o),ts.set(n,s))})}const Qg="data:text/javascript;base64,KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NvbnN0IGQ9dHlwZW9mIHNhbXBsZVJhdGU8InUiP3NhbXBsZVJhdGU6NDhlMyxBPU1hdGguUEkvZCxiPTEvZDtsZXQgRT1pPT5NYXRoLnBvdyhpLDIpO2NvbnN0IFY9KGkscyx0KT0+TWF0aC5taW4oTWF0aC5tYXgoaSxzKSx0KTtmdW5jdGlvbiBjKGkpe3JldHVybiBFKGkpfWZ1bmN0aW9uIE8oaSxzLHQpe2NvbnN0IGU9TWF0aC5zaW4oKDEtdCkqLjUqTWF0aC5QSSksaD1NYXRoLnNpbih0Ki41Kk1hdGguUEkpO3JldHVybiBpKmUrcypofWNsYXNzIHZ7cGhhc2U9MDt1cGRhdGUocyl7Y29uc3QgdD1NYXRoLnNpbih0aGlzLnBoYXNlKjIqTWF0aC5QSSk7cmV0dXJuIHRoaXMucGhhc2U9KHRoaXMucGhhc2Urcy9kKSUxLHR9fWNsYXNzIHh7cGhhc2U9MDt1cGRhdGUocyl7cmV0dXJuIHRoaXMucGhhc2UrPWIqcyx0aGlzLnBoYXNlJTEqMi0xfX1mdW5jdGlvbiB5KGkscyl7cmV0dXJuIGk8cz8oaS89cyxpK2ktaSppLTEpOmk+MS1zPyhpPShpLTEpL3MsaSppK2kraSsxKTowfWNsYXNzIFJ7Y29uc3RydWN0b3Iocz17fSl7dGhpcy5waGFzZT1zLnBoYXNlPz8wfXVwZGF0ZShzKXtjb25zdCB0PXMvZDtsZXQgZT15KHRoaXMucGhhc2UsdCksaD0yKnRoaXMucGhhc2UtMS1lO3JldHVybiB0aGlzLnBoYXNlKz10LHRoaXMucGhhc2U+MSYmKHRoaXMucGhhc2UtPTEpLGh9fWZ1bmN0aW9uIFQoaSxzLHQpe3JldHVybiBpPDI/MDooKGgsbyxuKT0+biooby1oKStoKSgtcyouNSxzKi41LHQvKGktMSkpfWZ1bmN0aW9uIHooaSxzKXtyZXR1cm4gaSpNYXRoLnBvdygyLHMvMTIpfWNsYXNzIEZ7Y29uc3RydWN0b3Iocz17fSl7dGhpcy52b2ljZXM9cy52b2ljZXM/PzUsdGhpcy5mcmVxc3ByZWFkPXMuZnJlcXNwcmVhZD8/LjIsdGhpcy5wYW5zcHJlYWQ9cy5wYW5zcHJlYWQ/Py40LHRoaXMucGhhc2U9bmV3IEZsb2F0MzJBcnJheSh0aGlzLnZvaWNlcykubWFwKCgpPT5NYXRoLnJhbmRvbSgpKX11cGRhdGUocyl7Y29uc3QgdD1NYXRoLnNxcnQoMS10aGlzLnBhbnNwcmVhZCksZT1NYXRoLnNxcnQodGhpcy5wYW5zcHJlYWQpO2xldCBoPTAsbz0wO2ZvcihsZXQgbj0wO248dGhpcy52b2ljZXM7bisrKXtjb25zdCBhPXoocyxUKHRoaXMudm9pY2VzLHRoaXMuZnJlcXNwcmVhZCxuKSkvZCxwPShuJjEpPT0xO2xldCB1PXQ7cCYmKHU9ZSk7bGV0IHE9eSh0aGlzLnBoYXNlW25dLGEpLEQ9Mip0aGlzLnBoYXNlW25dLTEtcTtoPWgrRCp1LG89bytEKnUsdGhpcy5waGFzZVtuXSs9YSx0aGlzLnBoYXNlW25dPjEmJih0aGlzLnBoYXNlW25dLT0xKX1yZXR1cm4gaCtvfX1jbGFzcyB3e3BoYXNlPTA7dXBkYXRlKHMpe3RoaXMucGhhc2UrPWIqcztsZXQgdD10aGlzLnBoYXNlJTE7cmV0dXJuKHQ8LjU/Mip0OjEtMioodC0uNSkpKjItMX19Y2xhc3MgZ3tzMD0wO3MxPTA7dXBkYXRlKHMsdCxlPTApe2U9TWF0aC5tYXgoZSwwKSx0PU1hdGgubWluKHQsMmU0KTtsZXQgaD0yKk1hdGguc2luKHQqQSk7aD1WKGgsMCwxLjE0KTtjb25zdCBuPTEtTWF0aC5wb3coLjUsKGUrLjEyNSkvLjEyNSkqaDtyZXR1cm4gdGhpcy5zMD1uKnRoaXMuczAtaCp0aGlzLnMxK2gqcyx0aGlzLnMxPW4qdGhpcy5zMStoKnRoaXMuczAsdGhpcy5zMX19Y2xhc3MgSXtjb25zdHJ1Y3RvcihzPTApe3RoaXMucGhhc2U9c31zYXcocyx0KXtsZXQgZT0odGhpcy5waGFzZStzKSUxLGg9eShlLHQpO3JldHVybiAyKmUtMS1ofXVwZGF0ZShzLHQ9LjUpe2NvbnN0IGU9cy9kO2xldCBoPXRoaXMuc2F3KDAsZSktdGhpcy5zYXcodCxlKTtyZXR1cm4gdGhpcy5waGFzZT0odGhpcy5waGFzZStlKSUxLGgrdCoyLTF9fWNsYXNzIEx7cGhhc2U9MDt1cGRhdGUocyx0PS41KXtyZXR1cm4gdGhpcy5waGFzZSs9YipzLHRoaXMucGhhc2UlMTx0PzE6LTF9fWNsYXNzIFN7dXBkYXRlPXM9Pk1hdGgucmFuZG9tKCk8cypiP01hdGgucmFuZG9tKCk6MH1jbGFzcyBOe3VwZGF0ZSgpe3JldHVybiBNYXRoLnJhbmRvbSgpKjItMX19Y2xhc3MgQntjb25zdHJ1Y3Rvcigpe3RoaXMub3V0PTB9dXBkYXRlKCl7bGV0IHM9TWF0aC5yYW5kb20oKSoyLTE7cmV0dXJuIHRoaXMub3V0PSh0aGlzLm91dCsuMDIqcykvMS4wMix0aGlzLm91dH19Y2xhc3MgR3tjb25zdHJ1Y3Rvcigpe3RoaXMuYjA9MCx0aGlzLmIxPTAsdGhpcy5iMj0wLHRoaXMuYjM9MCx0aGlzLmI0PTAsdGhpcy5iNT0wLHRoaXMuYjY9MH11cGRhdGUoKXtjb25zdCBzPU1hdGgucmFuZG9tKCkqMi0xO3RoaXMuYjA9Ljk5ODg2KnRoaXMuYjArcyouMDU1NTE3OSx0aGlzLmIxPS45OTMzMip0aGlzLmIxK3MqLjA3NTA3NTksdGhpcy5iMj0uOTY5KnRoaXMuYjIrcyouMTUzODUyLHRoaXMuYjM9Ljg2NjUqdGhpcy5iMytzKi4zMTA0ODU2LHRoaXMuYjQ9LjU1KnRoaXMuYjQrcyouNTMyOTUyMix0aGlzLmI1PS0uNzYxNip0aGlzLmI1LXMqLjAxNjg5ODtjb25zdCB0PXRoaXMuYjArdGhpcy5iMSt0aGlzLmIyK3RoaXMuYjMrdGhpcy5iNCt0aGlzLmI1K3RoaXMuYjYrcyouNTM2MjtyZXR1cm4gdGhpcy5iNj1zKi4xMTU5MjYsdCouMTF9fWNsYXNzIGp7cGhhc2U9MTt1cGRhdGUocyl7dGhpcy5waGFzZSs9YipzO2xldCB0PXRoaXMucGhhc2U+PTE/MTowO3JldHVybiB0aGlzLnBoYXNlPXRoaXMucGhhc2UlMSx0fX1mdW5jdGlvbiBNKGkscyx0LGU9MSl7aWYoaTw9MClyZXR1cm4gcztpZihpPj0xKXJldHVybiB0O2xldCBoO3JldHVybiBlPT09MD9oPWk6ZT4wP2g9TWF0aC5wb3coaSxlKTpoPTEtTWF0aC5wb3coMS1pLC1lKSxzKyh0LXMpKmh9Y2xhc3MgZntjb25zdHJ1Y3RvcihzPXt9KXt0aGlzLnN0YXRlPSJvZmYiLHRoaXMuc3RhcnRUaW1lPTAsdGhpcy5zdGFydFZhbD0wLHRoaXMuZGVjYXlDdXJ2ZT1zLmRlY2F5Q3VydmU/PzF9dXBkYXRlKHMsdCxlLGgsbyxuKXtzd2l0Y2godGhpcy5zdGF0ZSl7Y2FzZSJvZmYiOnJldHVybiB0PjAmJih0aGlzLnN0YXRlPSJhdHRhY2siLHRoaXMuc3RhcnRUaW1lPXMsdGhpcy5zdGFydFZhbD0wKSwwO2Nhc2UiYXR0YWNrIjp7bGV0IGw9cy10aGlzLnN0YXJ0VGltZTtyZXR1cm4gbD5lPyh0aGlzLnN0YXRlPSJkZWNheSIsdGhpcy5zdGFydFRpbWU9cywxKTpNKGwvZSx0aGlzLnN0YXJ0VmFsLDEsMSl9Y2FzZSJkZWNheSI6e2xldCBsPXMtdGhpcy5zdGFydFRpbWUsYT1NKGwvaCwxLG8sLXRoaXMuZGVjYXlDdXJ2ZSk7cmV0dXJuIHQ8PTA/KHRoaXMuc3RhdGU9InJlbGVhc2UiLHRoaXMuc3RhcnRUaW1lPXMsdGhpcy5zdGFydFZhbD1hLGEpOmw+aD8odGhpcy5zdGF0ZT0ic3VzdGFpbiIsdGhpcy5zdGFydFRpbWU9cyxvKTphfWNhc2Uic3VzdGFpbiI6cmV0dXJuIHQ8PTAmJih0aGlzLnN0YXRlPSJyZWxlYXNlIix0aGlzLnN0YXJ0VGltZT1zLHRoaXMuc3RhcnRWYWw9byksbztjYXNlInJlbGVhc2UiOntsZXQgbD1zLXRoaXMuc3RhcnRUaW1lO2lmKGw+bilyZXR1cm4gdGhpcy5zdGF0ZT0ib2ZmIiwwO2xldCBhPU0obC9uLHRoaXMuc3RhcnRWYWwsMCwtdGhpcy5kZWNheUN1cnZlKTtyZXR1cm4gdD4wJiYodGhpcy5zdGF0ZT0iYXR0YWNrIix0aGlzLnN0YXJ0VGltZT1zLHRoaXMuc3RhcnRWYWw9YSksYX19dGhyb3ciaW52YWxpZCBlbnZlbG9wZSBzdGF0ZSJ9fWNvbnN0ICQ9MTA7Y2xhc3Mga3t3cml0ZUlkeD0wO3JlYWRJZHg9MDtidWZmZXI9bmV3IEZsb2F0MzJBcnJheSgkKmQpO3dyaXRlKHMsdCl7dGhpcy53cml0ZUlkeD0odGhpcy53cml0ZUlkeCsxKSV0aGlzLmJ1ZmZlci5sZW5ndGgsdGhpcy5idWZmZXJbdGhpcy53cml0ZUlkeF09cztsZXQgZT1NYXRoLm1pbihNYXRoLmZsb29yKGQqdCksdGhpcy5idWZmZXIubGVuZ3RoLTEpO3RoaXMucmVhZElkeD10aGlzLndyaXRlSWR4LWUsdGhpcy5yZWFkSWR4PDAmJih0aGlzLnJlYWRJZHgrPXRoaXMuYnVmZmVyLmxlbmd0aCl9dXBkYXRlKHMsdCl7cmV0dXJuIHRoaXMud3JpdGUocyx0KSx0aGlzLmJ1ZmZlclt0aGlzLnJlYWRJZHhdfX1jbGFzcyBXe2RlbGF5PW5ldyBrO21vZHVsYXRvcj1uZXcgdzt1cGRhdGUocyx0LGUsaCxvKXtjb25zdCBuPXRoaXMubW9kdWxhdG9yLnVwZGF0ZShoKSpvLGw9dGhpcy5kZWxheS51cGRhdGUocyxlKigxK24pKTtyZXR1cm4gTyhzLGwsdCl9fWNsYXNzIFh7aG9sZD0wO3Q9MDt1cGRhdGUocyx0KXtyZXR1cm4gdGhpcy50KysldD09PTAmJih0aGlzLnQ9MCx0aGlzLmhvbGQ9cyksdGhpcy5ob2xkfX1jbGFzcyBVe3VwZGF0ZShzLHQpe3Q9TWF0aC5tYXgoMSx0KTtjb25zdCBlPU1hdGgucG93KDIsdC0xKTtyZXR1cm4gTWF0aC5yb3VuZChzKmUpL2V9fWNsYXNzIFl7dXBkYXRlKHMsdD0wLGU9MSl7ZT1NYXRoLm1heCguMDAxLE1hdGgubWluKDEsZSkpO2NvbnN0IGg9TWF0aC5leHBtMSh0KTtyZXR1cm4oMStoKSpzLygxK2gqTWF0aC5hYnMocykpKmV9fWNsYXNzIF97c3RhdGljIHNhbXBsZXM9bmV3IE1hcDtidWZmZXI7c2FtcGxlUmF0ZTtwb3M9MDtzYW1wbGVGcmVxPVAoKTtjb25zdHJ1Y3RvcihzLHQsZSl7dGhpcy5idWZmZXI9cyx0aGlzLnNhbXBsZVJhdGU9dCx0aGlzLmR1cmF0aW9uPXRoaXMuYnVmZmVyLmxlbmd0aC90aGlzLnNhbXBsZVJhdGUsdGhpcy5zcGVlZD1kL3RoaXMuc2FtcGxlUmF0ZSxlJiYodGhpcy5zcGVlZCo9dGhpcy5kdXJhdGlvbil9dXBkYXRlKHMpe2lmKHRoaXMucG9zPj10aGlzLmJ1ZmZlci5sZW5ndGgpcmV0dXJuIDA7Y29uc3QgdD1zL3RoaXMuc2FtcGxlRnJlcSp0aGlzLnNwZWVkO2xldCBlPXRoaXMuYnVmZmVyW01hdGguZmxvb3IodGhpcy5wb3MpXTtyZXR1cm4gdGhpcy5wb3M9dGhpcy5wb3MrdCxlfX1jb25zdCBtPShpLHM9ImxpbmVhciIsdCk9Pntjb25zdFtuLGwsYSxwXT1pO2lmKG49PW51bGwmJmw9PW51bGwmJmE9PW51bGwmJnA9PW51bGwpcmV0dXJuIHQ/P1suMDAxLC4wMDEsMSwuMDFdO2NvbnN0IHU9YT8/KG4hPW51bGwmJmw9PW51bGx8fG49PW51bGwmJmw9PW51bGw/MTouMDAxKTtyZXR1cm5bTWF0aC5tYXgobj8/MCwuMDAxKSxNYXRoLm1heChsPz8wLC4wMDEpLE1hdGgubWluKHUsMSksTWF0aC5tYXgocD8/MCwuMDEpXX07bGV0IEM9e3NpbmU6dixzYXc6Uix6YXc6eCxzYXd0b290aDpSLHphd3Rvb3RoOngsc3VwZXJzYXc6Rix0cmk6dyx0cmlhbmdsZTp3LHB1bHNlOkksc3F1YXJlOkkscHVsemU6TCxkdXN0OlMsY3JhY2tsZTpTLGltcHVsc2U6aix3aGl0ZTpOLGJyb3duOkIscGluazpHfTtjb25zdCBaPXtjaG9ydXM6MCxub3RlOjQ4LHM6InRyaWFuZ2xlIixiYW5rOiIiLGdhaW46MSxwb3N0Z2FpbjoxLHZlbG9jaXR5OjEsZGVuc2l0eToiLjAzIixmdHlwZToiMTJkYiIsZmFuY2hvcjowLHJlc29uYW5jZTowLGhyZXNvbmFuY2U6MCxiYW5kcTowLGNoYW5uZWxzOlsxLDJdLHBoYXNlcmRlcHRoOi43NSxzaGFwZXZvbDoxLGRpc3RvcnR2b2w6MSxkZWxheTowLGJ5dGVCZWF0RXhwcmVzc2lvbjoiMCIsZGVsYXlmZWVkYmFjazouNSxkZWxheXNwZWVkOjEsZGVsYXl0aW1lOi4yNSxvcmJpdDoxLGk6MSxmZnQ6OCx6OiJ0cmlhbmdsZSIscGFuOi41LGZtaDoxLGZtZW52OjAsc3BlZWQ6MSxwdzouNX07bGV0IHI9aT0+WltpXTtjb25zdCBIPXtjOjAsZDoyLGU6NCxmOjUsZzo3LGE6OSxiOjExfSxKPXsiIyI6MSxiOi0xLHM6MSxmOi0xfSxLPShpLHM9Myk9PntsZXRbdCxlPSIiLGg9IiJdPVN0cmluZyhpKS5tYXRjaCgvXihbYS1nQS1HXSkoWyNic2ZdKikoWzAtOV0qKSQvKT8uc2xpY2UoMSl8fFtdO2lmKCF0KXRocm93IG5ldyBFcnJvcignbm90IGEgbm90ZTogIicraSsnIicpO2NvbnN0IG89SFt0LnRvTG93ZXJDYXNlKCldLG49ZT8uc3BsaXQoIiIpLnJlZHVjZSgoYSxwKT0+YStKW3BdLDApfHwwO3JldHVybihOdW1iZXIoaHx8cykrMSkqMTIrbytufSxRPWk9Pk1hdGgucG93KDIsKGktNjkpLzEyKSo0NDAsUD1pPT4oaT1pfHxyKCJub3RlIiksdHlwZW9mIGk9PSJzdHJpbmciJiYoaT1LKGksMykpLFEoaSkpO2NsYXNzIHR0e2lkPTA7b3V0PVswLDBdO2F0dGFjaztkZWNheTtzdXN0YWluO3JlbGVhc2U7X2JlZ2luO19kdXJhdGlvbjtfc291bmQ7X2NoYW5uZWxzPTE7X2J1ZmZlcnM7dW5pdDtfcGVudjtwZW52O3BhdHRhY2s7cGRlY2F5O3BzdXN0YWluO3ByZWxlYXNlO3ZpYjtfdmliO3ZpYm1vZDtfZm07Zm1oO2ZtaTtfZm1lbnY7Zm1hdHRhY2s7Zm1kZWNheTtmbXN1c3RhaW47Zm1yZWxlYXNlO19scGVudjtscGVudjtscGF0dGFjaztscGRlY2F5O2xwc3VzdGFpbjtscHJlbGVhc2U7X2hwZW52O2hwZW52O2hwYXR0YWNrO2hwZGVjYXk7aHBzdXN0YWluO2hwcmVsZWFzZTtfYnBlbnY7YnBlbnY7YnBhdHRhY2s7YnBkZWNheTticHN1c3RhaW47YnByZWxlYXNlO2N1dG9mZjtoY3V0b2ZmO2JhbmRmO2NvYXJzZTtjcnVzaDtkaXN0b3J0O2ZyZXE7bm90ZTtfbHBmO19ocGY7X2JwZjtfY2hvcnVzO19jb2Fyc2U7X2NydXNoO19kaXN0b3J0O2NvbnN0cnVjdG9yKHMpe3RoaXMuZnJlcT8/PVAocy5ub3RlKSx0aGlzLl9iZWdpbj1zLl9iZWdpbix0aGlzLl9kdXJhdGlvbj1zLl9kdXJhdGlvbix0aGlzLnJlbGVhc2U9cy5yZWxlYXNlPz8wO2xldCB0PXRoaXM7aWYoT2JqZWN0LmFzc2lnbih0LHMpLHQucz10LnM/P3IoInMiKSx0LmdhaW49Yyh0LmdhaW4/P3IoImdhaW4iKSksdC52ZWxvY2l0eT1jKHQudmVsb2NpdHk/P3IoInZlbG9jaXR5IikpLHQucG9zdGdhaW49Yyh0LnBvc3RnYWluPz9yKCJwb3N0Z2FpbiIpKSx0LmRlbnNpdHk9dC5kZW5zaXR5Pz9yKCJkZW5zaXR5IiksdC5mYW5jaG9yPXQuZmFuY2hvcj8/cigiZmFuY2hvciIpLHQuZHJpdmU9dC5kcml2ZT8/LjY5LHQucGhhc2VyZGVwdGg9dC5waGFzZXJkZXB0aD8/cigicGhhc2VyZGVwdGgiKSx0LnNoYXBldm9sPWModC5zaGFwZXZvbD8/cigic2hhcGV2b2wiKSksdC5kaXN0b3J0dm9sPWModC5kaXN0b3J0dm9sPz9yKCJkaXN0b3J0dm9sIikpLHQuaT10Lmk/P3IoImkiKSx0LmNob3J1cz10LmNob3J1cz8/cigiY2hvcnVzIiksdC5mZnQ9dC5mZnQ/P3IoImZmdCIpLHQucGFuPXQucGFuPz9yKCJwYW4iKSx0Lm9yYml0PXQub3JiaXQ/P3IoIm9yYml0IiksdC5mbWVudj10LmZtZW52Pz9yKCJmbWVudiIpLHQucmVzb25hbmNlPXQucmVzb25hbmNlPz9yKCJyZXNvbmFuY2UiKSx0LmhyZXNvbmFuY2U9dC5ocmVzb25hbmNlPz9yKCJocmVzb25hbmNlIiksdC5iYW5kcT10LmJhbmRxPz9yKCJiYW5kcSIpLHQuc3BlZWQ9dC5zcGVlZD8/cigic3BlZWQiKSx0LnB3PXQucHc/P3IoInB3IiksW3QuYXR0YWNrLHQuZGVjYXksdC5zdXN0YWluLHQucmVsZWFzZV09bShbdC5hdHRhY2ssdC5kZWNheSx0LnN1c3RhaW4sdC5yZWxlYXNlXSksdC5faG9sZEVuZD10Ll9iZWdpbit0Ll9kdXJhdGlvbix0Ll9lbmQ9dC5faG9sZEVuZCt0LnJlbGVhc2UrLjAxLHQuZm1pJiYodC5zPT09InNhdyJ8fHQucz09PSJzYXd0b290aCIpJiYodC5zPSJ6YXciKSxDW3Quc10pe2NvbnN0IGU9Q1t0LnNdO3QuX3NvdW5kPW5ldyBlLHQuX2NoYW5uZWxzPTF9ZWxzZSBpZihfLnNhbXBsZXMuaGFzKHQucykpe2NvbnN0IGU9Xy5zYW1wbGVzLmdldCh0LnMpO3QuX2J1ZmZlcnM9W10sdC5fY2hhbm5lbHM9ZS5jaGFubmVscy5sZW5ndGg7Zm9yKGxldCBoPTA7aDx0Ll9jaGFubmVscztoKyspdC5fYnVmZmVycy5wdXNoKG5ldyBfKGUuY2hhbm5lbHNbaF0sZS5zYW1wbGVSYXRlLHQudW5pdD09PSJjIikpfWVsc2UgY29uc29sZS53YXJuKCJzb3VuZCBub3QgbG9hZGVkIix0LnMpO3QucGVudiYmKHQuX3BlbnY9bmV3IGYoe2RlY2F5Q3VydmU6NH0pLFt0LnBhdHRhY2ssdC5wZGVjYXksdC5wc3VzdGFpbix0LnByZWxlYXNlXT1tKFt0LnBhdHRhY2ssdC5wZGVjYXksdC5wc3VzdGFpbix0LnByZWxlYXNlXSkpLHQudmliJiYodC5fdmliPW5ldyB2LHQudmlibW9kPXQudmlibW9kPz9yKCJ2aWJtb2QiKSksdC5mbWkmJih0Ll9mbT1uZXcgdix0LmZtaD10LmZtaD8/cigiZm1oIiksdC5mbWVudiYmKHQuX2ZtZW52PW5ldyBmKHtkZWNheUN1cnZlOjJ9KSxbdC5mbWF0dGFjayx0LmZtZGVjYXksdC5mbXN1c3RhaW4sdC5mbXJlbGVhc2VdPW0oW3QuZm1hdHRhY2ssdC5mbWRlY2F5LHQuZm1zdXN0YWluLHQuZm1yZWxlYXNlXSkpKSx0Ll9hZHNyPW5ldyBmKHtkZWNheUN1cnZlOjJ9KSx0LmRlbGF5PWModC5kZWxheT8/cigiZGVsYXkiKSksdC5kZWxheWZlZWRiYWNrPXQuZGVsYXlmZWVkYmFjaz8/cigiZGVsYXlmZWVkYmFjayIpLHQuZGVsYXlzcGVlZD10LmRlbGF5c3BlZWQ/P3IoImRlbGF5c3BlZWQiKSx0LmRlbGF5dGltZT10LmRlbGF5dGltZT8/cigiZGVsYXl0aW1lIiksdC5scGVudiYmKHQuX2xwZW52PW5ldyBmKHtkZWNheUN1cnZlOjR9KSxbdC5scGF0dGFjayx0LmxwZGVjYXksdC5scHN1c3RhaW4sdC5scHJlbGVhc2VdPW0oW3QubHBhdHRhY2ssdC5scGRlY2F5LHQubHBzdXN0YWluLHQubHByZWxlYXNlXSkpLHQuaHBlbnYmJih0Ll9ocGVudj1uZXcgZih7ZGVjYXlDdXJ2ZTo0fSksW3QuaHBhdHRhY2ssdC5ocGRlY2F5LHQuaHBzdXN0YWluLHQuaHByZWxlYXNlXT1tKFt0LmhwYXR0YWNrLHQuaHBkZWNheSx0Lmhwc3VzdGFpbix0LmhwcmVsZWFzZV0pKSx0LmJwZW52JiYodC5fYnBlbnY9bmV3IGYoe2RlY2F5Q3VydmU6NH0pLFt0LmJwYXR0YWNrLHQuYnBkZWNheSx0LmJwc3VzdGFpbix0LmJwcmVsZWFzZV09bShbdC5icGF0dGFjayx0LmJwZGVjYXksdC5icHN1c3RhaW4sdC5icHJlbGVhc2VdKSksdC5fY2hvcnVzPXQuY2hvcnVzP1tdOm51bGwsdC5fbHBmPXQuY3V0b2ZmP1tdOm51bGwsdC5faHBmPXQuaGN1dG9mZj9bXTpudWxsLHQuX2JwZj10LmJhbmRmP1tdOm51bGwsdC5fY29hcnNlPXQuY29hcnNlP1tdOm51bGwsdC5fY3J1c2g9dC5jcnVzaD9bXTpudWxsLHQuX2Rpc3RvcnQ9dC5kaXN0b3J0P1tdOm51bGw7Zm9yKGxldCBlPTA7ZTx0aGlzLl9jaGFubmVscztlKyspdC5fbHBmPy5wdXNoKG5ldyBnKSx0Ll9ocGY/LnB1c2gobmV3IGcpLHQuX2JwZj8ucHVzaChuZXcgZyksdC5fY2hvcnVzPy5wdXNoKG5ldyBXKSx0Ll9jb2Fyc2U/LnB1c2gobmV3IFgpLHQuX2NydXNoPy5wdXNoKG5ldyBVKSx0Ll9kaXN0b3J0Py5wdXNoKG5ldyBZKX11cGRhdGUocyl7aWYoIXRoaXMuX3NvdW5kJiYhdGhpcy5fYnVmZmVycylyZXR1cm4gMDtsZXQgdD0rKHM+PXRoaXMuX2JlZ2luJiZzPD10aGlzLl9ob2xkRW5kKSxlPXRoaXMuZnJlcSp0aGlzLnNwZWVkO2lmKHRoaXMuX2ZtJiZ0aGlzLmZtaCE9PXZvaWQgMCYmdGhpcy5mbWkhPT12b2lkIDApe2xldCBhPXRoaXMuZm1pO2lmKHRoaXMuX2ZtZW52KXtjb25zdCBxPXRoaXMuX2ZtZW52LnVwZGF0ZShzLHQsdGhpcy5mbWF0dGFjayx0aGlzLmZtZGVjYXksdGhpcy5mbXN1c3RhaW4sdGhpcy5mbXJlbGVhc2UpO2E9dGhpcy5mbWVudipxKmF9Y29uc3QgcD1lKnRoaXMuZm1oLHU9cCphO2U9ZSt0aGlzLl9mbS51cGRhdGUocCkqdX1pZih0aGlzLl92aWImJnRoaXMudmlibW9kIT09dm9pZCAwJiYoZT1lKjIqKih0aGlzLl92aWIudXBkYXRlKHRoaXMudmliKSp0aGlzLnZpYm1vZC8xMikpLHRoaXMuX3BlbnYmJnRoaXMucGVudiE9PXZvaWQgMCl7Y29uc3QgYT10aGlzLl9wZW52LnVwZGF0ZShzLHQsdGhpcy5wYXR0YWNrLHRoaXMucGRlY2F5LHRoaXMucHN1c3RhaW4sdGhpcy5wcmVsZWFzZSk7ZT1lK2EqdGhpcy5wZW52fWxldCBoPXRoaXMuY3V0b2ZmO2lmKGghPT12b2lkIDAmJnRoaXMuX2xwZW52KXtjb25zdCBhPXRoaXMuX2xwZW52LnVwZGF0ZShzLHQsdGhpcy5scGF0dGFjayx0aGlzLmxwZGVjYXksdGhpcy5scHN1c3RhaW4sdGhpcy5scHJlbGVhc2UpO2g9dGhpcy5scGVudiphKmgraH1sZXQgbz10aGlzLmhjdXRvZmY7aWYobyE9PXZvaWQgMCYmdGhpcy5faHBlbnYmJnRoaXMuaHBlbnYhPT12b2lkIDApe2NvbnN0IGE9dGhpcy5faHBlbnYudXBkYXRlKHMsdCx0aGlzLmhwYXR0YWNrLHRoaXMuaHBkZWNheSx0aGlzLmhwc3VzdGFpbix0aGlzLmhwcmVsZWFzZSk7bz0yKip0aGlzLmhwZW52KmEqbytvfWxldCBuPXRoaXMuYmFuZGY7aWYobiE9PXZvaWQgMCYmdGhpcy5fYnBlbnYmJnRoaXMuYnBlbnYhPT12b2lkIDApe2NvbnN0IGE9dGhpcy5fYnBlbnYudXBkYXRlKHMsdCx0aGlzLmJwYXR0YWNrLHRoaXMuYnBkZWNheSx0aGlzLmJwc3VzdGFpbix0aGlzLmJwcmVsZWFzZSk7bj0yKip0aGlzLmJwZW52KmEqbitufWNvbnN0IGw9dGhpcy5fYWRzci51cGRhdGUocyx0LHRoaXMuYXR0YWNrLHRoaXMuZGVjYXksdGhpcy5zdXN0YWluLHRoaXMucmVsZWFzZSk7Zm9yKGxldCBhPTA7YTx0aGlzLl9jaGFubmVsczthKyspe2lmKHRoaXMuX3NvdW5kJiZ0aGlzLnM9PT0icHVsc2UiP3RoaXMub3V0W2FdPXRoaXMuX3NvdW5kLnVwZGF0ZShlLHRoaXMucHcpOnRoaXMuX3NvdW5kP3RoaXMub3V0W2FdPXRoaXMuX3NvdW5kLnVwZGF0ZShlKTp0aGlzLl9idWZmZXJzJiYodGhpcy5vdXRbYV09dGhpcy5fYnVmZmVyc1thXS51cGRhdGUoZSkpLHRoaXMub3V0W2FdPXRoaXMub3V0W2FdKnRoaXMuZ2Fpbip0aGlzLnZlbG9jaXR5LHRoaXMuX2Nob3J1cyl7Y29uc3QgcD10aGlzLl9jaG9ydXNbYV0udXBkYXRlKHRoaXMub3V0W2FdLHRoaXMuY2hvcnVzLC4wMysuMDUqYSwxLC4xMSk7dGhpcy5vdXRbYV09cCt0aGlzLm91dFthXX10aGlzLl9scGYmJih0aGlzLl9scGZbYV0udXBkYXRlKHRoaXMub3V0W2FdLGgsdGhpcy5yZXNvbmFuY2UpLHRoaXMub3V0W2FdPXRoaXMuX2xwZlthXS5zMSksdGhpcy5faHBmJiYodGhpcy5faHBmW2FdLnVwZGF0ZSh0aGlzLm91dFthXSxvLHRoaXMuaHJlc29uYW5jZSksdGhpcy5vdXRbYV09dGhpcy5vdXRbYV0tdGhpcy5faHBmW2FdLnMxKSx0aGlzLl9icGYmJih0aGlzLl9icGZbYV0udXBkYXRlKHRoaXMub3V0W2FdLG4sdGhpcy5iYW5kcSksdGhpcy5vdXRbYV09dGhpcy5fYnBmW2FdLnMwKSx0aGlzLl9jb2Fyc2UmJih0aGlzLm91dFthXT10aGlzLl9jb2Fyc2VbYV0udXBkYXRlKHRoaXMub3V0W2FdLHRoaXMuY29hcnNlKSksdGhpcy5fY3J1c2gmJih0aGlzLm91dFthXT10aGlzLl9jcnVzaFthXS51cGRhdGUodGhpcy5vdXRbYV0sdGhpcy5jcnVzaCkpLHRoaXMuX2Rpc3RvcnQmJih0aGlzLm91dFthXT10aGlzLl9kaXN0b3J0W2FdLnVwZGF0ZSh0aGlzLm91dFthXSx0aGlzLmRpc3RvcnQsdGhpcy5kaXN0b3J0dm9sKSksdGhpcy5vdXRbYV09dGhpcy5vdXRbYV0qbCx0aGlzLm91dFthXT10aGlzLm91dFthXSp0aGlzLnBvc3RnYWluLHRoaXMuX2J1ZmZlcnN8fCh0aGlzLm91dFthXT10aGlzLm91dFthXSouMil9aWYodGhpcy5fY2hhbm5lbHM9PT0xJiYodGhpcy5vdXRbMV09dGhpcy5vdXRbMF0pLHRoaXMucGFuIT09LjUpe2NvbnN0IGE9dGhpcy5wYW4qTWF0aC5QSS8yO3RoaXMub3V0WzBdPXRoaXMub3V0WzBdKk1hdGguY29zKGEpLHRoaXMub3V0WzFdPXRoaXMub3V0WzFdKk1hdGguc2luKGEpfX19Y2xhc3Mgc3R7dm9pY2VzPVtdO3ZpZD0wO3E9W107b3V0PVswLDBdO2RlbGF5c2VuZD1bMCwwXTtkZWxheXRpbWU9cigiZGVsYXl0aW1lIik7ZGVsYXlmZWVkYmFjaz1yKCJkZWxheWZlZWRiYWNrIik7ZGVsYXlzcGVlZD1yKCJkZWxheXNwZWVkIik7dD0wO2NvbnN0cnVjdG9yKHM9NDhlMyx0PTApe3RoaXMuc2FtcGxlUmF0ZT1zLHRoaXMudD1NYXRoLmZsb29yKHQqcyksdGhpcy5fZGVsYXlMPW5ldyBrLHRoaXMuX2RlbGF5Uj1uZXcga31sb2FkU2FtcGxlKHMsdCxlKXtfLnNhbXBsZXMuc2V0KHMse2NoYW5uZWxzOnQsc2FtcGxlUmF0ZTplfSl9c2NoZWR1bGVTcGF3bihzKXtpZihzLl9iZWdpbj09PXZvaWQgMCl0aHJvdyBuZXcgRXJyb3IoIltkb3VnaF06IHNjaGVkdWxlU3Bhd24gZXhwZWN0ZWQgX2JlZ2luIHRvIGJlIHNldCIpO2lmKHMuX2R1cmF0aW9uPT09dm9pZCAwKXRocm93IG5ldyBFcnJvcigiW2RvdWdoXTogc2NoZWR1bGVTcGF3biBleHBlY3RlZCBfZHVyYXRpb24gdG8gYmUgc2V0Iik7cy5zYW1wbGVSYXRlPXRoaXMuc2FtcGxlUmF0ZTtjb25zdCB0PU1hdGguZmxvb3Iocy5fYmVnaW4qdGhpcy5zYW1wbGVSYXRlKTt0aGlzLnNjaGVkdWxlKHt0aW1lOnQsdHlwZToic3Bhd24iLGFyZzpzfSl9c3Bhd24ocyl7cy5pZD10aGlzLnZpZCsrO2NvbnN0IHQ9bmV3IHR0KHMpO3RoaXMudm9pY2VzLnB1c2godCk7Y29uc3QgZT1NYXRoLmNlaWwodC5fZW5kKnRoaXMuc2FtcGxlUmF0ZSk7dGhpcy5zY2hlZHVsZSh7dGltZTplLHR5cGU6ImRlc3Bhd24iLGFyZzp0LmlkfSl9ZGVzcGF3bihzKXt0aGlzLnZvaWNlcz10aGlzLnZvaWNlcy5maWx0ZXIodD0+dC5pZCE9PXMpfXNjaGVkdWxlKHMpe2lmKCF0aGlzLnEubGVuZ3RoKXt0aGlzLnEucHVzaChzKTtyZXR1cm59bGV0IHQ9MDtmb3IoO3Q8dGhpcy5xLmxlbmd0aCYmdGhpcy5xW3RdLnRpbWU8cy50aW1lOyl0Kys7dGhpcy5xLnNwbGljZSh0LDAscyl9dXBkYXRlKCl7Zm9yKDt0aGlzLnEubGVuZ3RoPjAmJnRoaXMucVswXS50aW1lPD10aGlzLnQ7KXRoaXNbdGhpcy5xWzBdLnR5cGVdKHRoaXMucVswXS5hcmcpLHRoaXMucS5zaGlmdCgpO3RoaXMub3V0WzBdPTAsdGhpcy5vdXRbMV09MDtmb3IobGV0IGU9MDtlPHRoaXMudm9pY2VzLmxlbmd0aDtlKyspdGhpcy52b2ljZXNbZV0udXBkYXRlKHRoaXMudC90aGlzLnNhbXBsZVJhdGUpLHRoaXMub3V0WzBdKz10aGlzLnZvaWNlc1tlXS5vdXRbMF0sdGhpcy5vdXRbMV0rPXRoaXMudm9pY2VzW2VdLm91dFsxXSx0aGlzLnZvaWNlc1tlXS5kZWxheSYmKHRoaXMuZGVsYXlzZW5kWzBdKz10aGlzLnZvaWNlc1tlXS5vdXRbMF0qdGhpcy52b2ljZXNbZV0uZGVsYXksdGhpcy5kZWxheXNlbmRbMV0rPXRoaXMudm9pY2VzW2VdLm91dFsxXSp0aGlzLnZvaWNlc1tlXS5kZWxheSx0aGlzLmRlbGF5dGltZT10aGlzLnZvaWNlc1tlXS5kZWxheXRpbWUsdGhpcy5kZWxheXNwZWVkPXRoaXMudm9pY2VzW2VdLmRlbGF5c3BlZWQsdGhpcy5kZWxheWZlZWRiYWNrPXRoaXMudm9pY2VzW2VdLmRlbGF5ZmVlZGJhY2spO2NvbnN0IHM9dGhpcy5fZGVsYXlMLnVwZGF0ZSh0aGlzLmRlbGF5c2VuZFswXSx0aGlzLmRlbGF5dGltZSksdD10aGlzLl9kZWxheVIudXBkYXRlKHRoaXMuZGVsYXlzZW5kWzFdLHRoaXMuZGVsYXl0aW1lKTt0aGlzLmRlbGF5c2VuZFswXT1zKnRoaXMuZGVsYXlmZWVkYmFjayx0aGlzLmRlbGF5c2VuZFsxXT10KnRoaXMuZGVsYXlmZWVkYmFjayx0aGlzLm91dFswXSs9cyx0aGlzLm91dFsxXSs9dCx0aGlzLnQrK319Y29uc3QgZXQ9KGkscyx0KT0+TWF0aC5taW4oTWF0aC5tYXgoaSxzKSx0KTtjbGFzcyBpdCBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3Nvcntjb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5kb3VnaD1uZXcgc3Qoc2FtcGxlUmF0ZSxjdXJyZW50VGltZSksdGhpcy5wb3J0Lm9ubWVzc2FnZT1zPT57cy5kYXRhLnNwYXduP3RoaXMuZG91Z2guc2NoZWR1bGVTcGF3bihzLmRhdGEuc3Bhd24pOnMuZGF0YS5zYW1wbGU/dGhpcy5kb3VnaC5sb2FkU2FtcGxlKHMuZGF0YS5zYW1wbGUscy5kYXRhLmNoYW5uZWxzLHMuZGF0YS5zYW1wbGVSYXRlKTpzLmRhdGEuc2FtcGxlcz9zLmRhdGEuc2FtcGxlcy5mb3JFYWNoKChbdCxlLGhdKT0+e3RoaXMuZG91Z2gubG9hZFNhbXBsZSh0LGUsaCl9KTpjb25zb2xlLmxvZygidW5yZWNvZ25pemVkIGV2ZW50IHR5cGUiLHMuZGF0YSl9fXByb2Nlc3Mocyx0LGUpe2lmKHRoaXMuZGlzY29ubmVjdGVkKXJldHVybiExO2NvbnN0IGg9dFswXTtmb3IobGV0IG89MDtvPGhbMF0ubGVuZ3RoO28rKyl7dGhpcy5kb3VnaC51cGRhdGUoKTtmb3IobGV0IG49MDtuPGgubGVuZ3RoO24rKyloW25dW29dPWV0KHRoaXMuZG91Z2gub3V0W25dLC0xLDEpfXJldHVybiEwfX1yZWdpc3RlclByb2Nlc3NvcigiZG91Z2gtcHJvY2Vzc29yIixpdCl9KSgpOwo=";typeof sampleRate<"u"&&sampleRate,Mp(Qg);const{Pattern:qg,logger:$g,repl:t2}=js;j0($g);const e2=t=>(t.ensureObjectValue(),t.value),Ip=(t,e,n,s,o)=>Xo(e2(t),o,n,s,t.whole?.begin.valueOf());function jp(t={}){return t={getTime:()=>I().currentTime,defaultOutput:Ip,...t},t2(t)}qg.prototype.dough=function(){return this.onTrigger(Np,1)};const Me=(t="test-canvas",e)=>{let{contextType:n="2d",pixelated:s=!1,pixelRatio:o=window.devicePixelRatio}={},c=document.querySelector("#"+t);if(!c){c=document.createElement("canvas"),c.id=t,c.width=window.innerWidth*o,c.height=window.innerHeight*o,c.style="pointer-events:none;width:100%;height:100%;position:fixed;top:0;left:0",s&&(c.style.imageRendering="pixelated"),document.body.prepend(c);let i;window.addEventListener("resize",()=>{i&&clearTimeout(i),i=setTimeout(()=>{c.width=window.innerWidth*o,c.height=window.innerHeight*o},200)})}return c.getContext(n,{willReadFrequently:!0})};let Vn={};function n2(t){Vn[t]!==void 0&&(cancelAnimationFrame(Vn[t]),delete Vn[t])}let de={};L.prototype.draw=function(t,e){if(typeof window>"u")return this;let{id:n=1,lookbehind:s=0,lookahead:o=0}=e,c=Math.max(Js(),0);n2(n),s=Math.abs(s),de[n]=(de[n]||[]).filter(l=>!l.isInFuture(c));let i=this.queryArc(c,c+o).filter(l=>l.hasOnset());de[n]=de[n].concat(i);let u;const a=()=>{const l=Js(),p=l+o;de[n]=de[n].filter(g=>g.isInNearPast(s,l));let f=Math.max(u||p,p-1/10);const b=this.queryArc(f,p).filter(g=>g.hasOnset());de[n]=de[n].concat(b),u=p,t(de[n],l,p,this),Vn[n]=requestAnimationFrame(a)};return Vn[n]=requestAnimationFrame(a),this},L.prototype.onPaint=function(t){return this.withState(e=>(e.controls.painters||(e.controls.painters=[]),e.controls.painters.push(t),e))},L.prototype.getPainters=function(){let t=[];return this.queryArc(0,0,{painters:t}),t};let s2={background:"#222",foreground:"#75baff",caret:"#ffcc00",selection:"rgba(128, 203, 196, 0.5)",selectionMatch:"#036dd626",lineHighlight:"#00000050",gutterBackground:"transparent",gutterForeground:"#8a919966"};function pe(){return s2}let Op="#22222210";L.prototype.animate=function({callback:t,sync:e=!1,smear:n=.5}={}){window.frame&&cancelAnimationFrame(window.frame);const s=Me();let{clientWidth:o,clientHeight:c}=s.canvas;o*=window.devicePixelRatio,c*=window.devicePixelRatio;let i=n===0?"99":Number((1-n)*100).toFixed(0);i=i.length===1?`0${i}`:i,Op=`#200010${i}`;const u=a=>{let l;a=Math.round(a),l=this.slow(1e3).queryArc(a,a),s.fillStyle=Op,s.fillRect(0,0,o,c),l.forEach(p=>{let{x:f,y:b,w:g,h:X,s:Z,r:W,angle:F=0,fill:z="darkseagreen"}=p.value;if(g*=o,X*=c,W!==void 0&&F!==void 0){const x=F*2*Math.PI,[R,A]=[(o-g)/2,(c-X)/2];f=R+Math.cos(x)*W*R,b=A+Math.sin(x)*W*A}else f*=o-g,b*=c-X;const v={...p.value,x:f,y:b,w:g,h:X};s.fillStyle=z,Z==="rect"?s.fillRect(f,b,g,X):Z==="ellipse"&&(s.beginPath(),s.ellipse(f+g/2,b+X/2,g/2,X/2,0,0,2*Math.PI),s.fill()),t&&t(s,v,p)}),window.frame=requestAnimationFrame(u)};return window.frame=requestAnimationFrame(u),nt};const{x:Up,y:lG,w:dG,h:pG,angle:hG,r:fG,fill:mG,smear:yG}=xs("x","y","w","h","angle","r","fill","smear");G("rescale",function(t,e){return e.mul(Up(t).w(t).y(t).h(t))}),G("moveXY",function(t,e,n){return n.add(Up(t).y(e))}),G("zoomIn",function(t,e){const n=gt(1).sub(t).div(2);return e.rescale(t).move(n,n)});const Cn=(t,e,n)=>t*(n-e)+e,_p=t=>{let{value:e}=t;typeof t.value!="object"&&(e={value:e});let{note:n,n:s,freq:o,s:c}=e;if(o)return ps(o);if(n=n??s,typeof n=="string")try{return Ae(n)}catch{return 0}return typeof n=="number"?n:c?"_"+c:e};L.prototype.pianoroll=function(t={}){let{cycles:e=4,playhead:n=.5,overscan:s=0,hideNegative:o=!1,ctx:c=Me(),id:i=1}=t,u=-e*n,a=e*(1-n);const l=(p,f)=>(!o||p.whole.begin>=0)&&p.isWithinTime(f+u,f+a);return this.draw((p,f)=>{Qp({...t,time:f,ctx:c,haps:p.filter(b=>l(b,f))})},{lookbehind:u-s,lookahead:a+s,id:i}),this};function Qp({time:t,haps:e,cycles:n=4,playhead:s=.5,flipTime:o=0,flipValues:c=0,hideNegative:i=!1,inactive:u=pe().foreground,active:a=pe().foreground,background:l="transparent",smear:p=0,playheadColor:f=pe().foreground,minMidi:b=10,maxMidi:g=90,autorange:X=0,timeframe:Z,fold:W=1,vertical:F=0,labels:z=!1,fill:v=1,fillActive:x=!1,strokeActive:R=!0,stroke:A,hideInactive:O=0,colorizeInactive:j=1,fontFamily:tt,ctx:k,id:it}={}){const H=k.canvas.width,Q=k.canvas.height;let U=-n*s,dt=n*(1-s);it&&(e=e.filter($=>$.hasTag(it))),Z&&(console.warn("timeframe is deprecated! use from/to instead"),U=0,dt=Z);const q=F?Q:H,st=F?H:Q;let pt=F?[q,0]:[0,q];const Vt=dt-U,Ht=F?[0,st]:[st,0];let kt=g-b+1,K=st/kt,J=[];o&&pt.reverse(),c&&Ht.reverse();const{min:$t,max:rt,values:oe}=e.reduce(({min:$,max:ot,values:Jt},It)=>{const Zt=_p(It);return{min:Zt<$?Zt:$,max:Zt>ot?Zt:ot,values:Jt.includes(Zt)?Jt:[...Jt,Zt]}},{min:1/0,max:-1/0,values:[]});X&&(b=$t,g=rt,kt=g-b+1),J=oe.sort(($,ot)=>typeof $=="number"&&typeof ot=="number"?$-ot:typeof $=="number"?1:String($).localeCompare(String(ot))),K=W?st/J.length:st/kt,k.fillStyle=l,k.globalAlpha=1,p||(k.clearRect(0,0,H,Q),k.fillRect(0,0,H,Q)),e.forEach($=>{const ot=$.whole.begin<=t&&$.endClipped>t;let Jt=A??(R&&ot),It=!ot&&v||ot&&x;if(O&&!ot)return;let Zt=$.value?.color;a=Zt||a,u=j&&Zt||u,Zt=ot?a:u,k.fillStyle=It?Zt:"transparent",k.strokeStyle=Zt;const{velocity:Ge=1,gain:Ln=1}=$.value||{};k.globalAlpha=Ge*Ln;const Ze=($.whole.begin-(o?dt:U))/Vt,qe=Cn(Ze,...pt);let he=Cn($.duration/Vt,0,q);const Re=_p($),xe=W?J.indexOf(Re)/J.length:(Number(Re)-b)/kt,ve=Cn(xe,...Ht);let $e=0;const Ye=Cn(t/Vt,...pt);let ce;if(F?ce=[ve+1-(c?K:0),q-Ye+qe+$e+1-(o?0:he),K-2,he-2]:ce=[qe-Ye+$e+1-(o?he:0),ve+1-(c?0:K),he-2,K-2],Jt&&k.strokeRect(...ce),It&&k.fillRect(...ce),z){const zn=$.value.note??$.value.s+($.value.n?`:${$.value.n}`:""),{label:tn,activeLabel:Mn}=$.value,Rn=(ot&&Mn||tn)??zn;let jt=F?he:K*.75;k.font=`${jt}px ${tt||"monospace"}`,k.fillStyle=It?"black":Zt,k.textBaseline="top",k.fillText(Rn,...ce)}}),k.globalAlpha=1;const Lt=Cn(-U/Vt,...pt);return k.strokeStyle=f,k.beginPath(),F?(k.moveTo(0,Lt),k.lineTo(st,Lt)):(k.moveTo(Lt,0),k.lineTo(Lt,st)),k.stroke(),this}function o2(t,e={}){let[n,s]=t;n=Math.abs(n);const o=s+n,c=o!==0?n/o:0;return{fold:1,...e,cycles:o,playhead:c}}const c2=(t={})=>(e,n,s,o)=>Qp({ctx:e,time:n,haps:s,...o2(o,t)});L.prototype.punchcard=function(t){return this.onPaint(c2(t))},L.prototype.wordfall=function(t){return this.punchcard({vertical:1,labels:1,stroke:0,fillActive:1,active:"white",...t})};function r2(t,e,n,s){const o=(t-90)*Math.PI/180;return[n+Math.cos(o)*e,s+Math.sin(o)*e]}const qp=(t,e,n,s,o=0)=>r2((t+o)*360,e*t,n,s);function $p(t){let{ctx:e,from:n=0,to:s=3,margin:o=50,cx:c=100,cy:i=100,rotate:u=0,thickness:a=o/2,color:l=pe().foreground,cap:p="round",stretch:f=1,fromOpacity:b=1,toOpacity:g=1}=t;n*=f,s*=f,u*=f,e.lineWidth=a,e.lineCap=p,e.strokeStyle=l,e.globalAlpha=b,e.beginPath();let[X,Z]=qp(n,o,c,i,u);e.moveTo(X,Z);const W=1/60;let F=n;for(;F<=s;){const[z,v]=qp(F,o,c,i,u);e.globalAlpha=(F-n)/(s-n)*g,e.lineTo(z,v),F+=W}e.stroke()}function i2(t){let{stretch:e=1,size:n=80,thickness:s=n/2,cap:o="butt",inset:c=3,playheadColor:i="#ffffff",playheadLength:u=.02,playheadThickness:a=s,padding:l=0,steady:p=1,activeColor:f=pe().foreground,inactiveColor:b=pe().gutterForeground,colorizeInactive:g=0,fade:X=!0,ctx:Z,time:W,haps:F,drawTime:z,id:v}=t;v&&(F=F.filter(H=>H.hasTag(v)));const[x,R]=[Z.canvas.width,Z.canvas.height];Z.clearRect(0,0,x*2,R*2);const[A,O]=[x/2,R/2],j={margin:n/e,cx:A,cy:O,stretch:e,cap:o,thickness:s},tt={...j,thickness:a,from:c-u,to:c,color:i},[k]=z,it=p*W;F.forEach(H=>{const Q=H.whole.begin<=W&&H.endClipped>W,U=H.whole.begin-W+c,dt=H.endClipped-W+c-l,q=H.value?.color||f,st=g||Q?q:b,pt=X?1-Math.abs((H.whole.begin-W)/k):1;$p({ctx:Z,...j,from:U,to:dt,rotate:it,color:st,fromOpacity:pt,toOpacity:pt})}),$p({ctx:Z,...tt,rotate:it})}L.prototype.spiral=function(t={}){return this.onPaint((e,n,s,o)=>i2({ctx:e,time:n,haps:s,drawTime:o,...t}))};const u2=Fe(36),th=(t,e,n,s)=>{s=s*Math.PI*2;const o=Math.sin(s)*n+t,c=Math.cos(s)*n+e;return[o,c]},eh=(t,e)=>.5-Math.log2(t/e)%1;function a2({haps:t,ctx:e,id:n,hapcircles:s=1,circle:o=0,edo:c=12,root:i=u2,thickness:u=3,hapRadius:a=6,mode:l="flake",margin:p=10}={}){const f=l==="polygon",b=l==="flake",g=e.canvas.width,X=e.canvas.height;e.clearRect(0,0,g,X);const Z=pe().foreground,F=Math.min(g,X)/2-u/2-a-p,z=g/2,v=X/2;n&&(t=t.filter(R=>R.hasTag(n))),e.strokeStyle=Z,e.fillStyle=Z,e.globalAlpha=1,e.lineWidth=u,o&&(e.beginPath(),e.arc(z,v,F,0,2*Math.PI),e.stroke()),c&&(Array.from({length:c},(R,A)=>{const O=eh(i*Math.pow(2,A/c),i),[j,tt]=th(z,v,F,O);e.beginPath(),e.arc(j,tt,a,0,2*Math.PI),e.fill()}),e.stroke());let x=[];e.lineWidth=a,t.forEach(R=>{let A;try{A=Ao(R)}catch{return}const O=eh(A,i),[j,tt]=th(z,v,F,O),k=R.value.color||Z;e.strokeStyle=k,e.fillStyle=k;const{velocity:it=1,gain:H=1}=R.value||{},Q=it*H;e.globalAlpha=Q,x.push([j,tt,O,k,Q]),e.beginPath(),s&&(e.moveTo(j+a,tt),e.arc(j,tt,a,0,2*Math.PI),e.fill()),b&&(e.moveTo(z,v),e.lineTo(j,tt)),e.stroke()}),e.strokeStyle=Z,e.globalAlpha=1,f&&x.length&&(x=x.sort((R,A)=>R[2]-A[2]),e.beginPath(),e.moveTo(x[0][0],x[0][1]),x.forEach(([R,A,O,j,tt])=>{e.strokeStyle=j,e.globalAlpha=tt,e.lineTo(R,A)}),e.lineTo(x[0][0],x[0][1]),e.stroke())}L.prototype.pitchwheel=function(t={}){let{ctx:e=Me(),id:n=1}=t;return this.tag(n).onPaint((s,o,c)=>a2({...t,ctx:e,haps:c.filter(i=>i.isActive(o)),id:n}))};function nh(t,{align:e=!0,color:n="white",thickness:s=3,scale:o=.25,pos:c=.75,trigger:i=0,ctx:u=Me(),id:a=1}={}){u.lineWidth=s,u.strokeStyle=n;let l=u.canvas;if(!t){u.beginPath();let Z=c*l.height;u.moveTo(0,Z),u.lineTo(l.width,Z),u.stroke();return}const p=$n("time",a);u.beginPath();const f=t.frequencyBinCount;let b=e?Array.from(p).findIndex((Z,W,F)=>W&&F[W-1]>-i&&Z<=-i):0;b=Math.max(b,0);const g=l.width*1/f;let X=0;for(let Z=b;Z<f;Z++){const W=p[Z]+1,F=(c-o*(W-1))*l.height;Z===0?u.moveTo(X,F):u.lineTo(X,F),X+=g}u.stroke()}function sh(t,{color:e="white",scale:n=.25,pos:s=.75,lean:o=.5,min:c=-150,max:i=0,ctx:u=Me(),id:a=1}={}){if(!t){u.beginPath();let X=s*p.height;u.moveTo(0,X),u.lineTo(p.width,X),u.stroke();return}const l=$n("frequency",a),p=u.canvas;u.fillStyle=e;const f=t.frequencyBinCount,b=p.width*1/f;let g=0;for(let X=0;X<f;X++){const W=Tn((l[X]-c)/(i-c),0,1)*n,F=W*p.height,z=(s-W*o)*p.height;u.fillRect(g,z,Math.max(b,1),F),g+=b}}function oh(t=0,e="0,0,0",n=Me()){t?(n.fillStyle=`rgba(${e},${1-t})`,n.fillRect(0,0,n.canvas.width,n.canvas.height)):n.clearRect(0,0,n.canvas.width,n.canvas.height)}L.prototype.fscope=function(t={}){let e=t.id??1;return this.analyze(e).draw(()=>{oh(t.smear,"0,0,0",t.ctx),xt[e]&&sh(xt[e],t)},{id:e})},L.prototype.tscope=function(t={}){let e=t.id??1;return this.analyze(e).draw(n=>{t.color=n[0]?.value?.color||pe().foreground,t.color,oh(t.smear,"0,0,0",t.ctx),nh(xt[e],t)},{id:e})},L.prototype.scope=L.prototype.tscope;let ch={};L.prototype.spectrum=function(t={}){let e=t.id??1;return this.analyze(e).draw(n=>{t.color=n[0]?.value?.color||ch[e]||pe().foreground,ch[e]=t.color,l2(xt[e],t)},{id:e})},L.prototype.scope=L.prototype.tscope;const Wo=new Map;function l2(t,{thickness:e=3,speed:n=1,min:s=-80,max:o=0,ctx:c=Me(),id:i=1,color:u}={}){if(c.lineWidth=e,c.strokeStyle=u,!t)return;const a=n,l=$n("frequency",i),p=c.canvas;c.fillStyle=u;const f=t.frequencyBinCount;let b=Wo.get(i)||c.getImageData(0,0,p.width,p.height);Wo.set(i,b),c.clearRect(0,0,c.canvas.width,c.canvas.height),c.putImageData(b,-a,0);let g=p.width-n;for(let X=0;X<f;X++){const Z=Tn((l[X]-s)/(o-s),0,1);c.globalAlpha=Z;const W=Math.log(X+1)/Math.log(f)*p.height;c.fillRect(g,p.height-W,a,2)}Wo.set(i,c.getImageData(0,0,p.width,p.height))}const d2=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_MAX_POLYPHONY:ao,Warpmode:Go,aliasBank:Gg,get analysers(){return xt},get analysersData(){return ze},applyFM:Gn,applyGainCurve:le,applyParameterModulators:so,connectToDestination:Rp,createFilter:_n,destroyAudioWorkletNode:Oe,distortionAlgorithms:oo,dough:Kg,doughTrigger:Np,doughsamples:Jp,drawFrequencyScope:sh,drawTimeScope:nh,drywet:cp,dspWorklet:Tp,effectSend:Un,errorLogger:I0,gainNode:Rt,getADSRValues:Dt,getAnalyserById:xp,getAnalyzerData:$n,getAudioContext:I,getAudioContextCurrentTime:Ib,getAudioDevices:Cp,getCachedBuffer:ug,getCompressor:sp,getDefaultValue:Wt,getDistortion:ap,getDistortionAlgorithm:og,getFrequencyFromValue:Le,getLfo:Xn,getLoadedBuffer:lg,getOscillator:Bp,getParamADSR:Et,getParamLfo:no,getPitchEnvelope:Je,getSampleBuffer:dp,getSampleBufferSource:pp,getSampleInfo:lp,getSound:_e,getSuperdoughAudioController:go,getVibratoOscillator:Ie,getWorklet:Bt,getZZFX:kp,initAudio:yo,initAudioOnFirstClick:Mg,loadBuffer:io,logger:Gt,noises:eo,onTriggerSample:Xp,onTriggerSynth:Ep,processSampleMap:yp,registerSampleSource:Gp,registerSamplesPrefix:dg,registerSound:se,registerSynthSounds:Tg,registerWaveTable:wo,registerWorklet:Mp,registerZZFXSounds:Ng,resetDefaultValues:Lp,resetDefaults:Fg,resetGlobalEffects:vg,resetLoadedSounds:Lg,reverseBuffer:hp,samples:uo,scheduleAtTime:_b,setDefault:Wg,setDefaultAudioContext:tp,setDefaultValue:fo,setDefaultValues:Vg,setGainCurve:gg,setLogger:j0,setMaxPolyphony:wp,setMultiChannelOrbits:Fp,setVersionDefaults:Cg,soundAlias:Zg,soundMap:qt,superdough:Xo,superdoughTrigger:Yg,tables:Ig,waveformN:Sp,webAudioTimeout:Ce,webaudioOutput:Ip,webaudioRepl:jp},Symbol.toStringTag,{value:"Module"})),{evalScope:p2}=js,{evaluate:rh}=jp();let es;const h2=()=>(es||(es=p2(js,Sb,d2).catch(t=>{throw es=void 0,console.error("Strudel scope failed to load",t),t})),es);let Fo=!1;window.strudel_init=async()=>{if(!Fo){console.log("Initializing Audio...");try{await h2(),await yo(),D0(),await uo("github:tidalcycles/dirt-samples"),Fo=!0,console.log("Audio Ready.")}catch(t){throw console.error("Audio Failed:",t),t}}},window.strudel_update=t=>{if(!Fo){console.warn("Audio not started yet. Call strudel_init() first.");return}console.log("Running:",t),rh(t)},window.strudel_stop=()=>{rh("hush")}})();
