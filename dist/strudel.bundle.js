(function(){"use strict";typeof globalThis.process>"u"&&(globalThis.process={env:{}}),typeof globalThis.process.env>"u"&&(globalThis.process.env={}),typeof globalThis.process.env.NODE_ENV>"u"&&(globalThis.process.env.NODE_ENV="production"),typeof BigInt>"u"&&(BigInt=function(t){if(isNaN(t))throw new Error("");return t});const k=BigInt(0),D=BigInt(1),dn=BigInt(2),as=BigInt(5),St=BigInt(10),gh=2e3,M={s:D,n:k,d:D};function ue(t,e){try{t=BigInt(t)}catch{throw be()}return t*e}function Ot(t){return typeof t=="bigint"?t:Math.floor(t)}function dt(t,e){if(e===k)throw ls();const n=Object.create(ct.prototype);n.s=t<k?-D:D,t=t<k?-t:t;const s=Fe(t,e);return n.n=t/s,n.d=e/s,n}function Ae(t){const e={};let n=t,s=dn,o=as-D;for(;o<=n;){for(;n%s===k;)n/=s,e[s]=(e[s]||k)+D;o+=D+dn*s++}return n!==t?n>1&&(e[n]=(e[n]||k)+D):e[t]=(e[t]||k)+D,e}const Wt=function(t,e){let n=k,s=D,o=D;if(t!=null)if(e!==void 0){if(typeof t=="bigint")n=t;else{if(isNaN(t))throw be();if(t%1!==0)throw Mo();n=BigInt(t)}if(typeof e=="bigint")s=e;else{if(isNaN(e))throw be();if(e%1!==0)throw Mo();s=BigInt(e)}o=n*s}else if(typeof t=="object"){if("d"in t&&"n"in t)n=BigInt(t.n),s=BigInt(t.d),"s"in t&&(n*=BigInt(t.s));else if(0 in t)n=BigInt(t[0]),1 in t&&(s=BigInt(t[1]));else if(typeof t=="bigint")n=t;else throw be();o=n*s}else if(typeof t=="number"){if(isNaN(t))throw be();if(t<0&&(o=-D,t=-t),t%1===0)n=BigInt(t);else if(t>0){let r=1,i=0,u=1,a=1,l=1,p=1e7;for(t>=1&&(r=10**Math.floor(1+Math.log10(t)),t/=r);u<=p&&l<=p;){let f=(i+a)/(u+l);if(t===f){u+l<=p?(n=i+a,s=u+l):l>u?(n=a,s=l):(n=i,s=u);break}else t>f?(i+=a,u+=l):(a+=i,l+=u),u>p?(n=a,s=l):(n=i,s=u)}n=BigInt(n)*BigInt(r),s=BigInt(s)}}else if(typeof t=="string"){let r=0,i=k,u=k,a=k,l=D,p=D,f=t.replace(/_/g,"").match(/\d+|./g);if(f===null)throw be();if(f[r]==="-"?(o=-D,r++):f[r]==="+"&&r++,f.length===r+1?u=ue(f[r++],o):f[r+1]==="."||f[r]==="."?(f[r]!=="."&&(i=ue(f[r++],o)),r++,(r+1===f.length||f[r+1]==="("&&f[r+3]===")"||f[r+1]==="'"&&f[r+3]==="'")&&(u=ue(f[r],o),l=St**BigInt(f[r].length),r++),(f[r]==="("&&f[r+2]===")"||f[r]==="'"&&f[r+2]==="'")&&(a=ue(f[r+1],o),p=St**BigInt(f[r+1].length)-D,r+=3)):f[r+1]==="/"||f[r+1]===":"?(u=ue(f[r],o),l=ue(f[r+2],D),r+=3):f[r+3]==="/"&&f[r+1]===" "&&(i=ue(f[r],o),u=ue(f[r+2],o),l=ue(f[r+4],D),r+=5),f.length<=r)s=l*p,o=n=a+s*i+p*u;else throw be()}else if(typeof t=="bigint")n=t,o=t,s=D;else throw be();if(s===k)throw ls();M.s=o<k?-D:D,M.n=n<k?-n:n,M.d=s<k?-s:s};function Xh(t,e,n){let s=D;for(;e>k;t=t*t%n,e>>=D)e&D&&(s=s*t%n);return s}function Gh(t,e){for(;e%dn===k;e/=dn);for(;e%as===k;e/=as);if(e===D)return k;let n=St%e,s=1;for(;n!==D;s++)if(n=n*St%e,s>gh)return k;return BigInt(s)}function Zh(t,e,n){let s=D,o=Xh(St,n,e);for(let r=0;r<300;r++){if(s===o)return BigInt(r);s=s*St%e,o=o*St%e}return 0}function Fe(t,e){if(!t)return e;if(!e)return t;for(;;){if(t%=e,!t)return e;if(e%=t,!e)return t}}function ct(t,e){if(Wt(t,e),this instanceof ct)t=Fe(M.d,M.n),this.s=M.s,this.n=M.n/t,this.d=M.d/t;else return dt(M.s*M.n,M.d)}var ls=function(){return new Error("Division by Zero")},be=function(){return new Error("Invalid argument")},Mo=function(){return new Error("Parameters must be integer")};ct.prototype={s:D,n:k,d:D,abs:function(){return dt(this.n,this.d)},neg:function(){return dt(-this.s*this.n,this.d)},add:function(t,e){return Wt(t,e),dt(this.s*this.n*M.d+M.s*this.d*M.n,this.d*M.d)},sub:function(t,e){return Wt(t,e),dt(this.s*this.n*M.d-M.s*this.d*M.n,this.d*M.d)},mul:function(t,e){return Wt(t,e),dt(this.s*M.s*this.n*M.n,this.d*M.d)},div:function(t,e){return Wt(t,e),dt(this.s*M.s*this.n*M.d,this.d*M.n)},clone:function(){return dt(this.s*this.n,this.d)},mod:function(t,e){if(t===void 0)return dt(this.s*this.n%this.d,D);if(Wt(t,e),k===M.n*this.d)throw ls();return dt(this.s*(M.d*this.n)%(M.n*this.d),M.d*this.d)},gcd:function(t,e){return Wt(t,e),dt(Fe(M.n,this.n)*Fe(M.d,this.d),M.d*this.d)},lcm:function(t,e){return Wt(t,e),M.n===k&&this.n===k?dt(k,D):dt(M.n*this.n,Fe(M.n,this.n)*Fe(M.d,this.d))},inverse:function(){return dt(this.s*this.d,this.n)},pow:function(t,e){if(Wt(t,e),M.d===D)return M.s<k?dt((this.s*this.d)**M.n,this.n**M.n):dt((this.s*this.n)**M.n,this.d**M.n);if(this.s<k)return null;let n=Ae(this.n),s=Ae(this.d),o=D,r=D;for(let i in n)if(i!=="1"){if(i==="0"){o=k;break}if(n[i]*=M.n,n[i]%M.d===k)n[i]/=M.d;else return null;o*=BigInt(i)**n[i]}for(let i in s)if(i!=="1"){if(s[i]*=M.n,s[i]%M.d===k)s[i]/=M.d;else return null;r*=BigInt(i)**s[i]}return M.s<k?dt(r,o):dt(o,r)},log:function(t,e){if(Wt(t,e),this.s<=k||M.s<=k)return null;const n={},s=Ae(M.n),o=Ae(M.d),r=Ae(this.n),i=Ae(this.d);for(const l in o)s[l]=(s[l]||k)-o[l];for(const l in i)r[l]=(r[l]||k)-i[l];for(const l in s)l!=="1"&&(n[l]=!0);for(const l in r)l!=="1"&&(n[l]=!0);let u=null,a=null;for(const l in n){const p=s[l]||k,f=r[l]||k;if(p===k){if(f!==k)return null;continue}let b=f,g=p;const X=Fe(b,g);if(b/=X,g/=X,u===null&&a===null)u=b,a=g;else if(b*a!==u*g)return null}return u!==null&&a!==null?dt(u,a):null},equals:function(t,e){return Wt(t,e),this.s*this.n*M.d===M.s*M.n*this.d},lt:function(t,e){return Wt(t,e),this.s*this.n*M.d<M.s*M.n*this.d},lte:function(t,e){return Wt(t,e),this.s*this.n*M.d<=M.s*M.n*this.d},gt:function(t,e){return Wt(t,e),this.s*this.n*M.d>M.s*M.n*this.d},gte:function(t,e){return Wt(t,e),this.s*this.n*M.d>=M.s*M.n*this.d},compare:function(t,e){Wt(t,e);let n=this.s*this.n*M.d-M.s*M.n*this.d;return(k<n)-(n<k)},ceil:function(t){return t=St**BigInt(t||0),dt(Ot(this.s*t*this.n/this.d)+(t*this.n%this.d>k&&this.s>=k?D:k),t)},floor:function(t){return t=St**BigInt(t||0),dt(Ot(this.s*t*this.n/this.d)-(t*this.n%this.d>k&&this.s<k?D:k),t)},round:function(t){return t=St**BigInt(t||0),dt(Ot(this.s*t*this.n/this.d)+this.s*((this.s>=k?D:k)+dn*(t*this.n%this.d)>this.d?D:k),t)},roundTo:function(t,e){Wt(t,e);const n=this.n*M.d,s=this.d*M.n,o=n%s;let r=Ot(n/s);return o+o>=s&&r++,dt(this.s*r*M.n,M.d)},divisible:function(t,e){return Wt(t,e),!(!(M.n*this.d)||this.n*M.d%(M.n*this.d))},valueOf:function(){return Number(this.s*this.n)/Number(this.d)},toString:function(t){let e=this.n,n=this.d;t=t||15;let s=Gh(e,n),o=Zh(e,n,s),r=this.s<k?"-":"";if(r+=Ot(e/n),e%=n,e*=St,e&&(r+="."),s){for(let i=o;i--;)r+=Ot(e/n),e%=n,e*=St;r+="(";for(let i=s;i--;)r+=Ot(e/n),e%=n,e*=St;r+=")"}else for(let i=t;e&&i--;)r+=Ot(e/n),e%=n,e*=St;return r},toFraction:function(t){let e=this.n,n=this.d,s=this.s<k?"-":"";if(n===D)s+=e;else{let o=Ot(e/n);t&&o>k&&(s+=o,s+=" ",e%=n),s+=e,s+="/",s+=n}return s},toLatex:function(t){let e=this.n,n=this.d,s=this.s<k?"-":"";if(n===D)s+=e;else{let o=Ot(e/n);t&&o>k&&(s+=o,e%=n),s+="\\frac{",s+=e,s+="}{",s+=n,s+="}"}return s},toContinued:function(){let t=this.n,e=this.d,n=[];do{n.push(Ot(t/e));let s=t%e;t=e,e=s}while(t!==D);return n},simplify:function(t){const e=BigInt(1/(t||.001)|0),n=this.abs(),s=n.toContinued();for(let o=1;o<s.length;o++){let r=dt(s[o-1],D);for(let u=o-2;u>=0;u--)r=r.inverse().add(s[u]);let i=r.sub(n);if(i.n*e<i.d)return r.mul(this.s)}return this}};const ds="strudel.log";let wh=1e3,Ro,xo;function Bn(t,e="cyclist"){process.env.NODE_ENV==="development"&&console.error(t),Yt(`[${e}] error: ${t.message}`)}function Yt(t,e,n={}){let s=performance.now();Ro===t&&s-xo<wh||(Ro=t,xo=s,console.log(`%c${t}`,"background-color: black;color:white;border-radius:15px"),typeof document<"u"&&typeof CustomEvent<"u"&&document.dispatchEvent(new CustomEvent(ds,{detail:{message:t,type:e,data:n}})))}Yt.key=ds;const Wh=t=>/^[a-gA-G][#bsf]*[0-9]*$/.test(t),kn=t=>/^[a-gA-G][#bsf]*-?[0-9]*$/.test(t),vo=t=>{if(typeof t!="string")return[];const[e,n="",s]=t.match(/^([a-gA-G])([#bsf]*)(-?[0-9]*)$/)?.slice(1)||[];return e?[e,n,s?Number(s):void 0]:[]},Fh={c:0,d:2,e:4,f:5,g:7,a:9,b:11},Vh={"#":1,b:-1,s:1,f:-1},So=t=>t?.split("").reduce((e,n)=>e+Vh[n],0)||0,Ne=(t,e=3)=>{const[n,s,o=e]=vo(t);if(!n)throw new Error('not a note: "'+t+'"');const r=Fh[n.toLowerCase()],i=So(s);return(Number(o)+1)*12+r+i},Ve=t=>Math.pow(2,(t-69)/12)*440,ps=t=>12*Math.log(t/440)/Math.LN2+69,Ch=(t,e)=>{if(typeof t!="object")throw new Error("valueToMidi: expected object value");let{freq:n,note:s}=t;if(typeof n=="number")return ps(n);if(typeof s=="string")return Ne(s);if(typeof s=="number")return s;if(!e)throw new Error("valueToMidi: expected freq or note to be set");return e},Lh=(t,e)=>(t-e)*1e3,Yo=t=>Ve(typeof t=="number"?t:Ne(t)),zh=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],Mh=t=>{const e=Math.floor(t/12)-1;return zh[t%12]+e},pn=(t,e)=>(t%e+e)%e,Bo=t=>t.reduce((e,n)=>e+n)/t.length;function ko(t,e=0){return isNaN(Number(t))?(Yt(`"${t}" is not a number, falling back to ${e}`,"warning"),e):t}const Rh=(t,e)=>pn(Math.round(ko(t??0,0)),e),xh=t=>{let{value:e,context:n}=t,s=e;if(typeof s=="object"&&!Array.isArray(s)&&(s=s.note||s.n||s.value,s===void 0))throw new Error(`cannot find a playable note for ${JSON.stringify(e)}`);if(typeof s=="number"&&n.type!=="frequency")s=Ve(t.value);else if(typeof s=="number"&&n.type==="frequency")s=t.value;else if(typeof s!="string"||!kn(s))throw new Error("not a note: "+JSON.stringify(s));return s},To=t=>{let{value:e,context:n}=t;if(typeof e=="object")return e.freq?e.freq:Yo(e.note||e.n||e.value);if(typeof e=="number"&&n.type!=="frequency")e=Ve(t.value);else if(typeof e=="string"&&kn(e))e=Ve(Ne(t.value));else if(typeof e!="number")throw new Error("not a note or frequency: "+e);return e},Ao=(t,e)=>t.slice(e).concat(t.slice(0,e)),No=(...t)=>t.reduce((e,n)=>(...s)=>e(n(...s)),e=>e),vh=(...t)=>No(...t.reverse()),Ke=t=>t.filter(e=>e!=null),ae=t=>[].concat(...t),He=t=>t,Sh=(t,e)=>t,hn=(t,e)=>Array.from({length:e-t+1},(n,s)=>s+t);function J(t,e,n=t.length){const s=function o(...r){if(r.length>=n)return t.apply(this,r);{const i=function(...u){return o.apply(this,r.concat(u))};return e&&e(i,r),i}};return e&&e(s,[]),s}function hs(t){const e=Number(t);if(!isNaN(e))return e;if(kn(t))return Ne(t);throw new Error(`cannot parse as numeral: "${t}"`)}function fs(t,e){return(...n)=>t(...n.map(e))}function At(t){return fs(t,hs)}function Ko(t){const e=Number(t);if(!isNaN(e))return e;const n={pi:Math.PI,w:1,h:.5,q:.25,e:.125,s:.0625,t:1/3,f:.2,x:1/6}[t];if(typeof n<"u")return n;throw new Error(`cannot parse as fractional: "${t}"`)}const Yh=t=>fs(t,Ko),ms=function(t,e){return[e.slice(0,t),e.slice(t)]},Tn=(t,e,n)=>e.map((s,o)=>t(s,n[o])),Ho=function(t){const e=[];for(let n=0;n<t.length-1;++n)e.push([t[n],t[n+1]]);return e},An=(t,e,n)=>Math.min(Math.max(t,e),n),Bh=["Do","Reb","Re","Mib","Mi","Fa","Solb","Sol","Lab","La","Sib","Si"],kh=["Sa","Re","Ga","Ma","Pa","Dha","Ni"],Th=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Hb","H"],Ah=["Ni","Pab","Pa","Voub","Vou","Ga","Dib","Di","Keb","Ke","Zob","Zo"],Nh=["I","Ro","Ha","Ni","Ho","He","To"],Kh=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],Hh=(t,e="letters")=>{const s=(e==="solfeggio"?Bh:e==="indian"?kh:e==="german"?Th:e==="byzantine"?Ah:e==="japanese"?Nh:Kh)[t%12],o=Math.floor(t/12)-1;return s+o};function Ph(t){var e={};return t.filter(function(n){return e.hasOwn(n)?!1:e[n]=!0})}function Eh(t){return t.sort().filter(function(e,n,s){return!n||e!=s[n-1]})}function Po(t){return t.sort((e,n)=>e.compare(n)).filter(function(e,n,s){return!n||e.ne(s[n-1])})}function Eo(t){const e=new TextEncoder().encode(t);return btoa(String.fromCharCode(...e))}function Do(t){const e=new Uint8Array(atob(t).split("").map(s=>s.charCodeAt(0)));return new TextDecoder().decode(e)}function Dh(t){return encodeURIComponent(Eo(t))}function Jh(t){return Do(decodeURIComponent(t))}function Jo(t,e){return Array.isArray(t)?t.map(e):Object.fromEntries(Object.entries(t).map(([n,s],o)=>[n,e(s,n,o)]))}function ys(t,e){return t/e}class Io{constructor({getTargetClockTime:e=jh,weight:n=16,offsetDelta:s=.005,checkAfterTime:o=2,resetAfterTime:r=8}){this.offsetTime,this.timeAtPrevOffsetSample,this.prevOffsetTimes=[],this.getTargetClockTime=e,this.weight=n,this.offsetDelta=s,this.checkAfterTime=o,this.resetAfterTime=r,this.reset=()=>{this.prevOffsetTimes=[],this.offsetTime=null,this.timeAtPrevOffsetSample=null}}calculateOffset(e){const n=this.getTargetClockTime(),s=n-this.timeAtPrevOffsetSample,o=n-e;if(s>this.resetAfterTime&&this.reset(),this.offsetTime==null&&(this.offsetTime=o),this.prevOffsetTimes.push(o),this.prevOffsetTimes.length>this.weight&&this.prevOffsetTimes.shift(),this.timeAtPrevOffsetSample==null||s>this.checkAfterTime){this.timeAtPrevOffsetSample=n;const r=Bo(this.prevOffsetTimes);Math.abs(r-this.offsetTime)>this.offsetDelta&&(this.offsetTime=r)}return this.offsetTime}calculateTimestamp(e,n){return this.calculateOffset(e)+n}}function Ih(){return performance.now()*.001}function jh(){return Date.now()*.001}const jo=new Map([["control","Control"],["ctrl","Control"],["alt","Alt"],["shift","Shift"],["down","ArrowDown"],["up","ArrowUp"],["left","ArrowLeft"],["right","ArrowRight"]]);let fn;function _o(){if(fn==null){if(typeof window>"u")return;fn={},window.addEventListener("keydown",t=>{fn[t.key]=!0}),window.addEventListener("keyup",t=>{fn[t.key]=!1})}return{...fn}}function bs(t,e=!1){return typeof t=="object"?e?JSON.stringify(t).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(t):t}ct.prototype.sam=function(){return this.floor()},ct.prototype.nextSam=function(){return this.sam().add(1)},ct.prototype.wholeCycle=function(){return new bt(this.sam(),this.nextSam())},ct.prototype.cyclePos=function(){return this.sub(this.sam())},ct.prototype.lt=function(t){return this.compare(t)<0},ct.prototype.gt=function(t){return this.compare(t)>0},ct.prototype.lte=function(t){return this.compare(t)<=0},ct.prototype.gte=function(t){return this.compare(t)>=0},ct.prototype.eq=function(t){return this.compare(t)==0},ct.prototype.ne=function(t){return this.compare(t)!=0},ct.prototype.max=function(t){return this.gt(t)?this:t},ct.prototype.maximum=function(...t){return t=t.map(e=>new ct(e)),t.reduce((e,n)=>n.max(e),this)},ct.prototype.min=function(t){return this.lt(t)?this:t},ct.prototype.mulmaybe=function(t){return t!==void 0?this.mul(t):void 0},ct.prototype.divmaybe=function(t){return t!==void 0?this.div(t):void 0},ct.prototype.addmaybe=function(t){return t!==void 0?this.add(t):void 0},ct.prototype.submaybe=function(t){return t!==void 0?this.sub(t):void 0},ct.prototype.show=function(){return this.s*this.n+"/"+this.d},ct.prototype.or=function(t){return this.eq(0)?t:this};const gs=t=>ct(t),_h=(...t)=>{if(t=Ke(t),t.length!==0)return t.reduce((e,n)=>e.gcd(n),gs(1))},Ut=(...t)=>{if(t=Ke(t),t.length===0)return;const e=t.pop();return t.reduce((n,s)=>n===void 0||s===void 0?void 0:n.lcm(s),e)},Oh=t=>t instanceof ct;gs._original=ct;const C=gs;class bt{constructor(e,n){this.begin=C(e),this.end=C(n)}get spanCycles(){const e=[];var n=this.begin;const s=this.end,o=s.sam();if(n.equals(s))return[new bt(n,s)];for(;s.gt(n);){if(n.sam().equals(o)){e.push(new bt(n,this.end));break}const r=n.nextSam();e.push(new bt(n,r)),n=r}return e}get duration(){return this.end.sub(this.begin)}cycleArc(){const e=this.begin.cyclePos(),n=e.add(this.duration);return new bt(e,n)}withTime(e){return new bt(e(this.begin),e(this.end))}withEnd(e){return new bt(this.begin,e(this.end))}withCycle(e){const n=this.begin.sam(),s=n.add(e(this.begin.sub(n))),o=n.add(e(this.end.sub(n)));return new bt(s,o)}intersection(e){const n=this.begin.max(e.begin),s=this.end.min(e.end);if(!n.gt(s)&&!(n.equals(s)&&(n.equals(this.end)&&this.begin.lt(this.end)||n.equals(e.end)&&e.begin.lt(e.end))))return new bt(n,s)}intersection_e(e){const n=this.intersection(e);if(n==null)throw"TimeSpans do not intersect";return n}midpoint(){return this.begin.add(this.duration.div(C(2)))}equals(e){return this.begin.equals(e.begin)&&this.end.equals(e.end)}show(){return this.begin.show()+" → "+this.end.show()}}class gt{constructor(e,n,s,o={},r=!1){this.whole=e,this.part=n,this.value=s,this.context=o,this.stateful=r,r&&console.assert(typeof this.value=="function","Stateful values must be functions")}get duration(){let e;return typeof this.value?.duration=="number"?e=C(this.value.duration):e=this.whole.end.sub(this.whole.begin),typeof this.value?.clip=="number"?e.mul(this.value.clip):e}get endClipped(){return this.whole.begin.add(this.duration)}isActive(e){return this.whole.begin<=e&&this.endClipped>=e}isInPast(e){return e>this.endClipped}isInNearPast(e,n){return n-e<=this.endClipped}isInFuture(e){return e<this.whole.begin}isInNearFuture(e,n){return n<this.whole.begin&&n>this.whole.begin-e}isWithinTime(e,n){return this.whole.begin<=n&&this.endClipped>=e}wholeOrPart(){return this.whole?this.whole:this.part}withSpan(e){const n=this.whole?e(this.whole):void 0;return new gt(n,e(this.part),this.value,this.context)}withValue(e){return new gt(this.whole,this.part,e(this.value),this.context)}hasOnset(){return this.whole!=null&&this.whole.begin.equals(this.part.begin)}hasTag(e){return this.context.tags?.includes(e)}resolveState(e){if(this.stateful&&this.hasOnset()){console.log("stateful");const n=this.value,[s,o]=n(e);return[s,new gt(this.whole,this.part,o,this.context,!1)]}return[e,this]}spanEquals(e){return this.whole==null&&e.whole==null||this.whole.equals(e.whole)}equals(e){return this.spanEquals(e)&&this.part.equals(e.part)&&this.value===e.value}show(e=!1){const n=typeof this.value=="object"?e?JSON.stringify(this.value).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(this.value):this.value;var s="";if(this.whole==null)s="~"+this.part.show;else{var o=this.whole.begin.equals(this.part.begin)&&this.whole.end.equals(this.part.end);this.whole.begin.equals(this.part.begin)||(s=this.whole.begin.show()+" ⇜ "),o||(s+="("),s+=this.part.show(),o||(s+=")"),this.whole.end.equals(this.part.end)||(s+=" ⇝ "+this.whole.end.show())}return"[ "+s+" | "+n+" ]"}showWhole(e=!1){return`${this.whole==null?"~":this.whole.show()}: ${bs(this.value,e)}`}combineContext(e){const n=this;return{...n.context,...e.context,locations:(n.context.locations||[]).concat(e.context.locations||[])}}setContext(e){return new gt(this.whole,this.part,this.value,e)}ensureObjectValue(){if(typeof this.value!="object")throw new Error(`expected hap.value to be an object, but got "${this.value}". Hint: append .note() or .s() to the end`,"error")}}class Pe{constructor(e,n={}){this.span=e,this.controls=n}setSpan(e){return new Pe(e,this.controls)}withSpan(e){return this.setSpan(e(this.span))}setControls(e){return new Pe(this.span,{...this.controls,...e})}}function Uh(t,e,n){if(e?.value!==void 0&&Object.keys(e).length===1)return Yt("[warn]: Can't do arithmetic on control pattern."),t;const s=Object.keys(t).filter(o=>Object.keys(e).includes(o));return Object.assign({},t,e,Object.fromEntries(s.map(o=>[o,n(t[o],e[o])])))}J((t,e)=>t*e),J((t,e)=>e.map(t));function Oo(t,e=60){let n=0,s=C(0),o=[""],r="";for(;o[0].length<e;){const i=t.queryArc(n,n+1),u=i.filter(p=>p.hasOnset()).map(p=>p.duration),a=_h(...u),l=a.inverse();o=o.map(p=>p+"|"),r+="|";for(let p=0;p<l;p++){const[f,b]=[s,s.add(a)],g=i.filter(Z=>Z.whole.begin.lte(f)&&Z.whole.end.gte(b)),X=g.length-o.length;X>0&&(o=o.concat(Array(X).fill(r))),o=o.map((Z,W)=>{const F=g[W];if(F){const v=F.whole.begin.eq(f)?""+F.value:"-";return Z+v}return Z+"."}),r+=".",s=s.add(a)}n++}return o.join(`
`)}let Xs,Nt=!0;const Qh=function(t){Nt=!!t},Uo=t=>Xs=t;let L=class Vt{constructor(e,n=void 0){this.query=e,this._Pattern=!0,this._steps=n}get _steps(){return this.__steps}set _steps(e){this.__steps=e===void 0?void 0:C(e)}setSteps(e){return this._steps=e,this}withSteps(e){return Nt?new Vt(this.query,this._steps===void 0?void 0:e(this._steps)):this}get hasSteps(){return this._steps!==void 0}withValue(e){const n=new Vt(s=>this.query(s).map(o=>o.withValue(e)));return n._steps=this._steps,n}withState(e){return new Vt(n=>this.query(e(n)))}fmap(e){return this.withValue(e)}appWhole(e,n){const s=this,o=function(r){const i=s.query(r),u=n.query(r),a=function(l,p){const f=l.part.intersection(p.part);if(f!=null)return new gt(e(l.whole,p.whole),f,l.value(p.value),p.combineContext(l))};return ae(i.map(l=>Ke(u.map(p=>a(l,p)))))};return new Vt(o)}appBoth(e){const n=this,s=function(r,i){if(!(r==null||i==null))return r.intersection_e(i)},o=n.appWhole(s,e);return Nt&&(o._steps=Ut(e._steps,n._steps)),o}appLeft(e){const n=this,s=function(r){const i=[];for(const u of n.query(r)){const a=e.query(r.setSpan(u.wholeOrPart()));for(const l of a){const p=u.whole,f=u.part.intersection(l.part);if(f){const b=u.value(l.value),g=l.combineContext(u),X=new gt(p,f,b,g);i.push(X)}}}return i},o=new Vt(s);return o._steps=this._steps,o}appRight(e){const n=this,s=function(r){const i=[];for(const u of e.query(r)){const a=n.query(r.setSpan(u.wholeOrPart()));for(const l of a){const p=u.whole,f=l.part.intersection(u.part);if(f){const b=l.value(u.value),g=u.combineContext(l),X=new gt(p,f,b,g);i.push(X)}}}return i},o=new Vt(s);return o._steps=e._steps,o}bindWhole(e,n){const s=this,o=function(r){const i=function(a,l){return new gt(e(a.whole,l.whole),l.part,l.value,Object.assign({},a.context,l.context,{locations:(a.context.locations||[]).concat(l.context.locations||[])}))},u=function(a){return n(a.value).query(r.setSpan(a.part)).map(l=>i(a,l))};return ae(s.query(r).map(a=>u(a)))};return new Vt(o)}bind(e){const n=function(s,o){if(!(s==null||o==null))return s.intersection_e(o)};return this.bindWhole(n,e)}join(){return this.bind(He)}outerBind(e){return this.bindWhole(n=>n,e).setSteps(this._steps)}outerJoin(){return this.outerBind(He)}innerBind(e){return this.bindWhole((n,s)=>s,e)}innerJoin(){return this.innerBind(He)}resetJoin(e=!1){const n=this;return new Vt(s=>n.discreteOnly().query(s).map(o=>o.value.late(e?o.whole.begin:o.whole.begin.cyclePos()).query(s).map(r=>new gt(r.whole?r.whole.intersection(o.whole):void 0,r.part.intersection(o.part),r.value).setContext(o.combineContext(r))).filter(r=>r.part)).flat())}restartJoin(){return this.resetJoin(!0)}squeezeJoin(){const e=this;function n(s){const o=e.discreteOnly().query(s);function r(u){const l=u.value._focusSpan(u.wholeOrPart()).query(s.setSpan(u.part));function p(f,b){let g;if(b.whole&&f.whole&&(g=b.whole.intersection(f.whole),!g))return;const X=b.part.intersection(f.part);if(!X)return;const Z=b.combineContext(f);return new gt(g,X,b.value,Z)}return l.map(f=>p(u,f))}return ae(o.map(r)).filter(u=>u)}return new Vt(n)}squeezeBind(e){return this.fmap(e).squeezeJoin()}polyJoin=function(){const e=this;return e.fmap(n=>n.extend(e._steps.div(n._steps))).outerJoin()};polyBind(e){return this.fmap(e).polyJoin()}queryArc(e,n,s={}){try{return this.query(new Pe(new bt(e,n),s))}catch(o){return Bn(o,"query"),[]}}splitQueries(){const e=this,n=s=>ae(s.span.spanCycles.map(o=>e.query(s.setSpan(o))));return new Vt(n)}withQuerySpan(e){return new Vt(n=>this.query(n.withSpan(e)))}withQuerySpanMaybe(e){const n=this;return new Vt(s=>{const o=s.withSpan(e);return o.span?n.query(o):[]})}withQueryTime(e){return new Vt(n=>this.query(n.withSpan(s=>s.withTime(e))))}withHapSpan(e){return new Vt(n=>this.query(n).map(s=>s.withSpan(e)))}withHapTime(e){return this.withHapSpan(n=>n.withTime(e))}withHaps(e){const n=new Vt(s=>e(this.query(s),s));return n._steps=this._steps,n}withHap(e){return this.withHaps(n=>n.map(e))}setContext(e){return this.withHap(n=>n.setContext(e))}withContext(e){const n=this.withHap(s=>s.setContext(e(s.context)));return this.__pure!==void 0&&(n.__pure=this.__pure,n.__pure_loc=this.__pure_loc),n}stripContext(){return this.withHap(e=>e.setContext({}))}withLoc(e,n){const s={start:e,end:n},o=this.withContext(r=>{const i=(r.locations||[]).concat([s]);return{...r,locations:i}});return this.__pure&&(o.__pure=this.__pure,o.__pure_loc=s),o}filterHaps(e){return new Vt(n=>this.query(n).filter(e))}filterValues(e){return new Vt(n=>this.query(n).filter(s=>e(s.value))).setSteps(this._steps)}removeUndefineds(){return this.filterValues(e=>e!=null)}onsetsOnly(){return this.filterHaps(e=>e.hasOnset())}discreteOnly(){return this.filterHaps(e=>e.whole)}defragmentHaps(){return this.discreteOnly().withHaps(n=>{const s=[];for(var o=0;o<n.length;++o){for(var r=!0,i=n[o];r;){const l=JSON.stringify(n[o].value);for(var u=!1,a=o+1;a<n.length;a++){const p=n[a];if(i.whole.equals(p.whole)){if(i.part.begin.eq(p.part.end)){if(l===JSON.stringify(p.value)){i=new gt(i.whole,new bt(p.part.begin,i.part.end),i.value),n.splice(a,1),u=!0;break}}else if(p.part.begin.eq(i.part.end)&&l==JSON.stringify(p.value)){i=new gt(i.whole,new bt(i.part.begin,p.part.end),i.value),n.splice(a,1),u=!0;break}}}r=u}s.push(i)}return s})}firstCycle(e=!1){var n=this;return e||(n=n.stripContext()),n.query(new Pe(new bt(C(0),C(1))))}get firstCycleValues(){return this.firstCycle().map(e=>e.value)}get showFirstCycle(){return this.firstCycle().map(e=>`${e.value}: ${e.whole.begin.toFraction()} - ${e.whole.end.toFraction()}`)}sortHapsByPart(){return this.withHaps(e=>e.sort((n,s)=>n.part.begin.sub(s.part.begin).or(n.part.end.sub(s.part.end)).or(n.whole.begin.sub(s.whole.begin).or(n.whole.end.sub(s.whole.end)))))}asNumber(){return this.fmap(hs)}_opIn(e,n){return this.fmap(n).appLeft(V(e))}_opOut(e,n){return this.fmap(n).appRight(V(e))}_opMix(e,n){return this.fmap(n).appBoth(V(e))}_opSqueeze(e,n){const s=V(e);return this.fmap(o=>s.fmap(r=>n(o)(r))).squeezeJoin()}_opSqueezeOut(e,n){const s=this;return V(e).fmap(r=>s.fmap(i=>n(i)(r))).squeezeJoin()}_opReset(e,n){return V(e).fmap(o=>this.fmap(r=>n(r)(o))).resetJoin()}_opRestart(e,n){return V(e).fmap(o=>this.fmap(r=>n(r)(o))).restartJoin()}_opPoly(e,n){const s=V(e);return this.fmap(o=>s.fmap(r=>n(r)(o))).polyJoin()}layer(...e){return mt(...e.map(n=>n(this)))}superimpose(...e){return this.stack(...e.map(n=>n(this)))}stack(...e){return mt(this,...e)}sequence(...e){return Qt(this,...e)}seq(...e){return Qt(this,...e)}cat(...e){return mn(this,...e)}fastcat(...e){return Lt(this,...e)}slowcat(...e){return ge(this,...e)}onTrigger(e,n=!0){return this.withHap(s=>s.setContext({...s.context,onTrigger:(...o)=>{s.context.onTrigger?.(...o),e(...o)},dominantTrigger:s.context.dominantTrigger||n}))}log(e=s=>`[hap] ${s.showWhole(!0)}`,n=s=>({hap:s})){return this.onTrigger((...s)=>{Yt(e(...s),void 0,n(...s))},!1)}logValues(e=n=>`[hap] ${bs(n,!0)}`){return this.log(n=>e(n.value))}drawLine(){return console.log(Oo(this)),this}unjoin(e,n=He){return e.withHap(s=>s.withValue(o=>o?n(this.ribbon(s.whole.begin,s.whole.duration)):this))}into(e,n){return this.unjoin(e,n).innerJoin()}};function qh(t,e){let n=[];return e.forEach(s=>{const o=n.findIndex(([r])=>t(s,r));o===-1?n.push([s]):n[o].push(s)}),n}const $h=(t,e)=>t.spanEquals(e);L.prototype.collect=function(){return this.withHaps(t=>qh($h,t).map(e=>new gt(e[0].whole,e[0].part,e,{})))};const tf=G("arpWith",(t,e)=>e.collect().fmap(n=>V(t(n))).innerJoin().withHap(n=>new gt(n.whole,n.part,n.value.value,n.combineContext(n.value)))),ef=G("arp",(t,e)=>e.arpWith(n=>V(t).fmap(s=>n[s%n.length])),!1);function Nn(t){return!Array.isArray(t)&&typeof t=="object"&&!Oh(t)}function nf(t,e,n){return Nn(t)||Nn(e)?(Nn(t)||(t={value:t}),Nn(e)||(e={value:e}),Uh(t,e,n)):n(t,e)}(function(){const t={set:[(n,s)=>s],keep:[n=>n],keepif:[(n,s)=>s?n:void 0],add:[At((n,s)=>n+s)],sub:[At((n,s)=>n-s)],mul:[At((n,s)=>n*s)],div:[At((n,s)=>n/s)],mod:[At(pn)],pow:[At(Math.pow)],log2:[At(Math.log2)],band:[At((n,s)=>n&s)],bor:[At((n,s)=>n|s)],bxor:[At((n,s)=>n^s)],blshift:[At((n,s)=>n<<s)],brshift:[At((n,s)=>n>>s)],lt:[(n,s)=>n<s],gt:[(n,s)=>n>s],lte:[(n,s)=>n<=s],gte:[(n,s)=>n>=s],eq:[(n,s)=>n==s],eqt:[(n,s)=>n===s],ne:[(n,s)=>n!=s],net:[(n,s)=>n!==s],and:[(n,s)=>n&&s],or:[(n,s)=>n||s],func:[(n,s)=>s(n)]},e=["In","Out","Mix","Squeeze","SqueezeOut","Reset","Restart","Poly"];for(const[n,[s,o]]of Object.entries(t)){L.prototype["_"+n]=function(r){return this.fmap(i=>s(i,r))},Object.defineProperty(L.prototype,n,{get:function(){const r=this,i=(...u)=>r[n].in(...u);for(const u of e)i[u.toLowerCase()]=function(...a){var l=r;a=Qt(a),o&&(l=o(l),a=o(a));var p;return n==="keepif"?(p=l["_op"+u](a,f=>b=>s(f,b)),p=p.removeUndefineds()):p=l["_op"+u](a,f=>b=>nf(f,b,s)),p};return i.squeezein=i.squeeze,i}});for(const r of e)L.prototype[r.toLowerCase()]=function(...i){return this.set[r.toLowerCase()](i)}}L.prototype.struct=function(...n){return this.keepif.out(...n)},L.prototype.structAll=function(...n){return this.keep.out(...n)},L.prototype.mask=function(...n){return this.keepif.in(...n)},L.prototype.maskAll=function(...n){return this.keep.in(...n)},L.prototype.reset=function(...n){return this.keepif.reset(...n)},L.prototype.resetAll=function(...n){return this.keep.reset(...n)},L.prototype.restart=function(...n){return this.keepif.restart(...n)},L.prototype.restartAll=function(...n){return this.keep.restart(...n)}})();const sf=mt,of=mt,rf=Kn,Ee=t=>new L(()=>[],t),st=Ee(1),Kt=Ee(0);function Xt(t){function e(s){return s.span.spanCycles.map(o=>new gt(C(o.begin).wholeCycle(),o,t))}const n=new L(e,1);return n.__pure=t,n}function Gs(t){return t instanceof L||t?._Pattern}function V(t){return Gs(t)?t:Xs&&typeof t=="string"?Xs(t):Xt(t)}function Qo(t){let e=Xt([]);for(const n of t)e=e.bind(s=>n.fmap(o=>s.concat([o])));return e}function mt(...t){t=t.map(s=>Array.isArray(s)?Qt(...s):V(s));const e=s=>ae(t.map(o=>o.query(s))),n=new L(e);return Nt&&(n._steps=Ut(...t.map(s=>s._steps))),n}function Zs(t,e){if(e=e.map(r=>Array.isArray(r)?Qt(...r):V(r)),e.length===0)return st;if(e.length===1)return e[0];const[n,...s]=e.map(r=>r._steps),o=Nt?n.maximum(...s):void 0;return mt(...t(o,e))}function qo(...t){return Zs((e,n)=>n.map(s=>s._steps.eq(e)?s:Bt(s,Ee(e.sub(s._steps)))),t)}function $o(...t){return Zs((e,n)=>n.map(s=>s._steps.eq(e)?s:Bt(Ee(e.sub(s._steps)),s)),t)}function tr(...t){return Zs((e,n)=>n.map(s=>{if(s._steps.eq(e))return s;const o=Ee(e.sub(s._steps).div(2));return Bt(o,s,o)}),t)}function cf(t,...e){const[n,...s]=e.map(i=>i._steps),o=n.maximum(...s),r={centre:tr,left:qo,right:$o,expand:mt,repeat:(...i)=>Kn(...i).steps(o)};return t.inhabit(r).fmap(i=>i(...e)).innerJoin().setSteps(o)}function ge(...t){if(t=t.map(s=>Array.isArray(s)?Lt(...s):V(s)),t.length==1)return t[0];const e=function(s){const o=s.span,r=pn(o.begin.sam(),t.length),i=t[r];if(!i)return[];const u=o.begin.floor().sub(o.begin.div(t.length).floor());return i.withHapTime(a=>a.add(u)).query(s.setSpan(o.withTime(a=>a.sub(u))))},n=Nt?Ut(...t.map(s=>s._steps)):void 0;return new L(e).splitQueries().setSteps(n)}function ws(...t){t=t.map(V);const e=function(n){const s=Math.floor(n.span.begin)%t.length;return t[s]?.query(n)||[]};return new L(e).splitQueries()}function mn(...t){return ge(...t)}function uf(...t){const e=t.reduce((n,[s])=>n+s,0);return t=t.map(([n,s])=>[n,s.fast(n)]),Bt(...t).slow(e)}function af(...t){let e=C(0);for(let n of t)n.length==2&&n.unshift(e),e=n[1];return mt(...t.map(([n,s,o])=>Xt(V(o)).compress(C(n).div(e),C(s).div(e)))).slow(e).innerJoin()}function Lt(...t){let e=ge(...t);return t.length>1&&(e=e._fast(t.length),e._steps=t.length),t.length==1&&t[0].__steps_source&&(t._steps=t[0]._steps),e}function Qt(...t){return Lt(...t)}function er(...t){return Lt(...t)}function Ws(t){return Array.isArray(t)?t.length==0?[st,0]:t.length==1?Ws(t[0]):[Lt(...t.map(e=>Ws(e)[0])),t.length]:[V(t),1]}const lf=J((t,e)=>V(e).mask(t)),df=J((t,e)=>V(e).struct(t)),pf=J((t,e)=>V(e).superimpose(...t)),hf=J((t,e)=>V(e).withValue(t)),ff=J((t,e)=>V(e).bind(t)),mf=J((t,e)=>V(e).innerBind(t)),yf=J((t,e)=>V(e).outerBind(t)),bf=J((t,e)=>V(e).squeezeBind(t)),gf=J((t,e)=>V(e).stepBind(t)),Xf=J((t,e)=>V(e).polyBind(t)),Gf=J((t,e)=>V(e).set(t)),Zf=J((t,e)=>V(e).keep(t)),wf=J((t,e)=>V(e).keepif(t)),Wf=J((t,e)=>V(e).add(t)),Ff=J((t,e)=>V(e).sub(t)),Vf=J((t,e)=>V(e).mul(t)),Cf=J((t,e)=>V(e).div(t)),Lf=J((t,e)=>V(e).mod(t)),zf=J((t,e)=>V(e).pow(t)),Mf=J((t,e)=>V(e).band(t)),Rf=J((t,e)=>V(e).bor(t)),xf=J((t,e)=>V(e).bxor(t)),vf=J((t,e)=>V(e).blshift(t)),Sf=J((t,e)=>V(e).brshift(t)),Yf=J((t,e)=>V(e).lt(t)),Bf=J((t,e)=>V(e).gt(t)),kf=J((t,e)=>V(e).lte(t)),Tf=J((t,e)=>V(e).gte(t)),Af=J((t,e)=>V(e).eq(t)),Nf=J((t,e)=>V(e).eqt(t)),Kf=J((t,e)=>V(e).ne(t)),Hf=J((t,e)=>V(e).net(t)),Pf=J((t,e)=>V(e).and(t)),Ef=J((t,e)=>V(e).or(t)),Df=J((t,e)=>V(e).func(t));function G(t,e,n=!0,s=!1,o=r=>r.innerJoin()){if(Array.isArray(t)){const u={};for(const a of t)u[a]=G(a,e,n,s,o);return u}const r=e.length;var i;return n?i=function(...u){u=u.map(V);const a=u[u.length-1];let l;if(r===1)l=e(a);else{const p=u.slice(0,-1);if(p.every(f=>f.__pure!=null)){const f=p.map(g=>g.__pure),b=p.filter(g=>g.__pure_loc).map(g=>g.__pure_loc);l=e(...f,a),l=l.withContext(g=>{const X=(g.locations||[]).concat(b);return{...g,locations:X}})}else{const[f,...b]=p;let g=(...X)=>e(...X,a);g=J(g,null,r-1),l=o(b.reduce((X,Z)=>X.appLeft(Z),f.fmap(g)))}}return s&&(l._steps=a._steps),l}:i=function(...u){u=u.map(V);const a=e(...u);return s&&(a._steps=u[u.length-1]._steps),a},L.prototype[t]=function(...u){if(r===2&&u.length!==1)u=[Qt(...u)];else if(r!==u.length+1)throw new Error(`.${t}() expects ${r-1} inputs but got ${u.length}.`);return u=u.map(V),i(...u,this)},r>1&&(L.prototype["_"+t]=function(...u){const a=e(...u,this);return s&&a.setSteps(this._steps),a}),J(i,null,r)}function De(t,e,n=!0,s=!1,o=r=>r.stepJoin()){return G(t,e,n,s,o)}const Jf=G("round",function(t){return t.asNumber().fmap(e=>Math.round(e))}),If=G("floor",function(t){return t.asNumber().fmap(e=>Math.floor(e))}),jf=G("ceil",function(t){return t.asNumber().fmap(e=>Math.ceil(e))}),_f=G("toBipolar",function(t){return t.fmap(e=>e*2-1)}),Of=G("fromBipolar",function(t){return t.fmap(e=>(e+1)/2)}),Uf=G("range",function(t,e,n){return n.mul(e-t).add(t)}),Qf=G("rangex",function(t,e,n){return n._range(Math.log(t),Math.log(e)).fmap(Math.exp)}),qf=G("range2",function(t,e,n){return n.fromBipolar()._range(t,e)}),$f=G("ratio",t=>t.fmap(e=>Array.isArray(e)?e.slice(1).reduce((n,s)=>n/s,e[0]):e)),tm=G("compress",function(t,e,n){return t=C(t),e=C(e),t.gt(e)||t.gt(1)||e.gt(1)||t.lt(0)||e.lt(0)?st:n._fastGap(C(1).div(e.sub(t)))._late(t)}),{compressSpan:em,compressspan:nm}=G(["compressSpan","compressspan"],function(t,e){return e._compress(t.begin,t.end)}),{fastGap:sm,fastgap:om}=G(["fastGap","fastgap"],function(t,e){const n=function(o){const r=o.begin.sam(),i=o.begin.sub(r).mul(t).min(1),u=o.end.sub(r).mul(t).min(1);if(!(i>=1))return new bt(r.add(i),r.add(u))},s=function(o){const r=o.part.begin,i=o.part.end,u=r.sam(),a=r.sub(u).div(t).min(1),l=i.sub(u).div(t).min(1),p=new bt(u.add(a),u.add(l)),f=o.whole?new bt(p.begin.sub(r.sub(o.whole.begin).div(t)),p.end.add(o.whole.end.sub(i).div(t))):void 0;return new gt(f,p,o.value,o.context)};return e.withQuerySpanMaybe(n).withHap(s).splitQueries()}),rm=G("focus",function(t,e,n){return t=C(t),e=C(e),n._early(t.sam())._fast(C(1).div(e.sub(t)))._late(t)}),{focusSpan:cm,focusspan:im}=G(["focusSpan","focusspan"],function(t,e){return e._focus(t.begin,t.end)}),um=G("ply",function(t,e){const n=e.fmap(s=>Xt(s)._fast(t)).squeezeJoin();return Nt&&(n._steps=C(t).mulmaybe(e._steps)),n}),{fast:am,density:oG}=G(["fast","density"],function(t,e){return t===0?st:(t=C(t),e.withQueryTime(s=>s.mul(t)).withHapTime(s=>s.div(t)).setSteps(e._steps))},!0,!0),lm=G("hurry",function(t,e){return e._fast(t).mul(Xt({speed:t}))}),{slow:dm,sparsity:pm}=G(["slow","sparsity"],function(t,e){return t===0?st:e._fast(C(1).div(t))}),hm=G("inside",function(t,e,n){return e(n._slow(t))._fast(t)}),fm=G("outside",function(t,e,n){return e(n._fast(t))._slow(t)}),mm=G("lastOf",function(t,e,n){const s=Array(t-1).fill(n);return s.push(e(n)),ws(...s)}),{firstOf:ym,every:bm}=G(["firstOf","every"],function(t,e,n){const s=Array(t-1).fill(n);return s.unshift(e(n)),ws(...s)}),gm=G("apply",function(t,e){return t(e)}),Xm=G("cpm",function(t,e){return e._fast(t/60/1)}),Gm=G("early",function(t,e){return t=C(t),e.withQueryTime(n=>n.add(t)).withHapTime(n=>n.sub(t))},!0,!0),nr=G("late",function(t,e){return t=C(t),e._early(C(0).sub(t))},!0,!0),Zm=G("zoom",function(t,e,n){if(e=C(e),t=C(t),t.gte(e))return Kt;const s=e.sub(t),o=Nt?n._steps?.mulmaybe(s):void 0;return n.withQuerySpan(r=>r.withCycle(i=>i.mul(s).add(t))).withHapSpan(r=>r.withCycle(i=>i.sub(t).div(s))).splitQueries().setSteps(o)}),{zoomArc:wm,zoomarc:Wm}=G(["zoomArc","zoomarc"],function(t,e){return e.zoom(t.begin,t.end)}),Fm=G("bite",(t,e,n)=>e.fmap(s=>o=>{const r=C(s).div(o).mod(1),i=r.add(C(1).div(o));return n.zoom(r,i)}).appLeft(t).squeezeJoin(),!1),Vm=G("linger",function(t,e){return t==0?st:t<0?e._zoom(t.add(1),1)._slow(t):e._zoom(0,t)._slow(t)},!0,!0),{segment:Cm,seg:Lm}=G(["segment","seg"],function(t,e){return e.struct(Xt(!0)._fast(t)).setSteps(t)}),zm=G("swingBy",(t,e,n)=>n.inside(e,nr(er(0,t/2)))),Mm=G("swing",(t,e)=>e.swingBy(1/3,t)),{invert:Rm,inv:xm}=G(["invert","inv"],function(t){return t.fmap(e=>!e)},!0,!0),vm=G("when",function(t,e,n){return t?e(n):n}),Sm=G("off",function(t,e,n){return mt(n,e(n.late(t)))}),Ym=G("brak",function(t){return t.when(ge(!1,!0),e=>Lt(e,st)._late(.25))}),sr=G("rev",function(t){const e=function(n){const s=n.span,o=s.begin.sam(),r=s.begin.nextSam(),i=function(a){const l=a.withTime(f=>o.add(r.sub(f))),p=l.begin;return l.begin=l.end,l.end=p,l};return t.query(n.setSpan(i(s))).map(a=>a.withSpan(i))};return new L(e).splitQueries()},!1,!0),Bm=G("revv",function(t){const e=n=>new bt(C(0).sub(n.end),C(0).sub(n.begin));return t.withQuerySpan(e).withHapSpan(e)}),km=G("pressBy",function(t,e){return e.fmap(n=>Xt(n).compress(t,1)).squeezeJoin()}),Tm=G("press",function(t){return t._pressBy(.5)});L.prototype.hush=function(){return st};const Am=G("palindrome",function(t){return t.lastOf(2,sr)},!0,!0),{juxBy:Nm,juxby:Km}=G(["juxBy","juxby"],function(t,e,n){t/=2;const s=function(i,u,a){return u in i?i[u]:a},o=n.withValue(i=>Object.assign({},i,{pan:s(i,"pan",.5)-t})),r=e(n.withValue(i=>Object.assign({},i,{pan:s(i,"pan",.5)+t})));return mt(o,r).setSteps(Nt?Ut(o._steps,r._steps):void 0)}),Hm=G("jux",function(t,e){return e._juxBy(1,t,e)}),{echoWith:Pm,echowith:Em,stutWith:Dm,stutwith:Jm}=G(["echoWith","echowith","stutWith","stutwith"],function(t,e,n,s){return mt(...hn(0,t-1).map(o=>n(s.late(C(e).mul(o)),o)))}),Im=G("echo",function(t,e,n,s){return s._echoWith(t,e,(o,r)=>o.gain(Math.pow(n,r)))}),jm=G("stut",function(t,e,n,s){return s._echoWith(t,n,(o,r)=>o.gain(Math.pow(e,r)))}),or=G("applyN",function(t,e,n){let s=n;for(let o=0;o<t;o++)s=e(s);return s}),_m=G(["plyWith","plywith"],function(t,e,n){const s=n.fmap(o=>mn(...hn(0,t-1).map(r=>or(r,e,o)))._fast(t)).squeezeJoin();return Nt&&(s._steps=C(t).mulmaybe(n._steps)),s}),Om=G(["plyForEach","plyforeach"],function(t,e,n){const s=n.fmap(o=>mn(mn(Xt(o),...hn(1,t-1).map(r=>e(Xt(o),r))))._fast(t)).squeezeJoin();return Nt&&(s._steps=C(t).mulmaybe(n._steps)),s}),Fs=function(t,e,n=!1){return t=C(t),ge(...hn(0,t.sub(1)).map(s=>n?e.late(C(s).div(t)):e.early(C(s).div(t))))},Um=G("iter",function(t,e){return Fs(t,e,!1)},!0,!0),{iterBack:Qm,iterback:qm}=G(["iterBack","iterback"],function(t,e){return Fs(t,e,!0)},!0,!0),{repeatCycles:$m}=G("repeatCycles",function(t,e){return new L(function(n){const s=n.span.begin.sam(),o=s.div(t).sam(),r=s.sub(o);return n=n.withSpan(i=>i.withTime(u=>u.sub(r))),e.query(n).map(i=>i.withSpan(u=>u.withTime(a=>a.add(r))))}).splitQueries()},!0,!0),Vs=function(t,e,n,s=!1,o=!1){const r=Array(t-1).fill(!1);r.unshift(!0);const i=Fs(t,Qt(...r),!s);return o||(n=n.repeatCycles(t)),n.when(i,e)},{chunk:t1,slowchunk:e1,slowChunk:n1}=G(["chunk","slowchunk","slowChunk"],function(t,e,n){return Vs(t,e,n,!1,!1)},!0,!0),{chunkBack:s1,chunkback:o1}=G(["chunkBack","chunkback"],function(t,e,n){return Vs(t,e,n,!0)},!0,!0),{fastchunk:r1,fastChunk:c1}=G(["fastchunk","fastChunk"],function(t,e,n){return Vs(t,e,n,!1,!0)},!0,!0),{chunkinto:i1,chunkInto:u1}=G(["chunkinto","chunkInto"],function(t,e,n){return n.into(Lt(!0,...Array(t-1).fill(!1))._iterback(t),e)}),{chunkbackinto:a1,chunkBackInto:l1}=G(["chunkbackinto","chunkBackInto"],function(t,e,n){return n.into(Lt(!0,...Array(t-1).fill(!1))._iter(t)._early(1),e)}),d1=G("bypass",function(t,e){return t=!!parseInt(t),t?st:e},!0,!0),{ribbon:p1,rib:h1}=G(["ribbon","rib"],(t,e,n)=>n.early(t).restart(Xt(1).slow(e))),f1=G("hsla",(t,e,n,s,o)=>o.color(`hsla(${t}turn,${e*100}%,${n*100}%,${s})`)),m1=G("hsl",(t,e,n,s)=>s.color(`hsl(${t}turn,${e*100}%,${n*100}%)`));L.prototype.tag=function(t){return this.withContext(e=>({...e,tags:(e.tags||[]).concat([t])}))};const y1=G("filter",(t,e)=>e.withHaps(n=>n.filter(t))),b1=G("filterWhen",(t,e)=>e.filter(n=>t(n.whole.begin))),g1=G("within",(t,e,n,s)=>mt(n(s.filterWhen(o=>o.cyclePos()>=t&&o.cyclePos()<=e)),s.filterWhen(o=>o.cyclePos()<t||o.cyclePos()>e)));L.prototype.stepJoin=function(){const t=this,e=Bt(...Cs(Ls(t.queryArc(0,1))))._steps,n=function(s){const r=t.early(s.span.begin.sam()).query(s.setSpan(new bt(C(0),C(1))));return Bt(...Cs(Ls(r))).query(s)};return new L(n,e)},L.prototype.stepBind=function(t){return this.fmap(t).stepJoin()};function Cs(t){const e=t.filter((r,i)=>i.hasSteps).reduce((r,i)=>r.add(i),C(0)),n=Ke(t.map((r,i)=>i._steps)).reduce((r,i)=>r.add(i),C(0)),s=e.eq(0)?void 0:n.div(e);function o(r,i){return i._steps===void 0?[r.mulmaybe(s),i]:[i._steps,i]}return t.map(r=>o(...r))}function Ls(t){const e=ae(t.map(o=>[o.part.begin,o.part.end])),n=Po([C(0),C(1),...e]);return Ho(n).map(o=>[o[1].sub(o[0]),mt(...rr(new bt(...o),t).map(r=>r.value.withHap(i=>i.setContext(i.combineContext(r)))))])}function rr(t,e){return Ke(e.map(n=>cr(t,n)))}function cr(t,e){const n=t.intersection(e.part);if(n!=null)return new gt(e.whole,n,e.value,e.context)}const ir=G("pace",function(t,e){return e._steps===void 0?e:e._steps.eq(C(0))?Kt:e._fast(C(t).div(e._steps)).setSteps(t)});function ur(t,...e){const n=e.map(o=>Ws(o));if(n.length==0)return st;t==0&&(t=n[0][1]);const s=[];for(const o of n)o[1]!=0&&(t==o[1]?s.push(o[0]):s.push(o[0]._fast(C(t).div(C(o[1])))));return mt(...s)}function Kn(...t){if(Array.isArray(t[0]))return ur(0,...t);if(t=t.filter(s=>s.hasSteps),t.length==0)return st;const e=Ut(...t.map(s=>s._steps));if(e.eq(C(0)))return Kt;const n=mt(...t.map(s=>s.pace(e)));return n._steps=e,n}function Bt(...t){if(t.length===0)return Kt;const e=i=>Array.isArray(i)?i:[i._steps??1,i];if(t=t.map(e),t.find(i=>i[0]===void 0)){const i=t.map(a=>a[0]).filter(a=>a!==void 0);if(i.length===0)return Lt(...t.map(a=>a[1]));if(i.length===t.length)return Kt;const u=i.reduce((a,l)=>a.add(l),C(0)).div(i.length);for(let a of t)a[0]===void 0&&(a[0]=u)}if(t.length==1)return V(t[0][1]).withSteps(u=>t[0][0]);const n=t.map(i=>i[0]).reduce((i,u)=>i.add(u),C(0));let s=C(0);const o=[];for(const[i,u]of t){if(C(i).eq(0))continue;const a=s.add(i);o.push(V(u)._compress(s.div(n),a.div(n))),s=a}const r=mt(...o);return r._steps=n,r}function ar(...t){t=t.map(o=>Array.isArray(o)?o.map(V):[V(o)]);const e=Ut(...t.map(o=>C(o.length)));let n=[];for(let o=0;o<e;++o)n.push(...t.map(r=>r.length==0?st:r[o%r.length]));n=n.filter(o=>o.hasSteps&&o._steps>0);const s=n.reduce((o,r)=>o.add(r._steps),C(0));return n=Bt(...n),n._steps=s,n}const lr=De("take",function(t,e){if(!e.hasSteps||e._steps.lte(0)||(t=C(t),t.eq(0)))return Kt;const n=t<0;n&&(t=t.abs());const s=t.div(e._steps);return s.lte(0)?Kt:s.gte(1)?e:n?e.zoom(C(1).sub(s),1):e.zoom(0,s)}),dr=De("drop",function(t,e){return e.hasSteps?(t=C(t),t.lt(0)?e.take(e._steps.add(t)):e.take(C(0).sub(e._steps.sub(t)))):Kt}),pr=De("extend",function(t,e){return e.fast(t).expand(t)}),X1=De("replicate",function(t,e){return e.repeatCycles(t).fast(t).expand(t)}),hr=De("expand",function(t,e){return e.withSteps(n=>n.mul(C(t)))}),fr=De("contract",function(t,e){return e.withSteps(n=>n.div(C(t)))});L.prototype.shrinklist=function(t){const e=this;if(!e.hasSteps)return[e];let[n,s]=Array.isArray(t)?t:[t,e._steps];if(n=C(n),s===0||n===0)return[e];const o=n>0,r=[];if(o){const i=C(1).div(e._steps).mul(n);for(let u=0;u<s;++u){const a=i.mul(u);if(a.gt(1))break;r.push([a,1])}}else{n=C(0).sub(n);const i=C(1).div(e._steps).mul(n);for(let u=0;u<s;++u){const a=C(1).sub(i.mul(u));if(a.lt(0))break;r.push([C(0),a])}}return r.map(i=>e.zoom(...i))};const mr=(t,e)=>e.shrinklist(t),yr=G("shrink",function(t,e){if(!e.hasSteps)return Kt;const n=e.shrinklist(t),s=Bt(...n);return s._steps=n.reduce((o,r)=>o.add(r._steps),C(0)),s},!0,!1,t=>t.stepJoin()),G1=G("grow",function(t,e){if(!e.hasSteps)return Kt;const n=e.shrinklist(C(0).sub(t));n.reverse();const s=Bt(...n);return s._steps=n.reduce((o,r)=>o.add(r._steps),C(0)),s},!0,!1,t=>t.stepJoin()),br=function(t,...e){return t.tour(...e)};L.prototype.tour=function(...t){return Bt(...[].concat(...t.map((e,n)=>[...t.slice(0,t.length-n),this,...t.slice(t.length-n)]),this,...t))};const gr=function(...t){t=t.filter(s=>s.hasSteps);const e=ge(...t.map(s=>s._slow(s._steps))),n=Ut(...t.map(s=>s._steps));return e._fast(n).setSteps(n)},Z1=Bt,zs=Bt,w1=Bt,W1=ar,F1=Kn;L.prototype.s_polymeter=L.prototype.polymeter;const V1=yr;L.prototype.s_taper=L.prototype.shrink;const C1=mr;L.prototype.s_taperlist=L.prototype.shrinklist;const L1=lr;L.prototype.s_add=L.prototype.take;const z1=dr;L.prototype.s_sub=L.prototype.drop;const M1=hr;L.prototype.s_expand=L.prototype.expand;const R1=pr;L.prototype.s_extend=L.prototype.extend;const x1=fr;L.prototype.s_contract=L.prototype.contract;const v1=br;L.prototype.s_tour=L.prototype.tour;const S1=gr;L.prototype.s_zip=L.prototype.zip;const Y1=ir;L.prototype.steps=L.prototype.pace;const B1=G("chop",function(t,e){const s=Array.from({length:t},(i,u)=>u).map(i=>({begin:i/t,end:(i+1)/t})),o=function(i,u){if("begin"in i&&"end"in i&&i.begin!==void 0&&i.end!==void 0){const a=i.end-i.begin;u={begin:i.begin+u.begin*a,end:i.begin+u.end*a}}return Object.assign({},i,u)},r=function(i){return Qt(s.map(u=>o(i,u)))};return e.squeezeBind(r).setSteps(Nt?C(t).mulmaybe(e._steps):void 0)}),k1=G("striate",function(t,e){const s=Array.from({length:t},(r,i)=>i).map(r=>({begin:r/t,end:(r+1)/t})),o=ge(...s);return e.set(o)._fast(t).setSteps(Nt?C(t).mulmaybe(e._steps):void 0)}),Xr=function(t,e,n=.5){return e.speed(1/t*n).unit("c").slow(t)},Gr=G("slice",function(t,e,n){return t.innerBind(s=>e.outerBind(o=>n.outerBind(r=>{r=r instanceof Object?r:{s:r};const i=Array.isArray(s)?s[o]:o/s,u=Array.isArray(s)?s[o+1]:(o+1)/s;return Xt({begin:i,end:u,_slices:s,...r})}))).setSteps(e._steps)},!1);L.prototype.onTriggerTime=function(t){return this.onTrigger((e,n,s,o)=>{const r=o-n;window.setTimeout(()=>{t(e)},r*1e3)},!1)};const T1=G("splice",function(t,e,n){const s=Gr(t,e,n);return new L(o=>{const r=o.controls._cps||1;return s.query(o).map(u=>u.withValue(a=>({speed:r/a._slices/u.whole.duration*(a.speed||1),unit:"c",...a})))}).setSteps(e._steps)},!1),{loopAt:A1,loopat:N1}=G(["loopAt","loopat"],function(t,e){const n=e._steps?e._steps.div(t):void 0;return new L(s=>Xr(t,e,s.controls._cps).query(s),n)}),K1=G("fit",t=>t.withHaps((e,n)=>e.map(s=>s.withValue(o=>{const r=("end"in o?o.end:1)-("begin"in o?o.begin:0);return{...o,speed:(n.controls._cps||1)/s.whole.duration*r,unit:"c"}})))),{loopAtCps:H1,loopatcps:P1}=G(["loopAtCps","loopatcps"],function(t,e,n){return Xr(t,n,e)}),E1=t=>Xt(1).withValue(()=>V(t())).innerJoin();let Zr=t=>t<.5?1:1-(t-.5)/.5,wr=(t,e,n)=>{e=V(e),t=V(t),n=V(n);let s=e.fmap(r=>({gain:Zr(r)})),o=e.fmap(r=>({gain:Zr(1-r)}));return mt(t.mul(s),n.mul(o))};L.prototype.xfade=function(t,e){return wr(this,t,e)};const D1=t=>(e,n,s)=>{e=C(e).mod(n),n=C(n);const o=e.div(n),r=e.add(1).div(n);return t(s.fmap(i=>Xt(i)._compress(o,r)))},{beat:J1}=G(["beat"],D1(t=>t.innerJoin())),Ms=(t,e,n)=>{n=C(n);const s=C(1).div(t.length),o=u=>{const a=[];for(const[l,p]of u.entries())p&&a.push([C(l).div(u.length),p]);return a},r=Tn(([u,a],[l,p])=>{const f=n.mul(l-u).add(u),b=f.add(s);return new bt(f,b)},o(t),o(e));function i(u){const a=u.span.begin.sam(),l=u.span.cycleArc(),p=[];for(const f of r){const b=f.intersection(l);b!==void 0&&p.push(new gt(f.withTime(g=>g.add(a)),b.withTime(g=>g.add(a)),!0))}return p}return new L(i).splitQueries()},I1=(t,e,n)=>(t=V(t),e=V(e),n=V(n),t.innerBind(s=>e.innerBind(o=>n.innerBind(r=>Ms(s,o,r))))),j1=["scurve","soft","hard","cubic","diode","asym","fold","sinefold","chebyshev"];for(const t of j1)L.prototype[t]=function(e){const n=V(e).fmap(s=>Array.isArray(s)?[...s,t]:[s,1,t]);return this.distort(n)};const Wr=t=>{let n=Xt(J((...s)=>s,null,t.length));for(const s of t)n=n.appBoth(V(s));return n},Hn=t=>Array.isArray(t)?Wr(t):V(t);L.prototype.partials=function(t){return this.withValue(e=>n=>({...e,partials:n})).appLeft(Hn(t))};const _1=t=>Hn(t).as("partials");L.prototype.phases=function(t){return this.withValue(e=>n=>({...e,phases:n})).appLeft(Hn(t))};const O1=t=>Hn(t).as("phases");function Pn(t){let e=Array.isArray(t);t=e?t:[t];const n=t[0],s=r=>{let i;if(typeof r=="object"&&r.value!==void 0&&(i={...r},r=r.value,delete i.value),e&&Array.isArray(r)){const u=i||{};return r.forEach((a,l)=>{l<t.length&&(u[t[l]]=a)}),u}else return i?(i[n]=r,i):{[n]:r}},o=function(r,i){return i?typeof r>"u"?i.fmap(s):i.set(V(r).withValue(s)):V(r).withValue(s)};return L.prototype[n]=function(r){return o(r,this)},o}const yn=new Map;function Fr(t){return yn.has(t)}function h(t,...e){const n=Array.isArray(t)?t[0]:t;let s={};return s[n]=Pn(t),yn.set(n,n),e.forEach(o=>{s[o]=s[n],yn.set(o,n),L.prototype[o]=L.prototype[n]}),s}const{s:Vr,sound:Cr}=h(["s","n","gain"],"sound"),{wt:Lr,wavetablePosition:zr}=h("wt","wavetablePosition"),{wtenv:Mr}=h("wtenv"),{wtattack:Rr,wtatt:xr}=h("wtattack","wtatt"),{wtdecay:vr,wtdec:Sr}=h("wtdecay","wtdec"),{wtsustain:Yr,wtsus:Br}=h("wtsustain","wtsus"),{wtrelease:kr,wtrel:Tr}=h("wtrelease","wtrel"),{wtrate:Ar}=h("wtrate"),{wtsync:Nr}=h("wtsync"),{wtdepth:Kr}=h("wtdepth"),{wtshape:Hr}=h("wtshape"),{wtdc:Pr}=h("wtdc"),{wtskew:Er}=h("wtskew"),{warp:Dr,wavetableWarp:Jr}=h("warp","wavetableWarp"),{warpattack:Ir,warpatt:jr}=h("warpattack","warpatt"),{warpdecay:_r,warpdec:Or}=h("warpdecay","warpdec"),{warpsustain:Ur,warpsus:Qr}=h("warpsustain","warpsus"),{warprelease:qr,warprel:$r}=h("warprelease","warprel"),{warprate:tc}=h("warprate"),{warpdepth:ec}=h("warpdepth"),{warpshape:nc}=h("warpshape"),{warpdc:sc}=h("warpdc"),{warpskew:oc}=h("warpskew"),{warpmode:rc,wavetableWarpMode:cc}=h("warpmode","wavetableWarpMode"),{wtphaserand:ic,wavetablePhaseRand:uc}=h("wtphaserand","wavetablePhaseRand"),{warpenv:ac}=h("warpenv"),{warpsync:lc}=h("warpsync"),{source:dc,src:pc}=h("source","src"),{n:hc}=h("n"),{note:fc}=h(["note","n"]),{accelerate:mc}=h("accelerate"),{velocity:yc}=h("velocity"),{gain:bc}=h("gain"),{postgain:gc}=h("postgain"),{amp:Xc}=h("amp"),{attack:Gc,att:Zc}=h("attack","att"),{fmh:wc}=h(["fmh","fmi"],"fmh"),{fmi:Wc,fm:Fc}=h(["fmi","fmh"],"fm"),{fmenv:Vc}=h("fmenv"),{fmattack:Cc}=h("fmattack"),{fmwave:Lc}=h("fmwave"),{fmdecay:zc}=h("fmdecay"),{fmsustain:Mc}=h("fmsustain"),{fmrelease:Rc}=h("fmrelease"),{fmvelocity:xc}=h("fmvelocity"),{bank:vc}=h("bank"),{chorus:Sc}=h("chorus"),{analyze:Yc}=h("analyze"),{fft:Bc}=h("fft"),{decay:kc,dec:Tc}=h("decay","dec"),{sustain:Ac,sus:Nc}=h("sustain","sus"),{release:Kc,rel:Hc}=h("release","rel"),{hold:Pc}=h("hold"),{bandf:Ec,bpf:Dc,bp:Jc}=h(["bandf","bandq","bpenv"],"bpf","bp"),{bandq:Ic,bpq:jc}=h("bandq","bpq"),{begin:_c}=h("begin"),{end:Oc}=h("end"),{loop:Uc}=h("loop"),{loopBegin:Qc,loopb:qc}=h("loopBegin","loopb"),{loopEnd:$c,loope:ti}=h("loopEnd","loope"),{crush:ei}=h("crush"),{coarse:ni}=h("coarse"),{tremolo:si}=h(["tremolo","tremolodepth","tremoloskew","tremolophase"],"trem"),{tremolosync:oi}=h(["tremolosync","tremolodepth","tremoloskew","tremolophase"],"tremsync"),{tremolodepth:ri}=h("tremolodepth","tremdepth"),{tremoloskew:ci}=h("tremoloskew","tremskew"),{tremolophase:ii}=h("tremolophase","tremphase"),{tremoloshape:ui}=h("tremoloshape","tremshape"),{drive:ai}=h("drive"),{duck:li}=h("duckorbit","duck"),{duckdepth:di}=h("duckdepth"),{duckonset:pi}=h("duckonset","duckons"),{duckattack:hi}=h("duckattack","duckatt"),{byteBeatExpression:fi,bbexpr:mi}=h("byteBeatExpression","bbexpr"),{byteBeatStartTime:yi,bbst:bi}=h("byteBeatStartTime","bbst"),{channels:gi,ch:Xi}=h("channels","ch"),{pw:Gi}=h(["pw","pwrate","pwsweep"]),{pwrate:Zi}=h("pwrate"),{pwsweep:wi}=h("pwsweep"),{phaserrate:Wi,ph:Fi,phaser:Vi}=h(["phaserrate","phaserdepth","phasercenter","phasersweep"],"ph","phaser"),{phasersweep:Ci,phs:Li}=h("phasersweep","phs"),{phasercenter:zi,phc:Mi}=h("phasercenter","phc"),{phaserdepth:Ri,phd:xi,phasdp:vi}=h("phaserdepth","phd","phasdp"),{channel:Si}=h("channel"),{cut:Yi}=h("cut"),{cutoff:Bi,ctf:ki,lpf:Ti,lp:Ai}=h(["cutoff","resonance","lpenv"],"ctf","lpf","lp"),{lpenv:Ni,lpe:Ki}=h("lpenv","lpe"),{hpenv:Hi,hpe:Pi}=h("hpenv","hpe"),{bpenv:Ei,bpe:Di}=h("bpenv","bpe"),{lpattack:Ji,lpa:Ii}=h("lpattack","lpa"),{hpattack:ji,hpa:_i}=h("hpattack","hpa"),{bpattack:Oi,bpa:Ui}=h("bpattack","bpa"),{lpdecay:Qi,lpd:qi}=h("lpdecay","lpd"),{hpdecay:$i,hpd:tu}=h("hpdecay","hpd"),{bpdecay:eu,bpd:nu}=h("bpdecay","bpd"),{lpsustain:su,lps:ou}=h("lpsustain","lps"),{hpsustain:ru,hps:cu}=h("hpsustain","hps"),{bpsustain:iu,bps:uu}=h("bpsustain","bps"),{lprelease:au,lpr:lu}=h("lprelease","lpr"),{hprelease:du,hpr:pu}=h("hprelease","hpr"),{bprelease:hu,bpr:fu}=h("bprelease","bpr"),{ftype:mu}=h("ftype"),{fanchor:yu}=h("fanchor"),{lprate:bu}=h("lprate"),{lpsync:gu}=h("lpsync"),{lpdepth:Xu}=h("lpdepth"),{lpdepthfrequency:Gu}=h("lpdepthfrequency","lpdepthfreq"),{lpshape:Zu}=h("lpshape"),{lpdc:wu}=h("lpdc"),{lpskew:Wu}=h("lpskew"),{bprate:Fu}=h("bprate"),{bpsync:Vu}=h("bpsync"),{bpdepth:Cu}=h("bpdepth"),{bpdepthfrequency:Lu}=h("bpdepthfrequency","bpdepthfreq"),{bpshape:zu}=h("bpshape"),{bpdc:Mu}=h("bpdc"),{bpskew:Ru}=h("bpskew"),{hprate:xu}=h("hprate"),{hpsync:vu}=h("hpsync"),{hpdepth:Su,hpdepthfreq:Yu}=h("hpdepth"),{hpdepthfrequency:Bu}=h("hpdepthfrequency","hpdepthfreq"),{hpshape:ku}=h("hpshape"),{hpdc:Tu}=h("hpdc"),{hpskew:Au}=h("hpskew"),{vib:Nu,vibrato:Ku,v:Hu}=h(["vib","vibmod"],"vibrato","v"),{noise:Pu}=h("noise"),{vibmod:Eu,vmod:Du}=h(["vibmod","vib"],"vmod"),{hcutoff:Ju,hpf:Iu,hp:ju}=h(["hcutoff","hresonance","hpenv"],"hpf","hp"),{hresonance:_u,hpq:Ou}=h("hresonance","hpq"),{resonance:Uu,lpq:Qu}=h("resonance","lpq"),{djf:qu}=h("djf"),{delay:$u}=h(["delay","delaytime","delayfeedback"]),{delayfeedback:ta,delayfb:ea,dfb:na}=h("delayfeedback","delayfb","dfb"),{delayspeed:sa}=h("delayspeed"),{delaytime:oa,delayt:ra,dt:ca}=h("delaytime","delayt","dt"),{delaysync:ia}=h("delaysync"),{lock:ua}=h("lock"),{detune:aa,det:la}=h("detune","det"),{unison:da}=h("unison"),{spread:pa}=h("spread"),{dry:ha}=h("dry"),{fadeTime:fa,fadeOutTime:ma}=h("fadeTime","fadeOutTime"),{fadeInTime:ya}=h("fadeInTime"),{freq:ba}=h("freq"),{pattack:ga,patt:Xa}=h("pattack","patt"),{pdecay:Ga,pdec:Za}=h("pdecay","pdec"),{psustain:wa,psus:Wa}=h("psustain","psus"),{prelease:Fa,prel:Va}=h("prelease","prel"),{penv:Ca}=h("penv"),{pcurve:La}=h("pcurve"),{panchor:za}=h("panchor"),{gate:Ma,gat:Ra}=h("gate","gat"),{leslie:xa}=h("leslie"),{lrate:va}=h("lrate"),{lsize:Sa}=h("lsize"),{activeLabel:Ya}=h("activeLabel"),{label:Ba}=h(["label","activeLabel"]),{degree:ka}=h("degree"),{mtranspose:Ta}=h("mtranspose"),{ctranspose:Aa}=h("ctranspose"),{harmonic:Na}=h("harmonic"),{stepsPerOctave:Ka}=h("stepsPerOctave"),{octaveR:Ha}=h("octaveR"),{nudge:Pa}=h("nudge"),{octave:Ea,oct:Da}=h("octave","oct"),{orbit:Ja}=h("orbit","o"),{overgain:Ia}=h("overgain"),{overshape:ja}=h("overshape"),{pan:_a}=h("pan"),{panspan:Oa}=h("panspan"),{pansplay:Ua}=h("pansplay"),{panwidth:Qa}=h("panwidth"),{panorient:qa}=h("panorient"),{rate:$a}=h("rate"),{slide:tl}=h("slide"),{semitone:el}=h("semitone"),{voice:nl}=h("voice"),{chord:sl}=h("chord"),{dictionary:ol,dict:rl}=h("dictionary","dict"),{anchor:cl}=h("anchor"),{offset:il}=h("offset"),{octaves:ul}=h("octaves"),{mode:al}=h(["mode","anchor"]),{room:ll}=h(["room","size"]),{roomlp:dl,rlp:pl}=h("roomlp","rlp"),{roomdim:hl,rdim:fl}=h("roomdim","rdim"),{roomfade:ml,rfade:yl}=h("roomfade","rfade"),{ir:bl,iresponse:gl}=h(["ir","i"],"iresponse"),{irspeed:Xl}=h("irspeed"),{irbegin:Gl}=h("irbegin"),{roomsize:Zl,size:wl,sz:Wl,rsize:Fl}=h("roomsize","size","sz","rsize"),{shape:Vl}=h(["shape","shapevol"]),{distort:Cl,dist:Ll}=h(["distort","distortvol","distorttype"],"dist"),{distortvol:zl}=h("distortvol","distvol"),{distorttype:Ml}=h("distorttype","disttype"),{compressor:Rl}=h(["compressor","compressorRatio","compressorKnee","compressorAttack","compressorRelease"]),{compressorKnee:xl}=h("compressorKnee"),{compressorRatio:vl}=h("compressorRatio"),{compressorAttack:Sl}=h("compressorAttack"),{compressorRelease:Yl}=h("compressorRelease"),{speed:Rs}=h("speed"),{stretch:Bl}=h("stretch"),{unit:kl}=h("unit"),{squiz:Tl}=h("squiz"),{vowel:Al}=h("vowel"),{waveloss:Nl}=h("waveloss"),{density:U1}=h("density"),{expression:Kl}=h("expression"),{sustainpedal:Hl}=h("sustainpedal"),{fshift:Pl}=h("fshift"),{fshiftnote:El}=h("fshiftnote"),{fshiftphase:Dl}=h("fshiftphase"),{triode:Jl}=h("triode"),{krush:Il}=h("krush"),{kcutoff:jl}=h("kcutoff"),{octer:_l}=h("octer"),{octersub:Ol}=h("octersub"),{octersubsub:Ul}=h("octersubsub"),{ring:Ql}=h("ring"),{ringf:ql}=h("ringf"),{ringdf:$l}=h("ringdf"),{freeze:td}=h("freeze"),{xsdelay:ed}=h("xsdelay"),{tsdelay:nd}=h("tsdelay"),{real:sd}=h("real"),{imag:od}=h("imag"),{enhance:rd}=h("enhance"),{comb:cd}=h("comb"),{smear:id}=h("smear"),{scram:ud}=h("scram"),{binshift:ad}=h("binshift"),{hbrick:ld}=h("hbrick"),{lbrick:dd}=h("lbrick"),{frameRate:pd}=h("frameRate"),{frames:hd}=h("frames"),{hours:fd}=h("hours"),{minutes:md}=h("minutes"),{seconds:yd}=h("seconds"),{songPtr:bd}=h("songPtr"),{uid:gd}=h("uid"),{val:Xd}=h("val"),{cps:Gd}=h("cps"),{clip:Zd,legato:wd}=h("clip","legato"),{duration:Wd,dur:Fd}=h("duration","dur"),{zrand:Vd}=h("zrand"),{curve:Cd}=h("curve"),{deltaSlide:Ld}=h("deltaSlide"),{pitchJump:zd}=h("pitchJump"),{pitchJumpTime:Md}=h("pitchJumpTime"),{lfo:Rd,repeatTime:xd}=h("lfo","repeatTime"),{znoise:vd}=h("znoise"),{zmod:Sd}=h("zmod"),{zcrush:Yd}=h("zcrush"),{zdelay:Bd}=h("zdelay"),{zzfx:kd}=h("zzfx"),{color:Td,colour:Ad}=h(["color","colour"]);let xs=(...t)=>t.reduce((e,n)=>Object.assign(e,{[n]:Pn(n)}),{});const Nd=G("adsr",(t,e)=>{t=Array.isArray(t)?t:[t];const[n,s,o,r]=t;return e.set({attack:n,decay:s,sustain:o,release:r})}),Kd=G("ad",(t,e)=>{t=Array.isArray(t)?t:[t];const[n,s=n]=t;return e.attack(n).decay(s)}),Hd=G("ds",(t,e)=>{t=Array.isArray(t)?t:[t];const[n,s=0]=t;return e.set({decay:n,sustain:s})}),Pd=G("ar",(t,e)=>{t=Array.isArray(t)?t:[t];const[n,s=n]=t;return e.set({attack:n,release:s})}),{midichan:Ed}=h("midichan"),{midimap:Dd}=h("midimap"),{midiport:Jd}=h("midiport"),{midicmd:Id}=h("midicmd"),jd=G("control",(t,e)=>{if(!Array.isArray(t))throw new Error("control expects an array of [ccn, ccv]");const[n,s]=t;return e.ccn(n).ccv(s)}),{ccn:_d}=h("ccn"),{ccv:Od}=h("ccv"),{ctlNum:Ud}=h("ctlNum"),{nrpnn:Qd}=h("nrpnn"),{nrpv:qd}=h("nrpv"),{progNum:$d}=h("progNum"),t0=G("sysex",(t,e)=>{if(!Array.isArray(t))throw new Error("sysex expects an array of [id, data]");const[n,s]=t;return e.sysexid(n).sysexdata(s)}),{sysexid:e0}=h("sysexid"),{sysexdata:n0}=h("sysexdata"),{midibend:s0}=h("midibend"),{miditouch:o0}=h("miditouch"),{polyTouch:r0}=h("polyTouch"),{oschost:c0}=h("oschost"),{oscport:i0}=h("oscport"),vs=t=>yn.has(t)?yn.get(t):t,u0=G("as",(t,e)=>(t=Array.isArray(t)?t:[t],e.fmap(n=>(n=Array.isArray(n)?n:[n],n=Object.fromEntries(t.map((s,o)=>[vs(s),n[o]])),n)))),a0=G("scrub",(t,e)=>t.outerBind(n=>{Array.isArray(n)||(n=[n]);const[s,o=1]=n;return e.begin(s).mul(Rs(o)).clip(1)}),!1),Q1=Object.freeze(Object.defineProperty({__proto__:null,accelerate:mc,activeLabel:Ya,ad:Kd,adsr:Nd,amp:Xc,analyze:Yc,anchor:cl,ar:Pd,as:u0,att:Zc,attack:Gc,bandf:Ec,bandq:Ic,bank:vc,bbexpr:mi,bbst:bi,begin:_c,binshift:ad,bp:Jc,bpa:Ui,bpattack:Oi,bpd:nu,bpdc:Mu,bpdecay:eu,bpdepth:Cu,bpdepthfrequency:Lu,bpe:Di,bpenv:Ei,bpf:Dc,bpq:jc,bpr:fu,bprate:Fu,bprelease:hu,bps:uu,bpshape:zu,bpskew:Ru,bpsustain:iu,bpsync:Vu,byteBeatExpression:fi,byteBeatStartTime:yi,ccn:_d,ccv:Od,ch:Xi,channel:Si,channels:gi,chord:sl,chorus:Sc,clip:Zd,coarse:ni,color:Td,colour:Ad,comb:cd,compressor:Rl,compressorAttack:Sl,compressorKnee:xl,compressorRatio:vl,compressorRelease:Yl,control:jd,cps:Gd,createParam:Pn,createParams:xs,crush:ei,ctf:ki,ctlNum:Ud,ctranspose:Aa,curve:Cd,cut:Yi,cutoff:Bi,dec:Tc,decay:kc,degree:ka,delay:$u,delayfb:ea,delayfeedback:ta,delayspeed:sa,delaysync:ia,delayt:ra,delaytime:oa,deltaSlide:Ld,density:U1,det:la,detune:aa,dfb:na,dict:rl,dictionary:ol,dist:Ll,distort:Cl,distorttype:Ml,distortvol:zl,djf:qu,drive:ai,dry:ha,ds:Hd,dt:ca,duck:li,duckattack:hi,duckdepth:di,duckonset:pi,dur:Fd,duration:Wd,end:Oc,enhance:rd,expression:Kl,fadeInTime:ya,fadeOutTime:ma,fadeTime:fa,fanchor:yu,fft:Bc,fm:Fc,fmattack:Cc,fmdecay:zc,fmenv:Vc,fmh:wc,fmi:Wc,fmrelease:Rc,fmsustain:Mc,fmvelocity:xc,fmwave:Lc,frameRate:pd,frames:hd,freeze:td,freq:ba,fshift:Pl,fshiftnote:El,fshiftphase:Dl,ftype:mu,gain:bc,gat:Ra,gate:Ma,getControlName:vs,harmonic:Na,hbrick:ld,hcutoff:Ju,hold:Pc,hours:fd,hp:ju,hpa:_i,hpattack:ji,hpd:tu,hpdc:Tu,hpdecay:$i,hpdepth:Su,hpdepthfreq:Yu,hpdepthfrequency:Bu,hpe:Pi,hpenv:Hi,hpf:Iu,hpq:Ou,hpr:pu,hprate:xu,hprelease:du,hps:cu,hpshape:ku,hpskew:Au,hpsustain:ru,hpsync:vu,hresonance:_u,imag:od,ir:bl,irbegin:Gl,iresponse:gl,irspeed:Xl,isControlName:Fr,kcutoff:jl,krush:Il,label:Ba,lbrick:dd,legato:wd,leslie:xa,lfo:Rd,lock:ua,loop:Uc,loopBegin:Qc,loopEnd:$c,loopb:qc,loope:ti,lp:Ai,lpa:Ii,lpattack:Ji,lpd:qi,lpdc:wu,lpdecay:Qi,lpdepth:Xu,lpdepthfrequency:Gu,lpe:Ki,lpenv:Ni,lpf:Ti,lpq:Qu,lpr:lu,lprate:bu,lprelease:au,lps:ou,lpshape:Zu,lpskew:Wu,lpsustain:su,lpsync:gu,lrate:va,lsize:Sa,midibend:s0,midichan:Ed,midicmd:Id,midimap:Dd,midiport:Jd,miditouch:o0,minutes:md,mode:al,mtranspose:Ta,n:hc,noise:Pu,note:fc,nrpnn:Qd,nrpv:qd,nudge:Pa,oct:Da,octave:Ea,octaveR:Ha,octaves:ul,octer:_l,octersub:Ol,octersubsub:Ul,offset:il,orbit:Ja,oschost:c0,oscport:i0,overgain:Ia,overshape:ja,pan:_a,panchor:za,panorient:qa,panspan:Oa,pansplay:Ua,panwidth:Qa,patt:Xa,pattack:ga,pcurve:La,pdec:Za,pdecay:Ga,penv:Ca,ph:Fi,phasdp:vi,phaser:Vi,phasercenter:zi,phaserdepth:Ri,phaserrate:Wi,phasersweep:Ci,phc:Mi,phd:xi,phs:Li,pitchJump:zd,pitchJumpTime:Md,polyTouch:r0,postgain:gc,prel:Va,prelease:Fa,progNum:$d,psus:Wa,psustain:wa,pw:Gi,pwrate:Zi,pwsweep:wi,rate:$a,rdim:fl,real:sd,registerControl:h,rel:Hc,release:Kc,repeatTime:xd,resonance:Uu,rfade:yl,ring:Ql,ringdf:$l,ringf:ql,rlp:pl,room:ll,roomdim:hl,roomfade:ml,roomlp:dl,roomsize:Zl,rsize:Fl,s:Vr,scram:ud,scrub:a0,seconds:yd,semitone:el,shape:Vl,size:wl,slide:tl,smear:id,songPtr:bd,sound:Cr,source:dc,speed:Rs,spread:pa,squiz:Tl,src:pc,stepsPerOctave:Ka,stretch:Bl,sus:Nc,sustain:Ac,sustainpedal:Hl,sysex:t0,sysexdata:n0,sysexid:e0,sz:Wl,tremolo:si,tremolodepth:ri,tremolophase:ii,tremoloshape:ui,tremoloskew:ci,tremolosync:oi,triode:Jl,tsdelay:nd,uid:gd,unison:da,unit:kl,v:Hu,val:Xd,velocity:yc,vib:Nu,vibmod:Eu,vibrato:Ku,vmod:Du,voice:nl,vowel:Al,warp:Dr,warpatt:jr,warpattack:Ir,warpdc:sc,warpdec:Or,warpdecay:_r,warpdepth:ec,warpenv:ac,warpmode:rc,warprate:tc,warprel:$r,warprelease:qr,warpshape:nc,warpskew:oc,warpsus:Qr,warpsustain:Ur,warpsync:lc,waveloss:Nl,wavetablePhaseRand:uc,wavetablePosition:zr,wavetableWarp:Jr,wavetableWarpMode:cc,wt:Lr,wtatt:xr,wtattack:Rr,wtdc:Pr,wtdec:Sr,wtdecay:vr,wtdepth:Kr,wtenv:Mr,wtphaserand:ic,wtrate:Ar,wtrel:Tr,wtrelease:kr,wtshape:Hr,wtskew:Er,wtsus:Br,wtsustain:Yr,wtsync:Nr,xsdelay:ed,zcrush:Yd,zdelay:Bd,zmod:Sd,znoise:vd,zrand:Vd,zzfx:kd},Symbol.toStringTag,{value:"Module"})),q1=function(t,e){const[n,s]=t,[o,r]=e,[i,u]=ms(s,o);return[[s,n-s],[Tn((a,l)=>a.concat(l),i,r),u]]},$1=function(t,e){const[n,s]=t,[o,r]=e,[i,u]=ms(n,r);return[[n,s-n],[Tn((l,p)=>l.concat(p),o,i),u]]},l0=function(t,e){const[n,s]=t;return Math.min(n,s)<=1?[t,e]:l0(...n>s?q1(t,e):$1(t,e))},Ss=function(t,e){const n=t<0,s=Math.abs(t),o=e-s,r=Array(s).fill([1]),i=Array(o).fill([0]),u=l0([s,o],[r,i]),a=ae(u[1][0]).concat(ae(u[1][1]));return n?a.map(l=>1-l):a},En=function(t,e,n){const s=Ss(t,e);return n?Ao(s,-n):s},ty=G("euclid",function(t,e,n){return n.struct(En(t,e,0))}),ey=G("bjork",function(t,e){Array.isArray(t)||(t=[t]);const[n,s=n,o=0]=t;return e.struct(En(n,s,o))}),{euclidrot:ny,euclidRot:sy}=G(["euclidrot","euclidRot"],function(t,e,n,s){return s.struct(En(t,e,n))}),d0=function(t,e,n,s){if(t<1)return st;const r=En(t,e,0).join("").split("1").slice(1).map(i=>[i.length+1,!0]);return s.struct(zs(...r)).late(C(n).div(e))},oy=G(["euclidLegato"],function(t,e,n){return d0(t,e,0,n)}),ry=G(["euclidLegatoRot"],function(t,e,n,s){return d0(t,e,n,s)}),{euclidish:cy,eish:iy}=G(["euclidish","eish"],function(t,e,n,s){const o=Ms(Ss(t,e),new Array(t).fill(1),n);return s.struct(o).setSteps(e)});function p0(t,e,n=.05,s=.1,o=.1,r=globalThis.setInterval,i=globalThis.clearInterval,u=!0){let a=0,l=0,p=10**4,f=.01;const b=x=>n=x(n);o=o||s/2;const g=()=>{const x=t(),R=x+s+o;for(l===0&&(l=x+f);l<R;)l=u?Math.round(l*p)/p:l,e(l,n,a,x),l+=n,a++};let X;const Z=()=>{W(),g(),X=r(g,s*1e3)},W=()=>{X!==void 0&&i(X),X=void 0};return{setDuration:b,start:Z,stop:()=>{a=0,l=0,W()},pause:()=>W(),duration:n,interval:s,getPhase:()=>l,minLatency:f}}function uy(t){return new L(e=>[new gt(void 0,e.span,t)])}const Ht=t=>{const e=n=>[new gt(void 0,n.span,t(n.span.begin))];return new L(e)},bn=Ht(t=>t%1),Ys=bn.toBipolar(),Dn=Ht(t=>1-t%1),Bs=Dn.toBipolar(),ks=Ht(t=>Math.sin(Math.PI*2*t)),h0=ks.fromBipolar(),ay=h0._early(C(1).div(4)),ly=ks._early(C(1).div(4)),f0=Ht(t=>Math.floor(t*2%2)),dy=f0.toBipolar(),py=Lt(bn,Dn),hy=Lt(Ys,Bs),fy=Lt(Dn,bn),my=Lt(Bs,Ys),Ts=Ht(He);let As=0,Ns=0;typeof window<"u"&&document.addEventListener("mousemove",t=>{As=t.clientY/document.body.clientHeight,Ns=t.clientX/document.body.clientWidth});const yy=Ht(()=>As),by=Ht(()=>As),gy=Ht(()=>Ns),Xy=Ht(()=>Ns),m0=t=>{const e=t<<13^t,n=e>>17^e;return n<<5^n},Gy=t=>t-Math.trunc(t),y0=t=>m0(Math.trunc(Gy(t/300)*536870912)),b0=t=>t%536870912/536870912,gn=t=>Math.abs(b0(y0(t))),Zy=(t,e)=>{const n=[];for(let s=0;s<e;++s)n.push(b0(t)),t=m0(t);return n},g0=(t,e)=>Zy(y0(t),e),X0=t=>bn.range(0,t).round().segment(t),wy=t=>{const e=V(t).log2(0).floor().add(1);return G0(t,e)},G0=(t,e=16)=>{e=V(e);const n=X0(e).mul(-1).add(e.sub(1));return V(t).segment(e).brshift(n).band(Xt(1))},Wy=t=>{const e=V(t).log2(0).floor().add(1);return Z0(t,e)},Z0=(t,e=16)=>V(t).withValue(n=>s=>{const o=[];for(let r=s-1;r>=0;r--)o.push(n>>r&1);return o}).appLeft(V(e)),Fy=t=>Ht(e=>n=>g0(e,n).map(Math.abs)).appLeft(V(t)),w0=t=>Ht(e=>{const s=g0(e.floor().add(.5),t).map((r,i)=>[r,i]).sort((r,i)=>(r[0]>i[0])-(r[0]<i[0])).map(r=>r[1]),o=e.cyclePos().mul(t).floor()%t;return s[o]})._segment(t),W0=(t,e,n)=>{const s=[...Array(e).keys()].map(o=>n.zoom(C(o).div(e),C(o+1).div(e)));return t.fmap(o=>s[o].repeatCycles(e)._fast(e)).innerJoin()},Vy=G("shuffle",(t,e)=>W0(w0(t),t,e)),Cy=G("scramble",(t,e)=>W0(Hs(t)._segment(t),t,e)),Rt=Ht(gn),Ly=Rt.toBipolar(),Ks=t=>Rt.fmap(e=>e<t),zy=t=>V(t).fmap(Ks).innerJoin(),My=Ks(.5),Hs=t=>Rt.fmap(e=>Math.trunc(e*t)),Ry=t=>V(t).fmap(Hs).innerJoin(),Ps=(t,e)=>(e=e.map(V),e.length==0?st:t.range(0,e.length).fmap(n=>{const s=Math.min(Math.max(Math.floor(n),0),e.length-1);return e[s]})),Jn=(t,e)=>Ps(t,e).outerJoin(),In=(t,e)=>Ps(t,e).innerJoin(),F0=(...t)=>Jn(Rt,t),xy=(...t)=>In(Rt,t),vy=F0;L.prototype.choose=function(...t){return Jn(this,t)},L.prototype.choose2=function(...t){return Jn(this.fromBipolar(),t)};const V0=(...t)=>In(Rt.segment(1),t),Sy=V0,C0=function(t,...e){const n=e.map(u=>V(u[0])),s=[];let o=Xt(0);for(const u of e)o=o.add(u[1]),s.push(o);const r=Qo(s),i=function(u){const a=o.mul(u);return r.fmap(l=>p=>n[l.findIndex(f=>f>p,l)]).appLeft(a)};return t.bind(i)},Yy=(...t)=>C0(...t).outerJoin(),By=(...t)=>Yy(Rt,...t),L0=(...t)=>C0(Rt.segment(1),...t).innerJoin(),ky=L0;function Ty(t){let e=Math.floor(t),n=e+1;const s=i=>6*i**5-15*i**4+10*i**3;return(i=>u=>a=>u+s(i)*(a-u))(t-e)(gn(e))(gn(n))}const z0=t=>t.fmap(Ty);function Ay(t){const e=Math.floor(t),n=e+1,s=gn(e),o=gn(n)+s,r=(t-e)/(n-e);return((u,a,l)=>u+(a-u)*l)(s,o,r)/2}const M0=t=>t.fmap(Ay),Ny=z0(Ts.fmap(t=>Number(t))),Ky=M0(Ts.fmap(t=>Number(t))),Hy=G("degradeByWith",(t,e,n)=>n.fmap(s=>o=>s).appLeft(t.filterValues(s=>s>e)),!0,!0),Py=G("degradeBy",function(t,e){return e._degradeByWith(Rt,t)},!0,!0),Ey=G("degrade",t=>t._degradeBy(.5),!0,!0),Dy=G("undegradeBy",function(t,e){return e._degradeByWith(Rt.fmap(n=>1-n),t)},!0,!0),Jy=G("undegrade",t=>t._undegradeBy(.5),!0,!0),Iy=G("sometimesBy",function(t,e,n){return V(t).fmap(s=>mt(n._degradeBy(s),e(n._undegradeBy(1-s)))).innerJoin()}),jy=G("sometimes",function(t,e){return e._sometimesBy(.5,t)}),_y=G("someCyclesBy",function(t,e,n){return V(t).fmap(s=>mt(n._degradeByWith(Rt._segment(1),s),e(n._degradeByWith(Rt.fmap(o=>1-o)._segment(1),1-s)))).innerJoin()}),Oy=G("someCycles",function(t,e){return e._someCyclesBy(.5,t)}),Uy=G("often",function(t,e){return e.sometimesBy(.75,t)}),Qy=G("rarely",function(t,e){return e.sometimesBy(.25,t)}),qy=G("almostNever",function(t,e){return e.sometimesBy(.1,t)}),$y=G("almostAlways",function(t,e){return e.sometimesBy(.9,t)}),tb=G("never",function(t,e){return e}),eb=G("always",function(t,e){return t(e)});function Es(t){Array.isArray(t)===!1&&(t=[t]);const e=_o();return t.every(n=>{const s=jo.get(n)??n;return e[s]})}const nb=G("whenKey",function(t,e,n){return n.when(Es(t),e)}),sb=G("keyDown",function(t){return t.fmap(Es)}),se=function(t,e,n=!0){const s=Array.isArray(t),o=Object.keys(t).length;return t=Jo(t,V),o===0?st:e.fmap(r=>{let i=r;return s&&(i=n?Math.round(i)%o:An(Math.round(i),0,t.length-1)),t[i]})},R0=function(t,e){return Array.isArray(e)&&([e,t]=[t,e]),ob(t,e)},ob=G("pick",function(t,e){return se(t,e,!1).innerJoin()}),x0=G("pickmod",function(t,e){return se(t,e,!0).innerJoin()}),rb=G("pickF",function(t,e,n){return n.apply(R0(t,e))}),cb=G("pickmodF",function(t,e,n){return n.apply(x0(t,e))}),ib=G("pickOut",function(t,e){return se(t,e,!1).outerJoin()}),ub=G("pickmodOut",function(t,e){return se(t,e,!0).outerJoin()}),ab=G("pickRestart",function(t,e){return se(t,e,!1).restartJoin()}),lb=G("pickmodRestart",function(t,e){return se(t,e,!0).restartJoin()}),db=G("pickReset",function(t,e){return se(t,e,!1).resetJoin()}),pb=G("pickmodReset",function(t,e){return se(t,e,!0).resetJoin()}),{inhabit:hb,pickSqueeze:fb}=G(["inhabit","pickSqueeze"],function(t,e){return se(t,e,!1).squeezeJoin()}),{inhabitmod:mb,pickmodSqueeze:yb}=G(["inhabitmod","pickmodSqueeze"],function(t,e){return se(t,e,!0).squeezeJoin()}),bb=(t,e)=>(e=e.map(V),e.length==0?st:t.fmap(n=>{const s=pn(Math.round(n),e.length);return e[s]}).squeezeJoin());let jn;try{jn=window?.speechSynthesis}catch{console.warn("cannot use window: not in browser?")}let v0=jn?.getVoices();function gb(t,e,n){jn.cancel();const s=new SpeechSynthesisUtterance(t);s.lang=e,v0=jn.getVoices();const o=v0.filter(r=>r.lang.includes(e));typeof n=="number"?s.voice=o[n%o.length]:typeof n=="string"&&(s.voice=o.find(r=>r.name===r)),speechSynthesis.speak(s)}const Xb=G("speak",function(t,e,n){return n.onTrigger(s=>{gb(s.value,t,e)})}),S0={},Y0=async(...t)=>{const e=await Promise.allSettled(t),n=e.filter(s=>s.status==="fulfilled").map(s=>s.value);return e.forEach((s,o)=>{s.status==="rejected"&&console.warn(`evalScope: module with index ${o} could not be loaded:`,s.reason)}),n.forEach(s=>{Object.entries(s).forEach(([o,r])=>{globalThis[o]=r,S0[o]=r})}),n};function Gb(t,e={}){const{wrapExpression:n=!0,wrapAsync:s=!0}=e;n&&(t=`{${t}}`),s&&(t=`(async ()=>${t})()`);const o=`"use strict";return (${t})`;return Function(o)()}const B0=async(t,e,n)=>{let s={};if(e){const i=e(t,n);t=i.output,s=i}return{mode:"javascript",pattern:await Gb(t,{wrapExpression:!!e}),meta:s}},k0=`(function(){"use strict";function L(){return performance.now()*.001}let _=0,r=0,o=.5;const h=new Map,m=.1,M=new BroadcastChannel("strudeltick"),b=(s,e)=>{M.postMessage({type:s,payload:e})},C=E(L,(s,e,t,n)=>{const i=r*e,d=s-n,c=n+d,u=i*o,l=_+u,g=n-c-e,f=e*o,p=l+f,y=l+g*o;b("tick",{begin:l,end:p,cps:o,time:n,cycle:y}),r++},m);let k=!1;const I=s=>{h.set(s,{started:!0}),!k&&(C.start(),k=!0)},A=async s=>{h.set(s,{started:!1});const e=Array.from(h.values()).some(t=>t.started);!k||e||(C.stop(),w(0),k=!1)},w=s=>{r=0,_=s},D=s=>{const{type:e,payload:t}=s;switch(e){case"cpschange":{if(t.cps!==o){const n=r*m;_=_+n*o,o=t.cps,r=0}break}case"setcycle":{w(t.cycle);break}case"toggle":{t.started?I(s.id):A(s.id);break}}};self.onconnect=function(s){const e=s.ports[0];e.addEventListener("message",function(t){D(t.data)}),e.start()};function E(s,e,t=.05,n=.1,i=.1){let d=0,c=0,u=10**4,l=.01;const g=a=>t=a(t);i=i||n/2;const f=()=>{const a=s(),O=a+n+i;for(c===0&&(c=a+l);c<O;)c=Math.round(c*u)/u,c>=a&&e(c,t,d,a),c<a&&console.log("TOO LATE",c),c+=t,d++};let p;const y=()=>{T(),f(),p=setInterval(f,n*1e3)},T=()=>p!==void 0&&clearInterval(p);return{setDuration:g,start:y,stop:()=>{d=0,c=0,T()},pause:()=>T(),duration:t,interval:n,getPhase:()=>c,minLatency:l}}})();
`,T0=typeof self<"u"&&self.Blob&&new Blob(["(self.URL || self.webkitURL).revokeObjectURL(self.location.href);",k0],{type:"text/javascript;charset=utf-8"});function Zb(t){let e;try{if(e=T0&&(self.URL||self.webkitURL).createObjectURL(T0),!e)throw"";const n=new Worker(e,{name:t?.name});return n.addEventListener("error",()=>{(self.URL||self.webkitURL).revokeObjectURL(e)}),n}catch{return new Worker("data:text/javascript;charset=utf-8,"+encodeURIComponent(k0),{name:t?.name})}}class wb{constructor({onTrigger:e,onToggle:n,getTime:s}){this.started=!1,this.cps=.5,this.getTime=s,this.time_at_last_tick_message=0,this.collator=new Io({getTargetClockTime:s}),this.onToggle=n,this.latency=.1,this.cycle=0,this.id=Math.round(Date.now()*Math.random()),this.worker=new SharedWorker(Zb),this.worker.port.start(),this.channel=new BroadcastChannel("strudeltick");const o=i=>{const{cps:u,begin:a,end:l,cycle:p,time:f}=i;this.cps=u,this.cycle=p;const b=this.collator.calculateOffset(f)+f;r(a,l,b),this.time_at_last_tick_message=b},r=(i,u,a)=>{if(this.started===!1)return;this.pattern.queryArc(i,u,{_cps:this.cps,cyclist:"neocyclist"}).forEach(p=>{if(p.hasOnset()){const b=ys(p.whole.begin-this.cycle,this.cps)+a+this.latency,g=ys(p.duration,this.cps);e?.(p,0,g,this.cps,b)}})};this.channel.onmessage=i=>{if(!this.started)return;const{payload:u,type:a}=i.data;switch(a){case"tick":o(u)}}}sendMessage(e,n){this.worker.port.postMessage({type:e,payload:n,id:this.id})}now(){const e=(this.getTime()-this.time_at_last_tick_message)*this.cps;return this.cycle+e}setCps(e=1){this.sendMessage("cpschange",{cps:e})}setCycle(e){this.sendMessage("setcycle",{cycle:e})}setStarted(e){this.sendMessage("toggle",{started:e}),this.started=e,this.onToggle?.(e)}start(){Yt("[cyclist] start"),this.setStarted(!0)}stop(){Yt("[cyclist] stop"),this.collator.reset(),this.setStarted(!1)}setPattern(e,n=!1){this.pattern=e,n&&!this.started&&this.start()}log(e,n,s){const o=s.filter(r=>r.hasOnset());console.log(`${e.toFixed(4)} - ${n.toFixed(4)} ${Array(o.length).fill("I").join("")}`)}}class A0{constructor({interval:e,onTrigger:n,onToggle:s,onError:o,getTime:r,latency:i=.1,setInterval:u,clearInterval:a,beforeStart:l}){this.started=!1,this.beforeStart=l,this.cps=.5,this.num_ticks_since_cps_change=0,this.lastTick=0,this.lastBegin=0,this.lastEnd=0,this.getTime=r,this.num_cycles_at_cps_change=0,this.seconds_at_cps_change,this.onToggle=s,this.latency=i,this.clock=p0(r,(p,f,b,g)=>{this.num_ticks_since_cps_change===0&&(this.num_cycles_at_cps_change=this.lastEnd,this.seconds_at_cps_change=p),this.num_ticks_since_cps_change++;const Z=this.num_ticks_since_cps_change*f*this.cps;try{const W=this.lastEnd;this.lastBegin=W;const F=this.num_cycles_at_cps_change+Z;if(this.lastEnd=F,this.lastTick=p,p<g){console.log("skip query: too late");return}this.pattern.queryArc(W,F,{_cps:this.cps,cyclist:"cyclist"}).forEach(v=>{if(v.hasOnset()){const x=(v.whole.begin-this.num_cycles_at_cps_change)/this.cps+this.seconds_at_cps_change+i,R=v.duration/this.cps,N=x-p;n?.(v,N,R,this.cps,x),v.value.cps!==void 0&&this.cps!=v.value.cps&&(this.cps=v.value.cps,this.num_ticks_since_cps_change=0)}})}catch(W){Bn(W),o?.(W)}},e,.1,.1,u,a)}now(){if(!this.started)return 0;const e=this.getTime()-this.lastTick-this.clock.duration;return this.lastBegin+e*this.cps}setStarted(e){this.started=e,this.onToggle?.(e)}async start(){if(await this.beforeStart?.(),this.num_ticks_since_cps_change=0,this.num_cycles_at_cps_change=0,!this.pattern)throw new Error("Scheduler: no pattern set! call .setPattern first.");Yt("[cyclist] start"),this.clock.start(),this.setStarted(!0)}pause(){Yt("[cyclist] pause"),this.clock.pause(),this.setStarted(!1)}stop(){Yt("[cyclist] stop"),this.clock.stop(),this.lastEnd=0,this.setStarted(!1)}async setPattern(e,n=!1){this.pattern=e,n&&!this.started&&await this.start()}setCps(e=.5){this.cps!==e&&(this.cps=e,this.num_ticks_since_cps_change=0)}log(e,n,s){const o=s.filter(r=>r.hasOnset());console.log(`${e.toFixed(4)} - ${n.toFixed(4)} ${Array(o.length).fill("I").join("")}`)}}let Ds;function Js(){if(!Ds)throw new Error("no time set! use setTime to define a time source");return Ds()}function Is(t){Ds=t}function Wb({defaultOutput:t,onEvalError:e,beforeEval:n,beforeStart:s,afterEval:o,getTime:r,transpiler:i,onToggle:u,editPattern:a,onUpdateState:l,sync:p=!1,setInterval:f,clearInterval:b,id:g,mondo:X=!1}){const Z={schedulerError:void 0,evalError:void 0,code:"// LOADING",activeCode:"// LOADING",pattern:void 0,miniLocations:[],widgets:[],pending:!1,started:!1},W={id:g},F=H=>{Object.assign(Z,H),Z.isDirty=Z.code!==Z.activeCode,Z.error=Z.evalError||Z.schedulerError,l?.(Z)},z={onTrigger:N0({defaultOutput:t,getTime:r}),getTime:r,onToggle:H=>{F({started:H}),u?.(H)},setInterval:f,clearInterval:b,beforeStart:s},v=p&&typeof SharedWorker<"u"?new wb(z):new A0(z);let x={},R=0,N;const O=function(){return x={},R=0,N=void 0,st};function _(H){return H._Pattern?H.__pure:H}const et=async(H,I=!0)=>(H=a?.(H)||H,await v.setPattern(H,I),H);Is(()=>v.now());const T=()=>v.stop(),ut=()=>v.start(),P=()=>v.pause(),q=()=>v.toggle(),U=H=>(v.setCps(_(H)),st),pt=H=>(v.setCps(_(H)/60),st);let $=[];const ot=function(H){return $.push(H),st},ht=function(H){return N=H,st},Ct=()=>{L.prototype.p=function(I){return typeof I=="string"&&(I.startsWith("_")||I.endsWith("_"))?st:(I.includes("$")&&(I=`${I}${R}`,R++),x[I]=this,this)},L.prototype.q=function(I){return st};try{for(let I=1;I<10;++I)Object.defineProperty(L.prototype,`d${I}`,{get(){return this.p(I)},configurable:!0}),Object.defineProperty(L.prototype,`p${I}`,{get(){return this.p(I)},configurable:!0}),L.prototype[`q${I}`]=st}catch(I){console.warn("injectPatternMethods: error:",I)}const H=G("cpm",function(I,te){return te._fast(I/60/v.cps)});return Y0({all:ot,each:ht,hush:O,cpm:H,setCps:U,setcps:U,setCpm:pt,setcpm:pt})};return{scheduler:v,evaluate:async(H,I=!0,te=!0)=>{if(!H)throw new Error("no code to evaluate");try{F({code:H,pending:!0}),await Ct(),Is(()=>v.now()),await n?.({code:H}),$=[],te&&O(),X&&(H=`mondolang\`${H}\``);let{pattern:it,meta:re}=await B0(H,i,W);if(Object.keys(x).length){let zt=[],tt=!1;for(const[rt,It]of Object.entries(x)){const jt=rt.length>1&&rt.startsWith("S");if(jt&&tt===!1&&(zt=[],tt=!0),!tt||tt&&jt){const wt=It.withState(Ze=>Ze.setControls({id:rt}));zt.push(wt)}}N&&(zt=zt.map(rt=>N(rt))),it=mt(...zt)}else N&&(it=N(it));if($.length)for(const zt of $)it=zt(it);return Gs(it)||(it=st),Yt("[eval] code updated"),it=await et(it,I),F({miniLocations:re?.miniLocations||[],widgets:re?.widgets||[],activeCode:H,pattern:it,evalError:void 0,schedulerError:void 0,pending:!1}),o?.({code:H,pattern:it,meta:re}),it}catch(it){Yt(`[eval] error: ${it.message}`,"error"),console.error(it),F({evalError:it,pending:!1}),e?.(it)}},start:ut,stop:T,pause:P,setCps:U,setPattern:et,setCode:H=>F({code:H}),toggle:q,state:Z}}const N0=({getTime:t,defaultOutput:e})=>async(n,s,o,r,i)=>{try{(!n.context.onTrigger||!n.context.dominantTrigger)&&await e(n,s,o,r,i),n.context.onTrigger&&await n.context.onTrigger(n,t(),r,i)}catch(u){Bn(u,"getTrigger")}},Fb=function(t,e={}){const n=document.getElementById("code"),s="background-image:url("+t+");background-size:contain;";n.style=s;const{className:o}=n,r=(a,l)=>{({style:()=>n.style=s+";"+l,className:()=>n.className=l+" "+o})[a]()},i=Object.entries(e).filter(([a,l])=>typeof l=="function");Object.entries(e).filter(([a,l])=>typeof l=="string").forEach(([a,l])=>r(a,l)),i.length},Vb=()=>{const t=document.getElementById("code");t&&(t.style="")};Yt("🌀 @strudel/core loaded 🌀"),globalThis._strudelLoaded&&console.warn(`@strudel/core was loaded more than once...
This might happen when you have multiple versions of strudel installed. 
Please check with "npm ls @strudel/core".`),globalThis._strudelLoaded=!0;const js=Object.freeze(Object.defineProperty({__proto__:null,ClockCollator:Io,Cyclist:A0,Fraction:C,Hap:gt,Pattern:L,State:Pe,TimeSpan:bt,__chooseWith:Ps,_brandBy:Ks,_fitslice:rr,_irand:Hs,_keyDown:Es,_match:cr,_mod:pn,_morph:Ms,_polymeterListSteps:ur,_retime:Cs,_slices:Ls,accelerate:mc,activeLabel:Ya,ad:Kd,add:Wf,adsr:Nd,almostAlways:$y,almostNever:qy,always:eb,amp:Xc,analyze:Yc,anchor:cl,and:Pf,apply:gm,applyN:or,ar:Pd,arp:ef,arpWith:tf,arrange:uf,as:u0,att:Zc,attack:Gc,averageArray:Bo,backgroundImage:Fb,band:Mf,bandf:Ec,bandq:Ic,bank:vc,base64ToUnicode:Do,bbexpr:mi,bbst:bi,beat:J1,begin:_c,berlin:Ky,berlinWith:M0,binary:wy,binaryL:Wy,binaryN:G0,binaryNL:Z0,bind:ff,binshift:ad,bite:Fm,bjork:ey,bjorklund:Ss,blshift:vf,bor:Rf,bp:Jc,bpa:Ui,bpattack:Oi,bpd:nu,bpdc:Mu,bpdecay:eu,bpdepth:Cu,bpdepthfrequency:Lu,bpe:Di,bpenv:Ei,bpf:Dc,bpq:jc,bpr:fu,bprate:Fu,bprelease:hu,bps:uu,bpshape:zu,bpskew:Ru,bpsustain:iu,bpsync:Vu,brak:Ym,brand:My,brandBy:zy,brshift:Sf,bxor:xf,bypass:d1,byteBeatExpression:fi,byteBeatStartTime:yi,calculateSteps:Qh,cat:mn,ccn:_d,ccv:Od,ceil:jf,ch:Xi,channel:Si,channels:gi,choose:F0,chooseCycles:V0,chooseIn:xy,chooseInWith:In,chooseOut:vy,chooseWith:Jn,chop:B1,chord:sl,chorus:Sc,chunk:t1,chunkBack:s1,chunkBackInto:l1,chunkInto:u1,chunkback:o1,chunkbackinto:a1,chunkinto:i1,clamp:An,cleanupUi:Vb,clip:Zd,coarse:ni,code2hash:Dh,color:Td,colour:Ad,comb:cd,compose:vh,compress:tm,compressSpan:em,compressor:Rl,compressorAttack:Sl,compressorKnee:xl,compressorRatio:vl,compressorRelease:Yl,compressspan:nm,constant:Sh,contract:fr,control:jd,controls:Q1,cosine:ay,cosine2:ly,cpm:Xm,cps:Gd,createClock:p0,createParam:Pn,createParams:xs,crush:ei,ctf:ki,ctlNum:Ud,ctranspose:Aa,curry:J,curve:Cd,cut:Yi,cutoff:Bi,cycleToSeconds:ys,dec:Tc,decay:kc,degrade:Ey,degradeBy:Py,degradeByWith:Hy,degree:ka,delay:$u,delayfb:ea,delayfeedback:ta,delayspeed:sa,delaysync:ia,delayt:ra,delaytime:oa,deltaSlide:Ld,det:la,detune:aa,dfb:na,dict:rl,dictionary:ol,dist:Ll,distort:Cl,distorttype:Ml,distortvol:zl,div:Cf,djf:qu,drawLine:Oo,drive:ai,drop:dr,dry:ha,ds:Hd,dt:ca,duck:li,duckattack:hi,duckdepth:di,duckonset:pi,dur:Fd,duration:Wd,early:Gm,echo:Im,echoWith:Pm,echowith:Em,eish:iy,end:Oc,enhance:rd,eq:Af,eqt:Nf,errorLogger:Bn,euclid:ty,euclidLegato:oy,euclidLegatoRot:ry,euclidRot:sy,euclidish:cy,euclidrot:ny,evalScope:Y0,evaluate:B0,every:bm,expand:hr,expression:Kl,extend:pr,fadeInTime:ya,fadeOutTime:ma,fadeTime:fa,fanchor:yu,fast:am,fastChunk:c1,fastGap:sm,fastcat:Lt,fastchunk:r1,fastgap:om,fft:Bc,filter:y1,filterWhen:b1,firstOf:ym,fit:K1,flatten:ae,floor:If,fm:Fc,fmattack:Cc,fmdecay:zc,fmenv:Vc,fmh:wc,fmi:Wc,fmrelease:Rc,fmsustain:Mc,fmvelocity:xc,fmwave:Lc,focus:rm,focusSpan:cm,focusspan:im,fractionalArgs:Yh,frameRate:pd,frames:hd,freeze:td,freq:ba,freqToMidi:ps,fromBipolar:Of,fshift:Pl,fshiftnote:El,fshiftphase:Dl,ftype:mu,func:Df,gain:bc,gap:Ee,gat:Ra,gate:Ma,getAccidentalsOffset:So,getControlName:vs,getCurrentKeyboardState:_o,getEventOffsetMs:Lh,getFreq:Yo,getFrequency:To,getPerformanceTimeSeconds:Ih,getPlayableNoteValue:xh,getSoundIndex:Rh,getTime:Js,getTrigger:N0,grow:G1,gt:Bf,gte:Tf,harmonic:Na,hash2code:Jh,hbrick:ld,hcutoff:Ju,hold:Pc,hours:fd,hp:ju,hpa:_i,hpattack:ji,hpd:tu,hpdc:Tu,hpdecay:$i,hpdepth:Su,hpdepthfreq:Yu,hpdepthfrequency:Bu,hpe:Pi,hpenv:Hi,hpf:Iu,hpq:Ou,hpr:pu,hprate:xu,hprelease:du,hps:cu,hpshape:ku,hpskew:Au,hpsustain:ru,hpsync:vu,hresonance:_u,hsl:m1,hsla:f1,hurry:lm,id:He,imag:od,inhabit:hb,inhabitmod:mb,innerBind:mf,inside:hm,inv:xm,invert:Rm,ir:bl,irand:Ry,irbegin:Gl,iresponse:gl,irspeed:Xl,isControlName:Fr,isNote:kn,isNoteWithOctave:Wh,isPattern:Gs,isaw:Dn,isaw2:Bs,iter:Um,iterBack:Qm,iterback:qm,itri:fy,itri2:my,jux:Hm,juxBy:Nm,juxby:Km,kcutoff:jl,keep:Zf,keepif:wf,keyAlias:jo,keyDown:sb,krush:Il,label:Ba,lastOf:mm,late:nr,lbrick:dd,legato:wd,leslie:xa,lfo:Rd,linger:Vm,listRange:hn,lock:ua,logKey:ds,logger:Yt,loop:Uc,loopAt:A1,loopAtCps:H1,loopBegin:Qc,loopEnd:$c,loopat:N1,loopatcps:P1,loopb:qc,loope:ti,lp:Ai,lpa:Ii,lpattack:Ji,lpd:qi,lpdc:wu,lpdecay:Qi,lpdepth:Xu,lpdepthfrequency:Gu,lpe:Ki,lpenv:Ni,lpf:Ti,lpq:Qu,lpr:lu,lprate:bu,lprelease:au,lps:ou,lpshape:Zu,lpskew:Wu,lpsustain:su,lpsync:gu,lrate:va,lsize:Sa,lt:Yf,lte:kf,mapArgs:fs,mask:lf,midi2note:Mh,midiToFreq:Ve,midibend:s0,midichan:Ed,midicmd:Id,midimap:Dd,midiport:Jd,miditouch:o0,minutes:md,mod:Lf,mode:al,morph:I1,mouseX:Xy,mouseY:by,mousex:gy,mousey:yy,mtranspose:Ta,mul:Vf,n:hc,nanFallback:ko,ne:Kf,net:Hf,never:tb,noise:Pu,note:fc,noteToMidi:Ne,nothing:Kt,nrpnn:Qd,nrpv:qd,nudge:Pa,numeralArgs:At,objectMap:Jo,oct:Da,octave:Ea,octaveR:Ha,octaves:ul,octer:_l,octersub:Ol,octersubsub:Ul,off:Sm,offset:il,often:Uy,or:Ef,orbit:Ja,oschost:c0,oscport:i0,outerBind:yf,outside:fm,overgain:Ia,overshape:ja,pace:ir,pairs:Ho,palindrome:Am,pan:_a,panchor:za,panorient:qa,panspan:Oa,pansplay:Ua,panwidth:Qa,parray:Wr,parseFractional:Ko,parseNumeral:hs,partials:_1,patt:Xa,pattack:ga,pcurve:La,pdec:Za,pdecay:Ga,penv:Ca,perlin:Ny,perlinWith:z0,ph:Fi,phasdp:vi,phaser:Vi,phasercenter:zi,phaserdepth:Ri,phaserrate:Wi,phasersweep:Ci,phases:O1,phc:Mi,phd:xi,phs:Li,pick:R0,pickF:rb,pickOut:ib,pickReset:db,pickRestart:ab,pickSqueeze:fb,pickmod:x0,pickmodF:cb,pickmodOut:ub,pickmodReset:pb,pickmodRestart:lb,pickmodSqueeze:yb,pipe:No,pitchJump:zd,pitchJumpTime:Md,ply:um,plyForEach:Om,plyWith:_m,pm:rf,polyBind:Xf,polyTouch:r0,polymeter:Kn,polyrhythm:sf,postgain:gc,pow:zf,pr:of,prel:Va,prelease:Fa,press:Tm,pressBy:km,progNum:$d,psus:Wa,psustain:wa,pure:Xt,pw:Gi,pwrate:Zi,pwsweep:wi,rand:Rt,rand2:Ly,randL:Fy,randcat:Sy,randrun:w0,range:Uf,range2:qf,rangex:Qf,rarely:Qy,rate:$a,ratio:$f,rdim:fl,real:sd,ref:E1,register:G,registerControl:h,reify:V,rel:Hc,release:Kc,removeUndefineds:Ke,repeatCycles:$m,repeatTime:xd,repl:Wb,replicate:X1,resonance:Uu,rev:sr,revv:Bm,rfade:yl,rib:h1,ribbon:p1,ring:Ql,ringdf:$l,ringf:ql,rlp:pl,room:ll,roomdim:hl,roomfade:ml,roomlp:dl,roomsize:Zl,rotate:Ao,round:Jf,rsize:Fl,run:X0,s:Vr,s_add:L1,s_alt:W1,s_cat:w1,s_contract:x1,s_expand:M1,s_extend:R1,s_polymeter:F1,s_sub:z1,s_taper:V1,s_taperlist:C1,s_tour:v1,s_zip:S1,saw:bn,saw2:Ys,scram:ud,scramble:Cy,scrub:a0,seconds:yd,seg:Lm,segment:Cm,semitone:el,seq:er,seqPLoop:af,sequence:Qt,sequenceP:Qo,set:Gf,setStringParser:Uo,setTime:Is,shape:Vl,shrink:yr,shrinklist:mr,shuffle:Vy,signal:Ht,silence:st,sine:h0,sine2:ks,size:wl,slice:Gr,slide:tl,slow:dm,slowChunk:n1,slowcat:ge,slowcatPrime:ws,slowchunk:e1,smear:id,sol2note:Hh,someCycles:Oy,someCyclesBy:_y,sometimes:jy,sometimesBy:Iy,songPtr:bd,sound:Cr,source:dc,sparsity:pm,speak:Xb,speed:Rs,splice:T1,splitAt:ms,spread:pa,square:f0,square2:dy,squeeze:bb,squeezeBind:bf,squiz:Tl,src:pc,stack:mt,stackBy:cf,stackCentre:tr,stackLeft:qo,stackRight:$o,steady:uy,stepBind:gf,stepalt:ar,stepcat:Bt,steps:Y1,stepsPerOctave:Ka,stretch:Bl,striate:k1,stringifyValues:bs,struct:df,strudelScope:S0,stut:jm,stutWith:Dm,stutwith:Jm,sub:Ff,superimpose:pf,sus:Nc,sustain:Ac,sustainpedal:Hl,swing:Mm,swingBy:zm,sysex:t0,sysexdata:n0,sysexid:e0,sz:Wl,take:lr,time:Ts,timeCat:zs,timecat:Z1,toBipolar:_f,tokenizeNote:vo,tour:br,tremolo:si,tremolodepth:ri,tremolophase:ii,tremoloshape:ui,tremoloskew:ci,tremolosync:oi,tri:py,tri2:hy,triode:Jl,tsdelay:nd,uid:gd,undegrade:Jy,undegradeBy:Dy,unicodeToBase64:Eo,uniq:Ph,uniqsort:Eh,uniqsortr:Po,unison:da,unit:kl,v:Hu,val:Xd,valueToMidi:Ch,velocity:yc,vib:Nu,vibmod:Eu,vibrato:Ku,vmod:Du,voice:nl,vowel:Al,warp:Dr,warpatt:jr,warpattack:Ir,warpdc:sc,warpdec:Or,warpdecay:_r,warpdepth:ec,warpenv:ac,warpmode:rc,warprate:tc,warprel:$r,warprelease:qr,warpshape:nc,warpskew:oc,warpsus:Qr,warpsustain:Ur,warpsync:lc,waveloss:Nl,wavetablePhaseRand:uc,wavetablePosition:zr,wavetableWarp:Jr,wavetableWarpMode:cc,wchoose:By,wchooseCycles:L0,when:vm,whenKey:nb,withValue:hf,within:g1,wrandcat:ky,wt:Lr,wtatt:xr,wtattack:Rr,wtdc:Pr,wtdec:Sr,wtdecay:vr,wtdepth:Kr,wtenv:Mr,wtphaserand:ic,wtrate:Ar,wtrel:Tr,wtrelease:kr,wtshape:Hr,wtskew:Er,wtsus:Br,wtsustain:Yr,wtsync:Nr,xfade:wr,xsdelay:ed,zcrush:Yd,zdelay:Bd,zip:gr,zipWith:Tn,zmod:Sd,znoise:vd,zoom:Zm,zoomArc:wm,zoomarc:Wm,zrand:Vd,zzfx:kd},Symbol.toStringTag,{value:"Module"}));function Cb(t,e){function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n}function Ce(t,e,n,s){var o=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(o,Ce.prototype),o.expected=e,o.found=n,o.location=s,o.name="SyntaxError",o}Cb(Ce,Error);function _s(t,e,n){return n=n||" ",t.length>e?t:(e-=t.length,n+=n.repeat(e),t+n.slice(0,e))}Ce.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var n=null,s;for(s=0;s<t.length;s++)if(t[s].source===this.location.source){n=t[s].text.split(/\r\n|\n|\r/g);break}var o=this.location.start,r=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(o):o,i=this.location.source+":"+r.line+":"+r.column;if(n){var u=this.location.end,a=_s("",r.line.toString().length," "),l=n[o.line-1],p=o.line===u.line?u.column:l.length+1,f=p-o.column||1;e+=`
 --> `+i+`
`+a+` |
`+r.line+" | "+l+`
`+a+" | "+_s("",o.column-1," ")+_s("",f,"^")}else e+=`
 at `+i}return e},Ce.buildMessage=function(t,e){var n={literal:function(l){return'"'+o(l.text)+'"'},class:function(l){var p=l.parts.map(function(f){return Array.isArray(f)?r(f[0])+"-"+r(f[1]):r(f)});return"["+(l.inverted?"^":"")+p.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(l){return l.description}};function s(l){return l.charCodeAt(0).toString(16).toUpperCase()}function o(l){return l.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(p){return"\\x0"+s(p)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(p){return"\\x"+s(p)})}function r(l){return l.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(p){return"\\x0"+s(p)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(p){return"\\x"+s(p)})}function i(l){return n[l.type](l)}function u(l){var p=l.map(i),f,b;if(p.sort(),p.length>0){for(f=1,b=1;f<p.length;f++)p[f-1]!==p[f]&&(p[b]=p[f],b++);p.length=b}switch(p.length){case 1:return p[0];case 2:return p[0]+" or "+p[1];default:return p.slice(0,-1).join(", ")+", or "+p[p.length-1]}}function a(l){return l?'"'+o(l)+'"':"end of input"}return"Expected "+u(t)+" but "+a(e)+" found."};function K0(t,e){e=e!==void 0?e:{};var n={},s=e.grammarSource,o={start:lh},r=lh,i=".",u="-",a="0",l=",",p="|",f="[",b="]",g="{",X="}",Z="%",W="<",F=">",z="!",v="(",x=")",R="/",N="*",O="?",_=":",et="..",T="^",ut="struct",P="target",q="euclid",U="slow",pt="rotL",$="rotR",ot="fast",ht="scale",Ct="//",Pt="cat",Tt="$",H="setcps",I="setbpm",te="hush",it=/^[1-9]/,re=/^[eE]/,zt=/^[+\-]/,tt=/^[0-9]/,rt=/^[ \n\r\t\xA0]/,It=/^["']/,jt=/^[#\--.0-9A-Z\^-_a-z~\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376-\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E-\u066F\u0671-\u06D3\u06D5\u06E5-\u06E6\u06EE-\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4-\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F-\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC-\u09DD\u09DF-\u09E1\u09F0-\u09F1\u09FC\u0A05-\u0A0A\u0A0F-\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32-\u0A33\u0A35-\u0A36\u0A38-\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2-\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0-\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F-\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32-\u0B33\u0B35-\u0B39\u0B3D\u0B5C-\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99-\u0B9A\u0B9C\u0B9E-\u0B9F\u0BA3-\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60-\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0-\u0CE1\u0CF1-\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32-\u0E33\u0E40-\u0E46\u0E81-\u0E82\u0E84\u0E87-\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA-\u0EAB\u0EAD-\u0EB0\u0EB2-\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065-\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE-\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5-\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEF\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A-\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7B9\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD-\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5-\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40-\uFB41\uFB43-\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,wt=/^[@_]/,Ze=/^[^\n]/,zn=Fo("number"),we=Q(".",!1),$e=me([["1","9"]],!1,!1),fe=me(["e","E"],!1,!1),xe=me(["+","-"],!1,!1),ve=Q("-",!1),Se=Q("0",!1),tn=me([["0","9"]],!1,!1),Ye=Fo("whitespace"),ce=me([" ",`
`,"\r","	"," "],!1,!1),Mn=Q(",",!1),en=Q("|",!1),Rn=me(['"',"'"],!1,!1),ns=Fo('a letter, a number, "-", "#", ".", "^", "_"'),xn=me(["#",["-","."],["0","9"],["A","Z"],["^","_"],["a","z"],"~","ª","µ","º",["À","Ö"],["Ø","ö"],["ø","ˁ"],["ˆ","ˑ"],["ˠ","ˤ"],"ˬ","ˮ",["Ͱ","ʹ"],["Ͷ","ͷ"],["ͺ","ͽ"],"Ϳ","Ά",["Έ","Ί"],"Ό",["Ύ","Ρ"],["Σ","ϵ"],["Ϸ","ҁ"],["Ҋ","ԯ"],["Ա","Ֆ"],"ՙ",["ՠ","ֈ"],["א","ת"],["ׯ","ײ"],["ؠ","ي"],["ٮ","ٯ"],["ٱ","ۓ"],"ە",["ۥ","ۦ"],["ۮ","ۯ"],["ۺ","ۼ"],"ۿ","ܐ",["ܒ","ܯ"],["ݍ","ޥ"],"ޱ",["ߊ","ߪ"],["ߴ","ߵ"],"ߺ",["ࠀ","ࠕ"],"ࠚ","ࠤ","ࠨ",["ࡀ","ࡘ"],["ࡠ","ࡪ"],["ࢠ","ࢴ"],["ࢶ","ࢽ"],["ऄ","ह"],"ऽ","ॐ",["क़","ॡ"],["ॱ","ঀ"],["অ","ঌ"],["এ","ঐ"],["ও","ন"],["প","র"],"ল",["শ","হ"],"ঽ","ৎ",["ড়","ঢ়"],["য়","ৡ"],["ৰ","ৱ"],"ৼ",["ਅ","ਊ"],["ਏ","ਐ"],["ਓ","ਨ"],["ਪ","ਰ"],["ਲ","ਲ਼"],["ਵ","ਸ਼"],["ਸ","ਹ"],["ਖ਼","ੜ"],"ਫ਼",["ੲ","ੴ"],["અ","ઍ"],["એ","ઑ"],["ઓ","ન"],["પ","ર"],["લ","ળ"],["વ","હ"],"ઽ","ૐ",["ૠ","ૡ"],"ૹ",["ଅ","ଌ"],["ଏ","ଐ"],["ଓ","ନ"],["ପ","ର"],["ଲ","ଳ"],["ଵ","ହ"],"ଽ",["ଡ଼","ଢ଼"],["ୟ","ୡ"],"ୱ","ஃ",["அ","ஊ"],["எ","ஐ"],["ஒ","க"],["ங","ச"],"ஜ",["ஞ","ட"],["ண","த"],["ந","ப"],["ம","ஹ"],"ௐ",["అ","ఌ"],["ఎ","ఐ"],["ఒ","న"],["ప","హ"],"ఽ",["ౘ","ౚ"],["ౠ","ౡ"],"ಀ",["ಅ","ಌ"],["ಎ","ಐ"],["ಒ","ನ"],["ಪ","ಳ"],["ವ","ಹ"],"ಽ","ೞ",["ೠ","ೡ"],["ೱ","ೲ"],["അ","ഌ"],["എ","ഐ"],["ഒ","ഺ"],"ഽ","ൎ",["ൔ","ൖ"],["ൟ","ൡ"],["ൺ","ൿ"],["අ","ඖ"],["ක","න"],["ඳ","ර"],"ල",["ව","ෆ"],["ก","ะ"],["า","ำ"],["เ","ๆ"],["ກ","ຂ"],"ຄ",["ງ","ຈ"],"ຊ","ຍ",["ດ","ທ"],["ນ","ຟ"],["ມ","ຣ"],"ລ","ວ",["ສ","ຫ"],["ອ","ະ"],["າ","ຳ"],"ຽ",["ເ","ໄ"],"ໆ",["ໜ","ໟ"],"ༀ",["ཀ","ཇ"],["ཉ","ཬ"],["ྈ","ྌ"],["က","ဪ"],"ဿ",["ၐ","ၕ"],["ၚ","ၝ"],"ၡ",["ၥ","ၦ"],["ၮ","ၰ"],["ၵ","ႁ"],"ႎ",["Ⴀ","Ⴥ"],"Ⴧ","Ⴭ",["ა","ჺ"],["ჼ","ቈ"],["ቊ","ቍ"],["ቐ","ቖ"],"ቘ",["ቚ","ቝ"],["በ","ኈ"],["ኊ","ኍ"],["ነ","ኰ"],["ኲ","ኵ"],["ኸ","ኾ"],"ዀ",["ዂ","ዅ"],["ወ","ዖ"],["ዘ","ጐ"],["ጒ","ጕ"],["ጘ","ፚ"],["ᎀ","ᎏ"],["Ꭰ","Ᏽ"],["ᏸ","ᏽ"],["ᐁ","ᙬ"],["ᙯ","ᙿ"],["ᚁ","ᚚ"],["ᚠ","ᛪ"],["ᛮ","ᛸ"],["ᜀ","ᜌ"],["ᜎ","ᜑ"],["ᜠ","ᜱ"],["ᝀ","ᝑ"],["ᝠ","ᝬ"],["ᝮ","ᝰ"],["ក","ឳ"],"ៗ","ៜ",["ᠠ","ᡸ"],["ᢀ","ᢄ"],["ᢇ","ᢨ"],"ᢪ",["ᢰ","ᣵ"],["ᤀ","ᤞ"],["ᥐ","ᥭ"],["ᥰ","ᥴ"],["ᦀ","ᦫ"],["ᦰ","ᧉ"],["ᨀ","ᨖ"],["ᨠ","ᩔ"],"ᪧ",["ᬅ","ᬳ"],["ᭅ","ᭋ"],["ᮃ","ᮠ"],["ᮮ","ᮯ"],["ᮺ","ᯥ"],["ᰀ","ᰣ"],["ᱍ","ᱏ"],["ᱚ","ᱽ"],["ᲀ","ᲈ"],["Ა","Ჺ"],["Ჽ","Ჿ"],["ᳩ","ᳬ"],["ᳮ","ᳱ"],["ᳵ","ᳶ"],["ᴀ","ᶿ"],["Ḁ","ἕ"],["Ἐ","Ἕ"],["ἠ","ὅ"],["Ὀ","Ὅ"],["ὐ","ὗ"],"Ὑ","Ὓ","Ὕ",["Ὗ","ώ"],["ᾀ","ᾴ"],["ᾶ","ᾼ"],"ι",["ῂ","ῄ"],["ῆ","ῌ"],["ῐ","ΐ"],["ῖ","Ί"],["ῠ","Ῥ"],["ῲ","ῴ"],["ῶ","ῼ"],"ⁱ","ⁿ",["ₐ","ₜ"],"ℂ","ℇ",["ℊ","ℓ"],"ℕ",["ℙ","ℝ"],"ℤ","Ω","ℨ",["K","ℭ"],["ℯ","ℹ"],["ℼ","ℿ"],["ⅅ","ⅉ"],"ⅎ",["Ⅰ","ↈ"],["Ⰰ","Ⱞ"],["ⰰ","ⱞ"],["Ⱡ","ⳤ"],["Ⳬ","ⳮ"],["Ⳳ","ⳳ"],["ⴀ","ⴥ"],"ⴧ","ⴭ",["ⴰ","ⵧ"],"ⵯ",["ⶀ","ⶖ"],["ⶠ","ⶦ"],["ⶨ","ⶮ"],["ⶰ","ⶶ"],["ⶸ","ⶾ"],["ⷀ","ⷆ"],["ⷈ","ⷎ"],["ⷐ","ⷖ"],["ⷘ","ⷞ"],"ⸯ",["々","〇"],["〡","〩"],["〱","〵"],["〸","〼"],["ぁ","ゖ"],["ゝ","ゟ"],["ァ","ヺ"],["ー","ヿ"],["ㄅ","ㄯ"],["ㄱ","ㆎ"],["ㆠ","ㆺ"],["ㇰ","ㇿ"],["㐀","䶵"],["一","鿯"],["ꀀ","ꒌ"],["ꓐ","ꓽ"],["ꔀ","ꘌ"],["ꘐ","ꘟ"],["ꘪ","ꘫ"],["Ꙁ","ꙮ"],["ꙿ","ꚝ"],["ꚠ","ꛯ"],["ꜗ","ꜟ"],["Ꜣ","ꞈ"],["Ꞌ","ꞹ"],["ꟷ","ꠁ"],["ꠃ","ꠅ"],["ꠇ","ꠊ"],["ꠌ","ꠢ"],["ꡀ","ꡳ"],["ꢂ","ꢳ"],["ꣲ","ꣷ"],"ꣻ",["ꣽ","ꣾ"],["ꤊ","ꤥ"],["ꤰ","ꥆ"],["ꥠ","ꥼ"],["ꦄ","ꦲ"],"ꧏ",["ꧠ","ꧤ"],["ꧦ","ꧯ"],["ꧺ","ꧾ"],["ꨀ","ꨨ"],["ꩀ","ꩂ"],["ꩄ","ꩋ"],["ꩠ","ꩶ"],"ꩺ",["ꩾ","ꪯ"],"ꪱ",["ꪵ","ꪶ"],["ꪹ","ꪽ"],"ꫀ","ꫂ",["ꫛ","ꫝ"],["ꫠ","ꫪ"],["ꫲ","ꫴ"],["ꬁ","ꬆ"],["ꬉ","ꬎ"],["ꬑ","ꬖ"],["ꬠ","ꬦ"],["ꬨ","ꬮ"],["ꬰ","ꭚ"],["ꭜ","ꭥ"],["ꭰ","ꯢ"],["가","힣"],["ힰ","ퟆ"],["ퟋ","ퟻ"],["豈","舘"],["並","龎"],["ﬀ","ﬆ"],["ﬓ","ﬗ"],"יִ",["ײַ","ﬨ"],["שׁ","זּ"],["טּ","לּ"],"מּ",["נּ","סּ"],["ףּ","פּ"],["צּ","ﮱ"],["ﯓ","ﴽ"],["ﵐ","ﶏ"],["ﶒ","ﷇ"],["ﷰ","ﷻ"],["ﹰ","ﹴ"],["ﹶ","ﻼ"],["Ａ","Ｚ"],["ａ","ｚ"],["ｦ","ﾾ"],["ￂ","ￇ"],["ￊ","ￏ"],["ￒ","ￗ"],["ￚ","ￜ"]],!1,!1),_t=Q("[",!1),Be=Q("]",!1),ss=Q("{",!1),os=Q("}",!1),Mt=Q("%",!1),nn=Q("<",!1),at=Q(">",!1),vn=me(["@","_"],!1,!1),ke=Q("!",!1),nt=Q("(",!1),lt=Q(")",!1),yt=Q("/",!1),Gt=Q("*",!1),Et=Q("?",!1),Te=Q(":",!1),ie=Q("..",!1),p2=Q("^",!1),h2=Q("struct",!1),f2=Q("target",!1),m2=Q("euclid",!1),y2=Q("slow",!1),b2=Q("rotL",!1),g2=Q("rotR",!1),X2=Q("fast",!1),G2=Q("scale",!1),Z2=Q("//",!1),ch=me([`
`],!0,!1),w2=Q("cat",!1),W2=Q("$",!1),F2=Q("setcps",!1),V2=Q("setbpm",!1),C2=Q("hush",!1),L2=function(){return parseFloat(pX())},z2=function(c){const d=c.join("");return d==="."||d==="_"},M2=function(c){return new eG(c.join(""))},R2=function(c){return c},x2=function(c,d){return c.arguments_.stepsPerCycle=d,c},v2=function(c){return c},S2=function(c){return c.arguments_.alignment="polymeter_slowcat",c},Y2=function(c){return d=>d.options_.weight=(d.options_.weight??1)+(c??2)-1},B2=function(c){return d=>{const y=(d.options_.reps??1)+(c??2)-1;d.options_.reps=y,d.options_.ops=d.options_.ops.filter(w=>w.type_!=="replicate"),d.options_.ops.push({type_:"replicate",arguments_:{amount:y}}),d.options_.weight=y}},k2=function(c,d,y){return w=>w.options_.ops.push({type_:"bjorklund",arguments_:{pulse:c,step:d,rotation:y}})},T2=function(c){return d=>d.options_.ops.push({type_:"stretch",arguments_:{amount:c,type:"slow"}})},A2=function(c){return d=>d.options_.ops.push({type_:"stretch",arguments_:{amount:c,type:"fast"}})},N2=function(c){return d=>d.options_.ops.push({type_:"degradeBy",arguments_:{amount:c,seed:zo++}})},K2=function(c){return d=>d.options_.ops.push({type_:"tail",arguments_:{element:c}})},H2=function(c){return d=>d.options_.ops.push({type_:"range",arguments_:{element:c}})},P2=function(c,d){const y=new sG(c,{ops:[],weight:1,reps:1});for(const w of d)w(y);return y},E2=function(c,d){return new us(d,"fastcat",void 0,!!c)},D2=function(c){return{alignment:"stack",list:c}},J2=function(c){return{alignment:"rand",list:c,seed:zo++}},I2=function(c){return{alignment:"feet",list:c,seed:zo++}},j2=function(c,d){return d&&d.list.length>0?new us([c,...d.list],d.alignment,d.seed):c},_2=function(c,d){return new us(d?[c,...d.list]:[c],"polymeter")},O2=function(c){return c},U2=function(c){return{name:"struct",args:{mini:c}}},Q2=function(c){return{name:"target",args:{name:c}}},q2=function(c,d,y){return{name:"bjorklund",args:{pulse:c,step:parseInt(d)}}},$2=function(c){return{name:"stretch",args:{amount:c}}},tX=function(c){return{name:"shift",args:{amount:"-"+c}}},eX=function(c){return{name:"shift",args:{amount:c}}},nX=function(c){return{name:"stretch",args:{amount:"1/"+c}}},sX=function(c){return{name:"scale",args:{scale:c.join("")}}},ih=function(c,d){return d},oX=function(c,d){return d.unshift(c),new us(d,"slowcat")},rX=function(c){return c},cX=function(c,d){return new nG(c.name,c.args,d)},iX=function(c){return c},uX=function(c){return c},aX=function(c){return new Lo("setcps",{value:c})},lX=function(c){return new Lo("setcps",{value:c/120/2})},dX=function(){return new Lo("hush")},m=e.peg$currPos|0,E=m,sn=[{line:1,column:1}],ee=m,rs=e.peg$maxFailExpected||[],Y=e.peg$silentFails|0,Sn;if(e.startRule){if(!(e.startRule in o))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');r=o[e.startRule]}function pX(){return t.substring(E,m)}function uh(){return Vo(E,m)}function Q(c,d){return{type:"literal",text:c,ignoreCase:d}}function me(c,d,y){return{type:"class",parts:c,inverted:d,ignoreCase:y}}function hX(){return{type:"end"}}function Fo(c){return{type:"other",description:c}}function ah(c){var d=sn[c],y;if(d)return d;if(c>=sn.length)y=sn.length-1;else for(y=c;!sn[--y];);for(d=sn[y],d={line:d.line,column:d.column};y<c;)t.charCodeAt(y)===10?(d.line++,d.column=1):d.column++,y++;return sn[c]=d,d}function Vo(c,d,y){var w=ah(c),B=ah(d),ft={source:s,start:{offset:c,line:w.line,column:w.column},end:{offset:d,line:B.line,column:B.column}};return ft}function A(c){m<ee||(m>ee&&(ee=m,rs=[]),rs.push(c))}function fX(c,d,y){return new Ce(Ce.buildMessage(c,d),c,d,y)}function lh(){var c;return c=tG(),c}function ye(){var c,d;return Y++,c=m,GX(),d=cs(),d!==n?(XX(),gX(),E=c,c=L2()):(m=c,c=n),Y--,c===n&&Y===0&&A(zn),c}function mX(){var c;return t.charCodeAt(m)===46?(c=i,m++):(c=n,Y===0&&A(we)),c}function yX(){var c;return c=t.charAt(m),it.test(c)?m++:(c=n,Y===0&&A($e)),c}function bX(){var c;return c=t.charAt(m),re.test(c)?m++:(c=n,Y===0&&A(fe)),c}function gX(){var c,d,y,w,B;if(c=m,d=bX(),d!==n){if(y=t.charAt(m),zt.test(y)?m++:(y=n,Y===0&&A(xe)),y===n&&(y=null),w=[],B=on(),B!==n)for(;B!==n;)w.push(B),B=on();else w=n;w!==n?(d=[d,y,w],c=d):(m=c,c=n)}else m=c,c=n;return c}function XX(){var c,d,y,w;if(c=m,d=mX(),d!==n){if(y=[],w=on(),w!==n)for(;w!==n;)y.push(w),w=on();else y=n;y!==n?(d=[d,y],c=d):(m=c,c=n)}else m=c,c=n;return c}function cs(){var c,d,y,w;if(c=ZX(),c===n)if(c=m,d=yX(),d!==n){for(y=[],w=on();w!==n;)y.push(w),w=on();d=[d,y],c=d}else m=c,c=n;return c}function GX(){var c;return t.charCodeAt(m)===45?(c=u,m++):(c=n,Y===0&&A(ve)),c}function ZX(){var c;return t.charCodeAt(m)===48?(c=a,m++):(c=n,Y===0&&A(Se)),c}function on(){var c;return c=t.charAt(m),tt.test(c)?m++:(c=n,Y===0&&A(tn)),c}function K(){var c,d;for(Y++,c=[],d=t.charAt(m),rt.test(d)?m++:(d=n,Y===0&&A(ce));d!==n;)c.push(d),d=t.charAt(m),rt.test(d)?m++:(d=n,Y===0&&A(ce));return Y--,d=n,Y===0&&A(Ye),c}function rn(){var c,d,y,w;return c=m,d=K(),t.charCodeAt(m)===44?(y=l,m++):(y=n,Y===0&&A(Mn)),y!==n?(w=K(),d=[d,y,w],c=d):(m=c,c=n),c}function dh(){var c,d,y,w;return c=m,d=K(),t.charCodeAt(m)===124?(y=p,m++):(y=n,Y===0&&A(en)),y!==n?(w=K(),d=[d,y,w],c=d):(m=c,c=n),c}function ph(){var c,d,y,w;return c=m,d=K(),t.charCodeAt(m)===46?(y=i,m++):(y=n,Y===0&&A(we)),y!==n?(w=K(),d=[d,y,w],c=d):(m=c,c=n),c}function cn(){var c;return c=t.charAt(m),It.test(c)?m++:(c=n,Y===0&&A(Rn)),c}function is(){var c;return Y++,c=t.charAt(m),jt.test(c)?m++:(c=n,Y===0&&A(xn)),Y--,c===n&&Y===0&&A(ns),c}function hh(){var c,d,y,w;if(c=m,K(),d=[],y=is(),y!==n)for(;y!==n;)d.push(y),y=is();else d=n;return d!==n?(y=K(),E=m,w=z2(d),w?w=n:w=void 0,w!==n?(E=c,c=M2(d)):(m=c,c=n)):(m=c,c=n),c}function wX(){var c,d,y,w;return c=m,K(),t.charCodeAt(m)===91?(d=f,m++):(d=n,Y===0&&A(_t)),d!==n?(K(),y=yh(),y!==n?(K(),t.charCodeAt(m)===93?(w=b,m++):(w=n,Y===0&&A(Be)),w!==n?(K(),E=c,c=R2(y)):(m=c,c=n)):(m=c,c=n)):(m=c,c=n),c}function WX(){var c,d,y,w,B;return c=m,K(),t.charCodeAt(m)===123?(d=g,m++):(d=n,Y===0&&A(ss)),d!==n?(K(),y=bh(),y!==n?(K(),t.charCodeAt(m)===125?(w=X,m++):(w=n,Y===0&&A(os)),w!==n?(B=FX(),B===n&&(B=null),K(),E=c,c=x2(y,B)):(m=c,c=n)):(m=c,c=n)):(m=c,c=n),c}function FX(){var c,d,y;return c=m,t.charCodeAt(m)===37?(d=Z,m++):(d=n,Y===0&&A(Mt)),d!==n?(y=un(),y!==n?(E=c,c=v2(y)):(m=c,c=n)):(m=c,c=n),c}function VX(){var c,d,y,w;return c=m,K(),t.charCodeAt(m)===60?(d=W,m++):(d=n,Y===0&&A(nn)),d!==n?(K(),y=bh(),y!==n?(K(),t.charCodeAt(m)===62?(w=F,m++):(w=n,Y===0&&A(at)),w!==n?(K(),E=c,c=S2(y)):(m=c,c=n)):(m=c,c=n)):(m=c,c=n),c}function un(){var c;return c=hh(),c===n&&(c=wX(),c===n&&(c=WX(),c===n&&(c=VX()))),c}function fh(){var c;return c=CX(),c===n&&(c=zX(),c===n&&(c=MX(),c===n&&(c=RX(),c===n&&(c=LX(),c===n&&(c=xX(),c===n&&(c=vX(),c===n&&(c=SX()))))))),c}function CX(){var c,d,y;return c=m,K(),d=t.charAt(m),wt.test(d)?m++:(d=n,Y===0&&A(vn)),d!==n?(y=ye(),y===n&&(y=null),E=c,c=Y2(y)):(m=c,c=n),c}function LX(){var c,d,y;return c=m,K(),t.charCodeAt(m)===33?(d=z,m++):(d=n,Y===0&&A(ke)),d!==n?(y=ye(),y===n&&(y=null),E=c,c=B2(y)):(m=c,c=n),c}function zX(){var c,d,y,w,B,ft,ne;return c=m,t.charCodeAt(m)===40?(d=v,m++):(d=n,Y===0&&A(nt)),d!==n?(K(),y=Yn(),y!==n?(K(),w=rn(),w!==n?(K(),B=Yn(),B!==n?(K(),rn(),K(),ft=Yn(),ft===n&&(ft=null),K(),t.charCodeAt(m)===41?(ne=x,m++):(ne=n,Y===0&&A(lt)),ne!==n?(E=c,c=k2(y,B,ft)):(m=c,c=n)):(m=c,c=n)):(m=c,c=n)):(m=c,c=n)):(m=c,c=n),c}function MX(){var c,d,y;return c=m,t.charCodeAt(m)===47?(d=R,m++):(d=n,Y===0&&A(yt)),d!==n?(y=un(),y!==n?(E=c,c=T2(y)):(m=c,c=n)):(m=c,c=n),c}function RX(){var c,d,y;return c=m,t.charCodeAt(m)===42?(d=N,m++):(d=n,Y===0&&A(Gt)),d!==n?(y=un(),y!==n?(E=c,c=A2(y)):(m=c,c=n)):(m=c,c=n),c}function xX(){var c,d,y;return c=m,t.charCodeAt(m)===63?(d=O,m++):(d=n,Y===0&&A(Et)),d!==n?(y=ye(),y===n&&(y=null),E=c,c=N2(y)):(m=c,c=n),c}function vX(){var c,d,y;return c=m,t.charCodeAt(m)===58?(d=_,m++):(d=n,Y===0&&A(Te)),d!==n?(y=un(),y!==n?(E=c,c=K2(y)):(m=c,c=n)):(m=c,c=n),c}function SX(){var c,d,y;return c=m,t.substr(m,2)===et?(d=et,m+=2):(d=n,Y===0&&A(ie)),d!==n?(y=un(),y!==n?(E=c,c=H2(y)):(m=c,c=n)):(m=c,c=n),c}function Yn(){var c,d,y,w;if(c=m,d=un(),d!==n){for(y=[],w=fh();w!==n;)y.push(w),w=fh();E=c,c=P2(d,y)}else m=c,c=n;return c}function We(){var c,d,y,w;if(c=m,t.charCodeAt(m)===94?(d=T,m++):(d=n,Y===0&&A(p2)),d===n&&(d=null),y=[],w=Yn(),w!==n)for(;w!==n;)y.push(w),w=Yn();else y=n;return y!==n?(E=c,c=E2(d,y)):(m=c,c=n),c}function mh(){var c,d,y,w,B;if(c=m,d=[],y=m,w=rn(),w!==n?(B=We(),B!==n?y=B:(m=y,y=n)):(m=y,y=n),y!==n)for(;y!==n;)d.push(y),y=m,w=rn(),w!==n?(B=We(),B!==n?y=B:(m=y,y=n)):(m=y,y=n);else d=n;return d!==n&&(E=c,d=D2(d)),c=d,c}function YX(){var c,d,y,w,B;if(c=m,d=[],y=m,w=dh(),w!==n?(B=We(),B!==n?y=B:(m=y,y=n)):(m=y,y=n),y!==n)for(;y!==n;)d.push(y),y=m,w=dh(),w!==n?(B=We(),B!==n?y=B:(m=y,y=n)):(m=y,y=n);else d=n;return d!==n&&(E=c,d=J2(d)),c=d,c}function BX(){var c,d,y,w,B;if(c=m,d=[],y=m,w=ph(),w!==n?(B=We(),B!==n?y=B:(m=y,y=n)):(m=y,y=n),y!==n)for(;y!==n;)d.push(y),y=m,w=ph(),w!==n?(B=We(),B!==n?y=B:(m=y,y=n)):(m=y,y=n);else d=n;return d!==n&&(E=c,d=I2(d)),c=d,c}function yh(){var c,d,y;return c=m,d=We(),d!==n?(y=mh(),y===n&&(y=YX(),y===n&&(y=BX())),y===n&&(y=null),E=c,c=j2(d,y)):(m=c,c=n),c}function bh(){var c,d,y;return c=m,d=We(),d!==n?(y=mh(),y===n&&(y=null),E=c,c=_2(d,y)):(m=c,c=n),c}function kX(){var c,d,y,w;return c=m,K(),d=cn(),d!==n?(K(),y=yh(),y!==n?(K(),w=cn(),w!==n?(E=c,c=O2(y)):(m=c,c=n)):(m=c,c=n)):(m=c,c=n),c}function TX(){var c;return c=JX(),c===n&&(c=HX(),c===n&&(c=DX(),c===n&&(c=NX(),c===n&&(c=KX(),c===n&&(c=AX(),c===n&&(c=EX(),c===n&&(c=PX()))))))),c}function AX(){var c,d,y;return c=m,t.substr(m,6)===ut?(d=ut,m+=6):(d=n,Y===0&&A(h2)),d!==n?(K(),y=an(),y!==n?(E=c,c=U2(y)):(m=c,c=n)):(m=c,c=n),c}function NX(){var c,d,y,w,B;return c=m,t.substr(m,6)===P?(d=P,m+=6):(d=n,Y===0&&A(f2)),d!==n?(K(),y=cn(),y!==n?(w=hh(),w!==n?(B=cn(),B!==n?(E=c,c=Q2(w)):(m=c,c=n)):(m=c,c=n)):(m=c,c=n)):(m=c,c=n),c}function KX(){var c,d,y,w;return c=m,t.substr(m,6)===q?(d=q,m+=6):(d=n,Y===0&&A(m2)),d!==n?(K(),y=cs(),y!==n?(K(),w=cs(),w!==n?(K(),cs(),E=c,c=q2(y,w)):(m=c,c=n)):(m=c,c=n)):(m=c,c=n),c}function HX(){var c,d,y;return c=m,t.substr(m,4)===U?(d=U,m+=4):(d=n,Y===0&&A(y2)),d!==n?(K(),y=ye(),y!==n?(E=c,c=$2(y)):(m=c,c=n)):(m=c,c=n),c}function PX(){var c,d,y;return c=m,t.substr(m,4)===pt?(d=pt,m+=4):(d=n,Y===0&&A(b2)),d!==n?(K(),y=ye(),y!==n?(E=c,c=tX(y)):(m=c,c=n)):(m=c,c=n),c}function EX(){var c,d,y;return c=m,t.substr(m,4)===$?(d=$,m+=4):(d=n,Y===0&&A(g2)),d!==n?(K(),y=ye(),y!==n?(E=c,c=eX(y)):(m=c,c=n)):(m=c,c=n),c}function DX(){var c,d,y;return c=m,t.substr(m,4)===ot?(d=ot,m+=4):(d=n,Y===0&&A(X2)),d!==n?(K(),y=ye(),y!==n?(E=c,c=nX(y)):(m=c,c=n)):(m=c,c=n),c}function JX(){var c,d,y,w,B;if(c=m,t.substr(m,5)===ht?(d=ht,m+=5):(d=n,Y===0&&A(G2)),d!==n)if(K(),y=cn(),y!==n){if(w=[],B=is(),B!==n)for(;B!==n;)w.push(B),B=is();else w=n;w!==n?(B=cn(),B!==n?(E=c,c=sX(w)):(m=c,c=n)):(m=c,c=n)}else m=c,c=n;else m=c,c=n;return c}function Co(){var c,d,y,w;if(c=m,t.substr(m,2)===Ct?(d=Ct,m+=2):(d=n,Y===0&&A(Z2)),d!==n){for(y=[],w=t.charAt(m),Ze.test(w)?m++:(w=n,Y===0&&A(ch));w!==n;)y.push(w),w=t.charAt(m),Ze.test(w)?m++:(w=n,Y===0&&A(ch));d=[d,y],c=d}else m=c,c=n;return c}function IX(){var c,d,y,w,B,ft,ne,ln;if(c=m,t.substr(m,3)===Pt?(d=Pt,m+=3):(d=n,Y===0&&A(w2)),d!==n)if(K(),t.charCodeAt(m)===91?(y=f,m++):(y=n,Y===0&&A(_t)),y!==n)if(K(),w=an(),w!==n){for(B=[],ft=m,ne=rn(),ne!==n?(ln=an(),ln!==n?(E=ft,ft=ih(w,ln)):(m=ft,ft=n)):(m=ft,ft=n);ft!==n;)B.push(ft),ft=m,ne=rn(),ne!==n?(ln=an(),ln!==n?(E=ft,ft=ih(w,ln)):(m=ft,ft=n)):(m=ft,ft=n);ft=K(),t.charCodeAt(m)===93?(ne=b,m++):(ne=n,Y===0&&A(Be)),ne!==n?(E=c,c=oX(w,B)):(m=c,c=n)}else m=c,c=n;else m=c,c=n;else m=c,c=n;return c}function jX(){var c;return c=IX(),c===n&&(c=kX()),c}function an(){var c,d,y,w,B;if(c=m,d=jX(),d!==n){for(K(),y=[],w=Co();w!==n;)y.push(w),w=Co();E=c,c=rX(d)}else m=c,c=n;return c===n&&(c=m,d=TX(),d!==n?(K(),t.charCodeAt(m)===36?(y=Tt,m++):(y=n,Y===0&&A(W2)),y!==n?(w=K(),B=an(),B!==n?(E=c,c=cX(d,B)):(m=c,c=n)):(m=c,c=n)):(m=c,c=n)),c}function _X(){var c,d;return c=m,d=an(),d!==n&&(E=c,d=iX(d)),c=d,c===n&&(c=Co()),c}function OX(){var c;return c=_X(),c}function UX(){var c,d;return c=m,K(),d=QX(),d===n&&(d=qX(),d===n&&(d=$X())),d!==n?(K(),E=c,c=uX(d)):(m=c,c=n),c}function QX(){var c,d,y;return c=m,t.substr(m,6)===H?(d=H,m+=6):(d=n,Y===0&&A(F2)),d!==n?(K(),y=ye(),y!==n?(E=c,c=aX(y)):(m=c,c=n)):(m=c,c=n),c}function qX(){var c,d,y;return c=m,t.substr(m,6)===I?(d=I,m+=6):(d=n,Y===0&&A(V2)),d!==n?(K(),y=ye(),y!==n?(E=c,c=lX(y)):(m=c,c=n)):(m=c,c=n),c}function $X(){var c,d;return c=m,t.substr(m,4)===te?(d=te,m+=4):(d=n,Y===0&&A(C2)),d!==n&&(E=c,d=dX()),c=d,c}function tG(){var c;return c=OX(),c===n&&(c=UX()),c}var eG=function(c){this.type_="atom",this.source_=c,this.location_=uh()},us=function(c,d,y,w){this.type_="pattern",this.arguments_={alignment:d,_steps:w},y!==void 0&&(this.arguments_.seed=y),this.source_=c},nG=function(c,d,y){this.type_=c,this.arguments_=d,this.source_=y},sG=function(c,d){this.type_="element",this.source_=c,this.options_=d,this.location_=uh()},Lo=function(c,d){this.type_="command",this.name_=c,this.options_=d},zo=0;if(Sn=r(),e.peg$library)return{peg$result:Sn,peg$currPos:m,peg$FAILED:n,peg$maxFailExpected:rs,peg$maxFailPos:ee};if(Sn!==n&&m===t.length)return Sn;throw Sn!==n&&m<t.length&&A(hX()),fX(rs,ee<t.length?t.charAt(ee):null,ee<t.length?Vo(ee,ee+1):Vo(ee,ee))}const Lb=["start"],H0=3e-4,zb=(t,e)=>(n,s)=>{const i=t.source_[s].options_?.ops,u=n.__steps_source;if(i)for(const a of i)switch(a.type_){case"stretch":{const l=["fast","slow"],{type:p,amount:f}=a.arguments_;if(!l.includes(p))throw new Error(`mini: stretch: type must be one of ${l.join("|")} but got ${p}`);n=V(n)[p](e(f));break}case"replicate":{const{amount:l}=a.arguments_;n=V(n),n=n._repeatCycles(l)._fast(l);break}case"bjorklund":{a.arguments_.rotation?n=n.euclidRot(e(a.arguments_.pulse),e(a.arguments_.step),e(a.arguments_.rotation)):n=n.euclid(e(a.arguments_.pulse),e(a.arguments_.step));break}case"degradeBy":{n=V(n)._degradeByWith(Rt.early(H0*a.arguments_.seed),a.arguments_.amount??.5);break}case"tail":{const l=e(a.arguments_.element);n=n.fmap(p=>f=>Array.isArray(p)?[...p,f]:[p,f]).appLeft(l);break}case"range":{const l=e(a.arguments_.element);n=V(n);const p=(b,g,X=1)=>Array.from({length:Math.abs(g-b)/X+1},(Z,W)=>b<g?b+W*X:b-W*X);n=((b,g)=>b.squeezeBind(X=>g.bind(Z=>Lt(...p(X,Z)))))(n,l);break}default:console.warn(`operator "${a.type_}" not implemented`)}return n.__steps_source=n.__steps_source||u,n};function Je(t,e,n,s=0){n?.(t);const o=r=>Je(r,e,n,s);switch(t.type_){case"pattern":{const r=t.source_.map(l=>o(l)).map(zb(t,o)),i=t.arguments_.alignment,u=r.filter(l=>l.__steps_source);let a;switch(i){case"stack":{a=mt(...r),u.length&&(a._steps=Ut(...u.map(l=>C(l._steps))));break}case"polymeter_slowcat":{a=mt(...r.map(l=>l._slow(l.__weight))),u.length&&(a._steps=Ut(...u.map(l=>C(l._steps))));break}case"polymeter":{const l=t.arguments_.stepsPerCycle?o(t.arguments_.stepsPerCycle).fmap(f=>C(f)):Xt(C(r.length>0?r[0].__weight:1)),p=r.map(f=>f.fast(l.fmap(b=>b.div(f.__weight))));a=mt(...p);break}case"rand":{a=In(Rt.early(H0*t.arguments_.seed).segment(1),r),u.length&&(a._steps=Ut(...u.map(l=>C(l._steps))));break}case"feet":{a=Lt(...r);break}default:{if(t.source_.some(p=>!!p.options_?.weight)){const p=t.source_.reduce((f,b)=>f.add(b.options_?.weight||C(1)),C(0));a=zs(...t.source_.map((f,b)=>[f.options_?.weight||C(1),r[b]])),a.__weight=p,a._steps=p,u.length&&(a._steps=a._steps.mul(Ut(...u.map(f=>C(f._steps)))))}else a=Qt(...r),a._steps=r.length;t.arguments_._steps&&(a.__steps_source=!0)}}return u.length&&(a.__steps_source=!0),a}case"element":return o(t.source_);case"atom":{if(t.source_==="~"||t.source_==="-")return st;if(!t.location_)return console.warn("no location for",t),t.source_;const r=isNaN(Number(t.source_))?t.source_:Number(t.source_);if(s===-1)return Xt(r);const[i,u]=Os(e,t,s);return Xt(r).withLoc(i,u)}case"stretch":return o(t.source_).slow(o(t.arguments_.amount));default:return console.warn(`node type "${t.type_}" not implemented -> returning silence`),st}}const Os=(t,e,n=0)=>{const{start:s,end:o}=e.location_,r=t?.split("").slice(s.offset,o.offset).join(""),[i=0,u=0]=r?r.split(e.source_).map(a=>a.split("").filter(l=>l===" ").length):[];return[s.offset+i+n,o.offset-u+n]},Xn=(t,e=0,n=t)=>{try{return K0(t)}catch(s){const o=[s.location.start.offset+e,s.location.end.offset+e],r=n.slice(0,o[0]).split(`
`).length;throw new Error(`[mini] parse error at line ${r}: ${s.message}`)}},P0=(t,e,n)=>{const s=Xn(t,e,n);let o=[];return Je(s,t,r=>{r.type_==="atom"&&o.push(r)},-1),o},Mb=(t,e=0,n)=>P0(t,e,n).map(s=>Os(t,s,e)),Us=(...t)=>{const e=t.map(n=>{const s=`"${n}"`,o=Xn(s);return Je(o,s)});return Qt(...e)},Rb=(t,e)=>{const n=`"${t}"`,s=Xn(n);return Je(s,n,null,e)},xb=t=>{const e=Xn(t);return Je(e,t)};function vb(t){return typeof t=="string"?Us(t):V(t)}function E0(){Uo(Us)}const Sb=Object.freeze(Object.defineProperty({__proto__:null,StartRules:Lb,SyntaxError:Ce,getLeafLocation:Os,getLeafLocations:Mb,getLeaves:P0,h:xb,m:Rb,mini:Us,mini2ast:Xn,miniAllStrings:E0,minify:vb,parse:K0,patternifyAST:Je},Symbol.toStringTag,{value:"Module"}));if(typeof DelayNode<"u"){class t extends DelayNode{constructor(n,s,o,r){super(n),s=Math.abs(s),this.delayTime.value=o;const i=n.createGain();i.gain.value=Math.min(Math.abs(r),.995),this.feedback=i.gain;const u=n.createGain();return u.gain.value=s,this.delayGain=u,this.connect(i),this.connect(u),i.connect(this),this.connect=a=>u.connect(a),this}start(n){this.delayGain.gain.setValueAtTime(this.delayGain.gain.value,n+this.delayTime.value)}}AudioContext.prototype.createFeedbackDelay=function(e,n,s){return new t(this,e,n,s)}}var Qs={};Qs.generateReverb=function(t,e){for(var n=t.audioContext||new AudioContext,s=n.sampleRate,o=t.numChannels||2,r=t.decayTime*1.5,i=Math.round(t.decayTime*s),u=Math.round(r*s),a=Math.round((t.fadeInTime||0)*s),l=Math.pow(1/1e3,1/i),p=n.createBuffer(o,u,s),f=0;f<o;f++){for(var b=p.getChannelData(f),g=0;g<u;g++)b[g]=kb()*Math.pow(l,g);for(var g=0;g<a;g++)b[g]*=g/a}Yb(p,t.lpFreqStart||0,t.lpFreqEnd||0,t.decayTime,e)},Qs.generateGraph=function(t,e,n,s,o){var r=document.createElement("canvas");r.width=e,r.height=n;var i=r.getContext("2d");i.fillStyle="#000",i.fillRect(0,0,r.width,r.height),i.fillStyle="#fff";for(var u=e/t.length,a=n/(o-s),l=0;l<t.length;l++)i.fillRect(l*u,n-(t[l]-s)*a,1,1);return r};var Yb=function(t,e,n,s,o){if(e==0){o(t);return}var r=Bb(t),i=new OfflineAudioContext(t.numberOfChannels,r[0].length,t.sampleRate),u=i.createBufferSource();u.buffer=t;var a=i.createBiquadFilter();e=Math.min(e,t.sampleRate/2),n=Math.min(n,t.sampleRate/2),a.type="lowpass",a.Q.value=1e-4,a.frequency.setValueAtTime(e,0),a.frequency.linearRampToValueAtTime(n,s),u.connect(a),a.connect(i.destination),u.start(),i.oncomplete=function(l){o(l.renderedBuffer),a.disconnect(),u.disconnect()},i.startRendering(),window.filterNode=a},Bb=function(t){for(var e=[],n=0;n<t.numberOfChannels;n++)e[n]=t.getChannelData(n);return e},kb=function(){return Math.random()*2-1};let D0=t=>console.log(t);function J0(t,e="superdough"){process.env.NODE_ENV==="development"&&console.error(t),Zt(`[${e}] error: ${t.message}`)}const Zt=(...t)=>D0(...t),I0=t=>{D0=t},Tb=t=>{if(typeof t!="string")return[];const[e,n="",s]=t.match(/^([a-gA-G])([#bsf]*)(-?[0-9]*)$/)?.slice(1)||[];return e?[e,n,s?Number(s):void 0]:[]},Ab={c:0,d:2,e:4,f:5,g:7,a:9,b:11},Nb={"#":1,b:-1,s:1,f:-1},Kb=t=>t?.split("").reduce((e,n)=>e+Nb[n],0)||0,_n=(t,e=3)=>{const[n,s,o=e]=Tb(t);if(!n)throw new Error('not a note: "'+t+'"');const r=Ab[n.toLowerCase()],i=Kb(s);return(Number(o)+1)*12+r+i},j0=t=>Math.pow(2,(t-69)/12)*440,Xe=(t,e,n)=>Math.min(Math.max(t,e),n),Hb=t=>12*Math.log(t/440)/Math.LN2+69,Pb=(t,e)=>{if(typeof t!="object")throw new Error("valueToMidi: expected object value");let{freq:n,note:s}=t;return typeof n=="number"?Hb(n):typeof s=="string"?_n(s):typeof s=="number"?s:e};function le(t,e=0,n){return isNaN(Number(t))?(!n&&Zt(`"${t}" is not a number, falling back to ${e}`,"warning"),e):t}const _0=(t,e)=>(t%e+e)%e,O0=(t,e)=>_0(Math.round(le(t,0)),e);function Eb(t,e){return t/e}function U0(t,e){const{s:n,n:s=0}=t;let o=Pb(t,36),r=o-36,i,u=0;if(Array.isArray(e))u=O0(s,e.length),i=e[u];else{const l=f=>_n(f)-o,p=Object.keys(e).filter(f=>!f.startsWith("_")).reduce((f,b,g)=>!f||Math.abs(l(b))<Math.abs(l(f))?b:f,null);r=-l(p),u=O0(s,e[p].length),i=e[p][u]}const a=`${n}:${u}`;return{transpose:r,url:i,index:u,midi:o,label:a}}const qs=(t,e)=>Object.fromEntries(Object.entries(e).map(([n,s])=>[n,t[s]])),Q0=t=>{try{return new URL(".",new URL(t)).href.replace(/\/$/,"")}catch{return t.split("/").slice(0,-1).join("/")}};typeof AudioContext<"u"&&(AudioContext.prototype.adjustLength=function(t,e,n=1,s=0){const o=Math.floor(Xe(s,0,1)*e.length),r=e.sampleRate*t,i=this.createBuffer(e.numberOfChannels,e.length,e.sampleRate);for(let u=0;u<e.numberOfChannels;u++){let a=e.getChannelData(u),l=i.getChannelData(u);for(let p=0;p<r;p++){let f=(o+p*Math.abs(n))%a.length;n<1&&(f=f*-1),l[p]=a.at(f)||0}}return i},AudioContext.prototype.createReverb=function(t,e,n,s,o,r,i){const u=this.createConvolver();return u.generate=(a=2,l=.1,p=15e3,f=1e3,b,g,X)=>{u.duration=a,u.fade=l,u.lp=p,u.dim=f,u.ir=b,u.irspeed=g,u.irbegin=X,b?u.buffer=this.adjustLength(a,b,g,X):Qs.generateReverb({audioContext:this,numChannels:2,decayTime:a,fadeInTime:l,lpFreqStart:p,lpFreqEnd:f},Z=>{u.buffer=Z})},u.generate(t,e,n,s,o,r,i),u});var q0={a:{freqs:[660,1120,2750,3e3,3350],gains:[1,.5012,.0708,.0631,.0126],qs:[80,90,120,130,140]},e:{freqs:[440,1800,2700,3e3,3300],gains:[1,.1995,.1259,.1,.1],qs:[70,80,100,120,120]},i:{freqs:[270,1850,2900,3350,3590],gains:[1,.0631,.0631,.0158,.0158],qs:[40,90,100,120,120]},o:{freqs:[430,820,2700,3e3,3300],gains:[1,.3162,.0501,.0794,.01995],qs:[40,80,100,120,120]},u:{freqs:[370,630,2750,3e3,3400],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]},ae:{freqs:[650,1515,2400,3e3,3350],gains:[1,.5,.1008,.0631,.0126],qs:[80,90,120,130,140]},aa:{freqs:[560,900,2570,3e3,3300],gains:[1,.5,.0708,.0631,.0126],qs:[80,90,120,130,140]},oe:{freqs:[500,1430,2300,3e3,3300],gains:[1,.2,.0708,.0316,.01995],qs:[40,60,100,120,120]},ue:{freqs:[250,1750,2150,3200,3300],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]},y:{freqs:[400,1460,2400,3e3,3300],gains:[1,.2,.0708,.0316,.02995],qs:[40,60,100,120,120]},uh:{freqs:[600,1250,2100,3100,3500],gains:[1,.3,.0608,.0316,.01995],qs:[40,70,100,120,130]},un:{freqs:[500,1240,2280,3e3,3500],gains:[1,.1,.1708,.0216,.02995],qs:[40,60,100,120,120]},en:{freqs:[600,1480,2450,3200,3300],gains:[1,.15,.0708,.0316,.02995],qs:[40,60,100,120,120]},an:{freqs:[700,1050,2500,3e3,3300],gains:[1,.1,.0708,.0316,.02995],qs:[40,60,100,120,120]},on:{freqs:[500,1080,2350,3e3,3300],gains:[1,.1,.0708,.0316,.02995],qs:[40,60,100,120,120]},get æ(){return this.ae},get ø(){return this.oe},get ɑ(){return this.aa},get å(){return this.aa},get ö(){return this.oe},get ü(){return this.ue},get ı(){return this.y}};if(typeof GainNode<"u"){class t extends GainNode{constructor(n,s){if(super(n),!q0[s])throw new Error("vowel: unknown vowel "+s);const{gains:o,qs:r,freqs:i}=q0[s];this.makeupGain=n.createGain(),this.audioNodes=[];for(let u=0;u<5;u++){const a=n.createGain();a.gain.value=o[u];const l=n.createBiquadFilter();l.type="bandpass",l.Q.value=r[u],l.frequency.value=i[u],super.connect(l),l.connect(a),this.audioNodes.push(l),a.connect(this.makeupGain),this.audioNodes.push(a)}return this.makeupGain.gain.value=8,this}connect(n){this.makeupGain.connect(n)}disconnect(){this.makeupGain.disconnect(),this.audioNodes.forEach(n=>n.disconnect()),super.disconnect(),this.makeupGain=null,this.audioNodes=null}}AudioContext.prototype.createVowelFilter=function(e){return new t(this,e)}}const Db="data:text/javascript;base64,dmFyIF89KGZ1bmN0aW9uKGZ0KXsidXNlIHN0cmljdCI7Y2xhc3Mga3QgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3J7Y29uc3RydWN0b3IodCl7c3VwZXIodCksdGhpcy5zdGFydGVkPSExLHRoaXMubmJJbnB1dHM9dC5udW1iZXJPZklucHV0cyx0aGlzLm5iT3V0cHV0cz10Lm51bWJlck9mT3V0cHV0cyx0aGlzLmJsb2NrU2l6ZT10LnByb2Nlc3Nvck9wdGlvbnMuYmxvY2tTaXplLHRoaXMuaG9wU2l6ZT0xMjgsdGhpcy5uYk92ZXJsYXBzPXRoaXMuYmxvY2tTaXplL3RoaXMuaG9wU2l6ZSx0aGlzLmlucHV0QnVmZmVycz1uZXcgQXJyYXkodGhpcy5uYklucHV0cyksdGhpcy5pbnB1dEJ1ZmZlcnNIZWFkPW5ldyBBcnJheSh0aGlzLm5iSW5wdXRzKSx0aGlzLmlucHV0QnVmZmVyc1RvU2VuZD1uZXcgQXJyYXkodGhpcy5uYklucHV0cyk7Zm9yKGxldCBlPTA7ZTx0aGlzLm5iSW5wdXRzO2UrKyl0aGlzLmFsbG9jYXRlSW5wdXRDaGFubmVscyhlLDEpO3RoaXMub3V0cHV0QnVmZmVycz1uZXcgQXJyYXkodGhpcy5uYk91dHB1dHMpLHRoaXMub3V0cHV0QnVmZmVyc1RvUmV0cmlldmU9bmV3IEFycmF5KHRoaXMubmJPdXRwdXRzKTtmb3IobGV0IGU9MDtlPHRoaXMubmJPdXRwdXRzO2UrKyl0aGlzLmFsbG9jYXRlT3V0cHV0Q2hhbm5lbHMoZSwxKX1yZWFsbG9jYXRlQ2hhbm5lbHNJZk5lZWRlZCh0LGUpe2ZvcihsZXQgcz0wO3M8dGhpcy5uYklucHV0cztzKyspe2xldCByPXRbc10ubGVuZ3RoO3IhPXRoaXMuaW5wdXRCdWZmZXJzW3NdLmxlbmd0aCYmdGhpcy5hbGxvY2F0ZUlucHV0Q2hhbm5lbHMocyxyKX1mb3IobGV0IHM9MDtzPHRoaXMubmJPdXRwdXRzO3MrKyl7bGV0IHI9ZVtzXS5sZW5ndGg7ciE9dGhpcy5vdXRwdXRCdWZmZXJzW3NdLmxlbmd0aCYmdGhpcy5hbGxvY2F0ZU91dHB1dENoYW5uZWxzKHMscil9fWFsbG9jYXRlSW5wdXRDaGFubmVscyh0LGUpe3RoaXMuaW5wdXRCdWZmZXJzW3RdPW5ldyBBcnJheShlKTtmb3IobGV0IHM9MDtzPGU7cysrKXRoaXMuaW5wdXRCdWZmZXJzW3RdW3NdPW5ldyBGbG9hdDMyQXJyYXkodGhpcy5ibG9ja1NpemUrMTI4KSx0aGlzLmlucHV0QnVmZmVyc1t0XVtzXS5maWxsKDApO3RoaXMuaW5wdXRCdWZmZXJzSGVhZFt0XT1uZXcgQXJyYXkoZSksdGhpcy5pbnB1dEJ1ZmZlcnNUb1NlbmRbdF09bmV3IEFycmF5KGUpO2ZvcihsZXQgcz0wO3M8ZTtzKyspdGhpcy5pbnB1dEJ1ZmZlcnNIZWFkW3RdW3NdPXRoaXMuaW5wdXRCdWZmZXJzW3RdW3NdLnN1YmFycmF5KDAsdGhpcy5ibG9ja1NpemUpLHRoaXMuaW5wdXRCdWZmZXJzVG9TZW5kW3RdW3NdPW5ldyBGbG9hdDMyQXJyYXkodGhpcy5ibG9ja1NpemUpfWFsbG9jYXRlT3V0cHV0Q2hhbm5lbHModCxlKXt0aGlzLm91dHB1dEJ1ZmZlcnNbdF09bmV3IEFycmF5KGUpO2ZvcihsZXQgcz0wO3M8ZTtzKyspdGhpcy5vdXRwdXRCdWZmZXJzW3RdW3NdPW5ldyBGbG9hdDMyQXJyYXkodGhpcy5ibG9ja1NpemUpLHRoaXMub3V0cHV0QnVmZmVyc1t0XVtzXS5maWxsKDApO3RoaXMub3V0cHV0QnVmZmVyc1RvUmV0cmlldmVbdF09bmV3IEFycmF5KGUpO2ZvcihsZXQgcz0wO3M8ZTtzKyspdGhpcy5vdXRwdXRCdWZmZXJzVG9SZXRyaWV2ZVt0XVtzXT1uZXcgRmxvYXQzMkFycmF5KHRoaXMuYmxvY2tTaXplKSx0aGlzLm91dHB1dEJ1ZmZlcnNUb1JldHJpZXZlW3RdW3NdLmZpbGwoMCl9cmVhZElucHV0cyh0KXtpZih0WzBdLmxlbmd0aCYmdFswXVswXS5sZW5ndGg9PTApe2ZvcihsZXQgZT0wO2U8dGhpcy5uYklucHV0cztlKyspZm9yKGxldCBzPTA7czx0aGlzLmlucHV0QnVmZmVyc1tlXS5sZW5ndGg7cysrKXRoaXMuaW5wdXRCdWZmZXJzW2VdW3NdLmZpbGwoMCx0aGlzLmJsb2NrU2l6ZSk7cmV0dXJufWZvcihsZXQgZT0wO2U8dGhpcy5uYklucHV0cztlKyspZm9yKGxldCBzPTA7czx0aGlzLmlucHV0QnVmZmVyc1tlXS5sZW5ndGg7cysrKXtsZXQgcj10W2VdW3NdO3RoaXMuaW5wdXRCdWZmZXJzW2VdW3NdLnNldChyLHRoaXMuYmxvY2tTaXplKX19d3JpdGVPdXRwdXRzKHQpe2ZvcihsZXQgZT0wO2U8dGhpcy5uYklucHV0cztlKyspZm9yKGxldCBzPTA7czx0aGlzLmlucHV0QnVmZmVyc1tlXS5sZW5ndGg7cysrKXtsZXQgcj10aGlzLm91dHB1dEJ1ZmZlcnNbZV1bc10uc3ViYXJyYXkoMCwxMjgpO3RbZV1bc10uc2V0KHIpfX1zaGlmdElucHV0QnVmZmVycygpe2ZvcihsZXQgdD0wO3Q8dGhpcy5uYklucHV0czt0KyspZm9yKGxldCBlPTA7ZTx0aGlzLmlucHV0QnVmZmVyc1t0XS5sZW5ndGg7ZSsrKXRoaXMuaW5wdXRCdWZmZXJzW3RdW2VdLmNvcHlXaXRoaW4oMCwxMjgpfXNoaWZ0T3V0cHV0QnVmZmVycygpe2ZvcihsZXQgdD0wO3Q8dGhpcy5uYk91dHB1dHM7dCsrKWZvcihsZXQgZT0wO2U8dGhpcy5vdXRwdXRCdWZmZXJzW3RdLmxlbmd0aDtlKyspdGhpcy5vdXRwdXRCdWZmZXJzW3RdW2VdLmNvcHlXaXRoaW4oMCwxMjgpLHRoaXMub3V0cHV0QnVmZmVyc1t0XVtlXS5zdWJhcnJheSh0aGlzLmJsb2NrU2l6ZS0xMjgpLmZpbGwoMCl9cHJlcGFyZUlucHV0QnVmZmVyc1RvU2VuZCgpe2ZvcihsZXQgdD0wO3Q8dGhpcy5uYklucHV0czt0KyspZm9yKGxldCBlPTA7ZTx0aGlzLmlucHV0QnVmZmVyc1t0XS5sZW5ndGg7ZSsrKXRoaXMuaW5wdXRCdWZmZXJzVG9TZW5kW3RdW2VdLnNldCh0aGlzLmlucHV0QnVmZmVyc0hlYWRbdF1bZV0pfWhhbmRsZU91dHB1dEJ1ZmZlcnNUb1JldHJpZXZlKCl7Zm9yKGxldCB0PTA7dDx0aGlzLm5iT3V0cHV0czt0KyspZm9yKGxldCBlPTA7ZTx0aGlzLm91dHB1dEJ1ZmZlcnNbdF0ubGVuZ3RoO2UrKylmb3IobGV0IHM9MDtzPHRoaXMuYmxvY2tTaXplO3MrKyl0aGlzLm91dHB1dEJ1ZmZlcnNbdF1bZV1bc10rPXRoaXMub3V0cHV0QnVmZmVyc1RvUmV0cmlldmVbdF1bZV1bc10vdGhpcy5uYk92ZXJsYXBzfXByb2Nlc3ModCxlLHMpe2NvbnN0IGk9dFswXVswXSE9PXZvaWQgMDtyZXR1cm4gdGhpcy5zdGFydGVkJiYhaT8hMToodGhpcy5zdGFydGVkPWksdGhpcy5yZWFsbG9jYXRlQ2hhbm5lbHNJZk5lZWRlZCh0LGUpLHRoaXMucmVhZElucHV0cyh0KSx0aGlzLnNoaWZ0SW5wdXRCdWZmZXJzKCksdGhpcy5wcmVwYXJlSW5wdXRCdWZmZXJzVG9TZW5kKCksdGhpcy5wcm9jZXNzT0xBKHRoaXMuaW5wdXRCdWZmZXJzVG9TZW5kLHRoaXMub3V0cHV0QnVmZmVyc1RvUmV0cmlldmUscyksdGhpcy5oYW5kbGVPdXRwdXRCdWZmZXJzVG9SZXRyaWV2ZSgpLHRoaXMud3JpdGVPdXRwdXRzKGUpLHRoaXMuc2hpZnRPdXRwdXRCdWZmZXJzKCksITApfXByb2Nlc3NPTEEodCxlLHMpe2NvbnNvbGUuYXNzZXJ0KCExLCJOb3Qgb3ZlcnJpZGVuIil9fWNsYXNzIEV0e2NvbnN0cnVjdG9yKHQpe2lmKHRoaXMuc2l6ZT10fDAsdGhpcy5zaXplPD0xfHwodGhpcy5zaXplJnRoaXMuc2l6ZS0xKSE9PTApdGhyb3cgbmV3IEVycm9yKCJGRlQgc2l6ZSBtdXN0IGJlIGEgcG93ZXIgb2YgdHdvIGFuZCBiaWdnZXIgdGhhbiAxIik7dGhpcy5fY3NpemU9dDw8MTtmb3IodmFyIGU9bmV3IEFycmF5KHRoaXMuc2l6ZSoyKSxzPTA7czxlLmxlbmd0aDtzKz0yKXtjb25zdCBjPU1hdGguUEkqcy90aGlzLnNpemU7ZVtzXT1NYXRoLmNvcyhjKSxlW3MrMV09LU1hdGguc2luKGMpfXRoaXMudGFibGU9ZTtmb3IodmFyIHI9MCxpPTE7dGhpcy5zaXplPmk7aTw8PTEpcisrO3RoaXMuX3dpZHRoPXIlMj09PTA/ci0xOnIsdGhpcy5fYml0cmV2PW5ldyBBcnJheSgxPDx0aGlzLl93aWR0aCk7Zm9yKHZhciBvPTA7bzx0aGlzLl9iaXRyZXYubGVuZ3RoO28rKyl7dGhpcy5fYml0cmV2W29dPTA7Zm9yKHZhciBhPTA7YTx0aGlzLl93aWR0aDthKz0yKXt2YXIgdT10aGlzLl93aWR0aC1hLTI7dGhpcy5fYml0cmV2W29dfD0obz4+PmEmMyk8PHV9fXRoaXMuX291dD1udWxsLHRoaXMuX2RhdGE9bnVsbCx0aGlzLl9pbnY9MH1mcm9tQ29tcGxleEFycmF5KHQsZSl7Zm9yKHZhciBzPWV8fG5ldyBBcnJheSh0Lmxlbmd0aD4+PjEpLHI9MDtyPHQubGVuZ3RoO3IrPTIpc1tyPj4+MV09dFtyXTtyZXR1cm4gc31jcmVhdGVDb21wbGV4QXJyYXkoKXtjb25zdCB0PW5ldyBBcnJheSh0aGlzLl9jc2l6ZSk7Zm9yKHZhciBlPTA7ZTx0Lmxlbmd0aDtlKyspdFtlXT0wO3JldHVybiB0fXRvQ29tcGxleEFycmF5KHQsZSl7Zm9yKHZhciBzPWV8fHRoaXMuY3JlYXRlQ29tcGxleEFycmF5KCkscj0wO3I8cy5sZW5ndGg7cis9MilzW3JdPXRbcj4+PjFdLHNbcisxXT0wO3JldHVybiBzfWNvbXBsZXRlU3BlY3RydW0odCl7Zm9yKHZhciBlPXRoaXMuX2NzaXplLHM9ZT4+PjEscj0yO3I8cztyKz0yKXRbZS1yXT10W3JdLHRbZS1yKzFdPS10W3IrMV19dHJhbnNmb3JtKHQsZSl7aWYodD09PWUpdGhyb3cgbmV3IEVycm9yKCJJbnB1dCBhbmQgb3V0cHV0IGJ1ZmZlcnMgbXVzdCBiZSBkaWZmZXJlbnQiKTt0aGlzLl9vdXQ9dCx0aGlzLl9kYXRhPWUsdGhpcy5faW52PTAsdGhpcy5fdHJhbnNmb3JtNCgpLHRoaXMuX291dD1udWxsLHRoaXMuX2RhdGE9bnVsbH1yZWFsVHJhbnNmb3JtKHQsZSl7aWYodD09PWUpdGhyb3cgbmV3IEVycm9yKCJJbnB1dCBhbmQgb3V0cHV0IGJ1ZmZlcnMgbXVzdCBiZSBkaWZmZXJlbnQiKTt0aGlzLl9vdXQ9dCx0aGlzLl9kYXRhPWUsdGhpcy5faW52PTAsdGhpcy5fcmVhbFRyYW5zZm9ybTQoKSx0aGlzLl9vdXQ9bnVsbCx0aGlzLl9kYXRhPW51bGx9aW52ZXJzZVRyYW5zZm9ybSh0LGUpe2lmKHQ9PT1lKXRocm93IG5ldyBFcnJvcigiSW5wdXQgYW5kIG91dHB1dCBidWZmZXJzIG11c3QgYmUgZGlmZmVyZW50Iik7dGhpcy5fb3V0PXQsdGhpcy5fZGF0YT1lLHRoaXMuX2ludj0xLHRoaXMuX3RyYW5zZm9ybTQoKTtmb3IodmFyIHM9MDtzPHQubGVuZ3RoO3MrKyl0W3NdLz10aGlzLnNpemU7dGhpcy5fb3V0PW51bGwsdGhpcy5fZGF0YT1udWxsfV90cmFuc2Zvcm00KCl7dmFyIHQ9dGhpcy5fb3V0LGU9dGhpcy5fY3NpemUscz10aGlzLl93aWR0aCxyPTE8PHMsaT1lL3I8PDEsbyxhLHU9dGhpcy5fYml0cmV2O2lmKGk9PT00KWZvcihvPTAsYT0wO288ZTtvKz1pLGErKyl7Y29uc3QgbT11W2FdO3RoaXMuX3NpbmdsZVRyYW5zZm9ybTIobyxtLHIpfWVsc2UgZm9yKG89MCxhPTA7bzxlO28rPWksYSsrKXtjb25zdCBtPXVbYV07dGhpcy5fc2luZ2xlVHJhbnNmb3JtNChvLG0scil9dmFyIGM9dGhpcy5faW52Py0xOjEsaD10aGlzLnRhYmxlO2ZvcihyPj49MjtyPj0yO3I+Pj0yKXtpPWUvcjw8MTt2YXIgZj1pPj4+Mjtmb3Iobz0wO288ZTtvKz1pKWZvcih2YXIgZD1vK2YsbD1vLHA9MDtsPGQ7bCs9MixwKz1yKXtjb25zdCBtPWwsST1tK2YsZz1JK2Ysdj1nK2Ysdz10W21dLFA9dFttKzFdLFM9dFtJXSxWPXRbSSsxXSxNPXRbZ10seD10W2crMV0seT10W3ZdLEE9dFt2KzFdLFc9dyxOPVAsRT1oW3BdLE89YypoW3ArMV0sRj1TKkUtVipPLEQ9UypPK1YqRSxMPWhbMipwXSxDPWMqaFsyKnArMV0sZXQ9TSpMLXgqQyxzdD1NKkMreCpMLHJ0PWhbMypwXSxudD1jKmhbMypwKzFdLGl0PXkqcnQtQSpudCxvdD15Km50K0EqcnQsYXQ9VytldCwkPU4rc3QsRz1XLWV0LGN0PU4tc3QsdXQ9RitpdCxRPUQrb3QsSj1jKihGLWl0KSxodD1jKihELW90KSxsdD1hdCt1dCxidD0kK1EsSXQ9YXQtdXQsX3Q9JC1RLEJ0PUcraHQsd3Q9Y3QtSixUdD1HLWh0LFB0PWN0K0o7dFttXT1sdCx0W20rMV09YnQsdFtJXT1CdCx0W0krMV09d3QsdFtnXT1JdCx0W2crMV09X3QsdFt2XT1UdCx0W3YrMV09UHR9fX1fc2luZ2xlVHJhbnNmb3JtMih0LGUscyl7Y29uc3Qgcj10aGlzLl9vdXQsaT10aGlzLl9kYXRhLG89aVtlXSxhPWlbZSsxXSx1PWlbZStzXSxjPWlbZStzKzFdLGg9byt1LGY9YStjLGQ9by11LGw9YS1jO3JbdF09aCxyW3QrMV09ZixyW3QrMl09ZCxyW3QrM109bH1fc2luZ2xlVHJhbnNmb3JtNCh0LGUscyl7Y29uc3Qgcj10aGlzLl9vdXQsaT10aGlzLl9kYXRhLG89dGhpcy5faW52Py0xOjEsYT1zKjIsdT1zKjMsYz1pW2VdLGg9aVtlKzFdLGY9aVtlK3NdLGQ9aVtlK3MrMV0sbD1pW2UrYV0scD1pW2UrYSsxXSxtPWlbZSt1XSxJPWlbZSt1KzFdLGc9YytsLHY9aCtwLHc9Yy1sLFA9aC1wLFM9ZittLFY9ZCtJLE09byooZi1tKSx4PW8qKGQtSSkseT1nK1MsQT12K1YsVz13K3gsTj1QLU0sRT1nLVMsTz12LVYsRj13LXgsRD1QK007clt0XT15LHJbdCsxXT1BLHJbdCsyXT1XLHJbdCszXT1OLHJbdCs0XT1FLHJbdCs1XT1PLHJbdCs2XT1GLHJbdCs3XT1EfV9yZWFsVHJhbnNmb3JtNCgpe3ZhciB0PXRoaXMuX291dCxlPXRoaXMuX2NzaXplLHM9dGhpcy5fd2lkdGgscj0xPDxzLGk9ZS9yPDwxLG8sYSx1PXRoaXMuX2JpdHJldjtpZihpPT09NClmb3Iobz0wLGE9MDtvPGU7bys9aSxhKyspe2NvbnN0IE10PXVbYV07dGhpcy5fc2luZ2xlUmVhbFRyYW5zZm9ybTIobyxNdD4+PjEscj4+PjEpfWVsc2UgZm9yKG89MCxhPTA7bzxlO28rPWksYSsrKXtjb25zdCBNdD11W2FdO3RoaXMuX3NpbmdsZVJlYWxUcmFuc2Zvcm00KG8sTXQ+Pj4xLHI+Pj4xKX12YXIgYz10aGlzLl9pbnY/LTE6MSxoPXRoaXMudGFibGU7Zm9yKHI+Pj0yO3I+PTI7cj4+PTIpe2k9ZS9yPDwxO3ZhciBmPWk+Pj4xLGQ9Zj4+PjEsbD1kPj4+MTtmb3Iobz0wO288ZTtvKz1pKWZvcih2YXIgcD0wLG09MDtwPD1sO3ArPTIsbSs9cil7dmFyIEk9bytwLGc9SStkLHY9ZytkLHc9ditkLFA9dFtJXSxTPXRbSSsxXSxWPXRbZ10sTT10W2crMV0seD10W3ZdLHk9dFt2KzFdLEE9dFt3XSxXPXRbdysxXSxOPVAsRT1TLE89aFttXSxGPWMqaFttKzFdLEQ9VipPLU0qRixMPVYqRitNKk8sQz1oWzIqbV0sZXQ9YypoWzIqbSsxXSxzdD14KkMteSpldCxydD14KmV0K3kqQyxudD1oWzMqbV0saXQ9YypoWzMqbSsxXSxvdD1BKm50LVcqaXQsYXQ9QSppdCtXKm50LCQ9TitzdCxHPUUrcnQsY3Q9Ti1zdCx1dD1FLXJ0LFE9RCtvdCxKPUwrYXQsaHQ9YyooRC1vdCksbHQ9YyooTC1hdCksYnQ9JCtRLEl0PUcrSixfdD1jdCtsdCxCdD11dC1odDtpZih0W0ldPWJ0LHRbSSsxXT1JdCx0W2ddPV90LHRbZysxXT1CdCxwPT09MCl7dmFyIHd0PSQtUSxUdD1HLUo7dFt2XT13dCx0W3YrMV09VHQ7Y29udGludWV9aWYocCE9PWwpe3ZhciBQdD1jdCxnZT0tdXQsYmU9JCxJZT0tRyxfZT0tYypsdCxCZT0tYypodCx3ZT0tYypKLFRlPS1jKlEsUGU9UHQrX2UsTWU9Z2UrQmUsU2U9YmUrVGUsVmU9SWUtd2UsQ3Q9bytkLXAsUnQ9bytmLXA7dFtDdF09UGUsdFtDdCsxXT1NZSx0W1J0XT1TZSx0W1J0KzFdPVZlfX19fV9zaW5nbGVSZWFsVHJhbnNmb3JtMih0LGUscyl7Y29uc3Qgcj10aGlzLl9vdXQsaT10aGlzLl9kYXRhLG89aVtlXSxhPWlbZStzXSx1PW8rYSxjPW8tYTtyW3RdPXUsclt0KzFdPTAsclt0KzJdPWMsclt0KzNdPTB9X3NpbmdsZVJlYWxUcmFuc2Zvcm00KHQsZSxzKXtjb25zdCByPXRoaXMuX291dCxpPXRoaXMuX2RhdGEsbz10aGlzLl9pbnY/LTE6MSxhPXMqMix1PXMqMyxjPWlbZV0saD1pW2Urc10sZj1pW2UrYV0sZD1pW2UrdV0sbD1jK2YscD1jLWYsbT1oK2QsST1vKihoLWQpLGc9bCttLHY9cCx3PS1JLFA9bC1tLFM9cCxWPUk7clt0XT1nLHJbdCsxXT0wLHJbdCsyXT12LHJbdCszXT13LHJbdCs0XT1QLHJbdCs1XT0wLHJbdCs2XT1TLHJbdCs3XT1WfX1sZXQgRHQ9bj0+Y29uc29sZS5sb2cobik7Y29uc3QgenQ9KC4uLm4pPT5EdCguLi5uKSxXdD0obix0LGUpPT5NYXRoLm1pbihNYXRoLm1heChuLHQpLGUpLFN0PW49Pm4vKDErbikscXQ9KG4sdCk9PihuJXQrdCkldCxMdD0obix0KT0+KDErdCkqbi8oMSt0Kk1hdGguYWJzKG4pKSxZPShuLHQpPT5NYXRoLnRhbmgobiooMSt0KSksWXQ9KG4sdCk9Pld0KCgxK3QpKm4sLTEsMSksVnQ9KG4sdCk9PntsZXQgZT0oMSsuNSp0KSpuO2NvbnN0IHM9cXQoZSsxLDQpO3JldHVybiAxLU1hdGguYWJzKHMtMil9LGp0PShuLHQpPT5NYXRoLnNpbihNYXRoLlBJLzIqVnQobix0KSksSHQ9KG4sdCk9Pntjb25zdCBlPVN0KE1hdGgubG9nMXAodCkpLHM9KG4tZS8zKm4qbipuKS8oMS1lLzMpO3JldHVybiBZKHMsdCl9LHh0PShuLHQsZT0hMSk9Pntjb25zdCBzPTErMip0LGk9LjA3KlN0KE1hdGgubG9nMXAodCkpLG89WShuK2ksMip0KSxhPVkoZT9pOi1uK2ksMip0KSx1PW8tYSxjPTEvTWF0aC5jb3NoKHMqaSksaD1jKmMsZj1NYXRoLm1heCgxZS04LChlPzE6MikqcypoKTtyZXR1cm4gWSh1L2YsdCl9LHl0PXtzY3VydmU6THQsc29mdDpZLGhhcmQ6WXQsY3ViaWM6SHQsZGlvZGU6eHQsYXN5bToobix0KT0+eHQobix0LCEwKSxmb2xkOlZ0LHNpbmVmb2xkOmp0LGNoZWJ5c2hldjoobix0KT0+e2NvbnN0IGU9MTAqTWF0aC5sb2cxcCh0KTtsZXQgcz0xLHI9bixpLG89MDtmb3IobGV0IGE9MTthPDY0O2ErKyl7aWYoYTwyKXtvKz1hPT0wP3M6cjtjb250aW51ZX1pPTIqbipzLXIscj1zLHM9aSxhJTI9PT0wJiYobys9TWF0aC5taW4oMS4zKmUvYSwyKSppKX1yZXR1cm4gWShvLGUvMjApfX0sWD1PYmplY3QuZnJlZXplKE9iamVjdC5rZXlzKHl0KSksS3Q9bj0+e2xldCB0PW47dHlwZW9mIG49PSJzdHJpbmciJiYodD1YLmluZGV4T2YobiksdD09PS0xJiYoenQoYFtzdXBlcmRvdWdoXSBDb3VsZCBub3QgZmluZCB3YXZlc2hhcGluZyBhbGdvcml0aG0gJHtufS4KICAgICAgICBBdmFpbGFibGUgb3B0aW9ucyBhcmUgJHtYLmpvaW4oIiwgIil9LgogICAgICAgIERlZmF1bHRpbmcgdG8gJHtYWzBdfS5gKSx0PTApKTtjb25zdCBlPVhbdCVYLmxlbmd0aF07cmV0dXJuIHl0W2VdfSxqPTEyOCxSPU1hdGguUEksaz0yKlIscT0xL3NhbXBsZVJhdGUsVD0obix0LGUpPT5NYXRoLm1pbihNYXRoLm1heChuLHQpLGUpLFV0PShuLHQsZSk9PmUqKHQtbikrbixiPShuLHQpPT5uW3RdPz9uWzBdLEg9bj0+bi1NYXRoLmZsb29yKG4pLEs9bj0+bnwwLFU9bj0+SyhuKy41KSxadD1uPT5LKG4rMSksQXQ9bj0+bi1LKG4pLHo9bj0+e2NvbnN0IHQ9bioqMjtyZXR1cm4gbiooMjcrdCkvKDI3KzkqdCl9LE50PShuLHQpPT57aWYobjwyKXJldHVybiByPT4wO2NvbnN0IGU9dC8obi0xKSxzPXQqLjU7cmV0dXJuIHI9PnIqZS1zfSxaPShuLHQpPT5uKk1hdGgucG93KDIsdC8xMik7ZnVuY3Rpb24gJHQobix0KXt0PU1hdGgubWluKHQsMS10KTtjb25zdCBlPTEvdDtyZXR1cm4gbjx0PyhuKj1lLDIqbi1uKioyLTEpOm4+MS10PyhuPShuLTEpKmUsbioqMisyKm4rMSk6MH1jb25zdCBkdD17dHJpKG4sdD0uNSl7Y29uc3QgZT0xLXQ7cmV0dXJuIG4+PXQ/MS9lLW4vZTpuL3R9LHNpbmUobil7cmV0dXJuIE1hdGguc2luKGsqbikqLjUrLjV9LHJhbXAobil7cmV0dXJuIG59LHNhdyhuKXtyZXR1cm4gMS1ufSxzcXVhcmUobix0PS41KXtyZXR1cm4gbj49dD8wOjF9LGN1c3RvbShuLHQ9WzAsMV0pe2NvbnN0IGU9dC5sZW5ndGgtMSxzPU1hdGguZmxvb3IobiplKSxyPTEvZSxpPVQodFtzXSwwLDEpLGE9VCh0W3MrMV0sMCwxKSx1PWksYz0wLGg9cjtyZXR1cm4oYS11KS8oaC1jKSoobi1yKnMpK2l9LHNhd2JsZXAobix0KXtyZXR1cm4gMipuLTEtJHQobix0KX19LEd0PU9iamVjdC5rZXlzKGR0KTtjbGFzcyBRdCBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3NvcntzdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCl7cmV0dXJuW3tuYW1lOiJiZWdpbiIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJ0aW1lIixkZWZhdWx0VmFsdWU6MH0se25hbWU6ImVuZCIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJmcmVxdWVuY3kiLGRlZmF1bHRWYWx1ZTouNX0se25hbWU6InNrZXciLGRlZmF1bHRWYWx1ZTouNX0se25hbWU6ImRlcHRoIixkZWZhdWx0VmFsdWU6MX0se25hbWU6InBoYXNlb2Zmc2V0IixkZWZhdWx0VmFsdWU6MH0se25hbWU6InNoYXBlIixkZWZhdWx0VmFsdWU6MH0se25hbWU6ImN1cnZlIixkZWZhdWx0VmFsdWU6MX0se25hbWU6ImRjb2Zmc2V0IixkZWZhdWx0VmFsdWU6MH0se25hbWU6Im1pbiIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJtYXgiLGRlZmF1bHRWYWx1ZToxfV19Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMucGhhc2V9aW5jcmVtZW50UGhhc2UodCl7dGhpcy5waGFzZSs9dCx0aGlzLnBoYXNlPjEmJih0aGlzLnBoYXNlPXRoaXMucGhhc2UtMSl9cHJvY2Vzcyh0LGUscyl7Y29uc3Qgcj1zLmJlZ2luWzBdO2lmKGN1cnJlbnRUaW1lPj1zLmVuZFswXSlyZXR1cm4hMTtpZihjdXJyZW50VGltZTw9cilyZXR1cm4hMDtjb25zdCBpPWVbMF0sbz1zLmZyZXF1ZW5jeVswXSxhPXMudGltZVswXSx1PXMuZGVwdGhbMF0sYz1zLnNrZXdbMF0saD1zLnBoYXNlb2Zmc2V0WzBdLGY9cy5jdXJ2ZVswXSxkPXMuZGNvZmZzZXRbMF0sbD1zLm1pblswXSxwPXMubWF4WzBdLG09R3Rbcy5zaGFwZVswXV0sST1pWzBdLmxlbmd0aD8/MDt0aGlzLnBoYXNlPT1udWxsJiYodGhpcy5waGFzZT1BdChhKm8raCkpO2NvbnN0IGc9bypxO2ZvcihsZXQgdj0wO3Y8STt2Kyspe2ZvcihsZXQgdz0wO3c8aS5sZW5ndGg7dysrKXtsZXQgUD0oZHRbbV0odGhpcy5waGFzZSxjKStkKSp1O1A9TWF0aC5wb3coUCxmKSxpW3ddW3ZdPVQoUCxsLHApfXRoaXMuaW5jcmVtZW50UGhhc2UoZyl9cmV0dXJuITB9fXJlZ2lzdGVyUHJvY2Vzc29yKCJsZm8tcHJvY2Vzc29yIixRdCk7Y2xhc3MgSnQgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3J7c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToiY29hcnNlIixkZWZhdWx0VmFsdWU6MX1dfWNvbnN0cnVjdG9yKCl7c3VwZXIoKSx0aGlzLnN0YXJ0ZWQ9ITF9cHJvY2Vzcyh0LGUscyl7Y29uc3Qgcj10WzBdLGk9ZVswXSxvPXJbMF0hPT12b2lkIDA7aWYodGhpcy5zdGFydGVkJiYhbylyZXR1cm4hMTt0aGlzLnN0YXJ0ZWQ9bztsZXQgYT1zLmNvYXJzZVswXT8/MDthPU1hdGgubWF4KDEsYSk7Zm9yKGxldCB1PTA7dTxqO3UrKylmb3IobGV0IGM9MDtjPHIubGVuZ3RoO2MrKylpW2NdW3VdPXUlYT09PTA/cltjXVt1XTppW2NdW3UtMV07cmV0dXJuITB9fXJlZ2lzdGVyUHJvY2Vzc29yKCJjb2Fyc2UtcHJvY2Vzc29yIixKdCk7Y2xhc3MgWHQgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3J7c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToiY3J1c2giLGRlZmF1bHRWYWx1ZTowfV19Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMuc3RhcnRlZD0hMX1wcm9jZXNzKHQsZSxzKXtjb25zdCByPXRbMF0saT1lWzBdLG89clswXSE9PXZvaWQgMDtpZih0aGlzLnN0YXJ0ZWQmJiFvKXJldHVybiExO3RoaXMuc3RhcnRlZD1vO2xldCBhPXMuY3J1c2hbMF0/Pzg7YT1NYXRoLm1heCgxLGEpO2ZvcihsZXQgdT0wO3U8ajt1KyspZm9yKGxldCBjPTA7YzxyLmxlbmd0aDtjKyspe2NvbnN0IGg9TWF0aC5wb3coMixhLTEpO2lbY11bdV09TWF0aC5yb3VuZChyW2NdW3VdKmgpL2h9cmV0dXJuITB9fXJlZ2lzdGVyUHJvY2Vzc29yKCJjcnVzaC1wcm9jZXNzb3IiLFh0KTtjbGFzcyB0ZSBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3NvcntzdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCl7cmV0dXJuW3tuYW1lOiJzaGFwZSIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJwb3N0Z2FpbiIsZGVmYXVsdFZhbHVlOjF9XX1jb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5zdGFydGVkPSExfXByb2Nlc3ModCxlLHMpe2NvbnN0IHI9dFswXSxpPWVbMF0sbz1yWzBdIT09dm9pZCAwO2lmKHRoaXMuc3RhcnRlZCYmIW8pcmV0dXJuITE7dGhpcy5zdGFydGVkPW87bGV0IGE9cy5zaGFwZVswXTthPWE8MT9hOi45OTk5OTk5OTk2LGE9MiphLygxLWEpO2NvbnN0IHU9TWF0aC5tYXgoLjAwMSxNYXRoLm1pbigxLHMucG9zdGdhaW5bMF0pKTtmb3IobGV0IGM9MDtjPGo7YysrKWZvcihsZXQgaD0wO2g8ci5sZW5ndGg7aCsrKWlbaF1bY109KDErYSkqcltoXVtjXS8oMSthKk1hdGguYWJzKHJbaF1bY10pKSp1O3JldHVybiEwfX1yZWdpc3RlclByb2Nlc3Nvcigic2hhcGUtcHJvY2Vzc29yIix0ZSk7Y2xhc3MgT3R7czA9MDtzMT0wO3VwZGF0ZSh0LGUscz0wKXtzPVQocywwLDEpLGU9VChlLDAsc2FtcGxlUmF0ZS8yLTEpO2NvbnN0IHI9VCgyKk1hdGguc2luKGUqUipxKSwwLDEuMTQpLG89MS1NYXRoLnBvdyguNSw4KnMrMSkqcjtyZXR1cm4gdGhpcy5zMD1vKnRoaXMuczAtcip0aGlzLnMxK3IqdCx0aGlzLnMxPW8qdGhpcy5zMStyKnRoaXMuczAsdGhpcy5zMX19Y2xhc3MgZWUgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3J7c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToidmFsdWUiLGRlZmF1bHRWYWx1ZTouNX1dfWNvbnN0cnVjdG9yKCl7c3VwZXIoKSx0aGlzLmZpbHRlcnM9W25ldyBPdCxuZXcgT3RdfXByb2Nlc3ModCxlLHMpe2NvbnN0IHI9dFswXSxpPWVbMF0sbz1yWzBdIT09dm9pZCAwO3RoaXMuc3RhcnRlZD1vO2NvbnN0IGE9VChzLnZhbHVlWzBdLDAsMSk7bGV0IHU9Im5vbmUiLGMsaD0xO2E+LjUxPyh1PSJoaXBhc3MiLGg9KGEtLjUpKjIpOmE8LjQ5JiYodT0ibG9wYXNzIixoPWEqMiksYz1NYXRoLnBvdyhoKjExLDQpO2ZvcihsZXQgZj0wO2Y8ci5sZW5ndGg7ZisrKWZvcihsZXQgZD0wO2Q8ajtkKyspdT09Im5vbmUiP2lbZl1bZF09cltmXVtkXToodGhpcy5maWx0ZXJzW2ZdLnVwZGF0ZShyW2ZdW2RdLGMsLjEpLHU9PT0ibG9wYXNzIj9pW2ZdW2RdPXRoaXMuZmlsdGVyc1tmXS5zMTp1PT09ImhpcGFzcyI/aVtmXVtkXT1yW2ZdW2RdLXRoaXMuZmlsdGVyc1tmXS5zMTppW2ZdW2RdPXJbZl1bZF0pO3JldHVybiEwfX1yZWdpc3RlclByb2Nlc3NvcigiZGpmLXByb2Nlc3NvciIsZWUpO2NsYXNzIHNlIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29ye3N0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKXtyZXR1cm5be25hbWU6ImZyZXF1ZW5jeSIsZGVmYXVsdFZhbHVlOjUwMH0se25hbWU6InEiLGRlZmF1bHRWYWx1ZToxfSx7bmFtZToiZHJpdmUiLGRlZmF1bHRWYWx1ZTouNjl9XX1jb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5zdGFydGVkPSExLHRoaXMucDA9WzAsMF0sdGhpcy5wMT1bMCwwXSx0aGlzLnAyPVswLDBdLHRoaXMucDM9WzAsMF0sdGhpcy5wMzI9WzAsMF0sdGhpcy5wMzM9WzAsMF0sdGhpcy5wMzQ9WzAsMF19cHJvY2Vzcyh0LGUscyl7Y29uc3Qgcj10WzBdLGk9ZVswXSxvPXJbMF0hPT12b2lkIDA7aWYodGhpcy5zdGFydGVkJiYhbylyZXR1cm4hMTt0aGlzLnN0YXJ0ZWQ9bztjb25zdCBhPXMucVswXSx1PVQoTWF0aC5leHAocy5kcml2ZVswXSksLjEsMmUzKTtsZXQgYz1zLmZyZXF1ZW5jeVswXTtjPWMqaypxLGM9Yz4xPzE6Yztjb25zdCBoPU1hdGgubWluKDgsYSouMTMpO2xldCBmPTEvdSpNYXRoLm1pbigxLjc1LDEraCk7Zm9yKGxldCBkPTA7ZDxqO2QrKylmb3IobGV0IGw9MDtsPHIubGVuZ3RoO2wrKyl7Y29uc3QgcD10aGlzLnAzW2xdKi4zNjA4OTErdGhpcy5wMzJbbF0qLjQxNzI5K3RoaXMucDMzW2xdKi4xNzc4OTYrdGhpcy5wMzRbbF0qLjA0Mzk3MjU7dGhpcy5wMzRbbF09dGhpcy5wMzNbbF0sdGhpcy5wMzNbbF09dGhpcy5wMzJbbF0sdGhpcy5wMzJbbF09dGhpcy5wM1tsXSx0aGlzLnAwW2xdKz0oeihyW2xdW2RdKnUtaCpwKS16KHRoaXMucDBbbF0pKSpjLHRoaXMucDFbbF0rPSh6KHRoaXMucDBbbF0pLXoodGhpcy5wMVtsXSkpKmMsdGhpcy5wMltsXSs9KHoodGhpcy5wMVtsXSkteih0aGlzLnAyW2xdKSkqYyx0aGlzLnAzW2xdKz0oeih0aGlzLnAyW2xdKS16KHRoaXMucDNbbF0pKSpjLGlbbF1bZF09cCpmfXJldHVybiEwfX1yZWdpc3RlclByb2Nlc3NvcigibGFkZGVyLXByb2Nlc3NvciIsc2UpO2NsYXNzIHJlIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29ye3N0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKXtyZXR1cm5be25hbWU6ImRpc3RvcnQiLGRlZmF1bHRWYWx1ZTowfSx7bmFtZToicG9zdGdhaW4iLGRlZmF1bHRWYWx1ZToxfV19Y29uc3RydWN0b3Ioe3Byb2Nlc3Nvck9wdGlvbnM6dH0pe3N1cGVyKCksdGhpcy5zdGFydGVkPSExLHRoaXMuYWxnb3JpdGhtPUt0KHQuYWxnb3JpdGhtKX1wcm9jZXNzKHQsZSxzKXtjb25zdCByPXRbMF0saT1lWzBdLG89clswXSE9PXZvaWQgMDtpZih0aGlzLnN0YXJ0ZWQmJiFvKXJldHVybiExO3RoaXMuc3RhcnRlZD1vO2ZvcihsZXQgYT0wO2E8ajthKyspe2NvbnN0IHU9VChiKHMucG9zdGdhaW4sYSksLjAwMSwxKSxjPU1hdGguZXhwbTEoYihzLmRpc3RvcnQsYSkpO2ZvcihsZXQgaD0wO2g8ci5sZW5ndGg7aCsrKXtjb25zdCBmPXJbaF1bYV07aVtoXVthXT11KnRoaXMuYWxnb3JpdGhtKGYsYyl9fXJldHVybiEwfX1yZWdpc3RlclByb2Nlc3NvcigiZGlzdG9ydC1wcm9jZXNzb3IiLHJlKTtjbGFzcyBuZSBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3Nvcntjb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5waGFzZT1bXX1zdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCl7cmV0dXJuW3tuYW1lOiJiZWdpbiIsZGVmYXVsdFZhbHVlOjAsbWF4Ok51bWJlci5QT1NJVElWRV9JTkZJTklUWSxtaW46MH0se25hbWU6ImVuZCIsZGVmYXVsdFZhbHVlOjAsbWF4Ok51bWJlci5QT1NJVElWRV9JTkZJTklUWSxtaW46MH0se25hbWU6ImZyZXF1ZW5jeSIsZGVmYXVsdFZhbHVlOjQ0MCxtaW46TnVtYmVyLkVQU0lMT059LHtuYW1lOiJwYW5zcHJlYWQiLGRlZmF1bHRWYWx1ZTouNCxtaW46MCxtYXg6MX0se25hbWU6ImZyZXFzcHJlYWQiLGRlZmF1bHRWYWx1ZTouMixtaW46MH0se25hbWU6ImRldHVuZSIsZGVmYXVsdFZhbHVlOjAsbWluOjB9LHtuYW1lOiJ2b2ljZXMiLGRlZmF1bHRWYWx1ZTo1LG1pbjoxLGF1dG9tYXRpb25SYXRlOiJrLXJhdGUifV19cHJvY2Vzcyh0LGUscyl7aWYoY3VycmVudFRpbWU8PXMuYmVnaW5bMF0pcmV0dXJuITA7aWYoY3VycmVudFRpbWU+PXMuZW5kWzBdKXJldHVybiExO2NvbnN0IHI9ZVswXSxpPXMudm9pY2VzWzBdO2ZvcihsZXQgbz0wO288clswXS5sZW5ndGg7bysrKXtjb25zdCBhPWIocy5kZXR1bmUsbyksdT1iKHMuZnJlcXNwcmVhZCxvKSxjPWIocy5wYW5zcHJlYWQsbykqLjUrLjU7bGV0IGg9TWF0aC5zcXJ0KDEtYyksZj1NYXRoLnNxcnQoYyksZD1iKHMuZnJlcXVlbmN5LG8pO2Q9WihkLGEvMTAwKTtjb25zdCBsPU50KGksdSk7Zm9yKGxldCBwPTA7cDxpO3ArKyl7Y29uc3QgbT1aKGQsbChwKSksST1IKG0qcSk7dGhpcy5waGFzZVtwXT10aGlzLnBoYXNlW3BdPz9NYXRoLnJhbmRvbSgpO2NvbnN0IGc9ZHQuc2F3YmxlcCh0aGlzLnBoYXNlW3BdLEkpO3JbMF1bb10rPWcqaCxyWzFdW29dKz1nKmY7bGV0IHY9dGhpcy5waGFzZVtwXStJO3Y+PTEmJih2LT0xKSx0aGlzLnBoYXNlW3BdPXY7Y29uc3Qgdz1oO2g9ZixmPXd9fXJldHVybiEwfX1yZWdpc3RlclByb2Nlc3Nvcigic3VwZXJzYXctb3NjaWxsYXRvciIsbmUpO2NvbnN0IGllPTIwNDgscHQ9bmV3IE1hcDtmdW5jdGlvbiBvZShuKXtpZighcHQuaGFzKG4pKXtjb25zdCB0PW5ldyBGbG9hdDMyQXJyYXkobik7Zm9yKGxldCBlPTA7ZTxuO2UrKyl0W2VdPS41KigxLU1hdGguY29zKGsqZS9uKSk7cHQuc2V0KG4sdCl9cmV0dXJuIHB0LmdldChuKX1jbGFzcyBhZSBleHRlbmRzIGt0e3N0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKXtyZXR1cm5be25hbWU6InBpdGNoRmFjdG9yIixkZWZhdWx0VmFsdWU6MX1dfWNvbnN0cnVjdG9yKHQpe3QucHJvY2Vzc29yT3B0aW9ucz17YmxvY2tTaXplOmllfSxzdXBlcih0KSx0aGlzLnRpbWVDdXJzb3I9MCx0aGlzLmZmdFNpemU9dGhpcy5ibG9ja1NpemUsdGhpcy5pbnZmZnRTaXplPTEvdGhpcy5mZnRTaXplLHRoaXMuaGFubldpbmRvdz1vZSh0aGlzLmZmdFNpemUpLHRoaXMuZmZ0PW5ldyBFdCh0aGlzLmZmdFNpemUpLHRoaXMuZnJlcUNvbXBsZXhCdWZmZXI9dGhpcy5mZnQuY3JlYXRlQ29tcGxleEFycmF5KCksdGhpcy5mcmVxQ29tcGxleEJ1ZmZlclNoaWZ0ZWQ9dGhpcy5mZnQuY3JlYXRlQ29tcGxleEFycmF5KCksdGhpcy50aW1lQ29tcGxleEJ1ZmZlcj10aGlzLmZmdC5jcmVhdGVDb21wbGV4QXJyYXkoKSx0aGlzLm1hZ25pdHVkZXM9bmV3IEZsb2F0MzJBcnJheSh0aGlzLmZmdFNpemUvMisxKSx0aGlzLnBlYWtJbmRleGVzPW5ldyBJbnQzMkFycmF5KHRoaXMubWFnbml0dWRlcy5sZW5ndGgpLHRoaXMubmJQZWFrcz0wfXByb2Nlc3NPTEEodCxlLHMpe2xldCByPXMucGl0Y2hGYWN0b3Jbcy5waXRjaEZhY3Rvci5sZW5ndGgtMV07cjwwJiYocj1yKi4yNSkscj1NYXRoLm1heCgwLHIrMSk7Zm9yKGxldCBpPTA7aTx0aGlzLm5iSW5wdXRzO2krKylmb3IobGV0IG89MDtvPHRbaV0ubGVuZ3RoO28rKyl7Y29uc3QgYT10W2ldW29dLHU9ZVtpXVtvXTt0aGlzLmFwcGx5SGFubldpbmRvdyhhKSx0aGlzLmZmdC5yZWFsVHJhbnNmb3JtKHRoaXMuZnJlcUNvbXBsZXhCdWZmZXIsYSksdGhpcy5jb21wdXRlTWFnbml0dWRlcygpLHRoaXMuZmluZFBlYWtzKCksdGhpcy5zaGlmdFBlYWtzKHIpLHRoaXMuZmZ0LmNvbXBsZXRlU3BlY3RydW0odGhpcy5mcmVxQ29tcGxleEJ1ZmZlclNoaWZ0ZWQpLHRoaXMuZmZ0LmludmVyc2VUcmFuc2Zvcm0odGhpcy50aW1lQ29tcGxleEJ1ZmZlcix0aGlzLmZyZXFDb21wbGV4QnVmZmVyU2hpZnRlZCksdGhpcy5mZnQuZnJvbUNvbXBsZXhBcnJheSh0aGlzLnRpbWVDb21wbGV4QnVmZmVyLHUpLHRoaXMuYXBwbHlIYW5uV2luZG93KHUpfXRoaXMudGltZUN1cnNvcis9dGhpcy5ob3BTaXplfWFwcGx5SGFubldpbmRvdyh0KXtmb3IobGV0IGU9MDtlPHRoaXMuYmxvY2tTaXplO2UrKyl0W2VdKj10aGlzLmhhbm5XaW5kb3dbZV0qMS42Mn1jb21wdXRlTWFnbml0dWRlcygpe2xldCB0PTAsZT0wO2Zvcig7dDx0aGlzLm1hZ25pdHVkZXMubGVuZ3RoOyl7Y29uc3Qgcz10aGlzLmZyZXFDb21wbGV4QnVmZmVyW2VdLHI9dGhpcy5mcmVxQ29tcGxleEJ1ZmZlcltlKzFdO3RoaXMubWFnbml0dWRlc1t0XT1zKioyK3IqKjIsdCs9MSxlKz0yfX1maW5kUGVha3MoKXt0aGlzLm5iUGVha3M9MDtsZXQgdD0yO2NvbnN0IGU9dGhpcy5tYWduaXR1ZGVzLmxlbmd0aC0yO2Zvcig7dDxlOyl7Y29uc3Qgcz10aGlzLm1hZ25pdHVkZXNbdF07aWYodGhpcy5tYWduaXR1ZGVzW3QtMV0+PXN8fHRoaXMubWFnbml0dWRlc1t0LTJdPj1zKXt0Kys7Y29udGludWV9aWYodGhpcy5tYWduaXR1ZGVzW3QrMV0+PXN8fHRoaXMubWFnbml0dWRlc1t0KzJdPj1zKXt0Kys7Y29udGludWV9dGhpcy5wZWFrSW5kZXhlc1t0aGlzLm5iUGVha3NdPXQsdGhpcy5uYlBlYWtzKyssdCs9Mn19c2hpZnRQZWFrcyh0KXt0aGlzLmZyZXFDb21wbGV4QnVmZmVyU2hpZnRlZC5maWxsKDApO2ZvcihsZXQgZT0wO2U8dGhpcy5uYlBlYWtzO2UrKyl7Y29uc3Qgcz10aGlzLnBlYWtJbmRleGVzW2VdLHI9VShzKnQpO2lmKHI+dGhpcy5tYWduaXR1ZGVzLmxlbmd0aClicmVhaztsZXQgaT0wLG89dGhpcy5mZnRTaXplO2U+MCYmKGk9cy1VKChzLXRoaXMucGVha0luZGV4ZXNbZS0xXSkvMikpLGU8dGhpcy5uYlBlYWtzLTEmJihvPXMrWnQoKHRoaXMucGVha0luZGV4ZXNbZSsxXS1zKS8yKSk7Y29uc3QgYT1pLXMsdT1vLXMsYz1rKnRoaXMuaW52ZmZ0U2l6ZSooci1zKSxoPU1hdGguY29zKGMqdGhpcy50aW1lQ3Vyc29yKSxmPU1hdGguc2luKGMqdGhpcy50aW1lQ3Vyc29yKTtmb3IobGV0IGQ9YTtkPHU7ZCsrKXtjb25zdCBsPXMrZCxwPXIrZDtpZihwPj10aGlzLm1hZ25pdHVkZXMubGVuZ3RoKWJyZWFrO2NvbnN0IG09MipsLEk9bSsxLGc9dGhpcy5mcmVxQ29tcGxleEJ1ZmZlclttXSx2PXRoaXMuZnJlcUNvbXBsZXhCdWZmZXJbSV0sdz1nKmgtdipmLFA9ZypmK3YqaCxTPTIqcCxWPVMrMTt0aGlzLmZyZXFDb21wbGV4QnVmZmVyU2hpZnRlZFtTXSs9dyx0aGlzLmZyZXFDb21wbGV4QnVmZmVyU2hpZnRlZFtWXSs9UH19fX1yZWdpc3RlclByb2Nlc3NvcigicGhhc2Utdm9jb2Rlci1wcm9jZXNzb3IiLGFlKTtjbGFzcyBjZSBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3Nvcntjb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5waGk9LVIsdGhpcy5ZMD0wLHRoaXMuWTE9MCx0aGlzLlBXPVIsdGhpcy5CPTIuMyx0aGlzLmRwaGlmPTAsdGhpcy5lbnZmPTB9c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToiYmVnaW4iLGRlZmF1bHRWYWx1ZTowLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksbWluOjB9LHtuYW1lOiJlbmQiLGRlZmF1bHRWYWx1ZTowLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksbWluOjB9LHtuYW1lOiJmcmVxdWVuY3kiLGRlZmF1bHRWYWx1ZTo0NDAsbWluOk51bWJlci5FUFNJTE9OfSx7bmFtZToiZGV0dW5lIixkZWZhdWx0VmFsdWU6MCxtaW46TnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFl9LHtuYW1lOiJwdWxzZXdpZHRoIixkZWZhdWx0VmFsdWU6MSxtaW46MCxtYXg6TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZfV19cHJvY2Vzcyh0LGUscyl7aWYodGhpcy5kaXNjb25uZWN0ZWQpcmV0dXJuITE7aWYoY3VycmVudFRpbWU8PXMuYmVnaW5bMF0pcmV0dXJuITA7aWYoY3VycmVudFRpbWU+PXMuZW5kWzBdKXJldHVybiExO2NvbnN0IHI9ZVswXTtsZXQgaT0xLG87Zm9yKGxldCBhPTA7YTwoclswXS5sZW5ndGg/PzApO2ErKyl7Y29uc3QgdT0oMS1UKGIocy5wdWxzZXdpZHRoLGEpLC0uOTksLjk5KSkqUixjPWIocy5kZXR1bmUsYSksaD1aKGIocy5mcmVxdWVuY3ksYSksYy8xMDApO289aCprKnEsdGhpcy5kcGhpZis9LjEqKG8tdGhpcy5kcGhpZiksaSo9Ljk5OTgsdGhpcy5lbnZmKz0uMSooaS10aGlzLmVudmYpLHRoaXMuQj0yLjMqKDEtMWUtNCpoKSx0aGlzLkI8MCYmKHRoaXMuQj0wKSx0aGlzLnBoaSs9dGhpcy5kcGhpZix0aGlzLnBoaT49UiYmKHRoaXMucGhpLT1rKTtsZXQgZj1NYXRoLmNvcyh0aGlzLnBoaSt0aGlzLkIqdGhpcy5ZMCk7dGhpcy5ZMD0uNSooZit0aGlzLlkwKTtsZXQgZD1NYXRoLmNvcyh0aGlzLnBoaSt0aGlzLkIqdGhpcy5ZMSt1KTt0aGlzLlkxPS41KihkK3RoaXMuWTEpO2ZvcihsZXQgbD0wO2w8ci5sZW5ndGg7bCsrKXJbbF1bYV09LjE1KihmLWQpKnRoaXMuZW52Zn1yZXR1cm4hMH19cmVnaXN0ZXJQcm9jZXNzb3IoInB1bHNlLW9zY2lsbGF0b3IiLGNlKTtjb25zdCBtdD17Yml0QzpmdW5jdGlvbihuLHQsZSl7cmV0dXJuIG4mdD9lOjB9LGJyOmZ1bmN0aW9uKG4sdD04KXtpZih0PjMyKXRocm93IG5ldyBFcnJvcigiYnIoKSBTaXplIGNhbm5vdCBiZSBncmVhdGVyIHRoYW4gMzIiKTtsZXQgZT0wO2ZvcihsZXQgcz0wO3M8dDtzKyspZXw9bXQuYml0QyhuLDE8PHMsMTw8dC0ocysxKSk7cmV0dXJuIGV9LHNpbmY6ZnVuY3Rpb24obil7cmV0dXJuIE1hdGguc2luKG4qUi8xMjgpfSxjb3NmOmZ1bmN0aW9uKG4pe3JldHVybiBNYXRoLmNvcyhuKlIvMTI4KX0sdGFuZjpmdW5jdGlvbihuKXtyZXR1cm4gTWF0aC50YW4obipSLzEyOCl9LHJlZ0c6ZnVuY3Rpb24obix0KXtyZXR1cm4gdC50ZXN0KG4udG9TdHJpbmcoMikpfX07bGV0IHR0LHZ0O2Z1bmN0aW9uIHVlKG4pe2lmKHR0PT1udWxsKXt0dD1PYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhNYXRoKSx2dD10dC5tYXAocz0+TWF0aFtzXSk7Y29uc3QgdD1PYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhtdCksZT10Lm1hcChzPT5tdFtzXSk7dHQucHVzaCgiaW50Iiwid2luZG93IiwuLi50KSx2dC5wdXNoKE1hdGguZmxvb3IsZ2xvYmFsVGhpcywuLi5lKX1yZXR1cm4gbmV3IEZ1bmN0aW9uKC4uLnR0LCJ0IixgcmV0dXJuIDAsCiR7bnx8MH07YCkuYmluZChnbG9iYWxUaGlzLC4uLnZ0KX1jbGFzcyBoZSBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3Nvcntjb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5wb3J0Lm9ubWVzc2FnZT10PT57bGV0e2NvZGVUZXh0OmV9PXQuZGF0YTtjb25zdHtieXRlQmVhdFN0YXJ0VGltZTpzfT10LmRhdGE7cyE9bnVsbCYmKHRoaXMudD0wLHRoaXMuaW5pdGlhbE9mZnNldD1NYXRoLmZsb29yKHMpKSxlPWUudHJpbSgpLnJlcGxhY2UoL15ldmFsXCh1bmVzY2FwZVwoZXNjYXBlKD86YHxcKCd8XCgifFwoYCkoLio/KSg/OmB8J1wpfCJcKXxgXCkpLnJlcGxhY2VcKFwvdVwoXC5cLlwpXC9nLFsiJ2BdXCQxJVsiJ2BdXClcKVwpJC8sKHIsaSk9PnVuZXNjYXBlKGVzY2FwZShpKS5yZXBsYWNlKC91KC4uKS9nLCIkMSUiKSkpLHRoaXMuZnVuYz11ZShlKX0sdGhpcy5pbml0aWFsT2Zmc2V0PTAsdGhpcy50PW51bGwsdGhpcy5mdW5jPW51bGx9c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToiYmVnaW4iLGRlZmF1bHRWYWx1ZTowLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksbWluOjB9LHtuYW1lOiJmcmVxdWVuY3kiLGRlZmF1bHRWYWx1ZTo0NDAsbWluOk51bWJlci5FUFNJTE9OfSx7bmFtZToiZGV0dW5lIixkZWZhdWx0VmFsdWU6MCxtaW46TnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFl9LHtuYW1lOiJlbmQiLGRlZmF1bHRWYWx1ZTowLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksbWluOjB9XX1wcm9jZXNzKHQsZSxzKXtpZih0aGlzLmRpc2Nvbm5lY3RlZClyZXR1cm4hMTtpZihjdXJyZW50VGltZTw9cy5iZWdpblswXSlyZXR1cm4hMDtpZihjdXJyZW50VGltZT49cy5lbmRbMF0pcmV0dXJuITE7dGhpcy50PT1udWxsJiYodGhpcy50PXMuYmVnaW5bMF0qc2FtcGxlUmF0ZSk7Y29uc3Qgcj1lWzBdLGk9MjU2KnE7Zm9yKGxldCBvPTA7bzxyWzBdLmxlbmd0aDtvKyspe2NvbnN0IGE9YihzLmRldHVuZSxvKSx1PVooYihzLmZyZXF1ZW5jeSxvKSxhLzEwMCksYz1pKnUqdGhpcy50K3RoaXMuaW5pdGlhbE9mZnNldCxmPSh0aGlzLmZ1bmMoYykmMjU1KS8xMjcuNS0xLGQ9VChmKi4yLC0uNCwuNCk7Zm9yKGxldCBsPTA7bDxyLmxlbmd0aDtsKyspcltsXVtvXT1kO3RoaXMudCsrfXJldHVybiEwfX1yZWdpc3RlclByb2Nlc3NvcigiYnl0ZS1iZWF0LXByb2Nlc3NvciIsaGUpO2NsYXNzIGxlIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29ye3N0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKXtyZXR1cm5be25hbWU6ImJlZ2luIixkZWZhdWx0VmFsdWU6MH0se25hbWU6ImVuZCIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJhdHRhY2siLGRlZmF1bHRWYWx1ZTouMDA1LG1pblZhbHVlOjB9LHtuYW1lOiJkZWNheSIsZGVmYXVsdFZhbHVlOi4xNCxtaW5WYWx1ZTowfSx7bmFtZToic3VzdGFpbiIsZGVmYXVsdFZhbHVlOjAsbWluVmFsdWU6MCxtYXhWYWx1ZToxfSx7bmFtZToicmVsZWFzZSIsZGVmYXVsdFZhbHVlOi4xLG1pblZhbHVlOjB9LHtuYW1lOiJhdHRhY2tDdXJ2ZSIsZGVmYXVsdFZhbHVlOjAsbWluVmFsdWU6LTEsbWF4VmFsdWU6MX0se25hbWU6ImRlY2F5Q3VydmUiLGRlZmF1bHRWYWx1ZTowLG1pblZhbHVlOi0xLG1heFZhbHVlOjF9LHtuYW1lOiJyZWxlYXNlQ3VydmUiLGRlZmF1bHRWYWx1ZTowLG1pblZhbHVlOi0xLG1heFZhbHVlOjF9LHtuYW1lOiJwZWFrIixkZWZhdWx0VmFsdWU6MX0se25hbWU6InJldHJpZ2dlciIsZGVmYXVsdFZhbHVlOjEsbWluVmFsdWU6MCxtYXhWYWx1ZToxfV19Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMudmFsPTAsdGhpcy5zZWdJZHg9MCx0aGlzLnN0YXRlPTAsdGhpcy5iZWdpblRpbWU9MCx0aGlzLmVuZFRpbWU9MCx0aGlzLmF0dGFja1N0YXJ0PTB9X3dhcnAodCxlLHM9OCl7aWYodD09PTB8fHQ9PT0xKXJldHVybiB0O2lmKGU+MCl7Y29uc3Qgcj0xK3MqZTtyZXR1cm4gMS1NYXRoLnBvdygxLXQscil9ZWxzZXtjb25zdCByPTEtcyplO3JldHVybiBNYXRoLnBvdyh0LHIpfX1fYWR2YW5jZSh0LGUscyxyKXtpZihzPT09MHx8dD09PWUpdGhpcy52YWw9ZTtlbHNle2NvbnN0IGk9TWF0aC5taW4oMSwoY3VycmVudFRpbWUtdGhpcy5iZWdpblRpbWUpL3MpLG89dGhpcy5fd2FycChpLHIpO3RoaXMudmFsPXQrKGUtdCkqb319cHJvY2Vzcyh0LGUscyl7Y29uc3Qgcj1lWzBdWzBdO2lmKCFyKXJldHVybiEwO2NvbnN0IGk9YihzLmJlZ2luLDApLG89YihzLnJldHJpZ2dlciwwKT49LjU7aSE9PXRoaXMuYmVnaW5UaW1lJiYodGhpcy5zdGF0ZT09PTB8fG8pJiYodGhpcy5iZWdpblRpbWU9aSx0aGlzLnN0YXRlPTEsdGhpcy5lbmRUaW1lPWIocy5lbmQsMCksdGhpcy5hdHRhY2tTdGFydD10aGlzLnZhbCk7Y29uc3QgYT10aGlzLmVuZFRpbWUtdGhpcy5iZWdpblRpbWU7Zm9yKGxldCB1PTA7dTxyLmxlbmd0aDt1Kyspe2NvbnN0IGM9YihzLmF0dGFjayx1KSxoPWIocy5kZWNheSx1KSxmPWIocy5zdXN0YWluLHUpLGQ9YihzLnJlbGVhc2UsdSksbD1iKHMuYXR0YWNrQ3VydmUsdSkscD1iKHMuZGVjYXlDdXJ2ZSx1KSxtPWIocy5yZWxlYXNlQ3VydmUsdSksST1iKHMucGVhayx1KSxnPVt7dGltZTpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksc3RhcnQ6MCx0YXJnZXQ6MH0se3RpbWU6YyxzdGFydDp0aGlzLmF0dGFja1N0YXJ0LHRhcmdldDoxLGN1cnZlOmx9LHt0aW1lOmMraCxzdGFydDoxLHRhcmdldDpmLGN1cnZlOnB9LHt0aW1lOmEsc3RhcnQ6Zix0YXJnZXQ6Zn0se3RpbWU6YStkLHN0YXJ0OmYsdGFyZ2V0OjAsY3VydmU6bX1dO2xldHt0aW1lOnYsc3RhcnQ6dyx0YXJnZXQ6UCxjdXJ2ZTpTfT1nW3RoaXMuc3RhdGVdO2Zvcih0aGlzLl9hZHZhbmNlKHcsUCx2LFMpO2N1cnJlbnRUaW1lLXRoaXMuYmVnaW5UaW1lPj12Oyl0aGlzLnN0YXRlPSh0aGlzLnN0YXRlKzEpJWcubGVuZ3RoLHY9Z1t0aGlzLnN0YXRlXS50aW1lO3JbdV09dGhpcy52YWwqSX1yZXR1cm4hMH19cmVnaXN0ZXJQcm9jZXNzb3IoImVudmVsb3BlLXByb2Nlc3NvciIsbGUpO2NvbnN0IEI9T2JqZWN0LmZyZWV6ZSh7Tk9ORTowLEFTWU06MSxNSVJST1I6MixCRU5EUDozLEJFTkRNOjQsQkVORE1QOjUsU1lOQzo2LFFVQU5UOjcsRk9MRDo4LFBXTTo5LE9SQklUOjEwLFNQSU46MTEsQ0hBT1M6MTIsUFJJTUVTOjEzLEJJTkFSWToxNCxCUk9XTklBTjoxNSxSRUNJUFJPQ0FMOjE2LFdPUk1IT0xFOjE3LExPR0lTVElDOjE4LFNJR01PSUQ6MTksRlJBQ1RBTDoyMCxGTElQOjIxfSk7ZnVuY3Rpb24gZmUobil7cmV0dXJuIG49bisyMTI3OTEyMjE0KyhuPDwxMiksbj1uXjMzNDUwNzI3MDBebj4+PjE5LG49biszNzQ3NjEzOTMrKG48PDUpLG49biszNTUwNjM1MTE2Xm48PDksbj1uKzQyNTE5OTM3OTcrKG48PDMpLG49bl4zMDQyNTk0NTY5Xm4+Pj4xNixuPj4+MH1jb25zdCBGdD1uPT4oZmUobik+Pj44KS8xNjc3NzIxNjtmdW5jdGlvbiBkZShuLHQpe2xldCBlPTA7Zm9yKGxldCBzPTA7czx0O3MrKyllPWU8PDF8biYxLG4+Pj49MTtyZXR1cm4gZX1mdW5jdGlvbiBwZShuKXtjb25zdCB0PU1hdGguZmxvb3IobiksZT1uLXQscz1GdCh0KSxyPUZ0KHQrMSk7cmV0dXJuIHMrKHItcykqZX1mdW5jdGlvbiBtZShuLHQ9NCl7bGV0IGU9LjUscz0wLHI9MCxpPTE7Zm9yKGxldCBvPTA7bzx0O28rKylzKz1lKnBlKG4qaSkscis9ZSxlKj0uNSxpKj0yO3JldHVybiBzL3IqMi0xfWNvbnN0IGd0PXt9O2NsYXNzIHZlIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29ye3N0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKXtyZXR1cm5be25hbWU6ImJlZ2luIixkZWZhdWx0VmFsdWU6MCxtaW46MCxtYXg6TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZfSx7bmFtZToiZW5kIixkZWZhdWx0VmFsdWU6MCxtaW46MCxtYXg6TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZfSx7bmFtZToiZnJlcXVlbmN5IixkZWZhdWx0VmFsdWU6NDQwLG1pbjpOdW1iZXIuRVBTSUxPTn0se25hbWU6ImRldHVuZSIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJmcmVxc3ByZWFkIixkZWZhdWx0VmFsdWU6LjE4LG1pbjowfSx7bmFtZToicG9zaXRpb24iLGRlZmF1bHRWYWx1ZTowLG1pbjowLG1heDoxfSx7bmFtZToid2FycCIsZGVmYXVsdFZhbHVlOjAsbWluOjAsbWF4OjF9LHtuYW1lOiJ3YXJwTW9kZSIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJ2b2ljZXMiLGRlZmF1bHRWYWx1ZToxLG1pbjoxLGF1dG9tYXRpb25SYXRlOiJrLXJhdGUifSx7bmFtZToicGFuc3ByZWFkIixkZWZhdWx0VmFsdWU6LjcsbWluOjAsbWF4OjF9LHtuYW1lOiJwaGFzZXJhbmQiLGRlZmF1bHRWYWx1ZTowLG1pbjowLG1heDoxfV19Y29uc3RydWN0b3IodCl7c3VwZXIodCksdGhpcy5mcmFtZUxlbj0wLHRoaXMubnVtRnJhbWVzPTAsdGhpcy5waGFzZT1bXSx0aGlzLnBvcnQub25tZXNzYWdlPWU9Pntjb25zdHt0eXBlOnMscGF5bG9hZDpyfT1lLmRhdGF8fHt9O2lmKHM9PT0idGFibGUiKXtjb25zdCBpPXIua2V5O2lmKHRoaXMuZnJhbWVMZW49ci5mcmFtZUxlbiwhZ3RbaV0pe2NvbnN0IG89W3IuZnJhbWVzXTtsZXQgYT1vWzBdO2ZvcihsZXQgdT0xO3U8MTt1Kyspe2NvbnN0IGM9YS5sZW5ndGg+PjEsaD1hLm1hcChmPT57Y29uc3QgZD1uZXcgRmxvYXQzMkFycmF5KGMpO2ZvcihsZXQgbD0wO2w8YztsKyspZFtsXT0oZlsyKmxdK2ZbMipsKzFdKS8yO3JldHVybiBkfSk7aWYoby5wdXNoKGgpLGE9aCxjPD0zMilicmVha31ndFtpXT1vfXRoaXMudGFibGVzPWd0W2ldLHRoaXMubnVtRnJhbWVzPXRoaXMudGFibGVzWzBdLmxlbmd0aH19fV9taXJyb3IodCl7cmV0dXJuIDEtTWF0aC5hYnMoMip0LTEpfV90b0JpdHModCxlPTIscz0xMil7Y29uc3Qgcj1zKyhlLXMpKnQ7cmV0dXJue2I6cixuOlUoTWF0aC5wb3coMixyKSl9fV93YXJwUGhhc2UodCxlLHMpe3N3aXRjaChzKXtjYXNlIEIuTk9ORTpyZXR1cm4gdDtjYXNlIEIuQVNZTTp7Y29uc3Qgcj0uMDErLjk5KmU7cmV0dXJuIHQ8cj8uNSp0L3I6LjUrLjUqKHQtcikvKDEtcil9Y2FzZSBCLk1JUlJPUjpyZXR1cm4gdGhpcy5fbWlycm9yKHRoaXMuX3dhcnBQaGFzZSh0LGUsQi5BU1lNKSk7Y2FzZSBCLkJFTkRQOnJldHVybiBNYXRoLnBvdyh0LDErMyplKTtjYXNlIEIuQkVORE06cmV0dXJuIE1hdGgucG93KHQsMS8oMSszKmUpKTtjYXNlIEIuQkVORE1QOnJldHVybiBlPC41P3RoaXMuX3dhcnBQaGFzZSh0LDEtMiplLDMpOnRoaXMuX3dhcnBQaGFzZSh0LDIqZS0xLDIpO2Nhc2UgQi5TWU5DOntjb25zdCByPU1hdGgucG93KDE2LGUqKjIpO3JldHVybiB0KnIlMX1jYXNlIEIuUVVBTlQ6e2NvbnN0e246cn09dGhpcy5fdG9CaXRzKGUpO3JldHVybiBLKHQqcikvcn1jYXNlIEIuRk9MRDp7Y29uc3QgaT0xK01hdGgubWF4KDEsVSg3KmUpKTtyZXR1cm4gTWF0aC5hYnMoQXQoaSp0KS0uNSkqMn1jYXNlIEIuUFdNOntjb25zdCByPVQoLjUrLjQ5KigyKmUtMSksMCwxKTtyZXR1cm4gdDxyP3QvciouNTouNSsodC1yKS8oMS1yKSouNX1jYXNlIEIuT1JCSVQ6e2NvbnN0IHI9LjUqZTtyZXR1cm4gSCh0K3IqTWF0aC5zaW4oayozKnQpKX1jYXNlIEIuU1BJTjp7Y29uc3Qgcj0uNSplLHtuOml9PXRoaXMuX3RvQml0cyhlLDEsNik7cmV0dXJuIEgodCtyKk1hdGguc2luKGsqaSp0KSl9Y2FzZSBCLkNIQU9TOntjb25zdCBpPSgzLjcrLjMqZSkqdCooMS10KTtyZXR1cm4gVCgoMS1lKSp0K2UqaSwwLDEpfWNhc2UgQi5QUklNRVM6e2NvbnN0IHI9bz0+e2lmKG88MilyZXR1cm4hMTtpZihvJTI9PT0wKXJldHVybiBvPT09Mjtmb3IobGV0IGE9MzthKioyPD1vO2ErPTIpaWYobyVhPT09MClyZXR1cm4hMTtyZXR1cm4hMH07bGV0e246aX09dGhpcy5fdG9CaXRzKGUsMyk7Zm9yKDshcihpKTspaSsrO3JldHVybiBLKHQqaSkvaX1jYXNlIEIuQklOQVJZOntsZXR7YjpyfT10aGlzLl90b0JpdHMoZSwzKTtyPVUocik7Y29uc3QgaT0xPDxyLG89Syh0KmkpO3JldHVybiBkZShvLHIpL2l9Y2FzZSBCLkJST1dOSUFOOntjb25zdCByPS4yNSplKm1lKDY0KnQsNCk7cmV0dXJuIEgodCtyKX1jYXNlIEIuUkVDSVBST0NBTDp7Y29uc3Qgcj0yKzQqZSxpPXQqcixvPXQrKDEtdCkqcixhPW8+MWUtMTI/aS9vOjA7cmV0dXJuIFQoYSwwLDEpfWNhc2UgQi5XT1JNSE9MRTp7Y29uc3Qgcj1UKC44KmUsMCwxKSxpPS41KigxLXIpLG89LjUqKDErcik7cmV0dXJuIHQ8aT90L2kqLjU6dD5vPy41KigxKyh0LW8pLygxLW8pKTouNX1jYXNlIEIuTE9HSVNUSUM6e2xldCByPXQ7Y29uc3QgaT0zLjYrLjQqZSxvPTErVSgyKmUpO2ZvcihsZXQgYT0wO2E8bzthKyspcj1pKnIqKDEtcik7cmV0dXJuIFQociwwLDEpfWNhc2UgQi5TSUdNT0lEOntjb25zdCByPTErMTAqZSxpPXQtLjUsbz0xLygxK01hdGguZXhwKC1yKmkpKSxhPTEvKDErTWF0aC5leHAoLjUqcikpLHU9MS8oMStNYXRoLmV4cCgtLjUqcikpO3JldHVybihvLWEpLyh1LWEpfWNhc2UgQi5GUkFDVEFMOntjb25zdCByPS41Kk1hdGguc2luKGsqdCkqZTtyZXR1cm4gSCh0K3IpfWNhc2UgQi5GTElQOnJldHVybiB0O2RlZmF1bHQ6cmV0dXJuIHR9fV9zYW1wbGVGcmFtZSh0LGUpe2NvbnN0IHM9dC5sZW5ndGgscj1lKnM7bGV0IGk9cnwwO2k+PXMmJihpPTApO2NvbnN0IG89ci1pLGE9dFtpXTtsZXQgdT1pKzE7dT49cyYmKHU9MCk7Y29uc3QgYz10W3VdO3JldHVybiBhKyhjLWEpKm99X2Nob29zZU1pcCh0KXtjb25zdCBlPVQodCwxZS02LDY0KTtsZXQgcz0wO2Zvcig7cysxPCh0aGlzLnRhYmxlcz8ubGVuZ3RofHwxKSYmZTx0aGlzLnRhYmxlc1tzXVswXS5sZW5ndGgvODspcysrO3JldHVybiBzfXByb2Nlc3ModCxlLHMpe2lmKGN1cnJlbnRUaW1lPj1zLmVuZFswXSlyZXR1cm4hMTtpZihjdXJyZW50VGltZTw9cy5iZWdpblswXSlyZXR1cm4hMDtjb25zdCByPWVbMF1bMF0saT1lWzBdWzFdfHxlWzBdWzBdO2lmKCF0aGlzLnRhYmxlcylyZXR1cm4gci5maWxsKDApLGkhPT1yJiZpLnNldChyKSwhMDtjb25zdCBvPXMudm9pY2VzWzBdO2ZvcihsZXQgYT0wO2E8ci5sZW5ndGg7YSsrKXtjb25zdCB1PWIocy5kZXR1bmUsYSksYz1iKHMuZnJlcXNwcmVhZCxhKSxmPVQoYihzLnBvc2l0aW9uLGEpLDAsMSkqKHRoaXMubnVtRnJhbWVzLTEpLGQ9ZnwwLGw9Zi1kLHA9VChiKHMud2FycCxhKSwwLDEpLG09YihzLndhcnBNb2RlLGEpLEk9VChiKHMucGhhc2VyYW5kLGEpLDAsMSksZz1vPjE/VChiKHMucGFuc3ByZWFkLGEpLDAsMSk6MCx2PU1hdGguc3FydCguNS0uNSpnKSx3PU1hdGguc3FydCguNSsuNSpnKTtsZXQgUD1iKHMuZnJlcXVlbmN5LGEpO1A9WihQLHUvMTAwKTtjb25zdCBTPTEvTWF0aC5zcXJ0KG8pLFY9TnQobyxjKTtmb3IobGV0IE09MDtNPG87TSsrKXtjb25zdCB4PShNJjEpPT0xO2xldCB5PXYsQT13O3gmJih5PXcsQT12KTtjb25zdCBOPVooUCxWKE0pKSpxLEU9dGhpcy5fY2hvb3NlTWlwKE4pLE89dGhpcy50YWJsZXNbRV07dGhpcy5waGFzZVtNXT10aGlzLnBoYXNlW01dPz9NYXRoLnJhbmRvbSgpKkk7Y29uc3QgRj10aGlzLl93YXJwUGhhc2UodGhpcy5waGFzZVtNXSxwLG0pLEQ9dGhpcy5fc2FtcGxlRnJhbWUoT1tkXSxGKSxMPXRoaXMuX3NhbXBsZUZyYW1lKE9bTWF0aC5taW4odGhpcy5udW1GcmFtZXMtMSxkKzEpXSxGKTtsZXQgQz1VdChELEwsbCk7bT09PUIuRkxJUCYmdGhpcy5waGFzZVtNXTxwJiYoQz0tQyksclthXSs9Qyp5KlMsaVthXSs9QypBKlMsdGhpcy5waGFzZVtNXT1IKHRoaXMucGhhc2VbTV0rTil9fXJldHVybiEwfX1yZXR1cm4gcmVnaXN0ZXJQcm9jZXNzb3IoIndhdmV0YWJsZS1vc2NpbGxhdG9yLXByb2Nlc3NvciIsdmUpLGZ0LldhcnBNb2RlPUIsT2JqZWN0LmRlZmluZVByb3BlcnR5KGZ0LFN5bWJvbC50b1N0cmluZ1RhZyx7dmFsdWU6Ik1vZHVsZSJ9KSxmdH0pKHt9KTsK";let On;const $0=()=>(On=new AudioContext,On),j=()=>On||$0();function Jb(){return j().currentTime}let $s={};function tp(t,e){const n=j();if($s[t])return $s[t];const s=2*n.sampleRate,o=n.createBuffer(1,s,n.sampleRate),r=o.getChannelData(0);let i=0,u,a,l,p,f,b,g;u=a=l=p=f=b=g=0;for(let X=0;X<s;X++)if(t==="white")r[X]=Math.random()*2-1;else if(t==="brown"){let Z=Math.random()*2-1;r[X]=(i+.02*Z)/1.02,i=r[X]}else if(t==="pink"){let Z=Math.random()*2-1;u=.99886*u+Z*.0555179,a=.99332*a+Z*.0750759,l=.969*l+Z*.153852,p=.8665*p+Z*.3104856,f=.55*f+Z*.5329522,b=-.7616*b-Z*.016898,r[X]=u+a+l+p+f+b+g+Z*.5362,r[X]*=.11,g=Z*.115926}else if(t==="crackle"){const Z=e*.01;Math.random()<Z?r[X]=Math.random()*2-1:r[X]=0}return t!=="crackle"&&($s[t]=o),o}function to(t="white",e,n=.02){const o=j().createBufferSource();return o.buffer=tp(t,n),o.loop=!0,o.start(e),{node:o,stop:r=>o.stop(r)}}function Ib(t,e,n){const s=to("pink",n),o=op(t,s.node,e);return s.node.onended=()=>o.onended(),{node:o.node,stop:r=>s?.stop(r)}}const eo=["pink","white","brown","crackle"];function xt(t){const e=j().createGain();return e.gain.value=t,e}function Un(t,e,n){const s=xt(n);return t.connect(s),s.connect(e),s}const ep=(t,e,n,s)=>s-n===0?0:(e-t)/(s-n);function kt(t,e,n,s){const o=new AudioWorkletNode(t,e,s);return Object.entries(n).forEach(([r,i])=>{i!==void 0&&(o.parameters.get(r).value=i)}),o}const Dt=(t,e,n,s,o,r,i,u,a,l="exponential")=>{e=le(e),n=le(n),s=le(s),o=le(o);const p=l==="exponential"?"exponentialRampToValueAtTime":"linearRampToValueAtTime";l==="exponential"&&(r=r===0?.001:r,i=i===0?.001:i);const f=i-r,b=i,g=r+s*f,X=a-u,Z=W=>{let F;if(e>W){let z=ep(r,b,0,e);F=W*z+(r>b?r:0)}else F=(W-e)*ep(b,g,0,n)+b;return l==="exponential"&&(F=F||.001),F};t.setValueAtTime(r,u),e>X?t[p](Z(X),a):e+n>X?(t[p](Z(e),u+e),t[p](Z(X),a)):(t[p](Z(e),u+e),t[p](Z(e+n),u+e+n),t.setValueAtTime(g,a)),t[p](r,a+o)};function jb(t){return typeof t=="number"?t%5:{tri:0,triangle:0,sine:1,ramp:2,saw:3,square:4}[t]??0}function Gn(t,e,n,s={}){const{shape:o=0,...r}=s,{dcoffset:i=-.5,depth:u=1}=s,a={frequency:1,depth:u,skew:.5,phaseoffset:0,time:e,begin:e,end:n,shape:jb(o),dcoffset:i,min:i*u,max:i*u+u,curve:1,...r};return kt(t,"lfo-processor",a)}function np(t,e,n,s,o,r){const i={threshold:e??-3,ratio:n??10,knee:s??10,attack:o??.005,release:r??.05};return new DynamicsCompressorNode(t,i)}const Jt=(t,e="linear",n)=>{const[i,u,a,l]=t;if(i==null&&u==null&&a==null&&l==null)return n??[.001,.001,1,.01];const p=a??(i!=null&&u==null||i==null&&u==null?1:.001);return[Math.max(i??0,.001),Math.max(u??0,.001),Math.min(p,1),Math.max(l??0,.01)]};function no(t,e,n,s,o){let{defaultDepth:r=1,depth:i,dcoffset:u,...a}=o;i==null&&(i=Object.values(a).some(f=>f!=null)?r:0);let l;return i&&(l=Gn(t,n,s,{depth:i,dcoffset:u,...a}),l.connect(e)),l}function so(t,e,n,s,o,r){let{amount:i,offset:u,defaultAmount:a=1,curve:l="linear",values:p,holdEnd:f,defaultValues:b}=o;i==null&&(i=p.some(z=>z!=null)?a:0);const g=u??0,X=i+g;if(Math.abs(X-g)){const[F,z,v,x]=Jt(p,l,b);Dt(e,F,z,v,x,g,X,n,f,l)}const W=no(t,e,n,s,r);return{lfo:W,disconnect:()=>W?.disconnect()}}function Qn(t,e,n,s,o,r){let{frequency:i,anchor:u,env:a,type:l,model:p,q:f=1,drive:b=.69,depth:g,depthfrequency:X,dcoffset:Z=-.5,skew:W,shape:F,rate:z,sync:v}=s,x,R;p==="ladder"?(R=kt(t,"ladder-processor",{frequency:i,q:f,drive:b}),x=R.parameters.get("frequency")):(R=t.createBiquadFilter(),R.type=l,R.Q.value=f,R.frequency.value=i,x=R.frequency);const N=[s.attack,s.decay,s.sustain,s.release],[O,_,et,T]=Jt(N,"exponential",[.005,.14,0,.1]);if([...N,a].some(U=>U!==void 0)){a=le(a,1,!0),u=le(u,0,!0);const U=Math.abs(a),pt=U*u;let $=Xe(2**-pt*i,0,2e4),ot=Xe(2**(U-pt)*i,0,2e4);a<0&&([$,ot]=[ot,$]),Dt(x,O,_,et,T,$,ot,e,n,"exponential")}v!=null&&(z=o*v);const P=[g,X,W,F,z].some(U=>U!==void 0);let q;if(P){g=g??1;const U=r/o,$={depth:X??(g??1)*i,dcoffset:Z,skew:W,shape:F,frequency:z??o,min:-i+30,max:2e4-i,time:U,curve:1};q=no(t,x,e,n,$)}return{filter:R,lfo:q}}let sp=t=>t<.5?1:1-(t-.5)/.5;function op(t,e,n=0){const s=j();if(!n)return t;let o=s.createGain(),r=s.createGain();t.connect(o),e.connect(r),o.gain.value=sp(n),r.gain.value=sp(1-n);let i=s.createGain();return o.connect(i),r.connect(i),{node:i,onended:()=>{o.disconnect(i),r.disconnect(i),t.disconnect(o),e.disconnect(r)}}}let _b=["linear","exponential"];function Ie(t,e,n,s){if((e.pattack??e.pdecay??e.psustain??e.prelease??e.penv)===void 0)return;const r=le(e.penv,1,!0),i=_b[e.pcurve??0];let[u,a,l,p]=Jt([e.pattack,e.pdecay,e.psustain,e.prelease],i,[.2,.001,1,.001]),f=e.panchor??l;const b=r*100,g=0-b*f,X=b-b*f;Dt(t,u,a,l,p,g,X,n,s,i)}function je(t,e,n){const{vibmod:s=.5,vib:o}=e;let r;if(o>0){r=j().createOscillator(),r.frequency.value=o;const i=j().createGain();return i.gain.value=s*100,r.connect(i),i.connect(t),r.onended=()=>{i.disconnect(t),r.disconnect(i)},r.start(n),r}}function Ob(t,e,n=j()){const s=n.currentTime;Le(n,t,s,e)}function Le(t,e,n,s){const o=new ConstantSourceNode(t),r=xt(0);return r.connect(t.destination),o.connect(r),o.onended=()=>{try{r.disconnect()}catch{}try{o.disconnect()}catch{}e()},o.start(n),o.stop(s),o}const Ub=(t,e=1,n="sine")=>{const s=j();let o;eo.includes(n)?(o=s.createBufferSource(),o.buffer=tp(n,2),o.loop=!0):(o=s.createOscillator(),o.type=n,o.frequency.value=t),o.start();const r=xt(e);return o.connect(r),{node:r,stop:i=>o.stop(i),osc:o}},Qb=(t,e,n,s="sine")=>{const r=t.value*e,i=r*n;return Ub(r,i,s)};function Zn(t,e,n){const{fmh:s=1,fmi:o,fmenv:r="exp",fmattack:i,fmdecay:u,fmsustain:a,fmrelease:l,fmvelocity:p,fmwave:f="sine",duration:b}=e;let g,X=()=>{};if(o){const W=j().createGain(),F=Qb(t,s,o,f);if(g=F.node,X=F.stop,![i,u,a,l,p].some(z=>z!==void 0))g.connect(t);else{const[z,v,x,R]=Jt([i,u,a,l]),N=n+b;Dt(W.gain,z,v,x,R,0,1,n,N,r==="exp"?"exponential":"linear"),g.connect(W),W.connect(t)}F.osc.onended=()=>{W.disconnect(),g.disconnect(),F.osc.disconnect()}}return{stop:X}}const rp=t=>t/(1+t),qb=(t,e)=>(t%e+e)%e,$b=(t,e)=>(1+e)*t/(1+e*Math.abs(t)),_e=(t,e)=>Math.tanh(t*(1+e)),tg=(t,e)=>Xe((1+e)*t,-1,1),cp=(t,e)=>{let n=(1+.5*e)*t;const s=qb(n+1,4);return 1-Math.abs(s-2)},eg=(t,e)=>Math.sin(Math.PI/2*cp(t,e)),ng=(t,e)=>{const n=rp(Math.log1p(e)),s=(t-n/3*t*t*t)/(1-n/3);return _e(s,e)},ip=(t,e,n=!1)=>{const s=1+2*e,r=.07*rp(Math.log1p(e)),i=_e(t+r,2*e),u=_e(n?r:-t+r,2*e),a=i-u,l=1/Math.cosh(s*r),p=l*l,f=Math.max(1e-8,(n?1:2)*s*p);return _e(a/f,e)},oo={scurve:$b,soft:_e,hard:tg,cubic:ng,diode:ip,asym:(t,e)=>ip(t,e,!0),fold:cp,sinefold:eg,chebyshev:(t,e)=>{const n=10*Math.log1p(e);let s=1,o=t,r,i=0;for(let u=1;u<64;u++){if(u<2){i+=u==0?s:o;continue}r=2*t*s-o,o=s,s=r,u%2===0&&(i+=Math.min(1.3*n/u,2)*r)}return _e(i,n/20)}},wn=Object.freeze(Object.keys(oo)),sg=t=>{let e=t;typeof t=="string"&&(e=wn.indexOf(t),e===-1&&(Zt(`[superdough] Could not find waveshaping algorithm ${t}.
        Available options are ${wn.join(", ")}.
        Defaulting to ${wn[0]}.`),e=0));const n=wn[e%wn.length];return oo[n]},up=(t,e,n)=>kt(j(),"distort-processor",{distort:t,postgain:e},{processorOptions:{algorithm:n}}),ze=(t,e=36)=>{let{note:n,freq:s,octave:o=0}=t;return n=n||e,typeof n=="string"&&(n=_n(n)),!s&&typeof n=="number"&&(s=j0(n)),s*=Math.pow(2,o),Number(s)},Oe=t=>{t!=null&&(t.disconnect(),t.parameters.get("end")?.setValueAtTime(0,0))};let og=Symbol("clean"),qt=[],Ge=0;const qn=4;let rg=t=>{let e=[],n={get(){return n.lc||n.listen(()=>{})(),n.value},lc:0,listen(s){return n.lc=e.push(s),()=>{for(let r=Ge+qn;r<qt.length;)qt[r]===s?qt.splice(r,qn):r+=qn;let o=e.indexOf(s);~o&&(e.splice(o,1),--n.lc||n.off())}},notify(s,o){let r=!qt.length;for(let i of e)qt.push(i,n.value,s,o);if(r){for(Ge=0;Ge<qt.length;Ge+=qn)qt[Ge](qt[Ge+1],qt[Ge+2],qt[Ge+3]);qt.length=0}},off(){},set(s){let o=n.value;o!==s&&(n.value=s,n.notify(o))},subscribe(s){let o=n.listen(s);return s(n.value),o},value:t};return process.env.NODE_ENV!=="production"&&(n[og]=()=>{e=[],n.lc=0,n.off()}),n},cg=(t={})=>{let e=rg(t);return e.setKey=function(n,s){let o=e.value;typeof s>"u"&&n in e.value?(e.value={...e.value},delete e.value[n],e.notify(o,n)):e.value[n]!==s&&(e.value={...e.value,[n]:s},e.notify(o,n))},e};const ro={},co={},ig=t=>ro[t];function ug(t,e){var n=1024;if(t<n)return t+" B";var s=["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],o=-1;do t/=n,++o;while(t>=n);return t.toFixed(1)+" "+s[o]}function ap(t,e){const{speed:n=1}=t,{transpose:s,url:o,index:r,midi:i,label:u}=U0(t,e);let a=Math.abs(n)*Math.pow(2,s/12);return{transpose:s,url:o,index:r,midi:i,label:u,playbackRate:a}}const lp=async(t,e,n)=>{let{url:s,label:o,playbackRate:r}=ap(t,e);n&&(s=await n(s));const i=j(),u=await io(s,i,o);return t.unit==="c"&&(r=r*u.duration),{buffer:u,playbackRate:r}},dp=async(t,e,n)=>{let{buffer:s,playbackRate:o}=await lp(t,e,n);t.speed<0&&(s=pp(s));const i=j().createBufferSource();i.buffer=s,i.playbackRate.value=o;const{loopBegin:u=0,loopEnd:a=1,begin:l=0,end:p=1}=t,f=l*i.buffer.duration;t.loop&&(i.loop=!0,i.loopStart=u*i.buffer.duration-f,i.loopEnd=a*i.buffer.duration-f);const g=i.buffer.duration/i.playbackRate.value,X=(p-l)*g;return{bufferSource:i,offset:f,bufferDuration:g,sliceDuration:X}},io=(t,e,n,s=0)=>{const o=n?`sound "${n}:${s}"`:"sample";if(t=t.replace("#","%23"),!co[t]){Zt(`[sampler] load ${o}..`,"load-sample",{url:t});const r=Date.now();co[t]=fetch(t).then(i=>i.arrayBuffer()).then(async i=>{const u=Date.now()-r,a=ug(i.byteLength);Zt(`[sampler] load ${o}... done! loaded ${a} in ${u}ms`,"loaded-sample",{url:t});const l=await e.decodeAudioData(i);return ro[t]=l,l})}return co[t]};function pp(t){const e=j(),n=e.createBuffer(t.numberOfChannels,t.length,e.sampleRate);for(let s=0;s<t.numberOfChannels;s++)n.copyToChannel(t.getChannelData(s).slice().reverse(),s,s);return n}const ag=t=>ro[t];function hp(t){if(t.startsWith("bubo:")){const[e,n]=t.split(":");t=`github:Bubobubobubobubo/dough-${n}`}return t}function fp(t,e=""){if(!t.startsWith("github:"))throw new Error('expected "github:" at the start of pseudoUrl');let n=t.slice(7);n=n.endsWith("/")?n.slice(0,-1):n;let s=n.split("/"),o=s[0],r=s.length>=2?s[1]:"samples",i=s.length>=3?s[2]:"main",u=s.slice(3);return u.push(e||""),u=u.join("/"),`https://raw.githubusercontent.com/${o}/${r}/${i}/${u}`}const mp=(t,e,n=t._base||"")=>Object.entries(t).forEach(([s,o])=>{if(typeof o=="string"&&(o=[o]),typeof o!="object")throw new Error("wrong sample map format for "+s);n=o._base||n,n=hp(n),n.startsWith("github:")&&(n=fp(n,""));const r=i=>n+i;Array.isArray(o)?o=o.map(r):o=Object.fromEntries(Object.entries(o).map(([i,u])=>[i,(typeof u=="string"?[u]:u).map(r)])),e(s,o)});let yp={};function lg(t,e){yp[t]=e}function dg(t){const e=Object.entries(yp).find(([n])=>t.startsWith(n));if(e)return e[1]}async function pg(t){const e=dg(t);if(e)return e(t);if(t=hp(t),t.startsWith("github:")&&(t=fp(t,"strudel.json")),t.startsWith("local:")&&(t="http://localhost:5432"),t.startsWith("shabda:")){let[o,r]=t.split("shabda:");t=`https://shabda.ndre.gr/${r}.json?strudel=1`}if(t.startsWith("shabda/speech")){let[o,r]=t.split("shabda/speech");r=r.startsWith("/")?r.substring(1):r;let[i,u]=r.split(":"),a="f",l="en-GB";i&&([l,a]=i.split("/")),t=`https://shabda.ndre.gr/speech/${u}.json?gender=${a}&language=${l}&strudel=1'`}if(typeof fetch!="function")return;const n=Q0(t);if(typeof fetch>"u")return;const s=await fetch(t).then(o=>o.json()).catch(o=>{throw console.error(o),new Error(`error loading "${t}"`)});return[s,s._base||n]}const uo=async(t,e=t._base||"",n={})=>{if(typeof t=="string"){const[r,i]=await pg(t);return uo(r,e||i,n)}const{prebake:s,tag:o}=n;mp(t,(r,i)=>{Xp(r,i,{baseUrl:e,prebake:s,tag:o})},e)},bp=[];async function gp(t,e,n,s,o){let{s:r,nudge:i=0,cut:u,loop:a,clip:l=void 0,n:p=0,speed:f=1,duration:b}=e;if(f===0)return;const g=j();let[X,Z,W,F]=Jt([e.attack,e.decay,e.sustain,e.release]);const{bufferSource:z,sliceDuration:v,offset:x}=await dp(e,s,o);if(g.currentTime>t){Zt(`[sampler] still loading sound "${r}:${p}"`,"highlight");return}if(!z){Zt(`[sampler] could not load "${r}:${p}"`,"error");return}let R=je(z.detune,e,t);const N=t+i;z.start(N,x);const O=g.createGain(),_=z.connect(O);l==null&&a==null&&e.release==null&&(b=v);let et=t+b;Dt(_.gain,X,Z,W,F,0,1,t,et,"linear"),Ie(z.detune,e,t,et);const T=g.createGain();_.connect(T),z.onended=function(){z.disconnect(),R?.stop(),_.disconnect(),T.disconnect(),n()};let ut=et+F+.01;z.stop(ut);const q={node:T,bufferSource:z,stop:U=>{z.stop(U)}};if(u!==void 0){const U=bp[u];U&&(U.node.gain.setValueAtTime(1,N),U.node.gain.linearRampToValueAtTime(0,N+.01)),bp[u]=q}return q}function hg(t,e,n){oe(t,(s,o,r)=>gp(s,o,r,e),{type:"sample",samples:e,...n})}function Xp(t,e,n){t.startsWith("wt_")?wo(t,e,n):hg(t,e,n)}let Ue=(t,e)=>t!==void 0&&t!==e;class fg{reverbNode;delayNode;output;summingNode;djfNode;audioContext;constructor(e){this.audioContext=e,this.output=new GainNode(e,{gain:1,channelCount:2,channelCountMode:"explicit"}),this.summingNode=new GainNode(e,{gain:1,channelCount:2,channelCountMode:"explicit"}),this.summingNode.connect(this.output)}disconnect(){this.output.disconnect(),this.summingNode.disconnect(),this.delayNode?.disconnect(),this.reverbNode?.disconnect()}getDjf(e,n=0){this.djfNode==null&&(this.djfNode=kt(this.audioContext,"djf-processor",{value:e}),this.summingNode.disconnect(),this.summingNode.connect(this.djfNode),this.djfNode.connect(this.output)),this.djfNode.parameters.get("value").setValueAtTime(e,n)}getDelay(e=0,n=.5,s){return n=Xe(n,0,.98),this.delayNode==null&&(this.delayNode=this.audioContext.createFeedbackDelay(1,e,n),this.delayNode.connect(this.summingNode),this.delayNode.start?.(s)),this.delayNode.delayTime.value!==e&&this.delayNode.delayTime.setValueAtTime(e,s),this.delayNode.feedback.value!==n&&this.delayNode.feedback.setValueAtTime(n,s),this.delayNode}getReverb(e,n,s,o,r,i,u){return this.reverbNode==null&&(this.reverbNode=this.audioContext.createReverb(e,n,s,o,r,i,u),this.reverbNode.connect(this.summingNode)),(Ue(e,this.reverbNode.duration)||Ue(n,this.reverbNode.fade)||Ue(s,this.reverbNode.lp)||Ue(o,this.reverbNode.dim)||Ue(i,this.reverbNode.irspeed)||Ue(u,this.reverbNode.irbegin)||this.reverbNode.ir!==r)&&this.reverbNode.generate(e,n,s,o,r,i,u),this.reverbNode}sendReverb(e,n){return Un(e,this.reverbNode,n)}sendDelay(e,n){return Un(e,this.delayNode,n)}duck(e,n=0,s=.1,o=1){const r=n,i=Math.max(s,.002),u=this.output.gain;Le(this.audioContext,()=>{const a=this.audioContext.currentTime,l=u.value;u.cancelScheduledValues(a),u.setValueAtTime(l,a);const p=Math.max(e,a),f=Xe(1-Math.sqrt(o),.01,l);u.exponentialRampToValueAtTime(f,p+r),u.exponentialRampToValueAtTime(1,p+r+i)},0,e-.01)}connectToOutput(e){e.connect(this.summingNode)}}class mg{channelMerger;destinationGain;constructor(e){this.audioContext=e,this.initializeAudio()}initializeAudio(){const e=this.audioContext,n=e.destination.maxChannelCount;this.audioContext.destination.channelCount=n,this.channelMerger=new ChannelMergerNode(e,{numberOfInputs:e.destination.channelCount}),this.destinationGain=new GainNode(e),this.channelMerger.connect(this.destinationGain),this.destinationGain.connect(e.destination)}reset(){this.disconnect(),this.initializeAudio()}disconnect(){this.channelMerger.disconnect(),this.destinationGain.disconnect(),this.destinationGain=null,this.channelMerger=null}connectToDestination=(e,n=[0,1])=>{const s=new StereoPannerNode(this.audioContext);e.connect(s);const o=new ChannelSplitterNode(this.audioContext,{numberOfOutputs:s.channelCount});s.connect(o),n.forEach((r,i)=>{o.connect(this.channelMerger,i%s.channelCount,r%this.audioContext.destination.channelCount)})}}class yg{audioContext;output;nodes={};constructor(e){this.audioContext=e,this.output=new mg(e)}reset(){Array.from(this.nodes).forEach(e=>{e.disconnect()}),this.nodes={},this.output.reset()}duck(e,n,s=0,o=.1,r=1){const i=[e].flat(),u=[s].flat(),a=[o].flat(),l=[r].flat();i.forEach((p,f)=>{const b=this.nodes[p];if(b==null){J0(new Error(`duck target orbit ${p} does not exist`),"superdough");return}const g=u[f]??u[0],X=Math.max(a[f]??a[0],.002),Z=l[f]??l[0];b.duck(n,g,X,Z)})}getOrbit(e,n){return this.nodes[e]==null&&(this.nodes[e]=new fg(this.audioContext),this.output.connectToDestination(this.nodes[e].output,n)),this.nodes[e]}}const ao=128,lo="System Standard";let Gp=ao;function Zp(t){Gp=parseInt(t)??ao}let wp=!1;function Wp(t){wp=t==!0}const $t=cg();function oe(t,e,n={}){t=t.toLowerCase().replace(/\s+/g,"_"),$t.setKey(t,{onTrigger:e,data:n})}let Fp=t=>t;function de(t){return Fp(t)}function bg(t){Fp=t}function po(t){for(const n in t)t[n.toLowerCase()]=t[n];const e=$t.get();for(const n in e){const[s,o]=n.split("_");if(!o)continue;const r=t[s];if(r){if(typeof r=="string")e[`${r}_${o}`.toLowerCase()]=e[n];else if(Array.isArray(r))for(const i of r)e[`${i}_${o}`.toLowerCase()]=e[n]}}$t.set({...e})}async function gg(t){const n=await(await fetch(t)).json();po(n)}async function Xg(...t){switch(t.length){case 1:return typeof t[0]=="string"?gg(t[0]):po(t[0]);case 2:return po({[t[0]]:t[1]});default:throw new Error("aliasMap expects 1 or 2 arguments, received "+t.length)}}function Gg(t,e){if(Qe(t)==null){Zt("soundAlias: original sound not found");return}$t.setKey(e,Qe(t))}function Qe(t){return typeof t!="string"?(console.warn(`getSound: expected string got "${t}". fall back to triangle`),$t.get().triangle):$t.get()[t.toLowerCase()]}const Vp=async()=>{await navigator.mediaDevices.getUserMedia({audio:!0});let t=await navigator.mediaDevices.enumerateDevices();t=t.filter(n=>n.kind==="audiooutput"&&n.deviceId!=="default");const e=new Map;return e.set(lo,""),t.forEach(n=>{e.set(n.label,n.deviceId)}),e};let Wn={s:"triangle",gain:.8,postgain:1,density:".03",channels:[1,2],phaserdepth:.75,shapevol:1,distortvol:1,distorttype:0,delay:0,byteBeatExpression:"0",delayfeedback:.5,delaysync:3/16,orbit:1,i:1,velocity:1,fft:8};const Zg=Object.freeze({...Wn});function wg(t,e){Wn[t]=e}function Wg(){Wn={...Zg}}let ho=new Map(Object.entries(Wn));function fo(t,e){ho.set(t,e)}function Ft(t){return ho.get(t)}function Fg(t){Object.keys(t).forEach(e=>{fo(e,t[e])})}function Cp(){ho=new Map(Object.entries(Wn))}function Vg(t){Cp(),t==="1.0"&&fo("fanchor",.5)}const Cg=()=>$t.set({});let Lp=[];function zp(t){Lp.push(t)}let mo;function Lg(){if(!mo){const t=j(),e=Lp.concat([Db]);mo=Promise.all(e.map(n=>t.audioWorklet.addModule(n)))}return mo}async function yo(t={}){const{disableWorklets:e=!1,maxPolyphony:n,audioDeviceName:s=lo,multiChannelOrbits:o=!1}=t;if(Zp(n),Wp(o),typeof window>"u")return;const r=j();if(s!=null&&s!=lo)try{const u=(await Vp()).get(s),a=(u??"").length>0;r.sinkId!==u&&a&&await r.setSinkId(u),Zt(`[superdough] Audio Device set to ${s}, it might take a few seconds before audio plays on all output channels`)}catch{Zt("[superdough] failed to set audio interface","warning")}if(await r.resume(),e){Zt("[superdough]: AudioWorklets disabled with disableWorklets");return}try{await Lg(),Zt("[superdough] AudioWorklets loaded")}catch(i){console.warn("could not load AudioWorklet effects",i)}Zt("[superdough] ready")}let bo;async function zg(t){return bo||(bo=new Promise(e=>{document.addEventListener("mousedown",async function n(){document.removeEventListener("mousedown",n),await yo(t),e()})})),bo}let $n;function go(){return $n==null&&($n=new yg(j())),$n}function Mp(t,e){go().output.connectToDestination(t,e)}function Mg(t,e,n=1,s=.5,o=1e3,r=2e3){const i=j(),u=Gn(i,t,e,{frequency:n,depth:r*2}),a=2;let l=0;const p=[];for(let f=0;f<a;f++){const b=i.createBiquadFilter();b.type="notch",b.gain.value=1,b.frequency.value=o+l,b.Q.value=2-Math.min(Math.max(s*2,0),1.9),u.connect(b.detune),l+=282,f>0&&p[f-1].connect(b),p.push(b)}return{phaser:p[p.length-1],lfo:u}}function Rg(t){t=t??0;const e=["12db","ladder","24db"];return typeof t=="number"?e[Math.floor(_0(t,e.length))]:t}let vt={},Me={};function Rp(t,e=1024,n=.5){if(!vt[t]){const s=j().createAnalyser();s.fftSize=e,s.smoothingTimeConstant=n,vt[t]=s,Me[t]=new Float32Array(vt[t].frequencyBinCount)}return vt[t].fftSize!==e&&(vt[t].fftSize=e,Me[t]=new Float32Array(vt[t].frequencyBinCount)),vt[t]}function ts(t="time",e=1){const n={time:()=>vt[e]?.getFloatTimeDomainData(Me[e]),frequency:()=>vt[e]?.getFloatFrequencyData(Me[e])}[t];if(!n)throw new Error(`getAnalyzerData: ${t} not supported. use one of ${Object.keys(n).join(", ")}`);return n(),Me[e]}function xg(){$n?.reset(),vt={},Me={}}let Fn=new Map;function xp(t){return(Array.isArray(t)?t:[t]).map(e=>e-1)}const Xo=async(t,e,n,s=.5,o=.5)=>{const r=j(),i=go();let{stretch:u}=t;if(u!=null&&(e=e-.04),typeof t!="object")throw new Error(`expected hap.value to be an object, but got "${t}". Hint: append .note() or .s() to the end`,"error");if(t.duration=n,e<r.currentTime){console.warn(`[superdough]: cannot schedule sounds in the past (target: ${e.toFixed(2)}, now: ${r.currentTime.toFixed(2)})`);return}let{tremolo:a,tremolosync:l,tremolodepth:p=1,tremoloskew:f,tremolophase:b=0,tremoloshape:g,s:X=Ft("s"),bank:Z,source:W,gain:F=Ft("gain"),postgain:z=Ft("postgain"),density:v=Ft("density"),duckorbit:x,duckonset:R,duckattack:N,duckdepth:O,djf:_,fanchor:et=Ft("fanchor"),release:T=0,phaserrate:ut,phaserdepth:P=Ft("phaserdepth"),phasersweep:q,phasercenter:U,coarse:pt,crush:$,dry:ot,shape:ht,shapevol:Ct=Ft("shapevol"),distort:Pt,distortvol:Tt=Ft("distortvol"),distorttype:H=Ft("distorttype"),pan:I,vowel:te,delay:it=Ft("delay"),delayfeedback:re=Ft("delayfeedback"),delaysync:zt=Ft("delaysync"),delaytime:tt,orbit:rt=Ft("orbit"),room:It,roomfade:jt,roomlp:wt,roomdim:Ze,roomsize:zn,ir:we,irspeed:$e,irbegin:fe,i:xe=Ft("i"),velocity:ve=Ft("velocity"),analyze:Se,fft:tn=Ft("fft"),compressor:Ye,compressorRatio:ce,compressorKnee:Mn,compressorAttack:en,compressorRelease:Rn}=t;tt=tt??Eb(zt,s);const ns=xp(wp&&rt>0?[rt*2-1,rt*2]:Ft("channels")),xn=t.channels!=null?xp(t.channels):ns,_t=i.getOrbit(rt,xn);x!=null&&i.duck(x,e,R,N,O),F=de(le(F,1)),z=de(z),Ct=de(Ct),Tt=de(Tt),it=de(it),ve=de(ve),p=de(p),F*=ve;const Be=e+n,ss=Be+T,os=Math.round(Math.random()*1e6);for(let nt=0;nt<=Fn.size-Gp;nt++){const lt=Fn.entries().next(),yt=lt.value[1].deref(),Gt=lt.value[0],Et=e+.25;yt?.node?.gain?.linearRampToValueAtTime(0,Et),yt?.stop?.(Et),Fn.delete(Gt)}let Mt=[];if(["-","~","_"].includes(X))return;Z&&X&&(X=`${Z}_${X}`,t.s=X);let nn;if(W)nn=W(e,t,n,s);else if(Qe(X)){const{onTrigger:nt}=Qe(X),yt=await nt(e,t,()=>{Mt.forEach(Gt=>Gt?.disconnect()),Fn.delete(os)},s);yt&&(nn=yt.node,Fn.set(os,new WeakRef(yt)))}else throw new Error(`sound ${X} not found! Is it loaded?`);if(!nn)return;if(r.currentTime>e){Zt("[webaudio] skip hap: still loading",r.currentTime-e);return}const at=[];at.push(nn),u!==void 0&&at.push(kt(r,"phase-vocoder-processor",{pitchFactor:u})),at.push(xt(F));const vn=Rg(t.ftype);if(t.cutoff!==void 0){const lt=qs(t,{frequency:"cutoff",q:"resonance",attack:"lpattack",decay:"lpdecay",sustain:"lpsustain",release:"lprelease",env:"lpenv",anchor:"fanchor",model:"ftype",drive:"drive",rate:"lprate",sync:"lpsync",depth:"lpdepth",depthfrequency:"lpdepthfrequency",shape:"lpshape",dcoffset:"lpdc",skew:"lpskew"});lt.type="lowpass";const yt=()=>Qn(r,e,Be,lt,s,o),{filter:Gt,lfo:Et}=yt();if(at.push(Gt),Et&&Mt.push(Et),vn==="24db"){const{filter:Te,lfo:ie}=yt();at.push(Te),ie&&Mt.push(ie)}}if(t.hcutoff!==void 0){const lt=qs(t,{frequency:"hcutoff",q:"hresonance",attack:"hpattack",decay:"hpdecay",sustain:"hpsustain",release:"hprelease",env:"hpenv",anchor:"fanchor",model:"ftype",drive:"drive",rate:"hprate",sync:"hpsync",depth:"hpdepth",depthfrequency:"hpdepthfrequency",shape:"hpshape",dcoffset:"hpdc",skew:"hpskew"});lt.type="highpass";const yt=()=>Qn(r,e,Be,lt,s,o),{filter:Gt,lfo:Et}=yt();if(at.push(Gt),Et&&Mt.push(Et),vn==="24db"){const{filter:Te,lfo:ie}=yt();at.push(Te),ie&&Mt.push(ie)}}if(t.bandf!==void 0){const lt=qs(t,{frequency:"bandf",q:"bandq",attack:"bpattack",decay:"bpdecay",sustain:"bpsustain",release:"bprelease",env:"bpenv",anchor:"fanchor",model:"ftype",drive:"drive",rate:"bprate",sync:"bpsync",depth:"bpdepth",depthfrequency:"bpdepthfrequency",shape:"bpshape",dcoffset:"bpdc",skew:"bpskew"});lt.type="bandpass";const yt=()=>Qn(r,e,Be,lt,s,o),{filter:Gt,lfo:Et}=yt();if(at.push(Gt),Et&&Mt.push(Et),vn==="24db"){const{filter:Te,lfo:ie}=yt();at.push(Te),ie&&Mt.push(ie)}}if(te!==void 0){const nt=r.createVowelFilter(te);at.push(nt)}if(pt!==void 0&&at.push(kt(r,"coarse-processor",{coarse:pt})),$!==void 0&&at.push(kt(r,"crush-processor",{crush:$})),ht!==void 0&&at.push(kt(r,"shape-processor",{shape:ht,postgain:Ct})),Pt!==void 0&&at.push(up(Pt,Tt,H)),l!=null&&(a=s*l),t.wtPosSynced!=null&&(t.wtPosRate/=s),t.wtWarpSynced!=null&&(t.wtWarpRate/=s),a!==void 0){const nt=Math.max(1-p,0),lt=new GainNode(r,{gain:nt}),yt=o/s,Gt=Gn(r,e,ss,{skew:f??(g!=null?.5:1),frequency:a,depth:p,time:yt,dcoffset:0,shape:g,phaseoffset:b,min:0,max:1,curve:1.5});Gt.connect(lt.gain),Mt.push(Gt),at.push(lt)}if(Ye!==void 0&&at.push(np(r,Ye,ce,Mn,en,Rn)),I!==void 0){const nt=r.createStereoPanner();nt.pan.value=2*I-1,at.push(nt)}if(ut!==void 0&&P>0){const{phaser:nt,lfo:lt}=Mg(e,ss,ut,P,U,q);Mt.push(lt),at.push(nt)}const ke=new GainNode(r,{gain:z});if(at.push(ke),it>0&&tt>0&&re>0){_t.getDelay(tt,re,e);const nt=_t.sendDelay(ke,it);Mt.push(nt)}if(It>0){let nt;if(we!==void 0){let yt,Gt=Qe(we);Array.isArray(Gt)?yt=Gt.data.samples[xe%Gt.data.samples.length]:typeof Gt=="object"&&(yt=Object.values(Gt.data.samples).flat()[xe%Object.values(Gt.data.samples).length]),nt=await io(yt,r,we,0)}_t.getReverb(zn,jt,wt,Ze,nt,$e,fe);const lt=_t.sendReverb(ke,It);Mt.push(lt)}if(_!=null&&_t.getDjf(_,e),Se){const nt=Rp(Se,2**(tn+5)),lt=Un(ke,nt,1);Mt.push(lt)}if(ot!=null){ot=de(ot);const nt=new GainNode(r,{gain:ot});at.push(nt),_t.connectToOutput(nt)}else _t.connectToOutput(ke);at.slice(1).reduce((nt,lt)=>nt.connect(lt),at[0]),Mt=Mt.concat(at)},vg=(t,e,n,s)=>{Xo(e,t-n,e.duration/s,s)},Sg=["triangle","square","sawtooth","sine","user"],Yg=[["tri","triangle"],["sqr","square"],["saw","sawtooth"],["sin","sine"]];function Bg(t,e){const n=t,s=new Float32Array(e);for(let o=0;o<e;o++){const r=o*2/e-1;s[o]=Math.tanh(r*n)}return s}function kg(){[...Sg].forEach(t=>{oe(t,(e,n,s)=>{const[o,r,i,u]=Jt([n.attack,n.decay,n.sustain,n.release],"linear",[.001,.05,.6,.01]),a=xt(.3);let l=Yp(t,e,n,()=>{a.disconnect(),s()}),{node:p,stop:f,triggerRelease:b}=l;const{duration:g}=n,X=xt(1);let Z=p.connect(a).connect(X);const W=e+g;Dt(Z.gain,o,r,i,u,0,1,e,W,"linear");const F=W+u+.01;return b?.(F),f(F),{node:Z,stop:z=>{f(z)}}},{type:"synth",prebake:!0})}),oe("sbd",(t,e,n)=>{const{duration:s,decay:o=.5,pdecay:r=.5,penv:i=36,clip:u}=e,a=j(),l=.02,p=1.2,f=.025,b=1,g=a.createOscillator();g.type="triangle",g.frequency.value=ze(e,29),g.detune.setValueAtTime(i*100,0),g.detune.setValueAtTime(i*100,t),g.detune.exponentialRampToValueAtTime(.001,t+r);const X=xt(1);X.gain.setValueAtTime(1,t+l),X.gain.exponentialRampToValueAtTime(.001,t+l+o),g.start(t);const Z=to("brown",t,2),W=xt(1);W.gain.setValueAtTime(p,t),W.gain.exponentialRampToValueAtTime(.001,t+f);const F=new WaveShaperNode(a);F.curve=Bg(2,a.sampleRate);const z=xt(b);g.onended=()=>{g.disconnect(),X.disconnect(),F.disconnect(),Z.node.disconnect(),W.disconnect(),z.disconnect(),n()};const v=g.connect(F).connect(X).connect(z);Z.node.connect(W).connect(z);let R=t+o+.01;return u!=null&&(R=Math.min(t+u*s,R)),z.gain.setValueAtTime(b,R-.01),z.gain.linearRampToValueAtTime(0,R),g.stop(R),Z.stop(R),{node:v,stop:N=>{g.stop(N)}}},{type:"synth",prebake:!0}),oe("supersaw",(t,e,n)=>{const s=j();let{duration:o,n:r,unison:i=5,spread:u=.6,detune:a}=e;a=a??r??.18;const l=ze(e),[p,f,b,g]=Jt([e.attack,e.decay,e.sustain,e.release],"linear",[.001,.05,.6,.01]),X=t+o,Z=X+g+.01,W=Xe(i,1,100);let F=W>1?Xe(u,0,1):0,z=kt(s,"supersaw-oscillator",{frequency:l,begin:t,end:Z,freqspread:a,voices:W,panspread:F},{outputChannelCount:[2]});const v=1/Math.sqrt(W);Ie(z.parameters.get("detune"),e,t,X);const x=je(z.parameters.get("detune"),e,t),R=Zn(z.parameters.get("frequency"),e,t);let N=xt(1);N=z.connect(N),Dt(N.gain,p,f,b,g,0,.3*v,t,X,"linear");let O=Le(s,()=>{Oe(z),N.disconnect(),n(),R?.stop(),x?.stop()},t,Z);return{node:N,stop:_=>{O.stop(_)}}},{prebake:!0,type:"synth"}),oe("bytebeat",(t,e,n)=>{const s=["(t%255 >= t/255%255)*255","(t*(t*8%60 <= 300)|(-t)*(t*4%512 < 256))+t/400","t","t*(t >> 10^t)","t&128","t&t>>8","((t%255+t%128+t%64+t%32+t%16+t%127.8+t%64.8+t%32.8+t%16.8)/3)","((t%64+t%63.8+t%64.15+t%64.35+t%63.5)/1.25)","(t&(t>>7)-t)","(sin(t*PI/128)*127+127)","((t^t/2+t+64*(sin((t*PI/64)+(t*PI/32768))+64))%128*2)","((t^t/2+t+64*(cos >> 0))%127.85*2)","((t^t/2+t+64)%128*2)","(((t * .25)^(t * .25)/100+(t * .25))%128)*2","((t^t/2+t+64)%7 * 24)"],{n:o=0}=e,r=ze(e),{byteBeatExpression:i=s[o%s.length],byteBeatStartTime:u}=e,a=j();let{duration:l}=e;const[p,f,b,g]=Jt([e.attack,e.decay,e.sustain,e.release],"linear",[.001,.05,.6,.01]),X=t+l,Z=X+g+.01;let W=kt(a,"byte-beat-processor",{frequency:r,begin:t,end:Z},{outputChannelCount:[2]});W.port.postMessage({codeText:i,byteBeatStartTime:u,frequency:r});let F=xt(1);F=W.connect(F),Dt(F.gain,p,f,b,g,0,1,t,X,"linear");let z=Le(a,()=>{Oe(W),F.disconnect(),n()},t,Z);return{node:F,stop:v=>{z.stop(v)}}},{prebake:!0,type:"synth"}),oe("pulse",(t,e,n)=>{const s=j();let{pwrate:o,pwsweep:r}=e;r==null&&(o!=null?r=.3:r=0),o==null&&r!=null&&(o=1);let{duration:i,pw:u=.5}=e;const a=ze(e),[l,p,f,b]=Jt([e.attack,e.decay,e.sustain,e.release],"linear",[.001,.05,.6,.01]),g=t+i,X=g+b+.01;let Z=kt(s,"pulse-oscillator",{frequency:a,begin:t,end:X,pulsewidth:u},{outputChannelCount:[2]});Ie(Z.parameters.get("detune"),e,t,g);const W=je(Z.parameters.get("detune"),e,t),F=Zn(Z.parameters.get("frequency"),e,t);let z=xt(1);z=Z.connect(z),Dt(z.gain,l,p,f,b,0,1,t,g,"linear");let v;r!=0&&(v=Gn(s,t,X,{frequency:o,depth:r}),v.connect(Z.parameters.get("pulsewidth")));let x=Le(s,()=>{Oe(Z),Oe(v),z.disconnect(),n(),F?.stop(),W?.stop()},t,X);return{node:z,stop:R=>{x.stop(R)}}},{prebake:!0,type:"synth"}),[...eo].forEach(t=>{oe(t,(e,n,s)=>{const[o,r,i,u]=Jt([n.attack,n.decay,n.sustain,n.release],"linear",[.001,.05,.6,.01]);let a,{density:l}=n;a=to(t,e,l);let{node:p,stop:f,triggerRelease:b}=a;const g=xt(.3),{duration:X}=n;p.onended=()=>{p.disconnect(),g.disconnect(),s()};const Z=xt(1);let W=p.connect(g).connect(Z);const F=e+X;Dt(W.gain,o,r,i,u,0,1,e,F,"linear");const z=F+u+.01;return b?.(z),f(z),{node:W,stop:v=>{f(v)}}},{type:"synth",prebake:!0})}),Yg.forEach(([t,e])=>$t.set({...$t.get(),[t]:$t.get()[e]}))}const vp=2*Math.PI;function Sp(t,e,n){t=typeof t=="object"?t:new Float32Array(t).fill(1);const o=t.length,r=new Float32Array(o+1),i=new Float32Array(o+1),u=j(),a=u.createOscillator(),l={sawtooth:f=>[0,-1/f],square:f=>[0,f%2===0?0:1/f],triangle:f=>[f%2===0?0:1/(f*f),0],user:f=>[0,1]};if(!l[n])throw new Error(`unknown wave type ${n}`);for(let f=0;f<o;f++){const b=t[f],[g,X]=l[n](f+1),Z=e?.[f]??0;let W=g*b,F=X*b;if(Z!==0){const z=Math.cos(vp*Z),v=Math.sin(vp*Z);W=z*W-v*F,F=v*W+z*F}r[f+1]=W,i[f+1]=F}const p=u.createPeriodicWave(r,i);return a.setPeriodicWave(p),a}function Yp(t,e,n,s){const{duration:o,noise:r=0}=n,i=n.partials??n.n;let u;t==="user"&&!i&&(Zt("[superdough] Synth 'user' was selected, but partials not specified. Defaulting to triangle. Use pat.partials to setup custom waveform"),t="triangle"),t=t==="user"&&!i?"triangle":t,!i||i?.length===0||t==="sine"?(u=j().createOscillator(),u.type=t||"triangle"):u=Sp(i,n.phases,t),u.frequency.value=ze(n);let a=je(u.detune,n,e);Ie(u.detune,n,e,e+o);const l=Zn(u.frequency,n,e);let p;return r&&(p=Ib(u,r,e)),u.onended=()=>{p||u.disconnect(),p?.node.disconnect(),s()},u.start(e),{node:p?.node||u,stop:f=>{l.stop(f),a?.stop(f),p?.stop(f),u.stop(f)},triggerRelease:f=>{}}}function Tg(t=1,e=.05,n=220,s=0,o=0,r=.1,i=0,u=1,a=0,l=0,p=0,f=0,b=0,g=0,X=0,Z=0,W=0,F=1,z=0,v=0){let x=Math.PI*2,R=j().sampleRate,N=Ct=>Ct>0?1:-1,O=a*=500*x/R/R,_=n*=(1+e*2*Math.random()-e)*x/R,et=[],T=0,ut=0,P=0,q=1,U=0,pt=0,$=0,ot,ht;for(s=s*R+9,z*=R,o*=R,r*=R,W*=R,l*=500*x/R**3,X*=x/R,p*=x/R,f*=R,b=b*R|0,ht=s+z+o+r+W|0;P<ht;et[P++]=$)++pt%(Z*100|0)||($=i?i>1?i>2?i>3?Math.sin((T%x)**3):Math.max(Math.min(Math.tan(T),1),-1):1-(2*T/x%2+2)%2:1-4*Math.abs(Math.round(T/x)-T/x):Math.sin(T),$=(b?1-v+v*Math.sin(x*P/b):1)*N($)*Math.abs($)**u*t*1*(P<s?P/s:P<s+z?1-(P-s)/z*(1-F):P<s+z+o?F:P<ht-W?(ht-P-W)/r*F:0),$=W?$/2+(W>P?0:(P<ht-W?1:(ht-P)/W)*et[P-W|0]/2):$),ot=(n+=a+=l)*Math.cos(X*ut++),T+=ot-ot*g*(1-(Math.sin(P)+1)*1e9%2),q&&++q>f&&(n+=p,_+=p,q=0),b&&!(++U%b)&&(n=_,a=O,q||=1);return et}const Bp=(t,e)=>{let{s:n,note:s=36,freq:o,zrand:r=0,attack:i=0,decay:u=0,sustain:a=.8,release:l=.1,curve:p=1,slide:f=0,deltaSlide:b=0,pitchJump:g=0,pitchJumpTime:X=0,lfo:Z=0,znoise:W=0,zmod:F=0,zcrush:z=0,zdelay:v=0,tremolo:x=0,duration:R=.2,zzfx:N}=t;const O=Math.max(R-i-u,0);typeof s=="string"&&(s=_n(s)),!o&&typeof s=="number"&&(o=j0(s)),n=n.replace("z_","");const _=["sine","triangle","sawtooth","tan","noise"].indexOf(n)||0;p=n==="square"?0:p;const T=Tg(...N||[.25,r,o,i,O,l,_,p,f,b,g,X,Z,W,F,z,v,a,u,x]),ut=j(),P=ut.createBuffer(1,T.length,ut.sampleRate);P.getChannelData(0).set(T);const q=j().createBufferSource();return q.buffer=P,q.start(e),{node:q}};function Ag(){["zzfx","z_sine","z_sawtooth","z_triangle","z_square","z_tan","z_noise"].forEach(t=>{oe(t,(e,n,s)=>{const{node:o}=Bp({s:t,...n},e);return o.onended=()=>{o.disconnect(),s()},{node:o,stop:()=>{}}},{type:"synth",prebake:!0})})}let qe;async function kp(t,e){const n=`dsp-worklet-${Date.now()}`,s=`${e}
let __q = []; // trigger queue
class MyProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.t = 0;
    this.stopped = false;
    this.port.onmessage = (e) => {
      if(e.data==='stop') {
        this.stopped = true;
      } else if(e.data?.dough) {
        __q.push(e.data)
      } else {
        msg?.(e.data)
      }
    };
  }
  process(inputs, outputs, parameters) {
    const output = outputs[0];
    if(__q.length) {
      for(let i=0;i<__q.length;++i) {
        const deadline = __q[i].time-currentTime;
        if(deadline<=0) {
          trigger(__q[i].dough)
          __q.splice(i,1)
        }
      }
    }
    for (let i = 0; i < output[0].length; i++) {
      const out = dsp(this.t / sampleRate);
      output.forEach((channel) => {
        channel[i] = out;
      });
      this.t++;
    }
  return !this.stopped;
  }
}
registerProcessor('${n}', MyProcessor);
`,r=`data:text/javascript;base64,${btoa(s)}`;await t.audioWorklet.addModule(r);const i=new AudioWorkletNode(t,n);return{node:i,stop:()=>i.port.postMessage("stop")}}const Tp=()=>{qe&&(qe?.stop(),qe?.node?.disconnect())};typeof window<"u"&&window.addEventListener("message",t=>{t.data==="strudel-stop"?Tp():t.data?.dough&&qe?.node.port.postMessage(t.data)});const Ng=async t=>{const e=j();Tp(),qe=await kp(e,t),qe.node.connect(e.destination)};function Ap(t,e,n,s){window.postMessage({time:s,dough:t.value,currentTime:e,duration:t.duration,cps:n})}const Go=Object.freeze({NONE:0,ASYM:1,MIRROR:2,BENDP:3,BENDM:4,BENDMP:5,SYNC:6,QUANT:7,FOLD:8,PWM:9,ORBIT:10,SPIN:11,CHAOS:12,PRIMES:13,BINARY:14,BROWNIAN:15,RECIPROCAL:16,WORMHOLE:17,LOGISTIC:18,SIGMOID:19,FRACTAL:20,FLIP:21}),Np=new Set;async function Kg(t,e,n=2048){const s=`${t},${n}`;if(!Np.has(s)){const r=(await Dg(t,e)).getChannelData(0),i=r.length,u=Math.max(1,Math.floor(i/n)),a=new Array(u);for(let l=0;l<u;l++){const p=l*n;a[l]=r.subarray(p,p+n)}return Np.add(s),{frames:a,frameLen:n,numFrames:u,key:s}}return{frameLen:n,key:s}}function Hg(t,e){var n=1024;if(t<n)return t+" B";var s=["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],o=-1;do t/=n,++o;while(t>=n);return t.toFixed(1)+" "+s[o]}function Pg(t){const e=new DataView(t);let n=12;for(;n+8<=e.byteLength;){const s=String.fromCharCode(e.getUint8(n),e.getUint8(n+1),e.getUint8(n+2),e.getUint8(n+3)),o=e.getUint32(n+4,!0);if(s==="fmt ")return e.getUint32(n+12,!0);n+=8+o+(o&1)}return null}async function Eg(t){const e=Pg(t)||44100;return await new OfflineAudioContext(1,1,e).decodeAudioData(t)}const Zo={},Dg=(t,e)=>{if(t=t.replace("#","%23"),!Zo[t]){Zt(`[wavetable] load table ${e}..`,"load-table",{url:t});const n=Date.now();Zo[t]=fetch(t).then(s=>s.arrayBuffer()).then(async s=>{const o=Date.now()-n,r=Hg(s.byteLength);return Zt(`[wavetable] load table ${e}... done! loaded ${r} in ${o}ms`,"loaded-table",{url:t}),await Eg(s)})}return Zo[t]};function Kp(t,e=""){if(!t.startsWith("github:"))throw new Error('expected "github:" at the start of pseudoUrl');let[n,s]=t.split("github:");return s=s.endsWith("/")?s.slice(0,-1):s,s.split("/").length===2&&(s+="/main"),`https://raw.githubusercontent.com/${s}/${e}`}const Hp=(t,e,n,s={})=>(e=t._base||e,Object.entries(t).forEach(([o,r])=>{if(o==="_base")return!1;if(typeof r=="string"&&(r=[r]),typeof r!="object")throw new Error("wrong json format for "+o);let i=e;i.startsWith("github:")&&(i=Kp(i,"")),r=r.map(u=>i+u).filter(u=>u.toLowerCase().endsWith(".wav")?!0:(Zt(`[wavetable] skipping ${u} -- wavetables must be ".wav" format`),!1)),r.length&&wo(o,r,{baseUrl:e,frameLen:n})}));function wo(t,e,n){oe(t,(s,o,r,i)=>Pp(s,o,r,e,i,n?.frameLen??2048),{type:"wavetable",tables:e,...n})}const Jg=async(t,e,n,s={})=>{if(n!==void 0)return Hp(n,t,e);t.startsWith("github:")&&(t=Kp(t,"strudel.json")),t.startsWith("local:")&&(t="http://localhost:5432");const o=Q0(t);if(typeof fetch=="function"&&!(typeof fetch>"u"))return fetch(t).then(r=>r.json()).then(r=>Hp(r,o,e,s)).catch(r=>{throw console.error(r),new Error(`error loading "${t}"`)})};async function Pp(t,e,n,s,o,r){const{s:i,n:u=0,duration:a,clip:l}=e,p=j(),[f,b,g,X]=Jt([e.attack,e.decay,e.sustain,e.release]);let{warpmode:Z}=e;typeof Z=="string"&&(Z=Go[Z.toUpperCase()]??Go.NONE);const W=ze(e),{url:F,label:z}=U0(e,s),v=await Kg(F,z,r);let x=t+a;l!==void 0&&(x=Math.min(t+l*a,x));const R=x+X,N=R+.01,O=kt(p,"wavetable-oscillator-processor",{begin:t,end:N,frequency:W,freqspread:e.detune,position:e.wt,warp:e.warp,warpMode:Z,voices:Math.max(e.unison??1,1),panspread:e.spread,phaserand:e.wtphaserand??e.unison>1?1:0},{outputChannelCount:[2]});if(O.port.postMessage({type:"table",payload:v}),p.currentTime>t){Zt(`[wavetable] still loading sound "${i}:${u}"`,"highlight");return}const _=[e.wtattack,e.wtdecay,e.wtsustain,e.wtrelease],et=[e.warpattack,e.warpdecay,e.warpsustain,e.warprelease],T=O.parameters,ut=T.get("position"),P=T.get("warp");let q=e.wtrate;e.wtsync!=null&&(q=o*e.wtsync);const U=so(p,ut,t,R,{offset:e.wt,amount:e.wtenv,defaultAmount:.5,values:_,holdEnd:x,defaultValues:[0,.5,0,.1]},{frequency:q,depth:e.wtdepth,defaultDepth:.5,shape:e.wtshape,skew:e.wtskew,dcoffset:e.wtdc??0});let pt=e.warprate;e.warpsync!=null&&(pt=pt=o*e.warpsync);const $=so(p,P,t,R,{offset:e.warp,amount:e.warpenv,defaultAmount:.5,values:et,holdEnd:x,defaultValues:[0,.5,0,.1]},{frequency:pt,depth:e.warpdepth,defaultDepth:.5,shape:e.warpshape,skew:e.warpskew,dcoffset:e.warpdc??0}),ot=je(O.parameters.get("detune"),e,t),ht=Zn(O.parameters.get("frequency"),e,t),Ct=p.createGain(),Pt=O.connect(Ct);Dt(Pt.gain,f,b,g,X,0,.3,t,x,"linear"),Ie(O.parameters.get("detune"),e,t,x);const Tt={node:Pt,source:O},H=Le(p,()=>{Oe(O),ot?.stop(),ht?.stop(),Pt.disconnect(),U?.disconnect(),$?.disconnect(),n()},t,N);return Tt.stop=I=>{H.stop(I)},Tt}let Vn;function Ig(){const t=j();Vn=kt(t,"dough-processor",{},{outputChannelCount:[2]}),Mp(Vn)}const es=new Map,Ep=new Map;L.prototype.supradough=function(){return this.onTrigger((t,e,n,s)=>{t.value._begin=s,t.value._duration=t.duration/n,!Vn&&Ig();const o=(t.value.bank?t.value.bank+"_":"")+t.value.s,r=t.value.n??0,i=`${o}:${r}`;if(es.has(o)&&(t.value.s=i),es.has(o)&&!Ep.has(i)){const u=es.get(o),a=u[r%u.length];console.log(`load ${i} from ${a}`);const l=Og(a);Ep.set(i,l),l.then(({channels:p,sampleRate:f})=>Vn.port.postMessage({sample:i,channels:p,sampleRate:f}))}Vn.port.postMessage({spawn:t.value})},1)};function jg(t,e=""){if(!t.startsWith("github:"))throw new Error('expected "github:" at the start of pseudoUrl');let[n,s]=t.split("github:");return s=s.endsWith("/")?s.slice(0,-1):s,s.split("/").length===2&&(s+="/main"),`https://raw.githubusercontent.com/${s}/${e}`}async function _g(t){if(t.startsWith("github:")&&(t=jg(t,"strudel.json")),t.startsWith("local:")&&(t="http://localhost:5432"),t.startsWith("shabda:")){let[s,o]=t.split("shabda:");t=`https://shabda.ndre.gr/${o}.json?strudel=1`}if(t.startsWith("shabda/speech")){let[s,o]=t.split("shabda/speech");o=o.startsWith("/")?o.substring(1):o;let[r,i]=o.split(":"),u="f",a="en-GB";r&&([a,u]=r.split("/")),t=`https://shabda.ndre.gr/speech/${i}.json?gender=${u}&language=${a}&strudel=1'`}if(typeof fetch!="function")return;const e=t.split("/").slice(0,-1).join("/");if(typeof fetch>"u")return;const n=await fetch(t).then(s=>s.json()).catch(s=>{throw console.error(s),new Error(`error loading "${t}"`)});return[n,n._base||e]}async function Og(t){const e=await fetch(t).then(s=>s.arrayBuffer()).then(s=>j().decodeAudioData(s));let n=[];for(let s=0;s<e.numberOfChannels;s++)n.push(e.getChannelData(s));return{channels:n,sampleRate:e.sampleRate}}async function Dp(t,e){if(typeof t=="string"){const[n,s]=await _g(t);return Dp(n,s)}Object.entries(t).map(async([n,s])=>{n!=="_base"&&(s=s.map(o=>e+o),es.set(n,s))})}const Ug="data:text/javascript;base64,KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NvbnN0IGQ9dHlwZW9mIHNhbXBsZVJhdGU8InUiP3NhbXBsZVJhdGU6NDhlMyxBPU1hdGguUEkvZCxiPTEvZDtsZXQgRT1pPT5NYXRoLnBvdyhpLDIpO2NvbnN0IFY9KGkscyx0KT0+TWF0aC5taW4oTWF0aC5tYXgoaSxzKSx0KTtmdW5jdGlvbiBjKGkpe3JldHVybiBFKGkpfWZ1bmN0aW9uIE8oaSxzLHQpe2NvbnN0IGU9TWF0aC5zaW4oKDEtdCkqLjUqTWF0aC5QSSksaD1NYXRoLnNpbih0Ki41Kk1hdGguUEkpO3JldHVybiBpKmUrcypofWNsYXNzIHZ7cGhhc2U9MDt1cGRhdGUocyl7Y29uc3QgdD1NYXRoLnNpbih0aGlzLnBoYXNlKjIqTWF0aC5QSSk7cmV0dXJuIHRoaXMucGhhc2U9KHRoaXMucGhhc2Urcy9kKSUxLHR9fWNsYXNzIHh7cGhhc2U9MDt1cGRhdGUocyl7cmV0dXJuIHRoaXMucGhhc2UrPWIqcyx0aGlzLnBoYXNlJTEqMi0xfX1mdW5jdGlvbiB5KGkscyl7cmV0dXJuIGk8cz8oaS89cyxpK2ktaSppLTEpOmk+MS1zPyhpPShpLTEpL3MsaSppK2kraSsxKTowfWNsYXNzIFJ7Y29uc3RydWN0b3Iocz17fSl7dGhpcy5waGFzZT1zLnBoYXNlPz8wfXVwZGF0ZShzKXtjb25zdCB0PXMvZDtsZXQgZT15KHRoaXMucGhhc2UsdCksaD0yKnRoaXMucGhhc2UtMS1lO3JldHVybiB0aGlzLnBoYXNlKz10LHRoaXMucGhhc2U+MSYmKHRoaXMucGhhc2UtPTEpLGh9fWZ1bmN0aW9uIFQoaSxzLHQpe3JldHVybiBpPDI/MDooKGgsbyxuKT0+biooby1oKStoKSgtcyouNSxzKi41LHQvKGktMSkpfWZ1bmN0aW9uIHooaSxzKXtyZXR1cm4gaSpNYXRoLnBvdygyLHMvMTIpfWNsYXNzIEZ7Y29uc3RydWN0b3Iocz17fSl7dGhpcy52b2ljZXM9cy52b2ljZXM/PzUsdGhpcy5mcmVxc3ByZWFkPXMuZnJlcXNwcmVhZD8/LjIsdGhpcy5wYW5zcHJlYWQ9cy5wYW5zcHJlYWQ/Py40LHRoaXMucGhhc2U9bmV3IEZsb2F0MzJBcnJheSh0aGlzLnZvaWNlcykubWFwKCgpPT5NYXRoLnJhbmRvbSgpKX11cGRhdGUocyl7Y29uc3QgdD1NYXRoLnNxcnQoMS10aGlzLnBhbnNwcmVhZCksZT1NYXRoLnNxcnQodGhpcy5wYW5zcHJlYWQpO2xldCBoPTAsbz0wO2ZvcihsZXQgbj0wO248dGhpcy52b2ljZXM7bisrKXtjb25zdCBhPXoocyxUKHRoaXMudm9pY2VzLHRoaXMuZnJlcXNwcmVhZCxuKSkvZCxwPShuJjEpPT0xO2xldCB1PXQ7cCYmKHU9ZSk7bGV0IHE9eSh0aGlzLnBoYXNlW25dLGEpLEQ9Mip0aGlzLnBoYXNlW25dLTEtcTtoPWgrRCp1LG89bytEKnUsdGhpcy5waGFzZVtuXSs9YSx0aGlzLnBoYXNlW25dPjEmJih0aGlzLnBoYXNlW25dLT0xKX1yZXR1cm4gaCtvfX1jbGFzcyB3e3BoYXNlPTA7dXBkYXRlKHMpe3RoaXMucGhhc2UrPWIqcztsZXQgdD10aGlzLnBoYXNlJTE7cmV0dXJuKHQ8LjU/Mip0OjEtMioodC0uNSkpKjItMX19Y2xhc3MgZ3tzMD0wO3MxPTA7dXBkYXRlKHMsdCxlPTApe2U9TWF0aC5tYXgoZSwwKSx0PU1hdGgubWluKHQsMmU0KTtsZXQgaD0yKk1hdGguc2luKHQqQSk7aD1WKGgsMCwxLjE0KTtjb25zdCBuPTEtTWF0aC5wb3coLjUsKGUrLjEyNSkvLjEyNSkqaDtyZXR1cm4gdGhpcy5zMD1uKnRoaXMuczAtaCp0aGlzLnMxK2gqcyx0aGlzLnMxPW4qdGhpcy5zMStoKnRoaXMuczAsdGhpcy5zMX19Y2xhc3MgSXtjb25zdHJ1Y3RvcihzPTApe3RoaXMucGhhc2U9c31zYXcocyx0KXtsZXQgZT0odGhpcy5waGFzZStzKSUxLGg9eShlLHQpO3JldHVybiAyKmUtMS1ofXVwZGF0ZShzLHQ9LjUpe2NvbnN0IGU9cy9kO2xldCBoPXRoaXMuc2F3KDAsZSktdGhpcy5zYXcodCxlKTtyZXR1cm4gdGhpcy5waGFzZT0odGhpcy5waGFzZStlKSUxLGgrdCoyLTF9fWNsYXNzIEx7cGhhc2U9MDt1cGRhdGUocyx0PS41KXtyZXR1cm4gdGhpcy5waGFzZSs9YipzLHRoaXMucGhhc2UlMTx0PzE6LTF9fWNsYXNzIFN7dXBkYXRlPXM9Pk1hdGgucmFuZG9tKCk8cypiP01hdGgucmFuZG9tKCk6MH1jbGFzcyBOe3VwZGF0ZSgpe3JldHVybiBNYXRoLnJhbmRvbSgpKjItMX19Y2xhc3MgQntjb25zdHJ1Y3Rvcigpe3RoaXMub3V0PTB9dXBkYXRlKCl7bGV0IHM9TWF0aC5yYW5kb20oKSoyLTE7cmV0dXJuIHRoaXMub3V0PSh0aGlzLm91dCsuMDIqcykvMS4wMix0aGlzLm91dH19Y2xhc3MgR3tjb25zdHJ1Y3Rvcigpe3RoaXMuYjA9MCx0aGlzLmIxPTAsdGhpcy5iMj0wLHRoaXMuYjM9MCx0aGlzLmI0PTAsdGhpcy5iNT0wLHRoaXMuYjY9MH11cGRhdGUoKXtjb25zdCBzPU1hdGgucmFuZG9tKCkqMi0xO3RoaXMuYjA9Ljk5ODg2KnRoaXMuYjArcyouMDU1NTE3OSx0aGlzLmIxPS45OTMzMip0aGlzLmIxK3MqLjA3NTA3NTksdGhpcy5iMj0uOTY5KnRoaXMuYjIrcyouMTUzODUyLHRoaXMuYjM9Ljg2NjUqdGhpcy5iMytzKi4zMTA0ODU2LHRoaXMuYjQ9LjU1KnRoaXMuYjQrcyouNTMyOTUyMix0aGlzLmI1PS0uNzYxNip0aGlzLmI1LXMqLjAxNjg5ODtjb25zdCB0PXRoaXMuYjArdGhpcy5iMSt0aGlzLmIyK3RoaXMuYjMrdGhpcy5iNCt0aGlzLmI1K3RoaXMuYjYrcyouNTM2MjtyZXR1cm4gdGhpcy5iNj1zKi4xMTU5MjYsdCouMTF9fWNsYXNzIGp7cGhhc2U9MTt1cGRhdGUocyl7dGhpcy5waGFzZSs9YipzO2xldCB0PXRoaXMucGhhc2U+PTE/MTowO3JldHVybiB0aGlzLnBoYXNlPXRoaXMucGhhc2UlMSx0fX1mdW5jdGlvbiBNKGkscyx0LGU9MSl7aWYoaTw9MClyZXR1cm4gcztpZihpPj0xKXJldHVybiB0O2xldCBoO3JldHVybiBlPT09MD9oPWk6ZT4wP2g9TWF0aC5wb3coaSxlKTpoPTEtTWF0aC5wb3coMS1pLC1lKSxzKyh0LXMpKmh9Y2xhc3MgZntjb25zdHJ1Y3RvcihzPXt9KXt0aGlzLnN0YXRlPSJvZmYiLHRoaXMuc3RhcnRUaW1lPTAsdGhpcy5zdGFydFZhbD0wLHRoaXMuZGVjYXlDdXJ2ZT1zLmRlY2F5Q3VydmU/PzF9dXBkYXRlKHMsdCxlLGgsbyxuKXtzd2l0Y2godGhpcy5zdGF0ZSl7Y2FzZSJvZmYiOnJldHVybiB0PjAmJih0aGlzLnN0YXRlPSJhdHRhY2siLHRoaXMuc3RhcnRUaW1lPXMsdGhpcy5zdGFydFZhbD0wKSwwO2Nhc2UiYXR0YWNrIjp7bGV0IGw9cy10aGlzLnN0YXJ0VGltZTtyZXR1cm4gbD5lPyh0aGlzLnN0YXRlPSJkZWNheSIsdGhpcy5zdGFydFRpbWU9cywxKTpNKGwvZSx0aGlzLnN0YXJ0VmFsLDEsMSl9Y2FzZSJkZWNheSI6e2xldCBsPXMtdGhpcy5zdGFydFRpbWUsYT1NKGwvaCwxLG8sLXRoaXMuZGVjYXlDdXJ2ZSk7cmV0dXJuIHQ8PTA/KHRoaXMuc3RhdGU9InJlbGVhc2UiLHRoaXMuc3RhcnRUaW1lPXMsdGhpcy5zdGFydFZhbD1hLGEpOmw+aD8odGhpcy5zdGF0ZT0ic3VzdGFpbiIsdGhpcy5zdGFydFRpbWU9cyxvKTphfWNhc2Uic3VzdGFpbiI6cmV0dXJuIHQ8PTAmJih0aGlzLnN0YXRlPSJyZWxlYXNlIix0aGlzLnN0YXJ0VGltZT1zLHRoaXMuc3RhcnRWYWw9byksbztjYXNlInJlbGVhc2UiOntsZXQgbD1zLXRoaXMuc3RhcnRUaW1lO2lmKGw+bilyZXR1cm4gdGhpcy5zdGF0ZT0ib2ZmIiwwO2xldCBhPU0obC9uLHRoaXMuc3RhcnRWYWwsMCwtdGhpcy5kZWNheUN1cnZlKTtyZXR1cm4gdD4wJiYodGhpcy5zdGF0ZT0iYXR0YWNrIix0aGlzLnN0YXJ0VGltZT1zLHRoaXMuc3RhcnRWYWw9YSksYX19dGhyb3ciaW52YWxpZCBlbnZlbG9wZSBzdGF0ZSJ9fWNvbnN0ICQ9MTA7Y2xhc3Mga3t3cml0ZUlkeD0wO3JlYWRJZHg9MDtidWZmZXI9bmV3IEZsb2F0MzJBcnJheSgkKmQpO3dyaXRlKHMsdCl7dGhpcy53cml0ZUlkeD0odGhpcy53cml0ZUlkeCsxKSV0aGlzLmJ1ZmZlci5sZW5ndGgsdGhpcy5idWZmZXJbdGhpcy53cml0ZUlkeF09cztsZXQgZT1NYXRoLm1pbihNYXRoLmZsb29yKGQqdCksdGhpcy5idWZmZXIubGVuZ3RoLTEpO3RoaXMucmVhZElkeD10aGlzLndyaXRlSWR4LWUsdGhpcy5yZWFkSWR4PDAmJih0aGlzLnJlYWRJZHgrPXRoaXMuYnVmZmVyLmxlbmd0aCl9dXBkYXRlKHMsdCl7cmV0dXJuIHRoaXMud3JpdGUocyx0KSx0aGlzLmJ1ZmZlclt0aGlzLnJlYWRJZHhdfX1jbGFzcyBXe2RlbGF5PW5ldyBrO21vZHVsYXRvcj1uZXcgdzt1cGRhdGUocyx0LGUsaCxvKXtjb25zdCBuPXRoaXMubW9kdWxhdG9yLnVwZGF0ZShoKSpvLGw9dGhpcy5kZWxheS51cGRhdGUocyxlKigxK24pKTtyZXR1cm4gTyhzLGwsdCl9fWNsYXNzIFh7aG9sZD0wO3Q9MDt1cGRhdGUocyx0KXtyZXR1cm4gdGhpcy50KysldD09PTAmJih0aGlzLnQ9MCx0aGlzLmhvbGQ9cyksdGhpcy5ob2xkfX1jbGFzcyBVe3VwZGF0ZShzLHQpe3Q9TWF0aC5tYXgoMSx0KTtjb25zdCBlPU1hdGgucG93KDIsdC0xKTtyZXR1cm4gTWF0aC5yb3VuZChzKmUpL2V9fWNsYXNzIFl7dXBkYXRlKHMsdD0wLGU9MSl7ZT1NYXRoLm1heCguMDAxLE1hdGgubWluKDEsZSkpO2NvbnN0IGg9TWF0aC5leHBtMSh0KTtyZXR1cm4oMStoKSpzLygxK2gqTWF0aC5hYnMocykpKmV9fWNsYXNzIF97c3RhdGljIHNhbXBsZXM9bmV3IE1hcDtidWZmZXI7c2FtcGxlUmF0ZTtwb3M9MDtzYW1wbGVGcmVxPVAoKTtjb25zdHJ1Y3RvcihzLHQsZSl7dGhpcy5idWZmZXI9cyx0aGlzLnNhbXBsZVJhdGU9dCx0aGlzLmR1cmF0aW9uPXRoaXMuYnVmZmVyLmxlbmd0aC90aGlzLnNhbXBsZVJhdGUsdGhpcy5zcGVlZD1kL3RoaXMuc2FtcGxlUmF0ZSxlJiYodGhpcy5zcGVlZCo9dGhpcy5kdXJhdGlvbil9dXBkYXRlKHMpe2lmKHRoaXMucG9zPj10aGlzLmJ1ZmZlci5sZW5ndGgpcmV0dXJuIDA7Y29uc3QgdD1zL3RoaXMuc2FtcGxlRnJlcSp0aGlzLnNwZWVkO2xldCBlPXRoaXMuYnVmZmVyW01hdGguZmxvb3IodGhpcy5wb3MpXTtyZXR1cm4gdGhpcy5wb3M9dGhpcy5wb3MrdCxlfX1jb25zdCBtPShpLHM9ImxpbmVhciIsdCk9Pntjb25zdFtuLGwsYSxwXT1pO2lmKG49PW51bGwmJmw9PW51bGwmJmE9PW51bGwmJnA9PW51bGwpcmV0dXJuIHQ/P1suMDAxLC4wMDEsMSwuMDFdO2NvbnN0IHU9YT8/KG4hPW51bGwmJmw9PW51bGx8fG49PW51bGwmJmw9PW51bGw/MTouMDAxKTtyZXR1cm5bTWF0aC5tYXgobj8/MCwuMDAxKSxNYXRoLm1heChsPz8wLC4wMDEpLE1hdGgubWluKHUsMSksTWF0aC5tYXgocD8/MCwuMDEpXX07bGV0IEM9e3NpbmU6dixzYXc6Uix6YXc6eCxzYXd0b290aDpSLHphd3Rvb3RoOngsc3VwZXJzYXc6Rix0cmk6dyx0cmlhbmdsZTp3LHB1bHNlOkksc3F1YXJlOkkscHVsemU6TCxkdXN0OlMsY3JhY2tsZTpTLGltcHVsc2U6aix3aGl0ZTpOLGJyb3duOkIscGluazpHfTtjb25zdCBaPXtjaG9ydXM6MCxub3RlOjQ4LHM6InRyaWFuZ2xlIixiYW5rOiIiLGdhaW46MSxwb3N0Z2FpbjoxLHZlbG9jaXR5OjEsZGVuc2l0eToiLjAzIixmdHlwZToiMTJkYiIsZmFuY2hvcjowLHJlc29uYW5jZTowLGhyZXNvbmFuY2U6MCxiYW5kcTowLGNoYW5uZWxzOlsxLDJdLHBoYXNlcmRlcHRoOi43NSxzaGFwZXZvbDoxLGRpc3RvcnR2b2w6MSxkZWxheTowLGJ5dGVCZWF0RXhwcmVzc2lvbjoiMCIsZGVsYXlmZWVkYmFjazouNSxkZWxheXNwZWVkOjEsZGVsYXl0aW1lOi4yNSxvcmJpdDoxLGk6MSxmZnQ6OCx6OiJ0cmlhbmdsZSIscGFuOi41LGZtaDoxLGZtZW52OjAsc3BlZWQ6MSxwdzouNX07bGV0IHI9aT0+WltpXTtjb25zdCBIPXtjOjAsZDoyLGU6NCxmOjUsZzo3LGE6OSxiOjExfSxKPXsiIyI6MSxiOi0xLHM6MSxmOi0xfSxLPShpLHM9Myk9PntsZXRbdCxlPSIiLGg9IiJdPVN0cmluZyhpKS5tYXRjaCgvXihbYS1nQS1HXSkoWyNic2ZdKikoWzAtOV0qKSQvKT8uc2xpY2UoMSl8fFtdO2lmKCF0KXRocm93IG5ldyBFcnJvcignbm90IGEgbm90ZTogIicraSsnIicpO2NvbnN0IG89SFt0LnRvTG93ZXJDYXNlKCldLG49ZT8uc3BsaXQoIiIpLnJlZHVjZSgoYSxwKT0+YStKW3BdLDApfHwwO3JldHVybihOdW1iZXIoaHx8cykrMSkqMTIrbytufSxRPWk9Pk1hdGgucG93KDIsKGktNjkpLzEyKSo0NDAsUD1pPT4oaT1pfHxyKCJub3RlIiksdHlwZW9mIGk9PSJzdHJpbmciJiYoaT1LKGksMykpLFEoaSkpO2NsYXNzIHR0e2lkPTA7b3V0PVswLDBdO2F0dGFjaztkZWNheTtzdXN0YWluO3JlbGVhc2U7X2JlZ2luO19kdXJhdGlvbjtfc291bmQ7X2NoYW5uZWxzPTE7X2J1ZmZlcnM7dW5pdDtfcGVudjtwZW52O3BhdHRhY2s7cGRlY2F5O3BzdXN0YWluO3ByZWxlYXNlO3ZpYjtfdmliO3ZpYm1vZDtfZm07Zm1oO2ZtaTtfZm1lbnY7Zm1hdHRhY2s7Zm1kZWNheTtmbXN1c3RhaW47Zm1yZWxlYXNlO19scGVudjtscGVudjtscGF0dGFjaztscGRlY2F5O2xwc3VzdGFpbjtscHJlbGVhc2U7X2hwZW52O2hwZW52O2hwYXR0YWNrO2hwZGVjYXk7aHBzdXN0YWluO2hwcmVsZWFzZTtfYnBlbnY7YnBlbnY7YnBhdHRhY2s7YnBkZWNheTticHN1c3RhaW47YnByZWxlYXNlO2N1dG9mZjtoY3V0b2ZmO2JhbmRmO2NvYXJzZTtjcnVzaDtkaXN0b3J0O2ZyZXE7bm90ZTtfbHBmO19ocGY7X2JwZjtfY2hvcnVzO19jb2Fyc2U7X2NydXNoO19kaXN0b3J0O2NvbnN0cnVjdG9yKHMpe3RoaXMuZnJlcT8/PVAocy5ub3RlKSx0aGlzLl9iZWdpbj1zLl9iZWdpbix0aGlzLl9kdXJhdGlvbj1zLl9kdXJhdGlvbix0aGlzLnJlbGVhc2U9cy5yZWxlYXNlPz8wO2xldCB0PXRoaXM7aWYoT2JqZWN0LmFzc2lnbih0LHMpLHQucz10LnM/P3IoInMiKSx0LmdhaW49Yyh0LmdhaW4/P3IoImdhaW4iKSksdC52ZWxvY2l0eT1jKHQudmVsb2NpdHk/P3IoInZlbG9jaXR5IikpLHQucG9zdGdhaW49Yyh0LnBvc3RnYWluPz9yKCJwb3N0Z2FpbiIpKSx0LmRlbnNpdHk9dC5kZW5zaXR5Pz9yKCJkZW5zaXR5IiksdC5mYW5jaG9yPXQuZmFuY2hvcj8/cigiZmFuY2hvciIpLHQuZHJpdmU9dC5kcml2ZT8/LjY5LHQucGhhc2VyZGVwdGg9dC5waGFzZXJkZXB0aD8/cigicGhhc2VyZGVwdGgiKSx0LnNoYXBldm9sPWModC5zaGFwZXZvbD8/cigic2hhcGV2b2wiKSksdC5kaXN0b3J0dm9sPWModC5kaXN0b3J0dm9sPz9yKCJkaXN0b3J0dm9sIikpLHQuaT10Lmk/P3IoImkiKSx0LmNob3J1cz10LmNob3J1cz8/cigiY2hvcnVzIiksdC5mZnQ9dC5mZnQ/P3IoImZmdCIpLHQucGFuPXQucGFuPz9yKCJwYW4iKSx0Lm9yYml0PXQub3JiaXQ/P3IoIm9yYml0IiksdC5mbWVudj10LmZtZW52Pz9yKCJmbWVudiIpLHQucmVzb25hbmNlPXQucmVzb25hbmNlPz9yKCJyZXNvbmFuY2UiKSx0LmhyZXNvbmFuY2U9dC5ocmVzb25hbmNlPz9yKCJocmVzb25hbmNlIiksdC5iYW5kcT10LmJhbmRxPz9yKCJiYW5kcSIpLHQuc3BlZWQ9dC5zcGVlZD8/cigic3BlZWQiKSx0LnB3PXQucHc/P3IoInB3IiksW3QuYXR0YWNrLHQuZGVjYXksdC5zdXN0YWluLHQucmVsZWFzZV09bShbdC5hdHRhY2ssdC5kZWNheSx0LnN1c3RhaW4sdC5yZWxlYXNlXSksdC5faG9sZEVuZD10Ll9iZWdpbit0Ll9kdXJhdGlvbix0Ll9lbmQ9dC5faG9sZEVuZCt0LnJlbGVhc2UrLjAxLHQuZm1pJiYodC5zPT09InNhdyJ8fHQucz09PSJzYXd0b290aCIpJiYodC5zPSJ6YXciKSxDW3Quc10pe2NvbnN0IGU9Q1t0LnNdO3QuX3NvdW5kPW5ldyBlLHQuX2NoYW5uZWxzPTF9ZWxzZSBpZihfLnNhbXBsZXMuaGFzKHQucykpe2NvbnN0IGU9Xy5zYW1wbGVzLmdldCh0LnMpO3QuX2J1ZmZlcnM9W10sdC5fY2hhbm5lbHM9ZS5jaGFubmVscy5sZW5ndGg7Zm9yKGxldCBoPTA7aDx0Ll9jaGFubmVscztoKyspdC5fYnVmZmVycy5wdXNoKG5ldyBfKGUuY2hhbm5lbHNbaF0sZS5zYW1wbGVSYXRlLHQudW5pdD09PSJjIikpfWVsc2UgY29uc29sZS53YXJuKCJzb3VuZCBub3QgbG9hZGVkIix0LnMpO3QucGVudiYmKHQuX3BlbnY9bmV3IGYoe2RlY2F5Q3VydmU6NH0pLFt0LnBhdHRhY2ssdC5wZGVjYXksdC5wc3VzdGFpbix0LnByZWxlYXNlXT1tKFt0LnBhdHRhY2ssdC5wZGVjYXksdC5wc3VzdGFpbix0LnByZWxlYXNlXSkpLHQudmliJiYodC5fdmliPW5ldyB2LHQudmlibW9kPXQudmlibW9kPz9yKCJ2aWJtb2QiKSksdC5mbWkmJih0Ll9mbT1uZXcgdix0LmZtaD10LmZtaD8/cigiZm1oIiksdC5mbWVudiYmKHQuX2ZtZW52PW5ldyBmKHtkZWNheUN1cnZlOjJ9KSxbdC5mbWF0dGFjayx0LmZtZGVjYXksdC5mbXN1c3RhaW4sdC5mbXJlbGVhc2VdPW0oW3QuZm1hdHRhY2ssdC5mbWRlY2F5LHQuZm1zdXN0YWluLHQuZm1yZWxlYXNlXSkpKSx0Ll9hZHNyPW5ldyBmKHtkZWNheUN1cnZlOjJ9KSx0LmRlbGF5PWModC5kZWxheT8/cigiZGVsYXkiKSksdC5kZWxheWZlZWRiYWNrPXQuZGVsYXlmZWVkYmFjaz8/cigiZGVsYXlmZWVkYmFjayIpLHQuZGVsYXlzcGVlZD10LmRlbGF5c3BlZWQ/P3IoImRlbGF5c3BlZWQiKSx0LmRlbGF5dGltZT10LmRlbGF5dGltZT8/cigiZGVsYXl0aW1lIiksdC5scGVudiYmKHQuX2xwZW52PW5ldyBmKHtkZWNheUN1cnZlOjR9KSxbdC5scGF0dGFjayx0LmxwZGVjYXksdC5scHN1c3RhaW4sdC5scHJlbGVhc2VdPW0oW3QubHBhdHRhY2ssdC5scGRlY2F5LHQubHBzdXN0YWluLHQubHByZWxlYXNlXSkpLHQuaHBlbnYmJih0Ll9ocGVudj1uZXcgZih7ZGVjYXlDdXJ2ZTo0fSksW3QuaHBhdHRhY2ssdC5ocGRlY2F5LHQuaHBzdXN0YWluLHQuaHByZWxlYXNlXT1tKFt0LmhwYXR0YWNrLHQuaHBkZWNheSx0Lmhwc3VzdGFpbix0LmhwcmVsZWFzZV0pKSx0LmJwZW52JiYodC5fYnBlbnY9bmV3IGYoe2RlY2F5Q3VydmU6NH0pLFt0LmJwYXR0YWNrLHQuYnBkZWNheSx0LmJwc3VzdGFpbix0LmJwcmVsZWFzZV09bShbdC5icGF0dGFjayx0LmJwZGVjYXksdC5icHN1c3RhaW4sdC5icHJlbGVhc2VdKSksdC5fY2hvcnVzPXQuY2hvcnVzP1tdOm51bGwsdC5fbHBmPXQuY3V0b2ZmP1tdOm51bGwsdC5faHBmPXQuaGN1dG9mZj9bXTpudWxsLHQuX2JwZj10LmJhbmRmP1tdOm51bGwsdC5fY29hcnNlPXQuY29hcnNlP1tdOm51bGwsdC5fY3J1c2g9dC5jcnVzaD9bXTpudWxsLHQuX2Rpc3RvcnQ9dC5kaXN0b3J0P1tdOm51bGw7Zm9yKGxldCBlPTA7ZTx0aGlzLl9jaGFubmVscztlKyspdC5fbHBmPy5wdXNoKG5ldyBnKSx0Ll9ocGY/LnB1c2gobmV3IGcpLHQuX2JwZj8ucHVzaChuZXcgZyksdC5fY2hvcnVzPy5wdXNoKG5ldyBXKSx0Ll9jb2Fyc2U/LnB1c2gobmV3IFgpLHQuX2NydXNoPy5wdXNoKG5ldyBVKSx0Ll9kaXN0b3J0Py5wdXNoKG5ldyBZKX11cGRhdGUocyl7aWYoIXRoaXMuX3NvdW5kJiYhdGhpcy5fYnVmZmVycylyZXR1cm4gMDtsZXQgdD0rKHM+PXRoaXMuX2JlZ2luJiZzPD10aGlzLl9ob2xkRW5kKSxlPXRoaXMuZnJlcSp0aGlzLnNwZWVkO2lmKHRoaXMuX2ZtJiZ0aGlzLmZtaCE9PXZvaWQgMCYmdGhpcy5mbWkhPT12b2lkIDApe2xldCBhPXRoaXMuZm1pO2lmKHRoaXMuX2ZtZW52KXtjb25zdCBxPXRoaXMuX2ZtZW52LnVwZGF0ZShzLHQsdGhpcy5mbWF0dGFjayx0aGlzLmZtZGVjYXksdGhpcy5mbXN1c3RhaW4sdGhpcy5mbXJlbGVhc2UpO2E9dGhpcy5mbWVudipxKmF9Y29uc3QgcD1lKnRoaXMuZm1oLHU9cCphO2U9ZSt0aGlzLl9mbS51cGRhdGUocCkqdX1pZih0aGlzLl92aWImJnRoaXMudmlibW9kIT09dm9pZCAwJiYoZT1lKjIqKih0aGlzLl92aWIudXBkYXRlKHRoaXMudmliKSp0aGlzLnZpYm1vZC8xMikpLHRoaXMuX3BlbnYmJnRoaXMucGVudiE9PXZvaWQgMCl7Y29uc3QgYT10aGlzLl9wZW52LnVwZGF0ZShzLHQsdGhpcy5wYXR0YWNrLHRoaXMucGRlY2F5LHRoaXMucHN1c3RhaW4sdGhpcy5wcmVsZWFzZSk7ZT1lK2EqdGhpcy5wZW52fWxldCBoPXRoaXMuY3V0b2ZmO2lmKGghPT12b2lkIDAmJnRoaXMuX2xwZW52KXtjb25zdCBhPXRoaXMuX2xwZW52LnVwZGF0ZShzLHQsdGhpcy5scGF0dGFjayx0aGlzLmxwZGVjYXksdGhpcy5scHN1c3RhaW4sdGhpcy5scHJlbGVhc2UpO2g9dGhpcy5scGVudiphKmgraH1sZXQgbz10aGlzLmhjdXRvZmY7aWYobyE9PXZvaWQgMCYmdGhpcy5faHBlbnYmJnRoaXMuaHBlbnYhPT12b2lkIDApe2NvbnN0IGE9dGhpcy5faHBlbnYudXBkYXRlKHMsdCx0aGlzLmhwYXR0YWNrLHRoaXMuaHBkZWNheSx0aGlzLmhwc3VzdGFpbix0aGlzLmhwcmVsZWFzZSk7bz0yKip0aGlzLmhwZW52KmEqbytvfWxldCBuPXRoaXMuYmFuZGY7aWYobiE9PXZvaWQgMCYmdGhpcy5fYnBlbnYmJnRoaXMuYnBlbnYhPT12b2lkIDApe2NvbnN0IGE9dGhpcy5fYnBlbnYudXBkYXRlKHMsdCx0aGlzLmJwYXR0YWNrLHRoaXMuYnBkZWNheSx0aGlzLmJwc3VzdGFpbix0aGlzLmJwcmVsZWFzZSk7bj0yKip0aGlzLmJwZW52KmEqbitufWNvbnN0IGw9dGhpcy5fYWRzci51cGRhdGUocyx0LHRoaXMuYXR0YWNrLHRoaXMuZGVjYXksdGhpcy5zdXN0YWluLHRoaXMucmVsZWFzZSk7Zm9yKGxldCBhPTA7YTx0aGlzLl9jaGFubmVsczthKyspe2lmKHRoaXMuX3NvdW5kJiZ0aGlzLnM9PT0icHVsc2UiP3RoaXMub3V0W2FdPXRoaXMuX3NvdW5kLnVwZGF0ZShlLHRoaXMucHcpOnRoaXMuX3NvdW5kP3RoaXMub3V0W2FdPXRoaXMuX3NvdW5kLnVwZGF0ZShlKTp0aGlzLl9idWZmZXJzJiYodGhpcy5vdXRbYV09dGhpcy5fYnVmZmVyc1thXS51cGRhdGUoZSkpLHRoaXMub3V0W2FdPXRoaXMub3V0W2FdKnRoaXMuZ2Fpbip0aGlzLnZlbG9jaXR5LHRoaXMuX2Nob3J1cyl7Y29uc3QgcD10aGlzLl9jaG9ydXNbYV0udXBkYXRlKHRoaXMub3V0W2FdLHRoaXMuY2hvcnVzLC4wMysuMDUqYSwxLC4xMSk7dGhpcy5vdXRbYV09cCt0aGlzLm91dFthXX10aGlzLl9scGYmJih0aGlzLl9scGZbYV0udXBkYXRlKHRoaXMub3V0W2FdLGgsdGhpcy5yZXNvbmFuY2UpLHRoaXMub3V0W2FdPXRoaXMuX2xwZlthXS5zMSksdGhpcy5faHBmJiYodGhpcy5faHBmW2FdLnVwZGF0ZSh0aGlzLm91dFthXSxvLHRoaXMuaHJlc29uYW5jZSksdGhpcy5vdXRbYV09dGhpcy5vdXRbYV0tdGhpcy5faHBmW2FdLnMxKSx0aGlzLl9icGYmJih0aGlzLl9icGZbYV0udXBkYXRlKHRoaXMub3V0W2FdLG4sdGhpcy5iYW5kcSksdGhpcy5vdXRbYV09dGhpcy5fYnBmW2FdLnMwKSx0aGlzLl9jb2Fyc2UmJih0aGlzLm91dFthXT10aGlzLl9jb2Fyc2VbYV0udXBkYXRlKHRoaXMub3V0W2FdLHRoaXMuY29hcnNlKSksdGhpcy5fY3J1c2gmJih0aGlzLm91dFthXT10aGlzLl9jcnVzaFthXS51cGRhdGUodGhpcy5vdXRbYV0sdGhpcy5jcnVzaCkpLHRoaXMuX2Rpc3RvcnQmJih0aGlzLm91dFthXT10aGlzLl9kaXN0b3J0W2FdLnVwZGF0ZSh0aGlzLm91dFthXSx0aGlzLmRpc3RvcnQsdGhpcy5kaXN0b3J0dm9sKSksdGhpcy5vdXRbYV09dGhpcy5vdXRbYV0qbCx0aGlzLm91dFthXT10aGlzLm91dFthXSp0aGlzLnBvc3RnYWluLHRoaXMuX2J1ZmZlcnN8fCh0aGlzLm91dFthXT10aGlzLm91dFthXSouMil9aWYodGhpcy5fY2hhbm5lbHM9PT0xJiYodGhpcy5vdXRbMV09dGhpcy5vdXRbMF0pLHRoaXMucGFuIT09LjUpe2NvbnN0IGE9dGhpcy5wYW4qTWF0aC5QSS8yO3RoaXMub3V0WzBdPXRoaXMub3V0WzBdKk1hdGguY29zKGEpLHRoaXMub3V0WzFdPXRoaXMub3V0WzFdKk1hdGguc2luKGEpfX19Y2xhc3Mgc3R7dm9pY2VzPVtdO3ZpZD0wO3E9W107b3V0PVswLDBdO2RlbGF5c2VuZD1bMCwwXTtkZWxheXRpbWU9cigiZGVsYXl0aW1lIik7ZGVsYXlmZWVkYmFjaz1yKCJkZWxheWZlZWRiYWNrIik7ZGVsYXlzcGVlZD1yKCJkZWxheXNwZWVkIik7dD0wO2NvbnN0cnVjdG9yKHM9NDhlMyx0PTApe3RoaXMuc2FtcGxlUmF0ZT1zLHRoaXMudD1NYXRoLmZsb29yKHQqcyksdGhpcy5fZGVsYXlMPW5ldyBrLHRoaXMuX2RlbGF5Uj1uZXcga31sb2FkU2FtcGxlKHMsdCxlKXtfLnNhbXBsZXMuc2V0KHMse2NoYW5uZWxzOnQsc2FtcGxlUmF0ZTplfSl9c2NoZWR1bGVTcGF3bihzKXtpZihzLl9iZWdpbj09PXZvaWQgMCl0aHJvdyBuZXcgRXJyb3IoIltkb3VnaF06IHNjaGVkdWxlU3Bhd24gZXhwZWN0ZWQgX2JlZ2luIHRvIGJlIHNldCIpO2lmKHMuX2R1cmF0aW9uPT09dm9pZCAwKXRocm93IG5ldyBFcnJvcigiW2RvdWdoXTogc2NoZWR1bGVTcGF3biBleHBlY3RlZCBfZHVyYXRpb24gdG8gYmUgc2V0Iik7cy5zYW1wbGVSYXRlPXRoaXMuc2FtcGxlUmF0ZTtjb25zdCB0PU1hdGguZmxvb3Iocy5fYmVnaW4qdGhpcy5zYW1wbGVSYXRlKTt0aGlzLnNjaGVkdWxlKHt0aW1lOnQsdHlwZToic3Bhd24iLGFyZzpzfSl9c3Bhd24ocyl7cy5pZD10aGlzLnZpZCsrO2NvbnN0IHQ9bmV3IHR0KHMpO3RoaXMudm9pY2VzLnB1c2godCk7Y29uc3QgZT1NYXRoLmNlaWwodC5fZW5kKnRoaXMuc2FtcGxlUmF0ZSk7dGhpcy5zY2hlZHVsZSh7dGltZTplLHR5cGU6ImRlc3Bhd24iLGFyZzp0LmlkfSl9ZGVzcGF3bihzKXt0aGlzLnZvaWNlcz10aGlzLnZvaWNlcy5maWx0ZXIodD0+dC5pZCE9PXMpfXNjaGVkdWxlKHMpe2lmKCF0aGlzLnEubGVuZ3RoKXt0aGlzLnEucHVzaChzKTtyZXR1cm59bGV0IHQ9MDtmb3IoO3Q8dGhpcy5xLmxlbmd0aCYmdGhpcy5xW3RdLnRpbWU8cy50aW1lOyl0Kys7dGhpcy5xLnNwbGljZSh0LDAscyl9dXBkYXRlKCl7Zm9yKDt0aGlzLnEubGVuZ3RoPjAmJnRoaXMucVswXS50aW1lPD10aGlzLnQ7KXRoaXNbdGhpcy5xWzBdLnR5cGVdKHRoaXMucVswXS5hcmcpLHRoaXMucS5zaGlmdCgpO3RoaXMub3V0WzBdPTAsdGhpcy5vdXRbMV09MDtmb3IobGV0IGU9MDtlPHRoaXMudm9pY2VzLmxlbmd0aDtlKyspdGhpcy52b2ljZXNbZV0udXBkYXRlKHRoaXMudC90aGlzLnNhbXBsZVJhdGUpLHRoaXMub3V0WzBdKz10aGlzLnZvaWNlc1tlXS5vdXRbMF0sdGhpcy5vdXRbMV0rPXRoaXMudm9pY2VzW2VdLm91dFsxXSx0aGlzLnZvaWNlc1tlXS5kZWxheSYmKHRoaXMuZGVsYXlzZW5kWzBdKz10aGlzLnZvaWNlc1tlXS5vdXRbMF0qdGhpcy52b2ljZXNbZV0uZGVsYXksdGhpcy5kZWxheXNlbmRbMV0rPXRoaXMudm9pY2VzW2VdLm91dFsxXSp0aGlzLnZvaWNlc1tlXS5kZWxheSx0aGlzLmRlbGF5dGltZT10aGlzLnZvaWNlc1tlXS5kZWxheXRpbWUsdGhpcy5kZWxheXNwZWVkPXRoaXMudm9pY2VzW2VdLmRlbGF5c3BlZWQsdGhpcy5kZWxheWZlZWRiYWNrPXRoaXMudm9pY2VzW2VdLmRlbGF5ZmVlZGJhY2spO2NvbnN0IHM9dGhpcy5fZGVsYXlMLnVwZGF0ZSh0aGlzLmRlbGF5c2VuZFswXSx0aGlzLmRlbGF5dGltZSksdD10aGlzLl9kZWxheVIudXBkYXRlKHRoaXMuZGVsYXlzZW5kWzFdLHRoaXMuZGVsYXl0aW1lKTt0aGlzLmRlbGF5c2VuZFswXT1zKnRoaXMuZGVsYXlmZWVkYmFjayx0aGlzLmRlbGF5c2VuZFsxXT10KnRoaXMuZGVsYXlmZWVkYmFjayx0aGlzLm91dFswXSs9cyx0aGlzLm91dFsxXSs9dCx0aGlzLnQrK319Y29uc3QgZXQ9KGkscyx0KT0+TWF0aC5taW4oTWF0aC5tYXgoaSxzKSx0KTtjbGFzcyBpdCBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3Nvcntjb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5kb3VnaD1uZXcgc3Qoc2FtcGxlUmF0ZSxjdXJyZW50VGltZSksdGhpcy5wb3J0Lm9ubWVzc2FnZT1zPT57cy5kYXRhLnNwYXduP3RoaXMuZG91Z2guc2NoZWR1bGVTcGF3bihzLmRhdGEuc3Bhd24pOnMuZGF0YS5zYW1wbGU/dGhpcy5kb3VnaC5sb2FkU2FtcGxlKHMuZGF0YS5zYW1wbGUscy5kYXRhLmNoYW5uZWxzLHMuZGF0YS5zYW1wbGVSYXRlKTpzLmRhdGEuc2FtcGxlcz9zLmRhdGEuc2FtcGxlcy5mb3JFYWNoKChbdCxlLGhdKT0+e3RoaXMuZG91Z2gubG9hZFNhbXBsZSh0LGUsaCl9KTpjb25zb2xlLmxvZygidW5yZWNvZ25pemVkIGV2ZW50IHR5cGUiLHMuZGF0YSl9fXByb2Nlc3Mocyx0LGUpe2lmKHRoaXMuZGlzY29ubmVjdGVkKXJldHVybiExO2NvbnN0IGg9dFswXTtmb3IobGV0IG89MDtvPGhbMF0ubGVuZ3RoO28rKyl7dGhpcy5kb3VnaC51cGRhdGUoKTtmb3IobGV0IG49MDtuPGgubGVuZ3RoO24rKyloW25dW29dPWV0KHRoaXMuZG91Z2gub3V0W25dLC0xLDEpfXJldHVybiEwfX1yZWdpc3RlclByb2Nlc3NvcigiZG91Z2gtcHJvY2Vzc29yIixpdCl9KSgpOwo=";typeof sampleRate<"u"&&sampleRate,zp(Ug);const{Pattern:Qg,logger:qg,repl:$g}=js;I0(qg);const t2=t=>(t.ensureObjectValue(),t.value),Jp=(t,e,n,s,o)=>Xo(t2(t),o,n,s,t.whole?.begin.valueOf());function Ip(t={}){return t={getTime:()=>j().currentTime,defaultOutput:Jp,...t},$g(t)}Qg.prototype.dough=function(){return this.onTrigger(Ap,1)};const Re=(t="test-canvas",e)=>{let{contextType:n="2d",pixelated:s=!1,pixelRatio:o=window.devicePixelRatio}={},r=document.querySelector("#"+t);if(!r){r=document.createElement("canvas"),r.id=t,r.width=window.innerWidth*o,r.height=window.innerHeight*o,r.style="pointer-events:none;width:100%;height:100%;position:fixed;top:0;left:0",s&&(r.style.imageRendering="pixelated"),document.body.prepend(r);let i;window.addEventListener("resize",()=>{i&&clearTimeout(i),i=setTimeout(()=>{r.width=window.innerWidth*o,r.height=window.innerHeight*o},200)})}return r.getContext(n,{willReadFrequently:!0})};let Cn={};function e2(t){Cn[t]!==void 0&&(cancelAnimationFrame(Cn[t]),delete Cn[t])}let pe={};L.prototype.draw=function(t,e){if(typeof window>"u")return this;let{id:n=1,lookbehind:s=0,lookahead:o=0}=e,r=Math.max(Js(),0);e2(n),s=Math.abs(s),pe[n]=(pe[n]||[]).filter(l=>!l.isInFuture(r));let i=this.queryArc(r,r+o).filter(l=>l.hasOnset());pe[n]=pe[n].concat(i);let u;const a=()=>{const l=Js(),p=l+o;pe[n]=pe[n].filter(g=>g.isInNearPast(s,l));let f=Math.max(u||p,p-1/10);const b=this.queryArc(f,p).filter(g=>g.hasOnset());pe[n]=pe[n].concat(b),u=p,t(pe[n],l,p,this),Cn[n]=requestAnimationFrame(a)};return Cn[n]=requestAnimationFrame(a),this},L.prototype.onPaint=function(t){return this.withState(e=>(e.controls.painters||(e.controls.painters=[]),e.controls.painters.push(t),e))},L.prototype.getPainters=function(){let t=[];return this.queryArc(0,0,{painters:t}),t};let n2={background:"#222",foreground:"#75baff",caret:"#ffcc00",selection:"rgba(128, 203, 196, 0.5)",selectionMatch:"#036dd626",lineHighlight:"#00000050",gutterBackground:"transparent",gutterForeground:"#8a919966"};function he(){return n2}let jp="#22222210";L.prototype.animate=function({callback:t,sync:e=!1,smear:n=.5}={}){window.frame&&cancelAnimationFrame(window.frame);const s=Re();let{clientWidth:o,clientHeight:r}=s.canvas;o*=window.devicePixelRatio,r*=window.devicePixelRatio;let i=n===0?"99":Number((1-n)*100).toFixed(0);i=i.length===1?`0${i}`:i,jp=`#200010${i}`;const u=a=>{let l;a=Math.round(a),l=this.slow(1e3).queryArc(a,a),s.fillStyle=jp,s.fillRect(0,0,o,r),l.forEach(p=>{let{x:f,y:b,w:g,h:X,s:Z,r:W,angle:F=0,fill:z="darkseagreen"}=p.value;if(g*=o,X*=r,W!==void 0&&F!==void 0){const x=F*2*Math.PI,[R,N]=[(o-g)/2,(r-X)/2];f=R+Math.cos(x)*W*R,b=N+Math.sin(x)*W*N}else f*=o-g,b*=r-X;const v={...p.value,x:f,y:b,w:g,h:X};s.fillStyle=z,Z==="rect"?s.fillRect(f,b,g,X):Z==="ellipse"&&(s.beginPath(),s.ellipse(f+g/2,b+X/2,g/2,X/2,0,0,2*Math.PI),s.fill()),t&&t(s,v,p)}),window.frame=requestAnimationFrame(u)};return window.frame=requestAnimationFrame(u),st};const{x:_p,y:uG,w:aG,h:lG,angle:dG,r:pG,fill:hG,smear:fG}=xs("x","y","w","h","angle","r","fill","smear");G("rescale",function(t,e){return e.mul(_p(t).w(t).y(t).h(t))}),G("moveXY",function(t,e,n){return n.add(_p(t).y(e))}),G("zoomIn",function(t,e){const n=Xt(1).sub(t).div(2);return e.rescale(t).move(n,n)});const Ln=(t,e,n)=>t*(n-e)+e,Op=t=>{let{value:e}=t;typeof t.value!="object"&&(e={value:e});let{note:n,n:s,freq:o,s:r}=e;if(o)return ps(o);if(n=n??s,typeof n=="string")try{return Ne(n)}catch{return 0}return typeof n=="number"?n:r?"_"+r:e};L.prototype.pianoroll=function(t={}){let{cycles:e=4,playhead:n=.5,overscan:s=0,hideNegative:o=!1,ctx:r=Re(),id:i=1}=t,u=-e*n,a=e*(1-n);const l=(p,f)=>(!o||p.whole.begin>=0)&&p.isWithinTime(f+u,f+a);return this.draw((p,f)=>{Up({...t,time:f,ctx:r,haps:p.filter(b=>l(b,f))})},{lookbehind:u-s,lookahead:a+s,id:i}),this};function Up({time:t,haps:e,cycles:n=4,playhead:s=.5,flipTime:o=0,flipValues:r=0,hideNegative:i=!1,inactive:u=he().foreground,active:a=he().foreground,background:l="transparent",smear:p=0,playheadColor:f=he().foreground,minMidi:b=10,maxMidi:g=90,autorange:X=0,timeframe:Z,fold:W=1,vertical:F=0,labels:z=!1,fill:v=1,fillActive:x=!1,strokeActive:R=!0,stroke:N,hideInactive:O=0,colorizeInactive:_=1,fontFamily:et,ctx:T,id:ut}={}){const P=T.canvas.width,q=T.canvas.height;let U=-n*s,pt=n*(1-s);ut&&(e=e.filter(tt=>tt.hasTag(ut))),Z&&(console.warn("timeframe is deprecated! use from/to instead"),U=0,pt=Z);const $=F?q:P,ot=F?P:q;let ht=F?[$,0]:[0,$];const Ct=pt-U,Pt=F?[0,ot]:[ot,0];let Tt=g-b+1,H=ot/Tt,I=[];o&&ht.reverse(),r&&Pt.reverse();const{min:te,max:it,values:re}=e.reduce(({min:tt,max:rt,values:It},jt)=>{const wt=Op(jt);return{min:wt<tt?wt:tt,max:wt>rt?wt:rt,values:It.includes(wt)?It:[...It,wt]}},{min:1/0,max:-1/0,values:[]});X&&(b=te,g=it,Tt=g-b+1),I=re.sort((tt,rt)=>typeof tt=="number"&&typeof rt=="number"?tt-rt:typeof tt=="number"?1:String(tt).localeCompare(String(rt))),H=W?ot/I.length:ot/Tt,T.fillStyle=l,T.globalAlpha=1,p||(T.clearRect(0,0,P,q),T.fillRect(0,0,P,q)),e.forEach(tt=>{const rt=tt.whole.begin<=t&&tt.endClipped>t;let It=N??(R&&rt),jt=!rt&&v||rt&&x;if(O&&!rt)return;let wt=tt.value?.color;a=wt||a,u=_&&wt||u,wt=rt?a:u,T.fillStyle=jt?wt:"transparent",T.strokeStyle=wt;const{velocity:Ze=1,gain:zn=1}=tt.value||{};T.globalAlpha=Ze*zn;const we=(tt.whole.begin-(o?pt:U))/Ct,$e=Ln(we,...ht);let fe=Ln(tt.duration/Ct,0,$);const xe=Op(tt),ve=W?I.indexOf(xe)/I.length:(Number(xe)-b)/Tt,Se=Ln(ve,...Pt);let tn=0;const Ye=Ln(t/Ct,...ht);let ce;if(F?ce=[Se+1-(r?H:0),$-Ye+$e+tn+1-(o?0:fe),H-2,fe-2]:ce=[$e-Ye+tn+1-(o?fe:0),Se+1-(r?0:H),fe-2,H-2],It&&T.strokeRect(...ce),jt&&T.fillRect(...ce),z){const Mn=tt.value.note??tt.value.s+(tt.value.n?`:${tt.value.n}`:""),{label:en,activeLabel:Rn}=tt.value,xn=(rt&&Rn||en)??Mn;let _t=F?fe:H*.75;T.font=`${_t}px ${et||"monospace"}`,T.fillStyle=jt?"black":wt,T.textBaseline="top",T.fillText(xn,...ce)}}),T.globalAlpha=1;const zt=Ln(-U/Ct,...ht);return T.strokeStyle=f,T.beginPath(),F?(T.moveTo(0,zt),T.lineTo(ot,zt)):(T.moveTo(zt,0),T.lineTo(zt,ot)),T.stroke(),this}function s2(t,e={}){let[n,s]=t;n=Math.abs(n);const o=s+n,r=o!==0?n/o:0;return{fold:1,...e,cycles:o,playhead:r}}const o2=(t={})=>(e,n,s,o)=>Up({ctx:e,time:n,haps:s,...s2(o,t)});L.prototype.punchcard=function(t){return this.onPaint(o2(t))},L.prototype.wordfall=function(t){return this.punchcard({vertical:1,labels:1,stroke:0,fillActive:1,active:"white",...t})};function r2(t,e,n,s){const o=(t-90)*Math.PI/180;return[n+Math.cos(o)*e,s+Math.sin(o)*e]}const Qp=(t,e,n,s,o=0)=>r2((t+o)*360,e*t,n,s);function qp(t){let{ctx:e,from:n=0,to:s=3,margin:o=50,cx:r=100,cy:i=100,rotate:u=0,thickness:a=o/2,color:l=he().foreground,cap:p="round",stretch:f=1,fromOpacity:b=1,toOpacity:g=1}=t;n*=f,s*=f,u*=f,e.lineWidth=a,e.lineCap=p,e.strokeStyle=l,e.globalAlpha=b,e.beginPath();let[X,Z]=Qp(n,o,r,i,u);e.moveTo(X,Z);const W=1/60;let F=n;for(;F<=s;){const[z,v]=Qp(F,o,r,i,u);e.globalAlpha=(F-n)/(s-n)*g,e.lineTo(z,v),F+=W}e.stroke()}function c2(t){let{stretch:e=1,size:n=80,thickness:s=n/2,cap:o="butt",inset:r=3,playheadColor:i="#ffffff",playheadLength:u=.02,playheadThickness:a=s,padding:l=0,steady:p=1,activeColor:f=he().foreground,inactiveColor:b=he().gutterForeground,colorizeInactive:g=0,fade:X=!0,ctx:Z,time:W,haps:F,drawTime:z,id:v}=t;v&&(F=F.filter(P=>P.hasTag(v)));const[x,R]=[Z.canvas.width,Z.canvas.height];Z.clearRect(0,0,x*2,R*2);const[N,O]=[x/2,R/2],_={margin:n/e,cx:N,cy:O,stretch:e,cap:o,thickness:s},et={..._,thickness:a,from:r-u,to:r,color:i},[T]=z,ut=p*W;F.forEach(P=>{const q=P.whole.begin<=W&&P.endClipped>W,U=P.whole.begin-W+r,pt=P.endClipped-W+r-l,$=P.value?.color||f,ot=g||q?$:b,ht=X?1-Math.abs((P.whole.begin-W)/T):1;qp({ctx:Z,..._,from:U,to:pt,rotate:ut,color:ot,fromOpacity:ht,toOpacity:ht})}),qp({ctx:Z,...et,rotate:ut})}L.prototype.spiral=function(t={}){return this.onPaint((e,n,s,o)=>c2({ctx:e,time:n,haps:s,drawTime:o,...t}))};const i2=Ve(36),$p=(t,e,n,s)=>{s=s*Math.PI*2;const o=Math.sin(s)*n+t,r=Math.cos(s)*n+e;return[o,r]},th=(t,e)=>.5-Math.log2(t/e)%1;function u2({haps:t,ctx:e,id:n,hapcircles:s=1,circle:o=0,edo:r=12,root:i=i2,thickness:u=3,hapRadius:a=6,mode:l="flake",margin:p=10}={}){const f=l==="polygon",b=l==="flake",g=e.canvas.width,X=e.canvas.height;e.clearRect(0,0,g,X);const Z=he().foreground,F=Math.min(g,X)/2-u/2-a-p,z=g/2,v=X/2;n&&(t=t.filter(R=>R.hasTag(n))),e.strokeStyle=Z,e.fillStyle=Z,e.globalAlpha=1,e.lineWidth=u,o&&(e.beginPath(),e.arc(z,v,F,0,2*Math.PI),e.stroke()),r&&(Array.from({length:r},(R,N)=>{const O=th(i*Math.pow(2,N/r),i),[_,et]=$p(z,v,F,O);e.beginPath(),e.arc(_,et,a,0,2*Math.PI),e.fill()}),e.stroke());let x=[];e.lineWidth=a,t.forEach(R=>{let N;try{N=To(R)}catch{return}const O=th(N,i),[_,et]=$p(z,v,F,O),T=R.value.color||Z;e.strokeStyle=T,e.fillStyle=T;const{velocity:ut=1,gain:P=1}=R.value||{},q=ut*P;e.globalAlpha=q,x.push([_,et,O,T,q]),e.beginPath(),s&&(e.moveTo(_+a,et),e.arc(_,et,a,0,2*Math.PI),e.fill()),b&&(e.moveTo(z,v),e.lineTo(_,et)),e.stroke()}),e.strokeStyle=Z,e.globalAlpha=1,f&&x.length&&(x=x.sort((R,N)=>R[2]-N[2]),e.beginPath(),e.moveTo(x[0][0],x[0][1]),x.forEach(([R,N,O,_,et])=>{e.strokeStyle=_,e.globalAlpha=et,e.lineTo(R,N)}),e.lineTo(x[0][0],x[0][1]),e.stroke())}L.prototype.pitchwheel=function(t={}){let{ctx:e=Re(),id:n=1}=t;return this.tag(n).onPaint((s,o,r)=>u2({...t,ctx:e,haps:r.filter(i=>i.isActive(o)),id:n}))};function eh(t,{align:e=!0,color:n="white",thickness:s=3,scale:o=.25,pos:r=.75,trigger:i=0,ctx:u=Re(),id:a=1}={}){u.lineWidth=s,u.strokeStyle=n;let l=u.canvas;if(!t){u.beginPath();let Z=r*l.height;u.moveTo(0,Z),u.lineTo(l.width,Z),u.stroke();return}const p=ts("time",a);u.beginPath();const f=t.frequencyBinCount;let b=e?Array.from(p).findIndex((Z,W,F)=>W&&F[W-1]>-i&&Z<=-i):0;b=Math.max(b,0);const g=l.width*1/f;let X=0;for(let Z=b;Z<f;Z++){const W=p[Z]+1,F=(r-o*(W-1))*l.height;Z===0?u.moveTo(X,F):u.lineTo(X,F),X+=g}u.stroke()}function nh(t,{color:e="white",scale:n=.25,pos:s=.75,lean:o=.5,min:r=-150,max:i=0,ctx:u=Re(),id:a=1}={}){if(!t){u.beginPath();let X=s*p.height;u.moveTo(0,X),u.lineTo(p.width,X),u.stroke();return}const l=ts("frequency",a),p=u.canvas;u.fillStyle=e;const f=t.frequencyBinCount,b=p.width*1/f;let g=0;for(let X=0;X<f;X++){const W=An((l[X]-r)/(i-r),0,1)*n,F=W*p.height,z=(s-W*o)*p.height;u.fillRect(g,z,Math.max(b,1),F),g+=b}}function sh(t=0,e="0,0,0",n=Re()){t?(n.fillStyle=`rgba(${e},${1-t})`,n.fillRect(0,0,n.canvas.width,n.canvas.height)):n.clearRect(0,0,n.canvas.width,n.canvas.height)}L.prototype.fscope=function(t={}){let e=t.id??1;return this.analyze(e).draw(()=>{sh(t.smear,"0,0,0",t.ctx),vt[e]&&nh(vt[e],t)},{id:e})},L.prototype.tscope=function(t={}){let e=t.id??1;return this.analyze(e).draw(n=>{t.color=n[0]?.value?.color||he().foreground,t.color,sh(t.smear,"0,0,0",t.ctx),eh(vt[e],t)},{id:e})},L.prototype.scope=L.prototype.tscope;let oh={};L.prototype.spectrum=function(t={}){let e=t.id??1;return this.analyze(e).draw(n=>{t.color=n[0]?.value?.color||oh[e]||he().foreground,oh[e]=t.color,a2(vt[e],t)},{id:e})},L.prototype.scope=L.prototype.tscope;const Wo=new Map;function a2(t,{thickness:e=3,speed:n=1,min:s=-80,max:o=0,ctx:r=Re(),id:i=1,color:u}={}){if(r.lineWidth=e,r.strokeStyle=u,!t)return;const a=n,l=ts("frequency",i),p=r.canvas;r.fillStyle=u;const f=t.frequencyBinCount;let b=Wo.get(i)||r.getImageData(0,0,p.width,p.height);Wo.set(i,b),r.clearRect(0,0,r.canvas.width,r.canvas.height),r.putImageData(b,-a,0);let g=p.width-n;for(let X=0;X<f;X++){const Z=An((l[X]-s)/(o-s),0,1);r.globalAlpha=Z;const W=Math.log(X+1)/Math.log(f)*p.height;r.fillRect(g,p.height-W,a,2)}Wo.set(i,r.getImageData(0,0,p.width,p.height))}const l2=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_MAX_POLYPHONY:ao,Warpmode:Go,aliasBank:Xg,get analysers(){return vt},get analysersData(){return Me},applyFM:Zn,applyGainCurve:de,applyParameterModulators:so,connectToDestination:Mp,createFilter:Qn,destroyAudioWorkletNode:Oe,distortionAlgorithms:oo,dough:Ng,doughTrigger:Ap,doughsamples:Dp,drawFrequencyScope:nh,drawTimeScope:eh,drywet:op,dspWorklet:kp,effectSend:Un,errorLogger:J0,gainNode:xt,getADSRValues:Jt,getAnalyserById:Rp,getAnalyzerData:ts,getAudioContext:j,getAudioContextCurrentTime:Jb,getAudioDevices:Vp,getCachedBuffer:ig,getCompressor:np,getDefaultValue:Ft,getDistortion:up,getDistortionAlgorithm:sg,getFrequencyFromValue:ze,getLfo:Gn,getLoadedBuffer:ag,getOscillator:Yp,getParamADSR:Dt,getParamLfo:no,getPitchEnvelope:Ie,getSampleBuffer:lp,getSampleBufferSource:dp,getSampleInfo:ap,getSound:Qe,getSuperdoughAudioController:go,getVibratoOscillator:je,getWorklet:kt,getZZFX:Bp,initAudio:yo,initAudioOnFirstClick:zg,loadBuffer:io,logger:Zt,noises:eo,onTriggerSample:gp,onTriggerSynth:Pp,processSampleMap:mp,registerSampleSource:Xp,registerSamplesPrefix:lg,registerSound:oe,registerSynthSounds:kg,registerWaveTable:wo,registerWorklet:zp,registerZZFXSounds:Ag,resetDefaultValues:Cp,resetDefaults:Wg,resetGlobalEffects:xg,resetLoadedSounds:Cg,reverseBuffer:pp,samples:uo,scheduleAtTime:Ob,setDefault:wg,setDefaultAudioContext:$0,setDefaultValue:fo,setDefaultValues:Fg,setGainCurve:bg,setLogger:I0,setMaxPolyphony:Zp,setMultiChannelOrbits:Wp,setVersionDefaults:Vg,soundAlias:Gg,soundMap:$t,superdough:Xo,superdoughTrigger:vg,tables:Jg,waveformN:Sp,webAudioTimeout:Le,webaudioOutput:Jp,webaudioRepl:Ip},Symbol.toStringTag,{value:"Module"})),{evalScope:d2}=js,S={},{evaluate:rh}=Ip({onEvalError:t=>S.set_status(t)});S.poll_minutes=1,S.audio_started=!1,S.poll_in_flight=!1,S.clear_status_watch=()=>{S.poll_timer&&(clearInterval(S.poll_timer),S.poll_timer=void 0)},S.ensure_scope=()=>(S.scope_promise||(S.scope_promise=d2(js,Sb,l2).catch(t=>{throw S.scope_promise=void 0,console.error("Strudel scope failed to load",t),t})),S.scope_promise),S.strudel_init=async()=>{if(!S.audio_started){console.info("Initializing Audio...");try{await S.ensure_scope(),await yo(),E0(),await uo("github:tidalcycles/dirt-samples"),S.audio_started=!0,S.strudel_watch_status(),console.info("Audio Ready.")}catch(t){throw console.error("Audio Failed:",t),t}}},S.playing=()=>{S.set_status("Playing 🥁")},S.strudel_update=async t=>{if(!S.audio_started){console.warn("Audio not started yet. Call strudel_init() first.");return}console.info("Updating 💨");try{await rh(t),S.set_input(t),S.playing()}catch(e){S.set_status(e)}},S.set_input=t=>{const e=document.getElementById("code-input");e.value=t},S.strudel_stop=()=>{S.stop_status_watch(),rh("hush")},S.fetch_status_code=async()=>{const t=await fetch("/status",{cache:"no-store"});if(!t.ok)throw new Error(`Status endpoint returned ${t.status}`);return t.text()},S.stop_status_watch=()=>{S.clear_status_watch()},S.strudel_watch_status=()=>{if(!S.poll_minutes||S.poll_minutes<=0){console.error("Provide a polling interval in minutes greater than zero");return}const t=S.poll_minutes*60*1e3,e=async()=>{if(!S.poll_in_flight){if(!S.audio_started){console.warn("Audio not started yet.");return}S.poll_in_flight=!0;try{const s=(await S.fetch_status_code()).trim();if(!s||s===S.last_status)return;S.last_status=s,S.strudel_update(s)}catch(n){console.error("Failed to update Strudel status",n)}finally{S.poll_in_flight=!1}}};S.clear_status_watch(),e(),S.poll_timer=setInterval(()=>{e()},t),console.info("Interval started.")},S.set_status=t=>{let e=document.getElementById("status");e.innerText=t},S.start_events=()=>{const t=document.getElementById("code-input"),e=async()=>window.strudel_init?(await window.strudel_init(),!0):(S.set_status("Bundle not loaded. Check console for errors."),console.error("strudel.bundle.js is missing or failed to load"),!1),n=()=>{if(!window.strudel_watchStatus){console.warn("Polling function missing. Did strudel bundle load?");return}const s=window.App&&window.App.statusPollMinutes||1;window.strudel_watchStatus(s)};document.getElementById("btn-start").addEventListener("click",async()=>{await e()&&(S.set_status("Audio Ready! Click Update to play."),n())}),document.getElementById("btn-update").addEventListener("click",async()=>{if(!await e())return;const o=t.value;try{S.strudel_update(o),S.playing()}catch(r){S.set_status(`Error: ${r.message}`)}}),document.getElementById("btn-stop").addEventListener("click",()=>{if(!window.strudel_stop){S.set_status("Bundle not loaded. Cannot stop audio.");return}window.strudel_stopStatusWatch&&window.strudel_stopStatusWatch(),window.strudel_stop(),S.set_status("Stopped.")})},window.strudel_init=S.strudel_init,window.strudel_update=S.strudel_update,window.strudel_stop=S.strudel_stop,window.strudel_watchStatus=S.strudel_watch_status,window.strudel_stopStatusWatch=S.stop_status_watch,window.App=S,S.start_events()})();
