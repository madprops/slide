(function(){"use strict";typeof globalThis.process>"u"&&(globalThis.process={env:{}}),typeof globalThis.process.env>"u"&&(globalThis.process.env={}),typeof globalThis.process.env.NODE_ENV>"u"&&(globalThis.process.env.NODE_ENV="production"),typeof BigInt>"u"&&(BigInt=function(t){if(isNaN(t))throw new Error("");return t});const q=BigInt(0),C=BigInt(1),le=BigInt(2),Xe=BigInt(5),ut=BigInt(10),If=2e3,v={s:C,n:q,d:C};function Nt(t,e){try{t=BigInt(t)}catch{throw Lt()}return t*e}function qt(t){return typeof t=="bigint"?t:Math.floor(t)}function L(t,e){if(e===q)throw Ze();const n=Object.create(j.prototype);n.s=t<q?-C:C,t=t<q?-t:t;const s=Gt(t,e);return n.n=t/s,n.d=e/s,n}function Zt(t){const e={};let n=t,s=le,o=Xe-C;for(;o<=n;){for(;n%s===q;)n/=s,e[s]=(e[s]||q)+C;o+=C+le*s++}return n!==t?n>1&&(e[n]=(e[n]||q)+C):e[t]=(e[t]||q)+C,e}const tt=function(t,e){let n=q,s=C,o=C;if(t!=null)if(e!==void 0){if(typeof t=="bigint")n=t;else{if(isNaN(t))throw Lt();if(t%1!==0)throw es();n=BigInt(t)}if(typeof e=="bigint")s=e;else{if(isNaN(e))throw Lt();if(e%1!==0)throw es();s=BigInt(e)}o=n*s}else if(typeof t=="object"){if("d"in t&&"n"in t)n=BigInt(t.n),s=BigInt(t.d),"s"in t&&(n*=BigInt(t.s));else if(0 in t)n=BigInt(t[0]),1 in t&&(s=BigInt(t[1]));else if(typeof t=="bigint")n=t;else throw Lt();o=n*s}else if(typeof t=="number"){if(isNaN(t))throw Lt();if(t<0&&(o=-C,t=-t),t%1===0)n=BigInt(t);else if(t>0){let r=1,i=0,c=1,u=1,l=1,f=1e7;for(t>=1&&(r=10**Math.floor(1+Math.log10(t)),t/=r);c<=f&&l<=f;){let h=(i+u)/(c+l);if(t===h){c+l<=f?(n=i+u,s=c+l):l>c?(n=u,s=l):(n=i,s=c);break}else t>h?(i+=u,c+=l):(u+=i,l+=c),c>f?(n=u,s=l):(n=i,s=c)}n=BigInt(n)*BigInt(r),s=BigInt(s)}}else if(typeof t=="string"){let r=0,i=q,c=q,u=q,l=C,f=C,h=t.replace(/_/g,"").match(/\d+|./g);if(h===null)throw Lt();if(h[r]==="-"?(o=-C,r++):h[r]==="+"&&r++,h.length===r+1?c=Nt(h[r++],o):h[r+1]==="."||h[r]==="."?(h[r]!=="."&&(i=Nt(h[r++],o)),r++,(r+1===h.length||h[r+1]==="("&&h[r+3]===")"||h[r+1]==="'"&&h[r+3]==="'")&&(c=Nt(h[r],o),l=ut**BigInt(h[r].length),r++),(h[r]==="("&&h[r+2]===")"||h[r]==="'"&&h[r+2]==="'")&&(u=Nt(h[r+1],o),f=ut**BigInt(h[r+1].length)-C,r+=3)):h[r+1]==="/"||h[r+1]===":"?(c=Nt(h[r],o),l=Nt(h[r+2],C),r+=3):h[r+3]==="/"&&h[r+1]===" "&&(i=Nt(h[r],o),c=Nt(h[r+2],o),l=Nt(h[r+4],C),r+=5),h.length<=r)s=l*f,o=n=u+s*i+f*c;else throw Lt()}else if(typeof t=="bigint")n=t,o=t,s=C;else throw Lt();if(s===q)throw Ze();v.s=o<q?-C:C,v.n=n<q?-n:n,v.d=s<q?-s:s};function jf(t,e,n){let s=C;for(;e>q;t=t*t%n,e>>=C)e&C&&(s=s*t%n);return s}function Lf(t,e){for(;e%le===q;e/=le);for(;e%Xe===q;e/=Xe);if(e===C)return q;let n=ut%e,s=1;for(;n!==C;s++)if(n=n*ut%e,s>If)return q;return BigInt(s)}function $f(t,e,n){let s=C,o=jf(ut,n,e);for(let r=0;r<300;r++){if(s===o)return BigInt(r);s=s*ut%e,o=o*ut%e}return 0}function Gt(t,e){if(!t)return e;if(!e)return t;for(;;){if(t%=e,!t)return e;if(e%=t,!e)return t}}function j(t,e){if(tt(t,e),this instanceof j)t=Gt(v.d,v.n),this.s=v.s,this.n=v.n/t,this.d=v.d/t;else return L(v.s*v.n,v.d)}var Ze=function(){return new Error("Division by Zero")},Lt=function(){return new Error("Invalid argument")},es=function(){return new Error("Parameters must be integer")};j.prototype={s:C,n:q,d:C,abs:function(){return L(this.n,this.d)},neg:function(){return L(-this.s*this.n,this.d)},add:function(t,e){return tt(t,e),L(this.s*this.n*v.d+v.s*this.d*v.n,this.d*v.d)},sub:function(t,e){return tt(t,e),L(this.s*this.n*v.d-v.s*this.d*v.n,this.d*v.d)},mul:function(t,e){return tt(t,e),L(this.s*v.s*this.n*v.n,this.d*v.d)},div:function(t,e){return tt(t,e),L(this.s*v.s*this.n*v.d,this.d*v.n)},clone:function(){return L(this.s*this.n,this.d)},mod:function(t,e){if(t===void 0)return L(this.s*this.n%this.d,C);if(tt(t,e),q===v.n*this.d)throw Ze();return L(this.s*(v.d*this.n)%(v.n*this.d),v.d*this.d)},gcd:function(t,e){return tt(t,e),L(Gt(v.n,this.n)*Gt(v.d,this.d),v.d*this.d)},lcm:function(t,e){return tt(t,e),v.n===q&&this.n===q?L(q,C):L(v.n*this.n,Gt(v.n,this.n)*Gt(v.d,this.d))},inverse:function(){return L(this.s*this.d,this.n)},pow:function(t,e){if(tt(t,e),v.d===C)return v.s<q?L((this.s*this.d)**v.n,this.n**v.n):L((this.s*this.n)**v.n,this.d**v.n);if(this.s<q)return null;let n=Zt(this.n),s=Zt(this.d),o=C,r=C;for(let i in n)if(i!=="1"){if(i==="0"){o=q;break}if(n[i]*=v.n,n[i]%v.d===q)n[i]/=v.d;else return null;o*=BigInt(i)**n[i]}for(let i in s)if(i!=="1"){if(s[i]*=v.n,s[i]%v.d===q)s[i]/=v.d;else return null;r*=BigInt(i)**s[i]}return v.s<q?L(r,o):L(o,r)},log:function(t,e){if(tt(t,e),this.s<=q||v.s<=q)return null;const n={},s=Zt(v.n),o=Zt(v.d),r=Zt(this.n),i=Zt(this.d);for(const l in o)s[l]=(s[l]||q)-o[l];for(const l in i)r[l]=(r[l]||q)-i[l];for(const l in s)l!=="1"&&(n[l]=!0);for(const l in r)l!=="1"&&(n[l]=!0);let c=null,u=null;for(const l in n){const f=s[l]||q,h=r[l]||q;if(f===q){if(h!==q)return null;continue}let d=h,m=f;const w=Gt(d,m);if(d/=w,m/=w,c===null&&u===null)c=d,u=m;else if(d*u!==c*m)return null}return c!==null&&u!==null?L(c,u):null},equals:function(t,e){return tt(t,e),this.s*this.n*v.d===v.s*v.n*this.d},lt:function(t,e){return tt(t,e),this.s*this.n*v.d<v.s*v.n*this.d},lte:function(t,e){return tt(t,e),this.s*this.n*v.d<=v.s*v.n*this.d},gt:function(t,e){return tt(t,e),this.s*this.n*v.d>v.s*v.n*this.d},gte:function(t,e){return tt(t,e),this.s*this.n*v.d>=v.s*v.n*this.d},compare:function(t,e){tt(t,e);let n=this.s*this.n*v.d-v.s*v.n*this.d;return(q<n)-(n<q)},ceil:function(t){return t=ut**BigInt(t||0),L(qt(this.s*t*this.n/this.d)+(t*this.n%this.d>q&&this.s>=q?C:q),t)},floor:function(t){return t=ut**BigInt(t||0),L(qt(this.s*t*this.n/this.d)-(t*this.n%this.d>q&&this.s<q?C:q),t)},round:function(t){return t=ut**BigInt(t||0),L(qt(this.s*t*this.n/this.d)+this.s*((this.s>=q?C:q)+le*(t*this.n%this.d)>this.d?C:q),t)},roundTo:function(t,e){tt(t,e);const n=this.n*v.d,s=this.d*v.n,o=n%s;let r=qt(n/s);return o+o>=s&&r++,L(this.s*r*v.n,v.d)},divisible:function(t,e){return tt(t,e),!(!(v.n*this.d)||this.n*v.d%(v.n*this.d))},valueOf:function(){return Number(this.s*this.n)/Number(this.d)},toString:function(t){let e=this.n,n=this.d;t=t||15;let s=Lf(e,n),o=$f(e,n,s),r=this.s<q?"-":"";if(r+=qt(e/n),e%=n,e*=ut,e&&(r+="."),s){for(let i=o;i--;)r+=qt(e/n),e%=n,e*=ut;r+="(";for(let i=s;i--;)r+=qt(e/n),e%=n,e*=ut;r+=")"}else for(let i=t;e&&i--;)r+=qt(e/n),e%=n,e*=ut;return r},toFraction:function(t){let e=this.n,n=this.d,s=this.s<q?"-":"";if(n===C)s+=e;else{let o=qt(e/n);t&&o>q&&(s+=o,s+=" ",e%=n),s+=e,s+="/",s+=n}return s},toLatex:function(t){let e=this.n,n=this.d,s=this.s<q?"-":"";if(n===C)s+=e;else{let o=qt(e/n);t&&o>q&&(s+=o,e%=n),s+="\\frac{",s+=e,s+="}{",s+=n,s+="}"}return s},toContinued:function(){let t=this.n,e=this.d,n=[];do{n.push(qt(t/e));let s=t%e;t=e,e=s}while(t!==C);return n},simplify:function(t){const e=BigInt(1/(t||.001)|0),n=this.abs(),s=n.toContinued();for(let o=1;o<s.length;o++){let r=L(s[o-1],C);for(let c=o-2;c>=0;c--)r=r.inverse().add(s[c]);let i=r.sub(n);if(i.n*e<i.d)return r.mul(this.s)}return this}};const tn="strudel.log";let Ff=1e3,ns,ss;function Pe(t,e="cyclist"){process.env.NODE_ENV==="development"&&console.error(t),lt(`[${e}] error: ${t.message}`)}function lt(t,e,n={}){let s=performance.now();ns===t&&s-ss<Ff||(ns=t,ss=s,console.log(`%c${t}`,"background-color: black;color:white;border-radius:15px"),typeof document<"u"&&typeof CustomEvent<"u"&&document.dispatchEvent(new CustomEvent(tn,{detail:{message:t,type:e,data:n}})))}lt.key=tn;const Df=t=>/^[a-gA-G][#bsf]*[0-9]*$/.test(t),xe=t=>/^[a-gA-G][#bsf]*-?[0-9]*$/.test(t),os=t=>{if(typeof t!="string")return[];const[e,n="",s]=t.match(/^([a-gA-G])([#bsf]*)(-?[0-9]*)$/)?.slice(1)||[];return e?[e,n,s?Number(s):void 0]:[]},Wf={c:0,d:2,e:4,f:5,g:7,a:9,b:11},Vf={"#":1,b:-1,s:1,f:-1},rs=t=>t?.split("").reduce((e,n)=>e+Vf[n],0)||0,te=(t,e=3)=>{const[n,s,o=e]=os(t);if(!n)throw new Error('not a note: "'+t+'"');const r=Wf[n.toLowerCase()],i=rs(s);return(Number(o)+1)*12+r+i},Ht=t=>Math.pow(2,(t-69)/12)*440,en=t=>12*Math.log(t/440)/Math.LN2+69,Jf=(t,e)=>{if(typeof t!="object")throw new Error("valueToMidi: expected object value");let{freq:n,note:s}=t;if(typeof n=="number")return en(n);if(typeof s=="string")return te(s);if(typeof s=="number")return s;if(!e)throw new Error("valueToMidi: expected freq or note to be set");return e},Gf=(t,e)=>(t-e)*1e3,is=t=>Ht(typeof t=="number"?t:te(t)),Hf=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],Uf=t=>{const e=Math.floor(t/12)-1;return Hf[t%12]+e},fe=(t,e)=>(t%e+e)%e,cs=t=>t.reduce((e,n)=>e+n)/t.length;function as(t,e=0){return isNaN(Number(t))?(lt(`"${t}" is not a number, falling back to ${e}`,"warning"),e):t}const Qf=(t,e)=>fe(Math.round(as(t??0,0)),e),Kf=t=>{let{value:e,context:n}=t,s=e;if(typeof s=="object"&&!Array.isArray(s)&&(s=s.note||s.n||s.value,s===void 0))throw new Error(`cannot find a playable note for ${JSON.stringify(e)}`);if(typeof s=="number"&&n.type!=="frequency")s=Ht(t.value);else if(typeof s=="number"&&n.type==="frequency")s=t.value;else if(typeof s!="string"||!xe(s))throw new Error("not a note: "+JSON.stringify(s));return s},us=t=>{let{value:e,context:n}=t;if(typeof e=="object")return e.freq?e.freq:is(e.note||e.n||e.value);if(typeof e=="number"&&n.type!=="frequency")e=Ht(t.value);else if(typeof e=="string"&&xe(e))e=Ht(te(t.value));else if(typeof e!="number")throw new Error("not a note or frequency: "+e);return e},ls=(t,e)=>t.slice(e).concat(t.slice(0,e)),fs=(...t)=>t.reduce((e,n)=>(...s)=>e(n(...s)),e=>e),Yf=(...t)=>fs(...t.reverse()),ee=t=>t.filter(e=>e!=null),Bt=t=>[].concat(...t),ne=t=>t,Xf=(t,e)=>t,he=(t,e)=>Array.from({length:e-t+1},(n,s)=>s+t);function S(t,e,n=t.length){const s=function o(...r){if(r.length>=n)return t.apply(this,r);{const i=function(...c){return o.apply(this,r.concat(c))};return e&&e(i,r),i}};return e&&e(s,[]),s}function nn(t){const e=Number(t);if(!isNaN(e))return e;if(xe(t))return te(t);throw new Error(`cannot parse as numeral: "${t}"`)}function sn(t,e){return(...n)=>t(...n.map(e))}function mt(t){return sn(t,nn)}function hs(t){const e=Number(t);if(!isNaN(e))return e;const n={pi:Math.PI,w:1,h:.5,q:.25,e:.125,s:.0625,t:1/3,f:.2,x:1/6}[t];if(typeof n<"u")return n;throw new Error(`cannot parse as fractional: "${t}"`)}const Zf=t=>sn(t,hs),on=function(t,e){return[e.slice(0,t),e.slice(t)]},Ee=(t,e,n)=>e.map((s,o)=>t(s,n[o])),ps=function(t){const e=[];for(let n=0;n<t.length-1;++n)e.push([t[n],t[n+1]]);return e},Re=(t,e,n)=>Math.min(Math.max(t,e),n),th=["Do","Reb","Re","Mib","Mi","Fa","Solb","Sol","Lab","La","Sib","Si"],eh=["Sa","Re","Ga","Ma","Pa","Dha","Ni"],nh=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Hb","H"],sh=["Ni","Pab","Pa","Voub","Vou","Ga","Dib","Di","Keb","Ke","Zob","Zo"],oh=["I","Ro","Ha","Ni","Ho","He","To"],rh=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],ih=(t,e="letters")=>{const s=(e==="solfeggio"?th:e==="indian"?eh:e==="german"?nh:e==="byzantine"?sh:e==="japanese"?oh:rh)[t%12],o=Math.floor(t/12)-1;return s+o};function ch(t){var e={};return t.filter(function(n){return e.hasOwn(n)?!1:e[n]=!0})}function ah(t){return t.sort().filter(function(e,n,s){return!n||e!=s[n-1]})}function ds(t){return t.sort((e,n)=>e.compare(n)).filter(function(e,n,s){return!n||e.ne(s[n-1])})}function ms(t){const e=new TextEncoder().encode(t);return btoa(String.fromCharCode(...e))}function ys(t){const e=new Uint8Array(atob(t).split("").map(s=>s.charCodeAt(0)));return new TextDecoder().decode(e)}function uh(t){return encodeURIComponent(ms(t))}function lh(t){return ys(decodeURIComponent(t))}function gs(t,e){return Array.isArray(t)?t.map(e):Object.fromEntries(Object.entries(t).map(([n,s],o)=>[n,e(s,n,o)]))}function rn(t,e){return t/e}class ws{constructor({getTargetClockTime:e=hh,weight:n=16,offsetDelta:s=.005,checkAfterTime:o=2,resetAfterTime:r=8}){this.offsetTime,this.timeAtPrevOffsetSample,this.prevOffsetTimes=[],this.getTargetClockTime=e,this.weight=n,this.offsetDelta=s,this.checkAfterTime=o,this.resetAfterTime=r,this.reset=()=>{this.prevOffsetTimes=[],this.offsetTime=null,this.timeAtPrevOffsetSample=null}}calculateOffset(e){const n=this.getTargetClockTime(),s=n-this.timeAtPrevOffsetSample,o=n-e;if(s>this.resetAfterTime&&this.reset(),this.offsetTime==null&&(this.offsetTime=o),this.prevOffsetTimes.push(o),this.prevOffsetTimes.length>this.weight&&this.prevOffsetTimes.shift(),this.timeAtPrevOffsetSample==null||s>this.checkAfterTime){this.timeAtPrevOffsetSample=n;const r=cs(this.prevOffsetTimes);Math.abs(r-this.offsetTime)>this.offsetDelta&&(this.offsetTime=r)}return this.offsetTime}calculateTimestamp(e,n){return this.calculateOffset(e)+n}}function fh(){return performance.now()*.001}function hh(){return Date.now()*.001}const bs=new Map([["control","Control"],["ctrl","Control"],["alt","Alt"],["shift","Shift"],["down","ArrowDown"],["up","ArrowUp"],["left","ArrowLeft"],["right","ArrowRight"]]);let pe;function vs(){if(pe==null){if(typeof window>"u")return;pe={},window.addEventListener("keydown",t=>{pe[t.key]=!0}),window.addEventListener("keyup",t=>{pe[t.key]=!1})}return{...pe}}function cn(t,e=!1){return typeof t=="object"?e?JSON.stringify(t).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(t):t}j.prototype.sam=function(){return this.floor()},j.prototype.nextSam=function(){return this.sam().add(1)},j.prototype.wholeCycle=function(){return new W(this.sam(),this.nextSam())},j.prototype.cyclePos=function(){return this.sub(this.sam())},j.prototype.lt=function(t){return this.compare(t)<0},j.prototype.gt=function(t){return this.compare(t)>0},j.prototype.lte=function(t){return this.compare(t)<=0},j.prototype.gte=function(t){return this.compare(t)>=0},j.prototype.eq=function(t){return this.compare(t)==0},j.prototype.ne=function(t){return this.compare(t)!=0},j.prototype.max=function(t){return this.gt(t)?this:t},j.prototype.maximum=function(...t){return t=t.map(e=>new j(e)),t.reduce((e,n)=>n.max(e),this)},j.prototype.min=function(t){return this.lt(t)?this:t},j.prototype.mulmaybe=function(t){return t!==void 0?this.mul(t):void 0},j.prototype.divmaybe=function(t){return t!==void 0?this.div(t):void 0},j.prototype.addmaybe=function(t){return t!==void 0?this.add(t):void 0},j.prototype.submaybe=function(t){return t!==void 0?this.sub(t):void 0},j.prototype.show=function(){return this.s*this.n+"/"+this.d},j.prototype.or=function(t){return this.eq(0)?t:this};const an=t=>j(t),ph=(...t)=>{if(t=ee(t),t.length!==0)return t.reduce((e,n)=>e.gcd(n),an(1))},Ut=(...t)=>{if(t=ee(t),t.length===0)return;const e=t.pop();return t.reduce((n,s)=>n===void 0||s===void 0?void 0:n.lcm(s),e)},dh=t=>t instanceof j;an._original=j;const b=an;class W{constructor(e,n){this.begin=b(e),this.end=b(n)}get spanCycles(){const e=[];var n=this.begin;const s=this.end,o=s.sam();if(n.equals(s))return[new W(n,s)];for(;s.gt(n);){if(n.sam().equals(o)){e.push(new W(n,this.end));break}const r=n.nextSam();e.push(new W(n,r)),n=r}return e}get duration(){return this.end.sub(this.begin)}cycleArc(){const e=this.begin.cyclePos(),n=e.add(this.duration);return new W(e,n)}withTime(e){return new W(e(this.begin),e(this.end))}withEnd(e){return new W(this.begin,e(this.end))}withCycle(e){const n=this.begin.sam(),s=n.add(e(this.begin.sub(n))),o=n.add(e(this.end.sub(n)));return new W(s,o)}intersection(e){const n=this.begin.max(e.begin),s=this.end.min(e.end);if(!n.gt(s)&&!(n.equals(s)&&(n.equals(this.end)&&this.begin.lt(this.end)||n.equals(e.end)&&e.begin.lt(e.end))))return new W(n,s)}intersection_e(e){const n=this.intersection(e);if(n==null)throw"TimeSpans do not intersect";return n}midpoint(){return this.begin.add(this.duration.div(b(2)))}equals(e){return this.begin.equals(e.begin)&&this.end.equals(e.end)}show(){return this.begin.show()+" → "+this.end.show()}}class V{constructor(e,n,s,o={},r=!1){this.whole=e,this.part=n,this.value=s,this.context=o,this.stateful=r,r&&console.assert(typeof this.value=="function","Stateful values must be functions")}get duration(){let e;return typeof this.value?.duration=="number"?e=b(this.value.duration):e=this.whole.end.sub(this.whole.begin),typeof this.value?.clip=="number"?e.mul(this.value.clip):e}get endClipped(){return this.whole.begin.add(this.duration)}isActive(e){return this.whole.begin<=e&&this.endClipped>=e}isInPast(e){return e>this.endClipped}isInNearPast(e,n){return n-e<=this.endClipped}isInFuture(e){return e<this.whole.begin}isInNearFuture(e,n){return n<this.whole.begin&&n>this.whole.begin-e}isWithinTime(e,n){return this.whole.begin<=n&&this.endClipped>=e}wholeOrPart(){return this.whole?this.whole:this.part}withSpan(e){const n=this.whole?e(this.whole):void 0;return new V(n,e(this.part),this.value,this.context)}withValue(e){return new V(this.whole,this.part,e(this.value),this.context)}hasOnset(){return this.whole!=null&&this.whole.begin.equals(this.part.begin)}hasTag(e){return this.context.tags?.includes(e)}resolveState(e){if(this.stateful&&this.hasOnset()){console.log("stateful");const n=this.value,[s,o]=n(e);return[s,new V(this.whole,this.part,o,this.context,!1)]}return[e,this]}spanEquals(e){return this.whole==null&&e.whole==null||this.whole.equals(e.whole)}equals(e){return this.spanEquals(e)&&this.part.equals(e.part)&&this.value===e.value}show(e=!1){const n=typeof this.value=="object"?e?JSON.stringify(this.value).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(this.value):this.value;var s="";if(this.whole==null)s="~"+this.part.show;else{var o=this.whole.begin.equals(this.part.begin)&&this.whole.end.equals(this.part.end);this.whole.begin.equals(this.part.begin)||(s=this.whole.begin.show()+" ⇜ "),o||(s+="("),s+=this.part.show(),o||(s+=")"),this.whole.end.equals(this.part.end)||(s+=" ⇝ "+this.whole.end.show())}return"[ "+s+" | "+n+" ]"}showWhole(e=!1){return`${this.whole==null?"~":this.whole.show()}: ${cn(this.value,e)}`}combineContext(e){const n=this;return{...n.context,...e.context,locations:(n.context.locations||[]).concat(e.context.locations||[])}}setContext(e){return new V(this.whole,this.part,this.value,e)}ensureObjectValue(){if(typeof this.value!="object")throw new Error(`expected hap.value to be an object, but got "${this.value}". Hint: append .note() or .s() to the end`,"error")}}class se{constructor(e,n={}){this.span=e,this.controls=n}setSpan(e){return new se(e,this.controls)}withSpan(e){return this.setSpan(e(this.span))}setControls(e){return new se(this.span,{...this.controls,...e})}}function mh(t,e,n){if(e?.value!==void 0&&Object.keys(e).length===1)return lt("[warn]: Can't do arithmetic on control pattern."),t;const s=Object.keys(t).filter(o=>Object.keys(e).includes(o));return Object.assign({},t,e,Object.fromEntries(s.map(o=>[o,n(t[o],e[o])])))}S((t,e)=>t*e),S((t,e)=>e.map(t));function _s(t,e=60){let n=0,s=b(0),o=[""],r="";for(;o[0].length<e;){const i=t.queryArc(n,n+1),c=i.filter(f=>f.hasOnset()).map(f=>f.duration),u=ph(...c),l=u.inverse();o=o.map(f=>f+"|"),r+="|";for(let f=0;f<l;f++){const[h,d]=[s,s.add(u)],m=i.filter(_=>_.whole.begin.lte(h)&&_.whole.end.gte(d)),w=m.length-o.length;w>0&&(o=o.concat(Array(w).fill(r))),o=o.map((_,A)=>{const k=m[A];if(k){const M=k.whole.begin.eq(h)?""+k.value:"-";return _+M}return _+"."}),r+=".",s=s.add(u)}n++}return o.join(`
`)}let un,yt=!0;const yh=function(t){yt=!!t},gh=t=>un=t;let y=class st{constructor(e,n=void 0){this.query=e,this._Pattern=!0,this._steps=n}get _steps(){return this.__steps}set _steps(e){this.__steps=e===void 0?void 0:b(e)}setSteps(e){return this._steps=e,this}withSteps(e){return yt?new st(this.query,this._steps===void 0?void 0:e(this._steps)):this}get hasSteps(){return this._steps!==void 0}withValue(e){const n=new st(s=>this.query(s).map(o=>o.withValue(e)));return n._steps=this._steps,n}withState(e){return new st(n=>this.query(e(n)))}fmap(e){return this.withValue(e)}appWhole(e,n){const s=this,o=function(r){const i=s.query(r),c=n.query(r),u=function(l,f){const h=l.part.intersection(f.part);if(h!=null)return new V(e(l.whole,f.whole),h,l.value(f.value),f.combineContext(l))};return Bt(i.map(l=>ee(c.map(f=>u(l,f)))))};return new st(o)}appBoth(e){const n=this,s=function(r,i){if(!(r==null||i==null))return r.intersection_e(i)},o=n.appWhole(s,e);return yt&&(o._steps=Ut(e._steps,n._steps)),o}appLeft(e){const n=this,s=function(r){const i=[];for(const c of n.query(r)){const u=e.query(r.setSpan(c.wholeOrPart()));for(const l of u){const f=c.whole,h=c.part.intersection(l.part);if(h){const d=c.value(l.value),m=l.combineContext(c),w=new V(f,h,d,m);i.push(w)}}}return i},o=new st(s);return o._steps=this._steps,o}appRight(e){const n=this,s=function(r){const i=[];for(const c of e.query(r)){const u=n.query(r.setSpan(c.wholeOrPart()));for(const l of u){const f=c.whole,h=l.part.intersection(c.part);if(h){const d=l.value(c.value),m=c.combineContext(l),w=new V(f,h,d,m);i.push(w)}}}return i},o=new st(s);return o._steps=e._steps,o}bindWhole(e,n){const s=this,o=function(r){const i=function(u,l){return new V(e(u.whole,l.whole),l.part,l.value,Object.assign({},u.context,l.context,{locations:(u.context.locations||[]).concat(l.context.locations||[])}))},c=function(u){return n(u.value).query(r.setSpan(u.part)).map(l=>i(u,l))};return Bt(s.query(r).map(u=>c(u)))};return new st(o)}bind(e){const n=function(s,o){if(!(s==null||o==null))return s.intersection_e(o)};return this.bindWhole(n,e)}join(){return this.bind(ne)}outerBind(e){return this.bindWhole(n=>n,e).setSteps(this._steps)}outerJoin(){return this.outerBind(ne)}innerBind(e){return this.bindWhole((n,s)=>s,e)}innerJoin(){return this.innerBind(ne)}resetJoin(e=!1){const n=this;return new st(s=>n.discreteOnly().query(s).map(o=>o.value.late(e?o.whole.begin:o.whole.begin.cyclePos()).query(s).map(r=>new V(r.whole?r.whole.intersection(o.whole):void 0,r.part.intersection(o.part),r.value).setContext(o.combineContext(r))).filter(r=>r.part)).flat())}restartJoin(){return this.resetJoin(!0)}squeezeJoin(){const e=this;function n(s){const o=e.discreteOnly().query(s);function r(c){const l=c.value._focusSpan(c.wholeOrPart()).query(s.setSpan(c.part));function f(h,d){let m;if(d.whole&&h.whole&&(m=d.whole.intersection(h.whole),!m))return;const w=d.part.intersection(h.part);if(!w)return;const _=d.combineContext(h);return new V(m,w,d.value,_)}return l.map(h=>f(c,h))}return Bt(o.map(r)).filter(c=>c)}return new st(n)}squeezeBind(e){return this.fmap(e).squeezeJoin()}polyJoin=function(){const e=this;return e.fmap(n=>n.extend(e._steps.div(n._steps))).outerJoin()};polyBind(e){return this.fmap(e).polyJoin()}queryArc(e,n,s={}){try{return this.query(new se(new W(e,n),s))}catch(o){return Pe(o,"query"),[]}}splitQueries(){const e=this,n=s=>Bt(s.span.spanCycles.map(o=>e.query(s.setSpan(o))));return new st(n)}withQuerySpan(e){return new st(n=>this.query(n.withSpan(e)))}withQuerySpanMaybe(e){const n=this;return new st(s=>{const o=s.withSpan(e);return o.span?n.query(o):[]})}withQueryTime(e){return new st(n=>this.query(n.withSpan(s=>s.withTime(e))))}withHapSpan(e){return new st(n=>this.query(n).map(s=>s.withSpan(e)))}withHapTime(e){return this.withHapSpan(n=>n.withTime(e))}withHaps(e){const n=new st(s=>e(this.query(s),s));return n._steps=this._steps,n}withHap(e){return this.withHaps(n=>n.map(e))}setContext(e){return this.withHap(n=>n.setContext(e))}withContext(e){const n=this.withHap(s=>s.setContext(e(s.context)));return this.__pure!==void 0&&(n.__pure=this.__pure,n.__pure_loc=this.__pure_loc),n}stripContext(){return this.withHap(e=>e.setContext({}))}withLoc(e,n){const s={start:e,end:n},o=this.withContext(r=>{const i=(r.locations||[]).concat([s]);return{...r,locations:i}});return this.__pure&&(o.__pure=this.__pure,o.__pure_loc=s),o}filterHaps(e){return new st(n=>this.query(n).filter(e))}filterValues(e){return new st(n=>this.query(n).filter(s=>e(s.value))).setSteps(this._steps)}removeUndefineds(){return this.filterValues(e=>e!=null)}onsetsOnly(){return this.filterHaps(e=>e.hasOnset())}discreteOnly(){return this.filterHaps(e=>e.whole)}defragmentHaps(){return this.discreteOnly().withHaps(n=>{const s=[];for(var o=0;o<n.length;++o){for(var r=!0,i=n[o];r;){const l=JSON.stringify(n[o].value);for(var c=!1,u=o+1;u<n.length;u++){const f=n[u];if(i.whole.equals(f.whole)){if(i.part.begin.eq(f.part.end)){if(l===JSON.stringify(f.value)){i=new V(i.whole,new W(f.part.begin,i.part.end),i.value),n.splice(u,1),c=!0;break}}else if(f.part.begin.eq(i.part.end)&&l==JSON.stringify(f.value)){i=new V(i.whole,new W(i.part.begin,f.part.end),i.value),n.splice(u,1),c=!0;break}}}r=c}s.push(i)}return s})}firstCycle(e=!1){var n=this;return e||(n=n.stripContext()),n.query(new se(new W(b(0),b(1))))}get firstCycleValues(){return this.firstCycle().map(e=>e.value)}get showFirstCycle(){return this.firstCycle().map(e=>`${e.value}: ${e.whole.begin.toFraction()} - ${e.whole.end.toFraction()}`)}sortHapsByPart(){return this.withHaps(e=>e.sort((n,s)=>n.part.begin.sub(s.part.begin).or(n.part.end.sub(s.part.end)).or(n.whole.begin.sub(s.whole.begin).or(n.whole.end.sub(s.whole.end)))))}asNumber(){return this.fmap(nn)}_opIn(e,n){return this.fmap(n).appLeft(g(e))}_opOut(e,n){return this.fmap(n).appRight(g(e))}_opMix(e,n){return this.fmap(n).appBoth(g(e))}_opSqueeze(e,n){const s=g(e);return this.fmap(o=>s.fmap(r=>n(o)(r))).squeezeJoin()}_opSqueezeOut(e,n){const s=this;return g(e).fmap(r=>s.fmap(i=>n(i)(r))).squeezeJoin()}_opReset(e,n){return g(e).fmap(o=>this.fmap(r=>n(r)(o))).resetJoin()}_opRestart(e,n){return g(e).fmap(o=>this.fmap(r=>n(r)(o))).restartJoin()}_opPoly(e,n){const s=g(e);return this.fmap(o=>s.fmap(r=>n(r)(o))).polyJoin()}layer(...e){return K(...e.map(n=>n(this)))}superimpose(...e){return this.stack(...e.map(n=>n(this)))}stack(...e){return K(this,...e)}sequence(...e){return Pt(this,...e)}seq(...e){return Pt(this,...e)}cat(...e){return de(this,...e)}fastcat(...e){return ft(this,...e)}slowcat(...e){return $t(this,...e)}onTrigger(e,n=!0){return this.withHap(s=>s.setContext({...s.context,onTrigger:(...o)=>{s.context.onTrigger?.(...o),e(...o)},dominantTrigger:s.context.dominantTrigger||n}))}log(e=s=>`[hap] ${s.showWhole(!0)}`,n=s=>({hap:s})){return this.onTrigger((...s)=>{lt(e(...s),void 0,n(...s))},!1)}logValues(e=n=>`[hap] ${cn(n,!0)}`){return this.log(n=>e(n.value))}drawLine(){return console.log(_s(this)),this}unjoin(e,n=ne){return e.withHap(s=>s.withValue(o=>o?n(this.ribbon(s.whole.begin,s.whole.duration)):this))}into(e,n){return this.unjoin(e,n).innerJoin()}};function wh(t,e){let n=[];return e.forEach(s=>{const o=n.findIndex(([r])=>t(s,r));o===-1?n.push([s]):n[o].push(s)}),n}const bh=(t,e)=>t.spanEquals(e);y.prototype.collect=function(){return this.withHaps(t=>wh(bh,t).map(e=>new V(e[0].whole,e[0].part,e,{})))};const vh=p("arpWith",(t,e)=>e.collect().fmap(n=>g(t(n))).innerJoin().withHap(n=>new V(n.whole,n.part,n.value.value,n.combineContext(n.value)))),_h=p("arp",(t,e)=>e.arpWith(n=>g(t).fmap(s=>n[s%n.length])),!1);function ze(t){return!Array.isArray(t)&&typeof t=="object"&&!dh(t)}function kh(t,e,n){return ze(t)||ze(e)?(ze(t)||(t={value:t}),ze(e)||(e={value:e}),mh(t,e,n)):n(t,e)}(function(){const t={set:[(n,s)=>s],keep:[n=>n],keepif:[(n,s)=>s?n:void 0],add:[mt((n,s)=>n+s)],sub:[mt((n,s)=>n-s)],mul:[mt((n,s)=>n*s)],div:[mt((n,s)=>n/s)],mod:[mt(fe)],pow:[mt(Math.pow)],log2:[mt(Math.log2)],band:[mt((n,s)=>n&s)],bor:[mt((n,s)=>n|s)],bxor:[mt((n,s)=>n^s)],blshift:[mt((n,s)=>n<<s)],brshift:[mt((n,s)=>n>>s)],lt:[(n,s)=>n<s],gt:[(n,s)=>n>s],lte:[(n,s)=>n<=s],gte:[(n,s)=>n>=s],eq:[(n,s)=>n==s],eqt:[(n,s)=>n===s],ne:[(n,s)=>n!=s],net:[(n,s)=>n!==s],and:[(n,s)=>n&&s],or:[(n,s)=>n||s],func:[(n,s)=>s(n)]},e=["In","Out","Mix","Squeeze","SqueezeOut","Reset","Restart","Poly"];for(const[n,[s,o]]of Object.entries(t)){y.prototype["_"+n]=function(r){return this.fmap(i=>s(i,r))},Object.defineProperty(y.prototype,n,{get:function(){const r=this,i=(...c)=>r[n].in(...c);for(const c of e)i[c.toLowerCase()]=function(...u){var l=r;u=Pt(u),o&&(l=o(l),u=o(u));var f;return n==="keepif"?(f=l["_op"+c](u,h=>d=>s(h,d)),f=f.removeUndefineds()):f=l["_op"+c](u,h=>d=>kh(h,d,s)),f};return i.squeezein=i.squeeze,i}});for(const r of e)y.prototype[r.toLowerCase()]=function(...i){return this.set[r.toLowerCase()](i)}}y.prototype.struct=function(...n){return this.keepif.out(...n)},y.prototype.structAll=function(...n){return this.keep.out(...n)},y.prototype.mask=function(...n){return this.keepif.in(...n)},y.prototype.maskAll=function(...n){return this.keep.in(...n)},y.prototype.reset=function(...n){return this.keepif.reset(...n)},y.prototype.resetAll=function(...n){return this.keep.reset(...n)},y.prototype.restart=function(...n){return this.keepif.restart(...n)},y.prototype.restartAll=function(...n){return this.keep.restart(...n)}})();const qh=K,Ah=K,Th=Ie,oe=t=>new y(()=>[],t),I=oe(1),gt=oe(0);function et(t){function e(s){return s.span.spanCycles.map(o=>new V(b(o.begin).wholeCycle(),o,t))}const n=new y(e,1);return n.__pure=t,n}function ln(t){return t instanceof y||t?._Pattern}function g(t){return ln(t)?t:un&&typeof t=="string"?un(t):et(t)}function ks(t){let e=et([]);for(const n of t)e=e.bind(s=>n.fmap(o=>s.concat([o])));return e}function K(...t){t=t.map(s=>Array.isArray(s)?Pt(...s):g(s));const e=s=>Bt(t.map(o=>o.query(s))),n=new y(e);return yt&&(n._steps=Ut(...t.map(s=>s._steps))),n}function fn(t,e){if(e=e.map(r=>Array.isArray(r)?Pt(...r):g(r)),e.length===0)return I;if(e.length===1)return e[0];const[n,...s]=e.map(r=>r._steps),o=yt?n.maximum(...s):void 0;return K(...t(o,e))}function qs(...t){return fn((e,n)=>n.map(s=>s._steps.eq(e)?s:ht(s,oe(e.sub(s._steps)))),t)}function As(...t){return fn((e,n)=>n.map(s=>s._steps.eq(e)?s:ht(oe(e.sub(s._steps)),s)),t)}function Ts(...t){return fn((e,n)=>n.map(s=>{if(s._steps.eq(e))return s;const o=oe(e.sub(s._steps).div(2));return ht(o,s,o)}),t)}function Ch(t,...e){const[n,...s]=e.map(i=>i._steps),o=n.maximum(...s),r={centre:Ts,left:qs,right:As,expand:K,repeat:(...i)=>Ie(...i).steps(o)};return t.inhabit(r).fmap(i=>i(...e)).innerJoin().setSteps(o)}function $t(...t){if(t=t.map(s=>Array.isArray(s)?ft(...s):g(s)),t.length==1)return t[0];const e=function(s){const o=s.span,r=fe(o.begin.sam(),t.length),i=t[r];if(!i)return[];const c=o.begin.floor().sub(o.begin.div(t.length).floor());return i.withHapTime(u=>u.add(c)).query(s.setSpan(o.withTime(u=>u.sub(c))))},n=yt?Ut(...t.map(s=>s._steps)):void 0;return new y(e).splitQueries().setSteps(n)}function hn(...t){t=t.map(g);const e=function(n){const s=Math.floor(n.span.begin)%t.length;return t[s]?.query(n)||[]};return new y(e).splitQueries()}function de(...t){return $t(...t)}function Sh(...t){const e=t.reduce((n,[s])=>n+s,0);return t=t.map(([n,s])=>[n,s.fast(n)]),ht(...t).slow(e)}function Mh(...t){let e=b(0);for(let n of t)n.length==2&&n.unshift(e),e=n[1];return K(...t.map(([n,s,o])=>et(g(o)).compress(b(n).div(e),b(s).div(e)))).slow(e).innerJoin()}function ft(...t){let e=$t(...t);return t.length>1&&(e=e._fast(t.length),e._steps=t.length),t.length==1&&t[0].__steps_source&&(t._steps=t[0]._steps),e}function Pt(...t){return ft(...t)}function Cs(...t){return ft(...t)}function pn(t){return Array.isArray(t)?t.length==0?[I,0]:t.length==1?pn(t[0]):[ft(...t.map(e=>pn(e)[0])),t.length]:[g(t),1]}const Oh=S((t,e)=>g(e).mask(t)),Nh=S((t,e)=>g(e).struct(t)),Bh=S((t,e)=>g(e).superimpose(...t)),Ph=S((t,e)=>g(e).withValue(t)),xh=S((t,e)=>g(e).bind(t)),Eh=S((t,e)=>g(e).innerBind(t)),Rh=S((t,e)=>g(e).outerBind(t)),zh=S((t,e)=>g(e).squeezeBind(t)),Ih=S((t,e)=>g(e).stepBind(t)),jh=S((t,e)=>g(e).polyBind(t)),Lh=S((t,e)=>g(e).set(t)),$h=S((t,e)=>g(e).keep(t)),Fh=S((t,e)=>g(e).keepif(t)),Dh=S((t,e)=>g(e).add(t)),Wh=S((t,e)=>g(e).sub(t)),Vh=S((t,e)=>g(e).mul(t)),Jh=S((t,e)=>g(e).div(t)),Gh=S((t,e)=>g(e).mod(t)),Hh=S((t,e)=>g(e).pow(t)),Uh=S((t,e)=>g(e).band(t)),Qh=S((t,e)=>g(e).bor(t)),Kh=S((t,e)=>g(e).bxor(t)),Yh=S((t,e)=>g(e).blshift(t)),Xh=S((t,e)=>g(e).brshift(t)),Zh=S((t,e)=>g(e).lt(t)),tp=S((t,e)=>g(e).gt(t)),ep=S((t,e)=>g(e).lte(t)),np=S((t,e)=>g(e).gte(t)),sp=S((t,e)=>g(e).eq(t)),op=S((t,e)=>g(e).eqt(t)),rp=S((t,e)=>g(e).ne(t)),ip=S((t,e)=>g(e).net(t)),cp=S((t,e)=>g(e).and(t)),ap=S((t,e)=>g(e).or(t)),up=S((t,e)=>g(e).func(t));function p(t,e,n=!0,s=!1,o=r=>r.innerJoin()){if(Array.isArray(t)){const c={};for(const u of t)c[u]=p(u,e,n,s,o);return c}const r=e.length;var i;return n?i=function(...c){c=c.map(g);const u=c[c.length-1];let l;if(r===1)l=e(u);else{const f=c.slice(0,-1);if(f.every(h=>h.__pure!=null)){const h=f.map(m=>m.__pure),d=f.filter(m=>m.__pure_loc).map(m=>m.__pure_loc);l=e(...h,u),l=l.withContext(m=>{const w=(m.locations||[]).concat(d);return{...m,locations:w}})}else{const[h,...d]=f;let m=(...w)=>e(...w,u);m=S(m,null,r-1),l=o(d.reduce((w,_)=>w.appLeft(_),h.fmap(m)))}}return s&&(l._steps=u._steps),l}:i=function(...c){c=c.map(g);const u=e(...c);return s&&(u._steps=c[c.length-1]._steps),u},y.prototype[t]=function(...c){if(r===2&&c.length!==1)c=[Pt(...c)];else if(r!==c.length+1)throw new Error(`.${t}() expects ${r-1} inputs but got ${c.length}.`);return c=c.map(g),i(...c,this)},r>1&&(y.prototype["_"+t]=function(...c){const u=e(...c,this);return s&&u.setSteps(this._steps),u}),S(i,null,r)}function re(t,e,n=!0,s=!1,o=r=>r.stepJoin()){return p(t,e,n,s,o)}const lp=p("round",function(t){return t.asNumber().fmap(e=>Math.round(e))}),fp=p("floor",function(t){return t.asNumber().fmap(e=>Math.floor(e))}),hp=p("ceil",function(t){return t.asNumber().fmap(e=>Math.ceil(e))}),pp=p("toBipolar",function(t){return t.fmap(e=>e*2-1)}),dp=p("fromBipolar",function(t){return t.fmap(e=>(e+1)/2)}),mp=p("range",function(t,e,n){return n.mul(e-t).add(t)}),yp=p("rangex",function(t,e,n){return n._range(Math.log(t),Math.log(e)).fmap(Math.exp)}),gp=p("range2",function(t,e,n){return n.fromBipolar()._range(t,e)}),wp=p("ratio",t=>t.fmap(e=>Array.isArray(e)?e.slice(1).reduce((n,s)=>n/s,e[0]):e)),bp=p("compress",function(t,e,n){return t=b(t),e=b(e),t.gt(e)||t.gt(1)||e.gt(1)||t.lt(0)||e.lt(0)?I:n._fastGap(b(1).div(e.sub(t)))._late(t)}),{compressSpan:vp,compressspan:_p}=p(["compressSpan","compressspan"],function(t,e){return e._compress(t.begin,t.end)}),{fastGap:kp,fastgap:qp}=p(["fastGap","fastgap"],function(t,e){const n=function(o){const r=o.begin.sam(),i=o.begin.sub(r).mul(t).min(1),c=o.end.sub(r).mul(t).min(1);if(!(i>=1))return new W(r.add(i),r.add(c))},s=function(o){const r=o.part.begin,i=o.part.end,c=r.sam(),u=r.sub(c).div(t).min(1),l=i.sub(c).div(t).min(1),f=new W(c.add(u),c.add(l)),h=o.whole?new W(f.begin.sub(r.sub(o.whole.begin).div(t)),f.end.add(o.whole.end.sub(i).div(t))):void 0;return new V(h,f,o.value,o.context)};return e.withQuerySpanMaybe(n).withHap(s).splitQueries()}),Ap=p("focus",function(t,e,n){return t=b(t),e=b(e),n._early(t.sam())._fast(b(1).div(e.sub(t)))._late(t)}),{focusSpan:Tp,focusspan:Cp}=p(["focusSpan","focusspan"],function(t,e){return e._focus(t.begin,t.end)}),Sp=p("ply",function(t,e){const n=e.fmap(s=>et(s)._fast(t)).squeezeJoin();return yt&&(n._steps=b(t).mulmaybe(e._steps)),n}),{fast:Mp,density:Ky}=p(["fast","density"],function(t,e){return t===0?I:(t=b(t),e.withQueryTime(s=>s.mul(t)).withHapTime(s=>s.div(t)).setSteps(e._steps))},!0,!0),Op=p("hurry",function(t,e){return e._fast(t).mul(et({speed:t}))}),{slow:Np,sparsity:Bp}=p(["slow","sparsity"],function(t,e){return t===0?I:e._fast(b(1).div(t))}),Pp=p("inside",function(t,e,n){return e(n._slow(t))._fast(t)}),xp=p("outside",function(t,e,n){return e(n._fast(t))._slow(t)}),Ep=p("lastOf",function(t,e,n){const s=Array(t-1).fill(n);return s.push(e(n)),hn(...s)}),{firstOf:Rp,every:zp}=p(["firstOf","every"],function(t,e,n){const s=Array(t-1).fill(n);return s.unshift(e(n)),hn(...s)}),Ip=p("apply",function(t,e){return t(e)}),jp=p("cpm",function(t,e){return e._fast(t/60/1)}),Lp=p("early",function(t,e){return t=b(t),e.withQueryTime(n=>n.add(t)).withHapTime(n=>n.sub(t))},!0,!0),Ss=p("late",function(t,e){return t=b(t),e._early(b(0).sub(t))},!0,!0),$p=p("zoom",function(t,e,n){if(e=b(e),t=b(t),t.gte(e))return gt;const s=e.sub(t),o=yt?n._steps?.mulmaybe(s):void 0;return n.withQuerySpan(r=>r.withCycle(i=>i.mul(s).add(t))).withHapSpan(r=>r.withCycle(i=>i.sub(t).div(s))).splitQueries().setSteps(o)}),{zoomArc:Fp,zoomarc:Dp}=p(["zoomArc","zoomarc"],function(t,e){return e.zoom(t.begin,t.end)}),Wp=p("bite",(t,e,n)=>e.fmap(s=>o=>{const r=b(s).div(o).mod(1),i=r.add(b(1).div(o));return n.zoom(r,i)}).appLeft(t).squeezeJoin(),!1),Vp=p("linger",function(t,e){return t==0?I:t<0?e._zoom(t.add(1),1)._slow(t):e._zoom(0,t)._slow(t)},!0,!0),{segment:Jp,seg:Gp}=p(["segment","seg"],function(t,e){return e.struct(et(!0)._fast(t)).setSteps(t)}),Hp=p("swingBy",(t,e,n)=>n.inside(e,Ss(Cs(0,t/2)))),Up=p("swing",(t,e)=>e.swingBy(1/3,t)),{invert:Qp,inv:Kp}=p(["invert","inv"],function(t){return t.fmap(e=>!e)},!0,!0),Yp=p("when",function(t,e,n){return t?e(n):n}),Xp=p("off",function(t,e,n){return K(n,e(n.late(t)))}),Zp=p("brak",function(t){return t.when($t(!1,!0),e=>ft(e,I)._late(.25))}),Ms=p("rev",function(t){const e=function(n){const s=n.span,o=s.begin.sam(),r=s.begin.nextSam(),i=function(u){const l=u.withTime(h=>o.add(r.sub(h))),f=l.begin;return l.begin=l.end,l.end=f,l};return t.query(n.setSpan(i(s))).map(u=>u.withSpan(i))};return new y(e).splitQueries()},!1,!0),td=p("revv",function(t){const e=n=>new W(b(0).sub(n.end),b(0).sub(n.begin));return t.withQuerySpan(e).withHapSpan(e)}),ed=p("pressBy",function(t,e){return e.fmap(n=>et(n).compress(t,1)).squeezeJoin()}),nd=p("press",function(t){return t._pressBy(.5)});y.prototype.hush=function(){return I};const sd=p("palindrome",function(t){return t.lastOf(2,Ms)},!0,!0),{juxBy:od,juxby:rd}=p(["juxBy","juxby"],function(t,e,n){t/=2;const s=function(i,c,u){return c in i?i[c]:u},o=n.withValue(i=>Object.assign({},i,{pan:s(i,"pan",.5)-t})),r=e(n.withValue(i=>Object.assign({},i,{pan:s(i,"pan",.5)+t})));return K(o,r).setSteps(yt?Ut(o._steps,r._steps):void 0)}),id=p("jux",function(t,e){return e._juxBy(1,t,e)}),{echoWith:cd,echowith:ad,stutWith:ud,stutwith:ld}=p(["echoWith","echowith","stutWith","stutwith"],function(t,e,n,s){return K(...he(0,t-1).map(o=>n(s.late(b(e).mul(o)),o)))}),fd=p("echo",function(t,e,n,s){return s._echoWith(t,e,(o,r)=>o.gain(Math.pow(n,r)))}),hd=p("stut",function(t,e,n,s){return s._echoWith(t,n,(o,r)=>o.gain(Math.pow(e,r)))}),Os=p("applyN",function(t,e,n){let s=n;for(let o=0;o<t;o++)s=e(s);return s}),pd=p(["plyWith","plywith"],function(t,e,n){const s=n.fmap(o=>de(...he(0,t-1).map(r=>Os(r,e,o)))._fast(t)).squeezeJoin();return yt&&(s._steps=b(t).mulmaybe(n._steps)),s}),dd=p(["plyForEach","plyforeach"],function(t,e,n){const s=n.fmap(o=>de(de(et(o),...he(1,t-1).map(r=>e(et(o),r))))._fast(t)).squeezeJoin();return yt&&(s._steps=b(t).mulmaybe(n._steps)),s}),dn=function(t,e,n=!1){return t=b(t),$t(...he(0,t.sub(1)).map(s=>n?e.late(b(s).div(t)):e.early(b(s).div(t))))},md=p("iter",function(t,e){return dn(t,e,!1)},!0,!0),{iterBack:yd,iterback:gd}=p(["iterBack","iterback"],function(t,e){return dn(t,e,!0)},!0,!0),{repeatCycles:wd}=p("repeatCycles",function(t,e){return new y(function(n){const s=n.span.begin.sam(),o=s.div(t).sam(),r=s.sub(o);return n=n.withSpan(i=>i.withTime(c=>c.sub(r))),e.query(n).map(i=>i.withSpan(c=>c.withTime(u=>u.add(r))))}).splitQueries()},!0,!0),mn=function(t,e,n,s=!1,o=!1){const r=Array(t-1).fill(!1);r.unshift(!0);const i=dn(t,Pt(...r),!s);return o||(n=n.repeatCycles(t)),n.when(i,e)},{chunk:bd,slowchunk:vd,slowChunk:_d}=p(["chunk","slowchunk","slowChunk"],function(t,e,n){return mn(t,e,n,!1,!1)},!0,!0),{chunkBack:kd,chunkback:qd}=p(["chunkBack","chunkback"],function(t,e,n){return mn(t,e,n,!0)},!0,!0),{fastchunk:Ad,fastChunk:Td}=p(["fastchunk","fastChunk"],function(t,e,n){return mn(t,e,n,!1,!0)},!0,!0),{chunkinto:Cd,chunkInto:Sd}=p(["chunkinto","chunkInto"],function(t,e,n){return n.into(ft(!0,...Array(t-1).fill(!1))._iterback(t),e)}),{chunkbackinto:Md,chunkBackInto:Od}=p(["chunkbackinto","chunkBackInto"],function(t,e,n){return n.into(ft(!0,...Array(t-1).fill(!1))._iter(t)._early(1),e)}),Nd=p("bypass",function(t,e){return t=!!parseInt(t),t?I:e},!0,!0),{ribbon:Bd,rib:Pd}=p(["ribbon","rib"],(t,e,n)=>n.early(t).restart(et(1).slow(e))),xd=p("hsla",(t,e,n,s,o)=>o.color(`hsla(${t}turn,${e*100}%,${n*100}%,${s})`)),Ed=p("hsl",(t,e,n,s)=>s.color(`hsl(${t}turn,${e*100}%,${n*100}%)`));y.prototype.tag=function(t){return this.withContext(e=>({...e,tags:(e.tags||[]).concat([t])}))};const Rd=p("filter",(t,e)=>e.withHaps(n=>n.filter(t))),zd=p("filterWhen",(t,e)=>e.filter(n=>t(n.whole.begin))),Id=p("within",(t,e,n,s)=>K(n(s.filterWhen(o=>o.cyclePos()>=t&&o.cyclePos()<=e)),s.filterWhen(o=>o.cyclePos()<t||o.cyclePos()>e)));y.prototype.stepJoin=function(){const t=this,e=ht(...yn(gn(t.queryArc(0,1))))._steps,n=function(s){const r=t.early(s.span.begin.sam()).query(s.setSpan(new W(b(0),b(1))));return ht(...yn(gn(r))).query(s)};return new y(n,e)},y.prototype.stepBind=function(t){return this.fmap(t).stepJoin()};function yn(t){const e=t.filter((r,i)=>i.hasSteps).reduce((r,i)=>r.add(i),b(0)),n=ee(t.map((r,i)=>i._steps)).reduce((r,i)=>r.add(i),b(0)),s=e.eq(0)?void 0:n.div(e);function o(r,i){return i._steps===void 0?[r.mulmaybe(s),i]:[i._steps,i]}return t.map(r=>o(...r))}function gn(t){const e=Bt(t.map(o=>[o.part.begin,o.part.end])),n=ds([b(0),b(1),...e]);return ps(n).map(o=>[o[1].sub(o[0]),K(...Ns(new W(...o),t).map(r=>r.value.withHap(i=>i.setContext(i.combineContext(r)))))])}function Ns(t,e){return ee(e.map(n=>Bs(t,n)))}function Bs(t,e){const n=t.intersection(e.part);if(n!=null)return new V(e.whole,n,e.value,e.context)}const Ps=p("pace",function(t,e){return e._steps===void 0?e:e._steps.eq(b(0))?gt:e._fast(b(t).div(e._steps)).setSteps(t)});function xs(t,...e){const n=e.map(o=>pn(o));if(n.length==0)return I;t==0&&(t=n[0][1]);const s=[];for(const o of n)o[1]!=0&&(t==o[1]?s.push(o[0]):s.push(o[0]._fast(b(t).div(b(o[1])))));return K(...s)}function Ie(...t){if(Array.isArray(t[0]))return xs(0,...t);if(t=t.filter(s=>s.hasSteps),t.length==0)return I;const e=Ut(...t.map(s=>s._steps));if(e.eq(b(0)))return gt;const n=K(...t.map(s=>s.pace(e)));return n._steps=e,n}function ht(...t){if(t.length===0)return gt;const e=i=>Array.isArray(i)?i:[i._steps??1,i];if(t=t.map(e),t.find(i=>i[0]===void 0)){const i=t.map(u=>u[0]).filter(u=>u!==void 0);if(i.length===0)return ft(...t.map(u=>u[1]));if(i.length===t.length)return gt;const c=i.reduce((u,l)=>u.add(l),b(0)).div(i.length);for(let u of t)u[0]===void 0&&(u[0]=c)}if(t.length==1)return g(t[0][1]).withSteps(c=>t[0][0]);const n=t.map(i=>i[0]).reduce((i,c)=>i.add(c),b(0));let s=b(0);const o=[];for(const[i,c]of t){if(b(i).eq(0))continue;const u=s.add(i);o.push(g(c)._compress(s.div(n),u.div(n))),s=u}const r=K(...o);return r._steps=n,r}function Es(...t){t=t.map(o=>Array.isArray(o)?o.map(g):[g(o)]);const e=Ut(...t.map(o=>b(o.length)));let n=[];for(let o=0;o<e;++o)n.push(...t.map(r=>r.length==0?I:r[o%r.length]));n=n.filter(o=>o.hasSteps&&o._steps>0);const s=n.reduce((o,r)=>o.add(r._steps),b(0));return n=ht(...n),n._steps=s,n}const Rs=re("take",function(t,e){if(!e.hasSteps||e._steps.lte(0)||(t=b(t),t.eq(0)))return gt;const n=t<0;n&&(t=t.abs());const s=t.div(e._steps);return s.lte(0)?gt:s.gte(1)?e:n?e.zoom(b(1).sub(s),1):e.zoom(0,s)}),zs=re("drop",function(t,e){return e.hasSteps?(t=b(t),t.lt(0)?e.take(e._steps.add(t)):e.take(b(0).sub(e._steps.sub(t)))):gt}),Is=re("extend",function(t,e){return e.fast(t).expand(t)}),jd=re("replicate",function(t,e){return e.repeatCycles(t).fast(t).expand(t)}),js=re("expand",function(t,e){return e.withSteps(n=>n.mul(b(t)))}),Ls=re("contract",function(t,e){return e.withSteps(n=>n.div(b(t)))});y.prototype.shrinklist=function(t){const e=this;if(!e.hasSteps)return[e];let[n,s]=Array.isArray(t)?t:[t,e._steps];if(n=b(n),s===0||n===0)return[e];const o=n>0,r=[];if(o){const i=b(1).div(e._steps).mul(n);for(let c=0;c<s;++c){const u=i.mul(c);if(u.gt(1))break;r.push([u,1])}}else{n=b(0).sub(n);const i=b(1).div(e._steps).mul(n);for(let c=0;c<s;++c){const u=b(1).sub(i.mul(c));if(u.lt(0))break;r.push([b(0),u])}}return r.map(i=>e.zoom(...i))};const $s=(t,e)=>e.shrinklist(t),Fs=p("shrink",function(t,e){if(!e.hasSteps)return gt;const n=e.shrinklist(t),s=ht(...n);return s._steps=n.reduce((o,r)=>o.add(r._steps),b(0)),s},!0,!1,t=>t.stepJoin()),Ld=p("grow",function(t,e){if(!e.hasSteps)return gt;const n=e.shrinklist(b(0).sub(t));n.reverse();const s=ht(...n);return s._steps=n.reduce((o,r)=>o.add(r._steps),b(0)),s},!0,!1,t=>t.stepJoin()),Ds=function(t,...e){return t.tour(...e)};y.prototype.tour=function(...t){return ht(...[].concat(...t.map((e,n)=>[...t.slice(0,t.length-n),this,...t.slice(t.length-n)]),this,...t))};const Ws=function(...t){t=t.filter(s=>s.hasSteps);const e=$t(...t.map(s=>s._slow(s._steps))),n=Ut(...t.map(s=>s._steps));return e._fast(n).setSteps(n)},$d=ht,Vs=ht,Fd=ht,Dd=Es,Wd=Ie;y.prototype.s_polymeter=y.prototype.polymeter;const Vd=Fs;y.prototype.s_taper=y.prototype.shrink;const Jd=$s;y.prototype.s_taperlist=y.prototype.shrinklist;const Gd=Rs;y.prototype.s_add=y.prototype.take;const Hd=zs;y.prototype.s_sub=y.prototype.drop;const Ud=js;y.prototype.s_expand=y.prototype.expand;const Qd=Is;y.prototype.s_extend=y.prototype.extend;const Kd=Ls;y.prototype.s_contract=y.prototype.contract;const Yd=Ds;y.prototype.s_tour=y.prototype.tour;const Xd=Ws;y.prototype.s_zip=y.prototype.zip;const Zd=Ps;y.prototype.steps=y.prototype.pace;const tm=p("chop",function(t,e){const s=Array.from({length:t},(i,c)=>c).map(i=>({begin:i/t,end:(i+1)/t})),o=function(i,c){if("begin"in i&&"end"in i&&i.begin!==void 0&&i.end!==void 0){const u=i.end-i.begin;c={begin:i.begin+c.begin*u,end:i.begin+c.end*u}}return Object.assign({},i,c)},r=function(i){return Pt(s.map(c=>o(i,c)))};return e.squeezeBind(r).setSteps(yt?b(t).mulmaybe(e._steps):void 0)}),em=p("striate",function(t,e){const s=Array.from({length:t},(r,i)=>i).map(r=>({begin:r/t,end:(r+1)/t})),o=$t(...s);return e.set(o)._fast(t).setSteps(yt?b(t).mulmaybe(e._steps):void 0)}),Js=function(t,e,n=.5){return e.speed(1/t*n).unit("c").slow(t)},Gs=p("slice",function(t,e,n){return t.innerBind(s=>e.outerBind(o=>n.outerBind(r=>{r=r instanceof Object?r:{s:r};const i=Array.isArray(s)?s[o]:o/s,c=Array.isArray(s)?s[o+1]:(o+1)/s;return et({begin:i,end:c,_slices:s,...r})}))).setSteps(e._steps)},!1);y.prototype.onTriggerTime=function(t){return this.onTrigger((e,n,s,o)=>{const r=o-n;window.setTimeout(()=>{t(e)},r*1e3)},!1)};const nm=p("splice",function(t,e,n){const s=Gs(t,e,n);return new y(o=>{const r=o.controls._cps||1;return s.query(o).map(c=>c.withValue(u=>({speed:r/u._slices/c.whole.duration*(u.speed||1),unit:"c",...u})))}).setSteps(e._steps)},!1),{loopAt:sm,loopat:om}=p(["loopAt","loopat"],function(t,e){const n=e._steps?e._steps.div(t):void 0;return new y(s=>Js(t,e,s.controls._cps).query(s),n)}),rm=p("fit",t=>t.withHaps((e,n)=>e.map(s=>s.withValue(o=>{const r=("end"in o?o.end:1)-("begin"in o?o.begin:0);return{...o,speed:(n.controls._cps||1)/s.whole.duration*r,unit:"c"}})))),{loopAtCps:im,loopatcps:cm}=p(["loopAtCps","loopatcps"],function(t,e,n){return Js(t,n,e)}),am=t=>et(1).withValue(()=>g(t())).innerJoin();let Hs=t=>t<.5?1:1-(t-.5)/.5,Us=(t,e,n)=>{e=g(e),t=g(t),n=g(n);let s=e.fmap(r=>({gain:Hs(r)})),o=e.fmap(r=>({gain:Hs(1-r)}));return K(t.mul(s),n.mul(o))};y.prototype.xfade=function(t,e){return Us(this,t,e)};const um=t=>(e,n,s)=>{e=b(e).mod(n),n=b(n);const o=e.div(n),r=e.add(1).div(n);return t(s.fmap(i=>et(i)._compress(o,r)))},{beat:lm}=p(["beat"],um(t=>t.innerJoin())),wn=(t,e,n)=>{n=b(n);const s=b(1).div(t.length),o=c=>{const u=[];for(const[l,f]of c.entries())f&&u.push([b(l).div(c.length),f]);return u},r=Ee(([c,u],[l,f])=>{const h=n.mul(l-c).add(c),d=h.add(s);return new W(h,d)},o(t),o(e));function i(c){const u=c.span.begin.sam(),l=c.span.cycleArc(),f=[];for(const h of r){const d=h.intersection(l);d!==void 0&&f.push(new V(h.withTime(m=>m.add(u)),d.withTime(m=>m.add(u)),!0))}return f}return new y(i).splitQueries()},fm=(t,e,n)=>(t=g(t),e=g(e),n=g(n),t.innerBind(s=>e.innerBind(o=>n.innerBind(r=>wn(s,o,r))))),hm=["scurve","soft","hard","cubic","diode","asym","fold","sinefold","chebyshev"];for(const t of hm)y.prototype[t]=function(e){const n=g(e).fmap(s=>Array.isArray(s)?[...s,t]:[s,1,t]);return this.distort(n)};const Qs=t=>{let n=et(S((...s)=>s,null,t.length));for(const s of t)n=n.appBoth(g(s));return n},je=t=>Array.isArray(t)?Qs(t):g(t);y.prototype.partials=function(t){return this.withValue(e=>n=>({...e,partials:n})).appLeft(je(t))};const pm=t=>je(t).as("partials");y.prototype.phases=function(t){return this.withValue(e=>n=>({...e,phases:n})).appLeft(je(t))};const dm=t=>je(t).as("phases");function Le(t){let e=Array.isArray(t);t=e?t:[t];const n=t[0],s=r=>{let i;if(typeof r=="object"&&r.value!==void 0&&(i={...r},r=r.value,delete i.value),e&&Array.isArray(r)){const c=i||{};return r.forEach((u,l)=>{l<t.length&&(c[t[l]]=u)}),c}else return i?(i[n]=r,i):{[n]:r}},o=function(r,i){return i?typeof r>"u"?i.fmap(s):i.set(g(r).withValue(s)):g(r).withValue(s)};return y.prototype[n]=function(r){return o(r,this)},o}const me=new Map;function Ks(t){return me.has(t)}function a(t,...e){const n=Array.isArray(t)?t[0]:t;let s={};return s[n]=Le(t),me.set(n,n),e.forEach(o=>{s[o]=s[n],me.set(o,n),y.prototype[o]=y.prototype[n]}),s}const{s:Ys,sound:Xs}=a(["s","n","gain"],"sound"),{wt:Zs,wavetablePosition:to}=a("wt","wavetablePosition"),{wtenv:eo}=a("wtenv"),{wtattack:no,wtatt:so}=a("wtattack","wtatt"),{wtdecay:oo,wtdec:ro}=a("wtdecay","wtdec"),{wtsustain:io,wtsus:co}=a("wtsustain","wtsus"),{wtrelease:ao,wtrel:uo}=a("wtrelease","wtrel"),{wtrate:lo}=a("wtrate"),{wtsync:fo}=a("wtsync"),{wtdepth:ho}=a("wtdepth"),{wtshape:po}=a("wtshape"),{wtdc:mo}=a("wtdc"),{wtskew:yo}=a("wtskew"),{warp:go,wavetableWarp:wo}=a("warp","wavetableWarp"),{warpattack:bo,warpatt:vo}=a("warpattack","warpatt"),{warpdecay:_o,warpdec:ko}=a("warpdecay","warpdec"),{warpsustain:qo,warpsus:Ao}=a("warpsustain","warpsus"),{warprelease:To,warprel:Co}=a("warprelease","warprel"),{warprate:So}=a("warprate"),{warpdepth:Mo}=a("warpdepth"),{warpshape:Oo}=a("warpshape"),{warpdc:No}=a("warpdc"),{warpskew:Bo}=a("warpskew"),{warpmode:Po,wavetableWarpMode:xo}=a("warpmode","wavetableWarpMode"),{wtphaserand:Eo,wavetablePhaseRand:Ro}=a("wtphaserand","wavetablePhaseRand"),{warpenv:zo}=a("warpenv"),{warpsync:Io}=a("warpsync"),{source:jo,src:Lo}=a("source","src"),{n:$o}=a("n"),{note:Fo}=a(["note","n"]),{accelerate:Do}=a("accelerate"),{velocity:Wo}=a("velocity"),{gain:Vo}=a("gain"),{postgain:Jo}=a("postgain"),{amp:Go}=a("amp"),{attack:Ho,att:Uo}=a("attack","att"),{fmh:Qo}=a(["fmh","fmi"],"fmh"),{fmi:Ko,fm:Yo}=a(["fmi","fmh"],"fm"),{fmenv:Xo}=a("fmenv"),{fmattack:Zo}=a("fmattack"),{fmwave:tr}=a("fmwave"),{fmdecay:er}=a("fmdecay"),{fmsustain:nr}=a("fmsustain"),{fmrelease:sr}=a("fmrelease"),{fmvelocity:or}=a("fmvelocity"),{bank:rr}=a("bank"),{chorus:ir}=a("chorus"),{analyze:cr}=a("analyze"),{fft:ar}=a("fft"),{decay:ur,dec:lr}=a("decay","dec"),{sustain:fr,sus:hr}=a("sustain","sus"),{release:pr,rel:dr}=a("release","rel"),{hold:mr}=a("hold"),{bandf:yr,bpf:gr,bp:wr}=a(["bandf","bandq","bpenv"],"bpf","bp"),{bandq:br,bpq:vr}=a("bandq","bpq"),{begin:_r}=a("begin"),{end:kr}=a("end"),{loop:qr}=a("loop"),{loopBegin:Ar,loopb:Tr}=a("loopBegin","loopb"),{loopEnd:Cr,loope:Sr}=a("loopEnd","loope"),{crush:Mr}=a("crush"),{coarse:Or}=a("coarse"),{tremolo:Nr}=a(["tremolo","tremolodepth","tremoloskew","tremolophase"],"trem"),{tremolosync:Br}=a(["tremolosync","tremolodepth","tremoloskew","tremolophase"],"tremsync"),{tremolodepth:Pr}=a("tremolodepth","tremdepth"),{tremoloskew:xr}=a("tremoloskew","tremskew"),{tremolophase:Er}=a("tremolophase","tremphase"),{tremoloshape:Rr}=a("tremoloshape","tremshape"),{drive:zr}=a("drive"),{duck:Ir}=a("duckorbit","duck"),{duckdepth:jr}=a("duckdepth"),{duckonset:Lr}=a("duckonset","duckons"),{duckattack:$r}=a("duckattack","duckatt"),{byteBeatExpression:Fr,bbexpr:Dr}=a("byteBeatExpression","bbexpr"),{byteBeatStartTime:Wr,bbst:Vr}=a("byteBeatStartTime","bbst"),{channels:Jr,ch:Gr}=a("channels","ch"),{pw:Hr}=a(["pw","pwrate","pwsweep"]),{pwrate:Ur}=a("pwrate"),{pwsweep:Qr}=a("pwsweep"),{phaserrate:Kr,ph:Yr,phaser:Xr}=a(["phaserrate","phaserdepth","phasercenter","phasersweep"],"ph","phaser"),{phasersweep:Zr,phs:ti}=a("phasersweep","phs"),{phasercenter:ei,phc:ni}=a("phasercenter","phc"),{phaserdepth:si,phd:oi,phasdp:ri}=a("phaserdepth","phd","phasdp"),{channel:ii}=a("channel"),{cut:ci}=a("cut"),{cutoff:ai,ctf:ui,lpf:li,lp:fi}=a(["cutoff","resonance","lpenv"],"ctf","lpf","lp"),{lpenv:hi,lpe:pi}=a("lpenv","lpe"),{hpenv:di,hpe:mi}=a("hpenv","hpe"),{bpenv:yi,bpe:gi}=a("bpenv","bpe"),{lpattack:wi,lpa:bi}=a("lpattack","lpa"),{hpattack:vi,hpa:_i}=a("hpattack","hpa"),{bpattack:ki,bpa:qi}=a("bpattack","bpa"),{lpdecay:Ai,lpd:Ti}=a("lpdecay","lpd"),{hpdecay:Ci,hpd:Si}=a("hpdecay","hpd"),{bpdecay:Mi,bpd:Oi}=a("bpdecay","bpd"),{lpsustain:Ni,lps:Bi}=a("lpsustain","lps"),{hpsustain:Pi,hps:xi}=a("hpsustain","hps"),{bpsustain:Ei,bps:Ri}=a("bpsustain","bps"),{lprelease:zi,lpr:Ii}=a("lprelease","lpr"),{hprelease:ji,hpr:Li}=a("hprelease","hpr"),{bprelease:$i,bpr:Fi}=a("bprelease","bpr"),{ftype:Di}=a("ftype"),{fanchor:Wi}=a("fanchor"),{lprate:Vi}=a("lprate"),{lpsync:Ji}=a("lpsync"),{lpdepth:Gi}=a("lpdepth"),{lpdepthfrequency:Hi}=a("lpdepthfrequency","lpdepthfreq"),{lpshape:Ui}=a("lpshape"),{lpdc:Qi}=a("lpdc"),{lpskew:Ki}=a("lpskew"),{bprate:Yi}=a("bprate"),{bpsync:Xi}=a("bpsync"),{bpdepth:Zi}=a("bpdepth"),{bpdepthfrequency:tc}=a("bpdepthfrequency","bpdepthfreq"),{bpshape:ec}=a("bpshape"),{bpdc:nc}=a("bpdc"),{bpskew:sc}=a("bpskew"),{hprate:oc}=a("hprate"),{hpsync:rc}=a("hpsync"),{hpdepth:ic,hpdepthfreq:cc}=a("hpdepth"),{hpdepthfrequency:ac}=a("hpdepthfrequency","hpdepthfreq"),{hpshape:uc}=a("hpshape"),{hpdc:lc}=a("hpdc"),{hpskew:fc}=a("hpskew"),{vib:hc,vibrato:pc,v:dc}=a(["vib","vibmod"],"vibrato","v"),{noise:mc}=a("noise"),{vibmod:yc,vmod:gc}=a(["vibmod","vib"],"vmod"),{hcutoff:wc,hpf:bc,hp:vc}=a(["hcutoff","hresonance","hpenv"],"hpf","hp"),{hresonance:_c,hpq:kc}=a("hresonance","hpq"),{resonance:qc,lpq:Ac}=a("resonance","lpq"),{djf:Tc}=a("djf"),{delay:Cc}=a(["delay","delaytime","delayfeedback"]),{delayfeedback:Sc,delayfb:Mc,dfb:Oc}=a("delayfeedback","delayfb","dfb"),{delayspeed:Nc}=a("delayspeed"),{delaytime:Bc,delayt:Pc,dt:xc}=a("delaytime","delayt","dt"),{delaysync:Ec}=a("delaysync"),{lock:Rc}=a("lock"),{detune:zc,det:Ic}=a("detune","det"),{unison:jc}=a("unison"),{spread:Lc}=a("spread"),{dry:$c}=a("dry"),{fadeTime:Fc,fadeOutTime:Dc}=a("fadeTime","fadeOutTime"),{fadeInTime:Wc}=a("fadeInTime"),{freq:Vc}=a("freq"),{pattack:Jc,patt:Gc}=a("pattack","patt"),{pdecay:Hc,pdec:Uc}=a("pdecay","pdec"),{psustain:Qc,psus:Kc}=a("psustain","psus"),{prelease:Yc,prel:Xc}=a("prelease","prel"),{penv:Zc}=a("penv"),{pcurve:ta}=a("pcurve"),{panchor:ea}=a("panchor"),{gate:na,gat:sa}=a("gate","gat"),{leslie:oa}=a("leslie"),{lrate:ra}=a("lrate"),{lsize:ia}=a("lsize"),{activeLabel:ca}=a("activeLabel"),{label:aa}=a(["label","activeLabel"]),{degree:ua}=a("degree"),{mtranspose:la}=a("mtranspose"),{ctranspose:fa}=a("ctranspose"),{harmonic:ha}=a("harmonic"),{stepsPerOctave:pa}=a("stepsPerOctave"),{octaveR:da}=a("octaveR"),{nudge:ma}=a("nudge"),{octave:ya,oct:ga}=a("octave","oct"),{orbit:wa}=a("orbit","o"),{overgain:ba}=a("overgain"),{overshape:va}=a("overshape"),{pan:_a}=a("pan"),{panspan:ka}=a("panspan"),{pansplay:qa}=a("pansplay"),{panwidth:Aa}=a("panwidth"),{panorient:Ta}=a("panorient"),{rate:Ca}=a("rate"),{slide:Sa}=a("slide"),{semitone:Ma}=a("semitone"),{voice:Oa}=a("voice"),{chord:Na}=a("chord"),{dictionary:Ba,dict:Pa}=a("dictionary","dict"),{anchor:xa}=a("anchor"),{offset:Ea}=a("offset"),{octaves:Ra}=a("octaves"),{mode:za}=a(["mode","anchor"]),{room:Ia}=a(["room","size"]),{roomlp:ja,rlp:La}=a("roomlp","rlp"),{roomdim:$a,rdim:Fa}=a("roomdim","rdim"),{roomfade:Da,rfade:Wa}=a("roomfade","rfade"),{ir:Va,iresponse:Ja}=a(["ir","i"],"iresponse"),{irspeed:Ga}=a("irspeed"),{irbegin:Ha}=a("irbegin"),{roomsize:Ua,size:Qa,sz:Ka,rsize:Ya}=a("roomsize","size","sz","rsize"),{shape:Xa}=a(["shape","shapevol"]),{distort:Za,dist:tu}=a(["distort","distortvol","distorttype"],"dist"),{distortvol:eu}=a("distortvol","distvol"),{distorttype:nu}=a("distorttype","disttype"),{compressor:su}=a(["compressor","compressorRatio","compressorKnee","compressorAttack","compressorRelease"]),{compressorKnee:ou}=a("compressorKnee"),{compressorRatio:ru}=a("compressorRatio"),{compressorAttack:iu}=a("compressorAttack"),{compressorRelease:cu}=a("compressorRelease"),{speed:bn}=a("speed"),{stretch:au}=a("stretch"),{unit:uu}=a("unit"),{squiz:lu}=a("squiz"),{vowel:fu}=a("vowel"),{waveloss:hu}=a("waveloss"),{density:mm}=a("density"),{expression:pu}=a("expression"),{sustainpedal:du}=a("sustainpedal"),{fshift:mu}=a("fshift"),{fshiftnote:yu}=a("fshiftnote"),{fshiftphase:gu}=a("fshiftphase"),{triode:wu}=a("triode"),{krush:bu}=a("krush"),{kcutoff:vu}=a("kcutoff"),{octer:_u}=a("octer"),{octersub:ku}=a("octersub"),{octersubsub:qu}=a("octersubsub"),{ring:Au}=a("ring"),{ringf:Tu}=a("ringf"),{ringdf:Cu}=a("ringdf"),{freeze:Su}=a("freeze"),{xsdelay:Mu}=a("xsdelay"),{tsdelay:Ou}=a("tsdelay"),{real:Nu}=a("real"),{imag:Bu}=a("imag"),{enhance:Pu}=a("enhance"),{comb:xu}=a("comb"),{smear:Eu}=a("smear"),{scram:Ru}=a("scram"),{binshift:zu}=a("binshift"),{hbrick:Iu}=a("hbrick"),{lbrick:ju}=a("lbrick"),{frameRate:Lu}=a("frameRate"),{frames:$u}=a("frames"),{hours:Fu}=a("hours"),{minutes:Du}=a("minutes"),{seconds:Wu}=a("seconds"),{songPtr:Vu}=a("songPtr"),{uid:Ju}=a("uid"),{val:Gu}=a("val"),{cps:Hu}=a("cps"),{clip:Uu,legato:Qu}=a("clip","legato"),{duration:Ku,dur:Yu}=a("duration","dur"),{zrand:Xu}=a("zrand"),{curve:Zu}=a("curve"),{deltaSlide:tl}=a("deltaSlide"),{pitchJump:el}=a("pitchJump"),{pitchJumpTime:nl}=a("pitchJumpTime"),{lfo:sl,repeatTime:ol}=a("lfo","repeatTime"),{znoise:rl}=a("znoise"),{zmod:il}=a("zmod"),{zcrush:cl}=a("zcrush"),{zdelay:al}=a("zdelay"),{zzfx:ul}=a("zzfx"),{color:ll,colour:fl}=a(["color","colour"]);let vn=(...t)=>t.reduce((e,n)=>Object.assign(e,{[n]:Le(n)}),{});const hl=p("adsr",(t,e)=>{t=Array.isArray(t)?t:[t];const[n,s,o,r]=t;return e.set({attack:n,decay:s,sustain:o,release:r})}),pl=p("ad",(t,e)=>{t=Array.isArray(t)?t:[t];const[n,s=n]=t;return e.attack(n).decay(s)}),dl=p("ds",(t,e)=>{t=Array.isArray(t)?t:[t];const[n,s=0]=t;return e.set({decay:n,sustain:s})}),ml=p("ar",(t,e)=>{t=Array.isArray(t)?t:[t];const[n,s=n]=t;return e.set({attack:n,release:s})}),{midichan:yl}=a("midichan"),{midimap:gl}=a("midimap"),{midiport:wl}=a("midiport"),{midicmd:bl}=a("midicmd"),vl=p("control",(t,e)=>{if(!Array.isArray(t))throw new Error("control expects an array of [ccn, ccv]");const[n,s]=t;return e.ccn(n).ccv(s)}),{ccn:_l}=a("ccn"),{ccv:kl}=a("ccv"),{ctlNum:ql}=a("ctlNum"),{nrpnn:Al}=a("nrpnn"),{nrpv:Tl}=a("nrpv"),{progNum:Cl}=a("progNum"),Sl=p("sysex",(t,e)=>{if(!Array.isArray(t))throw new Error("sysex expects an array of [id, data]");const[n,s]=t;return e.sysexid(n).sysexdata(s)}),{sysexid:Ml}=a("sysexid"),{sysexdata:Ol}=a("sysexdata"),{midibend:Nl}=a("midibend"),{miditouch:Bl}=a("miditouch"),{polyTouch:Pl}=a("polyTouch"),{oschost:xl}=a("oschost"),{oscport:El}=a("oscport"),_n=t=>me.has(t)?me.get(t):t,Rl=p("as",(t,e)=>(t=Array.isArray(t)?t:[t],e.fmap(n=>(n=Array.isArray(n)?n:[n],n=Object.fromEntries(t.map((s,o)=>[_n(s),n[o]])),n)))),zl=p("scrub",(t,e)=>t.outerBind(n=>{Array.isArray(n)||(n=[n]);const[s,o=1]=n;return e.begin(s).mul(bn(o)).clip(1)}),!1),ym=Object.freeze(Object.defineProperty({__proto__:null,accelerate:Do,activeLabel:ca,ad:pl,adsr:hl,amp:Go,analyze:cr,anchor:xa,ar:ml,as:Rl,att:Uo,attack:Ho,bandf:yr,bandq:br,bank:rr,bbexpr:Dr,bbst:Vr,begin:_r,binshift:zu,bp:wr,bpa:qi,bpattack:ki,bpd:Oi,bpdc:nc,bpdecay:Mi,bpdepth:Zi,bpdepthfrequency:tc,bpe:gi,bpenv:yi,bpf:gr,bpq:vr,bpr:Fi,bprate:Yi,bprelease:$i,bps:Ri,bpshape:ec,bpskew:sc,bpsustain:Ei,bpsync:Xi,byteBeatExpression:Fr,byteBeatStartTime:Wr,ccn:_l,ccv:kl,ch:Gr,channel:ii,channels:Jr,chord:Na,chorus:ir,clip:Uu,coarse:Or,color:ll,colour:fl,comb:xu,compressor:su,compressorAttack:iu,compressorKnee:ou,compressorRatio:ru,compressorRelease:cu,control:vl,cps:Hu,createParam:Le,createParams:vn,crush:Mr,ctf:ui,ctlNum:ql,ctranspose:fa,curve:Zu,cut:ci,cutoff:ai,dec:lr,decay:ur,degree:ua,delay:Cc,delayfb:Mc,delayfeedback:Sc,delayspeed:Nc,delaysync:Ec,delayt:Pc,delaytime:Bc,deltaSlide:tl,density:mm,det:Ic,detune:zc,dfb:Oc,dict:Pa,dictionary:Ba,dist:tu,distort:Za,distorttype:nu,distortvol:eu,djf:Tc,drive:zr,dry:$c,ds:dl,dt:xc,duck:Ir,duckattack:$r,duckdepth:jr,duckonset:Lr,dur:Yu,duration:Ku,end:kr,enhance:Pu,expression:pu,fadeInTime:Wc,fadeOutTime:Dc,fadeTime:Fc,fanchor:Wi,fft:ar,fm:Yo,fmattack:Zo,fmdecay:er,fmenv:Xo,fmh:Qo,fmi:Ko,fmrelease:sr,fmsustain:nr,fmvelocity:or,fmwave:tr,frameRate:Lu,frames:$u,freeze:Su,freq:Vc,fshift:mu,fshiftnote:yu,fshiftphase:gu,ftype:Di,gain:Vo,gat:sa,gate:na,getControlName:_n,harmonic:ha,hbrick:Iu,hcutoff:wc,hold:mr,hours:Fu,hp:vc,hpa:_i,hpattack:vi,hpd:Si,hpdc:lc,hpdecay:Ci,hpdepth:ic,hpdepthfreq:cc,hpdepthfrequency:ac,hpe:mi,hpenv:di,hpf:bc,hpq:kc,hpr:Li,hprate:oc,hprelease:ji,hps:xi,hpshape:uc,hpskew:fc,hpsustain:Pi,hpsync:rc,hresonance:_c,imag:Bu,ir:Va,irbegin:Ha,iresponse:Ja,irspeed:Ga,isControlName:Ks,kcutoff:vu,krush:bu,label:aa,lbrick:ju,legato:Qu,leslie:oa,lfo:sl,lock:Rc,loop:qr,loopBegin:Ar,loopEnd:Cr,loopb:Tr,loope:Sr,lp:fi,lpa:bi,lpattack:wi,lpd:Ti,lpdc:Qi,lpdecay:Ai,lpdepth:Gi,lpdepthfrequency:Hi,lpe:pi,lpenv:hi,lpf:li,lpq:Ac,lpr:Ii,lprate:Vi,lprelease:zi,lps:Bi,lpshape:Ui,lpskew:Ki,lpsustain:Ni,lpsync:Ji,lrate:ra,lsize:ia,midibend:Nl,midichan:yl,midicmd:bl,midimap:gl,midiport:wl,miditouch:Bl,minutes:Du,mode:za,mtranspose:la,n:$o,noise:mc,note:Fo,nrpnn:Al,nrpv:Tl,nudge:ma,oct:ga,octave:ya,octaveR:da,octaves:Ra,octer:_u,octersub:ku,octersubsub:qu,offset:Ea,orbit:wa,oschost:xl,oscport:El,overgain:ba,overshape:va,pan:_a,panchor:ea,panorient:Ta,panspan:ka,pansplay:qa,panwidth:Aa,patt:Gc,pattack:Jc,pcurve:ta,pdec:Uc,pdecay:Hc,penv:Zc,ph:Yr,phasdp:ri,phaser:Xr,phasercenter:ei,phaserdepth:si,phaserrate:Kr,phasersweep:Zr,phc:ni,phd:oi,phs:ti,pitchJump:el,pitchJumpTime:nl,polyTouch:Pl,postgain:Jo,prel:Xc,prelease:Yc,progNum:Cl,psus:Kc,psustain:Qc,pw:Hr,pwrate:Ur,pwsweep:Qr,rate:Ca,rdim:Fa,real:Nu,registerControl:a,rel:dr,release:pr,repeatTime:ol,resonance:qc,rfade:Wa,ring:Au,ringdf:Cu,ringf:Tu,rlp:La,room:Ia,roomdim:$a,roomfade:Da,roomlp:ja,roomsize:Ua,rsize:Ya,s:Ys,scram:Ru,scrub:zl,seconds:Wu,semitone:Ma,shape:Xa,size:Qa,slide:Sa,smear:Eu,songPtr:Vu,sound:Xs,source:jo,speed:bn,spread:Lc,squiz:lu,src:Lo,stepsPerOctave:pa,stretch:au,sus:hr,sustain:fr,sustainpedal:du,sysex:Sl,sysexdata:Ol,sysexid:Ml,sz:Ka,tremolo:Nr,tremolodepth:Pr,tremolophase:Er,tremoloshape:Rr,tremoloskew:xr,tremolosync:Br,triode:wu,tsdelay:Ou,uid:Ju,unison:jc,unit:uu,v:dc,val:Gu,velocity:Wo,vib:hc,vibmod:yc,vibrato:pc,vmod:gc,voice:Oa,vowel:fu,warp:go,warpatt:vo,warpattack:bo,warpdc:No,warpdec:ko,warpdecay:_o,warpdepth:Mo,warpenv:zo,warpmode:Po,warprate:So,warprel:Co,warprelease:To,warpshape:Oo,warpskew:Bo,warpsus:Ao,warpsustain:qo,warpsync:Io,waveloss:hu,wavetablePhaseRand:Ro,wavetablePosition:to,wavetableWarp:wo,wavetableWarpMode:xo,wt:Zs,wtatt:so,wtattack:no,wtdc:mo,wtdec:ro,wtdecay:oo,wtdepth:ho,wtenv:eo,wtphaserand:Eo,wtrate:lo,wtrel:uo,wtrelease:ao,wtshape:po,wtskew:yo,wtsus:co,wtsustain:io,wtsync:fo,xsdelay:Mu,zcrush:cl,zdelay:al,zmod:il,znoise:rl,zrand:Xu,zzfx:ul},Symbol.toStringTag,{value:"Module"})),gm=function(t,e){const[n,s]=t,[o,r]=e,[i,c]=on(s,o);return[[s,n-s],[Ee((u,l)=>u.concat(l),i,r),c]]},wm=function(t,e){const[n,s]=t,[o,r]=e,[i,c]=on(n,r);return[[n,s-n],[Ee((l,f)=>l.concat(f),o,i),c]]},Il=function(t,e){const[n,s]=t;return Math.min(n,s)<=1?[t,e]:Il(...n>s?gm(t,e):wm(t,e))},kn=function(t,e){const n=t<0,s=Math.abs(t),o=e-s,r=Array(s).fill([1]),i=Array(o).fill([0]),c=Il([s,o],[r,i]),u=Bt(c[1][0]).concat(Bt(c[1][1]));return n?u.map(l=>1-l):u},$e=function(t,e,n){const s=kn(t,e);return n?ls(s,-n):s},bm=p("euclid",function(t,e,n){return n.struct($e(t,e,0))}),vm=p("bjork",function(t,e){Array.isArray(t)||(t=[t]);const[n,s=n,o=0]=t;return e.struct($e(n,s,o))}),{euclidrot:_m,euclidRot:km}=p(["euclidrot","euclidRot"],function(t,e,n,s){return s.struct($e(t,e,n))}),jl=function(t,e,n,s){if(t<1)return I;const r=$e(t,e,0).join("").split("1").slice(1).map(i=>[i.length+1,!0]);return s.struct(Vs(...r)).late(b(n).div(e))},qm=p(["euclidLegato"],function(t,e,n){return jl(t,e,0,n)}),Am=p(["euclidLegatoRot"],function(t,e,n,s){return jl(t,e,n,s)}),{euclidish:Tm,eish:Cm}=p(["euclidish","eish"],function(t,e,n,s){const o=wn(kn(t,e),new Array(t).fill(1),n);return s.struct(o).setSteps(e)});function Ll(t,e,n=.05,s=.1,o=.1,r=globalThis.setInterval,i=globalThis.clearInterval,c=!0){let u=0,l=0,f=10**4,h=.01;const d=O=>n=O(n);o=o||s/2;const m=()=>{const O=t(),N=O+s+o;for(l===0&&(l=O+h);l<N;)l=c?Math.round(l*f)/f:l,e(l,n,u,O),l+=n,u++};let w;const _=()=>{A(),m(),w=r(m,s*1e3)},A=()=>{w!==void 0&&i(w),w=void 0};return{setDuration:d,start:_,stop:()=>{u=0,l=0,A()},pause:()=>A(),duration:n,interval:s,getPhase:()=>l,minLatency:h}}function Sm(t){return new y(e=>[new V(void 0,e.span,t)])}const wt=t=>{const e=n=>[new V(void 0,n.span,t(n.span.begin))];return new y(e)},ye=wt(t=>t%1),qn=ye.toBipolar(),Fe=wt(t=>1-t%1),An=Fe.toBipolar(),Tn=wt(t=>Math.sin(Math.PI*2*t)),$l=Tn.fromBipolar(),Mm=$l._early(b(1).div(4)),Om=Tn._early(b(1).div(4)),Fl=wt(t=>Math.floor(t*2%2)),Nm=Fl.toBipolar(),Bm=ft(ye,Fe),Pm=ft(qn,An),xm=ft(Fe,ye),Em=ft(An,qn),Cn=wt(ne);let Sn=0,Mn=0;typeof window<"u"&&document.addEventListener("mousemove",t=>{Sn=t.clientY/document.body.clientHeight,Mn=t.clientX/document.body.clientWidth});const Rm=wt(()=>Sn),zm=wt(()=>Sn),Im=wt(()=>Mn),jm=wt(()=>Mn),Dl=t=>{const e=t<<13^t,n=e>>17^e;return n<<5^n},Lm=t=>t-Math.trunc(t),Wl=t=>Dl(Math.trunc(Lm(t/300)*536870912)),Vl=t=>t%536870912/536870912,ge=t=>Math.abs(Vl(Wl(t))),$m=(t,e)=>{const n=[];for(let s=0;s<e;++s)n.push(Vl(t)),t=Dl(t);return n},Jl=(t,e)=>$m(Wl(t),e),Gl=t=>ye.range(0,t).round().segment(t),Fm=t=>{const e=g(t).log2(0).floor().add(1);return Hl(t,e)},Hl=(t,e=16)=>{e=g(e);const n=Gl(e).mul(-1).add(e.sub(1));return g(t).segment(e).brshift(n).band(et(1))},Dm=t=>{const e=g(t).log2(0).floor().add(1);return Ul(t,e)},Ul=(t,e=16)=>g(t).withValue(n=>s=>{const o=[];for(let r=s-1;r>=0;r--)o.push(n>>r&1);return o}).appLeft(g(e)),Wm=t=>wt(e=>n=>Jl(e,n).map(Math.abs)).appLeft(g(t)),Ql=t=>wt(e=>{const s=Jl(e.floor().add(.5),t).map((r,i)=>[r,i]).sort((r,i)=>(r[0]>i[0])-(r[0]<i[0])).map(r=>r[1]),o=e.cyclePos().mul(t).floor()%t;return s[o]})._segment(t),Kl=(t,e,n)=>{const s=[...Array(e).keys()].map(o=>n.zoom(b(o).div(e),b(o+1).div(e)));return t.fmap(o=>s[o].repeatCycles(e)._fast(e)).innerJoin()},Vm=p("shuffle",(t,e)=>Kl(Ql(t),t,e)),Jm=p("scramble",(t,e)=>Kl(Nn(t)._segment(t),t,e)),bt=wt(ge),Gm=bt.toBipolar(),On=t=>bt.fmap(e=>e<t),Hm=t=>g(t).fmap(On).innerJoin(),Um=On(.5),Nn=t=>bt.fmap(e=>Math.trunc(e*t)),Qm=t=>g(t).fmap(Nn).innerJoin(),Bn=(t,e)=>(e=e.map(g),e.length==0?I:t.range(0,e.length).fmap(n=>{const s=Math.min(Math.max(Math.floor(n),0),e.length-1);return e[s]})),De=(t,e)=>Bn(t,e).outerJoin(),Pn=(t,e)=>Bn(t,e).innerJoin(),Yl=(...t)=>De(bt,t),Km=(...t)=>Pn(bt,t),Ym=Yl;y.prototype.choose=function(...t){return De(this,t)},y.prototype.choose2=function(...t){return De(this.fromBipolar(),t)};const Xl=(...t)=>Pn(bt.segment(1),t),Xm=Xl,Zl=function(t,...e){const n=e.map(c=>g(c[0])),s=[];let o=et(0);for(const c of e)o=o.add(c[1]),s.push(o);const r=ks(s),i=function(c){const u=o.mul(c);return r.fmap(l=>f=>n[l.findIndex(h=>h>f,l)]).appLeft(u)};return t.bind(i)},Zm=(...t)=>Zl(...t).outerJoin(),t0=(...t)=>Zm(bt,...t),tf=(...t)=>Zl(bt.segment(1),...t).innerJoin(),e0=tf;function n0(t){let e=Math.floor(t),n=e+1;const s=i=>6*i**5-15*i**4+10*i**3;return(i=>c=>u=>c+s(i)*(u-c))(t-e)(ge(e))(ge(n))}const ef=t=>t.fmap(n0);function s0(t){const e=Math.floor(t),n=e+1,s=ge(e),o=ge(n)+s,r=(t-e)/(n-e);return((c,u,l)=>c+(u-c)*l)(s,o,r)/2}const nf=t=>t.fmap(s0),o0=ef(Cn.fmap(t=>Number(t))),r0=nf(Cn.fmap(t=>Number(t))),i0=p("degradeByWith",(t,e,n)=>n.fmap(s=>o=>s).appLeft(t.filterValues(s=>s>e)),!0,!0),c0=p("degradeBy",function(t,e){return e._degradeByWith(bt,t)},!0,!0),a0=p("degrade",t=>t._degradeBy(.5),!0,!0),u0=p("undegradeBy",function(t,e){return e._degradeByWith(bt.fmap(n=>1-n),t)},!0,!0),l0=p("undegrade",t=>t._undegradeBy(.5),!0,!0),f0=p("sometimesBy",function(t,e,n){return g(t).fmap(s=>K(n._degradeBy(s),e(n._undegradeBy(1-s)))).innerJoin()}),h0=p("sometimes",function(t,e){return e._sometimesBy(.5,t)}),p0=p("someCyclesBy",function(t,e,n){return g(t).fmap(s=>K(n._degradeByWith(bt._segment(1),s),e(n._degradeByWith(bt.fmap(o=>1-o)._segment(1),1-s)))).innerJoin()}),d0=p("someCycles",function(t,e){return e._someCyclesBy(.5,t)}),m0=p("often",function(t,e){return e.sometimesBy(.75,t)}),y0=p("rarely",function(t,e){return e.sometimesBy(.25,t)}),g0=p("almostNever",function(t,e){return e.sometimesBy(.1,t)}),w0=p("almostAlways",function(t,e){return e.sometimesBy(.9,t)}),b0=p("never",function(t,e){return e}),v0=p("always",function(t,e){return t(e)});function xn(t){Array.isArray(t)===!1&&(t=[t]);const e=vs();return t.every(n=>{const s=bs.get(n)??n;return e[s]})}const _0=p("whenKey",function(t,e,n){return n.when(xn(t),e)}),k0=p("keyDown",function(t){return t.fmap(xn)}),Ct=function(t,e,n=!0){const s=Array.isArray(t),o=Object.keys(t).length;return t=gs(t,g),o===0?I:e.fmap(r=>{let i=r;return s&&(i=n?Math.round(i)%o:Re(Math.round(i),0,t.length-1)),t[i]})},sf=function(t,e){return Array.isArray(e)&&([e,t]=[t,e]),q0(t,e)},q0=p("pick",function(t,e){return Ct(t,e,!1).innerJoin()}),of=p("pickmod",function(t,e){return Ct(t,e,!0).innerJoin()}),A0=p("pickF",function(t,e,n){return n.apply(sf(t,e))}),T0=p("pickmodF",function(t,e,n){return n.apply(of(t,e))}),C0=p("pickOut",function(t,e){return Ct(t,e,!1).outerJoin()}),S0=p("pickmodOut",function(t,e){return Ct(t,e,!0).outerJoin()}),M0=p("pickRestart",function(t,e){return Ct(t,e,!1).restartJoin()}),O0=p("pickmodRestart",function(t,e){return Ct(t,e,!0).restartJoin()}),N0=p("pickReset",function(t,e){return Ct(t,e,!1).resetJoin()}),B0=p("pickmodReset",function(t,e){return Ct(t,e,!0).resetJoin()}),{inhabit:P0,pickSqueeze:x0}=p(["inhabit","pickSqueeze"],function(t,e){return Ct(t,e,!1).squeezeJoin()}),{inhabitmod:E0,pickmodSqueeze:R0}=p(["inhabitmod","pickmodSqueeze"],function(t,e){return Ct(t,e,!0).squeezeJoin()}),z0=(t,e)=>(e=e.map(g),e.length==0?I:t.fmap(n=>{const s=fe(Math.round(n),e.length);return e[s]}).squeezeJoin());let We;try{We=window?.speechSynthesis}catch{console.warn("cannot use window: not in browser?")}let rf=We?.getVoices();function I0(t,e,n){We.cancel();const s=new SpeechSynthesisUtterance(t);s.lang=e,rf=We.getVoices();const o=rf.filter(r=>r.lang.includes(e));typeof n=="number"?s.voice=o[n%o.length]:typeof n=="string"&&(s.voice=o.find(r=>r.name===r)),speechSynthesis.speak(s)}const j0=p("speak",function(t,e,n){return n.onTrigger(s=>{I0(s.value,t,e)})}),cf={},af=async(...t)=>{const e=await Promise.allSettled(t),n=e.filter(s=>s.status==="fulfilled").map(s=>s.value);return e.forEach((s,o)=>{s.status==="rejected"&&console.warn(`evalScope: module with index ${o} could not be loaded:`,s.reason)}),n.forEach(s=>{Object.entries(s).forEach(([o,r])=>{globalThis[o]=r,cf[o]=r})}),n};function L0(t,e={}){const{wrapExpression:n=!0,wrapAsync:s=!0}=e;n&&(t=`{${t}}`),s&&(t=`(async ()=>${t})()`);const o=`"use strict";return (${t})`;return Function(o)()}const uf=async(t,e,n)=>{let s={};if(e){const i=e(t,n);t=i.output,s=i}return{mode:"javascript",pattern:await L0(t,{wrapExpression:!!e}),meta:s}},lf=`(function(){"use strict";function L(){return performance.now()*.001}let _=0,r=0,o=.5;const h=new Map,m=.1,M=new BroadcastChannel("strudeltick"),b=(s,e)=>{M.postMessage({type:s,payload:e})},C=E(L,(s,e,t,n)=>{const i=r*e,d=s-n,c=n+d,u=i*o,l=_+u,g=n-c-e,f=e*o,p=l+f,y=l+g*o;b("tick",{begin:l,end:p,cps:o,time:n,cycle:y}),r++},m);let k=!1;const I=s=>{h.set(s,{started:!0}),!k&&(C.start(),k=!0)},A=async s=>{h.set(s,{started:!1});const e=Array.from(h.values()).some(t=>t.started);!k||e||(C.stop(),w(0),k=!1)},w=s=>{r=0,_=s},D=s=>{const{type:e,payload:t}=s;switch(e){case"cpschange":{if(t.cps!==o){const n=r*m;_=_+n*o,o=t.cps,r=0}break}case"setcycle":{w(t.cycle);break}case"toggle":{t.started?I(s.id):A(s.id);break}}};self.onconnect=function(s){const e=s.ports[0];e.addEventListener("message",function(t){D(t.data)}),e.start()};function E(s,e,t=.05,n=.1,i=.1){let d=0,c=0,u=10**4,l=.01;const g=a=>t=a(t);i=i||n/2;const f=()=>{const a=s(),O=a+n+i;for(c===0&&(c=a+l);c<O;)c=Math.round(c*u)/u,c>=a&&e(c,t,d,a),c<a&&console.log("TOO LATE",c),c+=t,d++};let p;const y=()=>{T(),f(),p=setInterval(f,n*1e3)},T=()=>p!==void 0&&clearInterval(p);return{setDuration:g,start:y,stop:()=>{d=0,c=0,T()},pause:()=>T(),duration:t,interval:n,getPhase:()=>c,minLatency:l}}})();
`,ff=typeof self<"u"&&self.Blob&&new Blob(["(self.URL || self.webkitURL).revokeObjectURL(self.location.href);",lf],{type:"text/javascript;charset=utf-8"});function $0(t){let e;try{if(e=ff&&(self.URL||self.webkitURL).createObjectURL(ff),!e)throw"";const n=new Worker(e,{name:t?.name});return n.addEventListener("error",()=>{(self.URL||self.webkitURL).revokeObjectURL(e)}),n}catch{return new Worker("data:text/javascript;charset=utf-8,"+encodeURIComponent(lf),{name:t?.name})}}class F0{constructor({onTrigger:e,onToggle:n,getTime:s}){this.started=!1,this.cps=.5,this.getTime=s,this.time_at_last_tick_message=0,this.collator=new ws({getTargetClockTime:s}),this.onToggle=n,this.latency=.1,this.cycle=0,this.id=Math.round(Date.now()*Math.random()),this.worker=new SharedWorker($0),this.worker.port.start(),this.channel=new BroadcastChannel("strudeltick");const o=i=>{const{cps:c,begin:u,end:l,cycle:f,time:h}=i;this.cps=c,this.cycle=f;const d=this.collator.calculateOffset(h)+h;r(u,l,d),this.time_at_last_tick_message=d},r=(i,c,u)=>{if(this.started===!1)return;this.pattern.queryArc(i,c,{_cps:this.cps,cyclist:"neocyclist"}).forEach(f=>{if(f.hasOnset()){const d=rn(f.whole.begin-this.cycle,this.cps)+u+this.latency,m=rn(f.duration,this.cps);e?.(f,0,m,this.cps,d)}})};this.channel.onmessage=i=>{if(!this.started)return;const{payload:c,type:u}=i.data;switch(u){case"tick":o(c)}}}sendMessage(e,n){this.worker.port.postMessage({type:e,payload:n,id:this.id})}now(){const e=(this.getTime()-this.time_at_last_tick_message)*this.cps;return this.cycle+e}setCps(e=1){this.sendMessage("cpschange",{cps:e})}setCycle(e){this.sendMessage("setcycle",{cycle:e})}setStarted(e){this.sendMessage("toggle",{started:e}),this.started=e,this.onToggle?.(e)}start(){lt("[cyclist] start"),this.setStarted(!0)}stop(){lt("[cyclist] stop"),this.collator.reset(),this.setStarted(!1)}setPattern(e,n=!1){this.pattern=e,n&&!this.started&&this.start()}log(e,n,s){const o=s.filter(r=>r.hasOnset());console.log(`${e.toFixed(4)} - ${n.toFixed(4)} ${Array(o.length).fill("I").join("")}`)}}class hf{constructor({interval:e,onTrigger:n,onToggle:s,onError:o,getTime:r,latency:i=.1,setInterval:c,clearInterval:u,beforeStart:l}){this.started=!1,this.beforeStart=l,this.cps=.5,this.num_ticks_since_cps_change=0,this.lastTick=0,this.lastBegin=0,this.lastEnd=0,this.getTime=r,this.num_cycles_at_cps_change=0,this.seconds_at_cps_change,this.onToggle=s,this.latency=i,this.clock=Ll(r,(f,h,d,m)=>{this.num_ticks_since_cps_change===0&&(this.num_cycles_at_cps_change=this.lastEnd,this.seconds_at_cps_change=f),this.num_ticks_since_cps_change++;const _=this.num_ticks_since_cps_change*h*this.cps;try{const A=this.lastEnd;this.lastBegin=A;const k=this.num_cycles_at_cps_change+_;if(this.lastEnd=k,this.lastTick=f,f<m){console.log("skip query: too late");return}this.pattern.queryArc(A,k,{_cps:this.cps,cyclist:"cyclist"}).forEach(M=>{if(M.hasOnset()){const O=(M.whole.begin-this.num_cycles_at_cps_change)/this.cps+this.seconds_at_cps_change+i,N=M.duration/this.cps,R=O-f;n?.(M,R,N,this.cps,O),M.value.cps!==void 0&&this.cps!=M.value.cps&&(this.cps=M.value.cps,this.num_ticks_since_cps_change=0)}})}catch(A){Pe(A),o?.(A)}},e,.1,.1,c,u)}now(){if(!this.started)return 0;const e=this.getTime()-this.lastTick-this.clock.duration;return this.lastBegin+e*this.cps}setStarted(e){this.started=e,this.onToggle?.(e)}async start(){if(await this.beforeStart?.(),this.num_ticks_since_cps_change=0,this.num_cycles_at_cps_change=0,!this.pattern)throw new Error("Scheduler: no pattern set! call .setPattern first.");lt("[cyclist] start"),this.clock.start(),this.setStarted(!0)}pause(){lt("[cyclist] pause"),this.clock.pause(),this.setStarted(!1)}stop(){lt("[cyclist] stop"),this.clock.stop(),this.lastEnd=0,this.setStarted(!1)}async setPattern(e,n=!1){this.pattern=e,n&&!this.started&&await this.start()}setCps(e=.5){this.cps!==e&&(this.cps=e,this.num_ticks_since_cps_change=0)}log(e,n,s){const o=s.filter(r=>r.hasOnset());console.log(`${e.toFixed(4)} - ${n.toFixed(4)} ${Array(o.length).fill("I").join("")}`)}}let En;function Rn(){if(!En)throw new Error("no time set! use setTime to define a time source");return En()}function zn(t){En=t}function D0({defaultOutput:t,onEvalError:e,beforeEval:n,beforeStart:s,afterEval:o,getTime:r,transpiler:i,onToggle:c,editPattern:u,onUpdateState:l,sync:f=!1,setInterval:h,clearInterval:d,id:m,mondo:w=!1}){const _={schedulerError:void 0,evalError:void 0,code:"// LOADING",activeCode:"// LOADING",pattern:void 0,miniLocations:[],widgets:[],pending:!1,started:!1},A={id:m},k=T=>{Object.assign(_,T),_.isDirty=_.code!==_.activeCode,_.error=_.evalError||_.schedulerError,l?.(_)},E={onTrigger:pf({defaultOutput:t,getTime:r}),getTime:r,onToggle:T=>{k({started:T}),c?.(T)},setInterval:h,clearInterval:d,beforeStart:s},M=f&&typeof SharedWorker<"u"?new F0(E):new hf(E);let O={},N=0,R;const it=function(){return O={},N=0,R=void 0,I};function H(T){return T._Pattern?T.__pure:T}const nt=async(T,P=!0)=>(T=u?.(T)||T,await M.setPattern(T,P),T);zn(()=>M.now());const B=()=>M.stop(),_t=()=>M.start(),J=()=>M.pause(),ct=()=>M.toggle(),G=T=>(M.setCps(H(T)),I),at=T=>(M.setCps(H(T)/60),I);let Y=[];const X=function(T){return Y.push(T),I},kt=function(T){return R=T,I},St=()=>{y.prototype.p=function(P){return typeof P=="string"&&(P.startsWith("_")||P.endsWith("_"))?I:(P.includes("$")&&(P=`${P}${N}`,N++),O[P]=this,this)},y.prototype.q=function(P){return I};try{for(let P=1;P<10;++P)Object.defineProperty(y.prototype,`d${P}`,{get(){return this.p(P)},configurable:!0}),Object.defineProperty(y.prototype,`p${P}`,{get(){return this.p(P)},configurable:!0}),y.prototype[`q${P}`]=I}catch(P){console.warn("injectPatternMethods: error:",P)}const T=p("cpm",function(P,Wt){return Wt._fast(P/60/M.cps)});return af({all:X,each:kt,hush:it,cpm:T,setCps:G,setcps:G,setCpm:at,setcpm:at})};return{scheduler:M,evaluate:async(T,P=!0,Wt=!0)=>{if(!T)throw new Error("no code to evaluate");try{k({code:T,pending:!0}),await St(),zn(()=>M.now()),await n?.({code:T}),Y=[],Wt&&it(),w&&(T=`mondolang\`${T}\``);let{pattern:$,meta:Vt}=await uf(T,i,A);if(Object.keys(O).length){let pt=[],x=!1;for(const[U,Mt]of Object.entries(O)){const Ot=U.length>1&&U.startsWith("S");if(Ot&&x===!1&&(pt=[],x=!0),!x||x&&Ot){const rt=Mt.withState(Ae=>Ae.setControls({id:U}));pt.push(rt)}}R&&(pt=pt.map(U=>R(U))),$=K(...pt)}else R&&($=R($));if(Y.length)for(const pt of Y)$=pt($);return ln($)||($=I),lt("[eval] code updated"),$=await nt($,P),k({miniLocations:Vt?.miniLocations||[],widgets:Vt?.widgets||[],activeCode:T,pattern:$,evalError:void 0,schedulerError:void 0,pending:!1}),o?.({code:T,pattern:$,meta:Vt}),$}catch($){lt(`[eval] error: ${$.message}`,"error"),console.error($),k({evalError:$,pending:!1}),e?.($)}},start:_t,stop:B,pause:J,setCps:G,setPattern:nt,setCode:T=>k({code:T}),toggle:ct,state:_}}const pf=({getTime:t,defaultOutput:e})=>async(n,s,o,r,i)=>{try{(!n.context.onTrigger||!n.context.dominantTrigger)&&await e(n,s,o,r,i),n.context.onTrigger&&await n.context.onTrigger(n,t(),r,i)}catch(c){Pe(c,"getTrigger")}},W0=function(t,e={}){const n=document.getElementById("code"),s="background-image:url("+t+");background-size:contain;";n.style=s;const{className:o}=n,r=(u,l)=>{({style:()=>n.style=s+";"+l,className:()=>n.className=l+" "+o})[u]()},i=Object.entries(e).filter(([u,l])=>typeof l=="function");Object.entries(e).filter(([u,l])=>typeof l=="string").forEach(([u,l])=>r(u,l)),i.length},V0=()=>{const t=document.getElementById("code");t&&(t.style="")};lt("🌀 @strudel/core loaded 🌀"),globalThis._strudelLoaded&&console.warn(`@strudel/core was loaded more than once...
This might happen when you have multiple versions of strudel installed. 
Please check with "npm ls @strudel/core".`),globalThis._strudelLoaded=!0;const J0=Object.freeze(Object.defineProperty({__proto__:null,ClockCollator:ws,Cyclist:hf,Fraction:b,Hap:V,Pattern:y,State:se,TimeSpan:W,__chooseWith:Bn,_brandBy:On,_fitslice:Ns,_irand:Nn,_keyDown:xn,_match:Bs,_mod:fe,_morph:wn,_polymeterListSteps:xs,_retime:yn,_slices:gn,accelerate:Do,activeLabel:ca,ad:pl,add:Dh,adsr:hl,almostAlways:w0,almostNever:g0,always:v0,amp:Go,analyze:cr,anchor:xa,and:cp,apply:Ip,applyN:Os,ar:ml,arp:_h,arpWith:vh,arrange:Sh,as:Rl,att:Uo,attack:Ho,averageArray:cs,backgroundImage:W0,band:Uh,bandf:yr,bandq:br,bank:rr,base64ToUnicode:ys,bbexpr:Dr,bbst:Vr,beat:lm,begin:_r,berlin:r0,berlinWith:nf,binary:Fm,binaryL:Dm,binaryN:Hl,binaryNL:Ul,bind:xh,binshift:zu,bite:Wp,bjork:vm,bjorklund:kn,blshift:Yh,bor:Qh,bp:wr,bpa:qi,bpattack:ki,bpd:Oi,bpdc:nc,bpdecay:Mi,bpdepth:Zi,bpdepthfrequency:tc,bpe:gi,bpenv:yi,bpf:gr,bpq:vr,bpr:Fi,bprate:Yi,bprelease:$i,bps:Ri,bpshape:ec,bpskew:sc,bpsustain:Ei,bpsync:Xi,brak:Zp,brand:Um,brandBy:Hm,brshift:Xh,bxor:Kh,bypass:Nd,byteBeatExpression:Fr,byteBeatStartTime:Wr,calculateSteps:yh,cat:de,ccn:_l,ccv:kl,ceil:hp,ch:Gr,channel:ii,channels:Jr,choose:Yl,chooseCycles:Xl,chooseIn:Km,chooseInWith:Pn,chooseOut:Ym,chooseWith:De,chop:tm,chord:Na,chorus:ir,chunk:bd,chunkBack:kd,chunkBackInto:Od,chunkInto:Sd,chunkback:qd,chunkbackinto:Md,chunkinto:Cd,clamp:Re,cleanupUi:V0,clip:Uu,coarse:Or,code2hash:uh,color:ll,colour:fl,comb:xu,compose:Yf,compress:bp,compressSpan:vp,compressor:su,compressorAttack:iu,compressorKnee:ou,compressorRatio:ru,compressorRelease:cu,compressspan:_p,constant:Xf,contract:Ls,control:vl,controls:ym,cosine:Mm,cosine2:Om,cpm:jp,cps:Hu,createClock:Ll,createParam:Le,createParams:vn,crush:Mr,ctf:ui,ctlNum:ql,ctranspose:fa,curry:S,curve:Zu,cut:ci,cutoff:ai,cycleToSeconds:rn,dec:lr,decay:ur,degrade:a0,degradeBy:c0,degradeByWith:i0,degree:ua,delay:Cc,delayfb:Mc,delayfeedback:Sc,delayspeed:Nc,delaysync:Ec,delayt:Pc,delaytime:Bc,deltaSlide:tl,det:Ic,detune:zc,dfb:Oc,dict:Pa,dictionary:Ba,dist:tu,distort:Za,distorttype:nu,distortvol:eu,div:Jh,djf:Tc,drawLine:_s,drive:zr,drop:zs,dry:$c,ds:dl,dt:xc,duck:Ir,duckattack:$r,duckdepth:jr,duckonset:Lr,dur:Yu,duration:Ku,early:Lp,echo:fd,echoWith:cd,echowith:ad,eish:Cm,end:kr,enhance:Pu,eq:sp,eqt:op,errorLogger:Pe,euclid:bm,euclidLegato:qm,euclidLegatoRot:Am,euclidRot:km,euclidish:Tm,euclidrot:_m,evalScope:af,evaluate:uf,every:zp,expand:js,expression:pu,extend:Is,fadeInTime:Wc,fadeOutTime:Dc,fadeTime:Fc,fanchor:Wi,fast:Mp,fastChunk:Td,fastGap:kp,fastcat:ft,fastchunk:Ad,fastgap:qp,fft:ar,filter:Rd,filterWhen:zd,firstOf:Rp,fit:rm,flatten:Bt,floor:fp,fm:Yo,fmattack:Zo,fmdecay:er,fmenv:Xo,fmh:Qo,fmi:Ko,fmrelease:sr,fmsustain:nr,fmvelocity:or,fmwave:tr,focus:Ap,focusSpan:Tp,focusspan:Cp,fractionalArgs:Zf,frameRate:Lu,frames:$u,freeze:Su,freq:Vc,freqToMidi:en,fromBipolar:dp,fshift:mu,fshiftnote:yu,fshiftphase:gu,ftype:Di,func:up,gain:Vo,gap:oe,gat:sa,gate:na,getAccidentalsOffset:rs,getControlName:_n,getCurrentKeyboardState:vs,getEventOffsetMs:Gf,getFreq:is,getFrequency:us,getPerformanceTimeSeconds:fh,getPlayableNoteValue:Kf,getSoundIndex:Qf,getTime:Rn,getTrigger:pf,grow:Ld,gt:tp,gte:np,harmonic:ha,hash2code:lh,hbrick:Iu,hcutoff:wc,hold:mr,hours:Fu,hp:vc,hpa:_i,hpattack:vi,hpd:Si,hpdc:lc,hpdecay:Ci,hpdepth:ic,hpdepthfreq:cc,hpdepthfrequency:ac,hpe:mi,hpenv:di,hpf:bc,hpq:kc,hpr:Li,hprate:oc,hprelease:ji,hps:xi,hpshape:uc,hpskew:fc,hpsustain:Pi,hpsync:rc,hresonance:_c,hsl:Ed,hsla:xd,hurry:Op,id:ne,imag:Bu,inhabit:P0,inhabitmod:E0,innerBind:Eh,inside:Pp,inv:Kp,invert:Qp,ir:Va,irand:Qm,irbegin:Ha,iresponse:Ja,irspeed:Ga,isControlName:Ks,isNote:xe,isNoteWithOctave:Df,isPattern:ln,isaw:Fe,isaw2:An,iter:md,iterBack:yd,iterback:gd,itri:xm,itri2:Em,jux:id,juxBy:od,juxby:rd,kcutoff:vu,keep:$h,keepif:Fh,keyAlias:bs,keyDown:k0,krush:bu,label:aa,lastOf:Ep,late:Ss,lbrick:ju,legato:Qu,leslie:oa,lfo:sl,linger:Vp,listRange:he,lock:Rc,logKey:tn,logger:lt,loop:qr,loopAt:sm,loopAtCps:im,loopBegin:Ar,loopEnd:Cr,loopat:om,loopatcps:cm,loopb:Tr,loope:Sr,lp:fi,lpa:bi,lpattack:wi,lpd:Ti,lpdc:Qi,lpdecay:Ai,lpdepth:Gi,lpdepthfrequency:Hi,lpe:pi,lpenv:hi,lpf:li,lpq:Ac,lpr:Ii,lprate:Vi,lprelease:zi,lps:Bi,lpshape:Ui,lpskew:Ki,lpsustain:Ni,lpsync:Ji,lrate:ra,lsize:ia,lt:Zh,lte:ep,mapArgs:sn,mask:Oh,midi2note:Uf,midiToFreq:Ht,midibend:Nl,midichan:yl,midicmd:bl,midimap:gl,midiport:wl,miditouch:Bl,minutes:Du,mod:Gh,mode:za,morph:fm,mouseX:jm,mouseY:zm,mousex:Im,mousey:Rm,mtranspose:la,mul:Vh,n:$o,nanFallback:as,ne:rp,net:ip,never:b0,noise:mc,note:Fo,noteToMidi:te,nothing:gt,nrpnn:Al,nrpv:Tl,nudge:ma,numeralArgs:mt,objectMap:gs,oct:ga,octave:ya,octaveR:da,octaves:Ra,octer:_u,octersub:ku,octersubsub:qu,off:Xp,offset:Ea,often:m0,or:ap,orbit:wa,oschost:xl,oscport:El,outerBind:Rh,outside:xp,overgain:ba,overshape:va,pace:Ps,pairs:ps,palindrome:sd,pan:_a,panchor:ea,panorient:Ta,panspan:ka,pansplay:qa,panwidth:Aa,parray:Qs,parseFractional:hs,parseNumeral:nn,partials:pm,patt:Gc,pattack:Jc,pcurve:ta,pdec:Uc,pdecay:Hc,penv:Zc,perlin:o0,perlinWith:ef,ph:Yr,phasdp:ri,phaser:Xr,phasercenter:ei,phaserdepth:si,phaserrate:Kr,phasersweep:Zr,phases:dm,phc:ni,phd:oi,phs:ti,pick:sf,pickF:A0,pickOut:C0,pickReset:N0,pickRestart:M0,pickSqueeze:x0,pickmod:of,pickmodF:T0,pickmodOut:S0,pickmodReset:B0,pickmodRestart:O0,pickmodSqueeze:R0,pipe:fs,pitchJump:el,pitchJumpTime:nl,ply:Sp,plyForEach:dd,plyWith:pd,pm:Th,polyBind:jh,polyTouch:Pl,polymeter:Ie,polyrhythm:qh,postgain:Jo,pow:Hh,pr:Ah,prel:Xc,prelease:Yc,press:nd,pressBy:ed,progNum:Cl,psus:Kc,psustain:Qc,pure:et,pw:Hr,pwrate:Ur,pwsweep:Qr,rand:bt,rand2:Gm,randL:Wm,randcat:Xm,randrun:Ql,range:mp,range2:gp,rangex:yp,rarely:y0,rate:Ca,ratio:wp,rdim:Fa,real:Nu,ref:am,register:p,registerControl:a,reify:g,rel:dr,release:pr,removeUndefineds:ee,repeatCycles:wd,repeatTime:ol,repl:D0,replicate:jd,resonance:qc,rev:Ms,revv:td,rfade:Wa,rib:Pd,ribbon:Bd,ring:Au,ringdf:Cu,ringf:Tu,rlp:La,room:Ia,roomdim:$a,roomfade:Da,roomlp:ja,roomsize:Ua,rotate:ls,round:lp,rsize:Ya,run:Gl,s:Ys,s_add:Gd,s_alt:Dd,s_cat:Fd,s_contract:Kd,s_expand:Ud,s_extend:Qd,s_polymeter:Wd,s_sub:Hd,s_taper:Vd,s_taperlist:Jd,s_tour:Yd,s_zip:Xd,saw:ye,saw2:qn,scram:Ru,scramble:Jm,scrub:zl,seconds:Wu,seg:Gp,segment:Jp,semitone:Ma,seq:Cs,seqPLoop:Mh,sequence:Pt,sequenceP:ks,set:Lh,setStringParser:gh,setTime:zn,shape:Xa,shrink:Fs,shrinklist:$s,shuffle:Vm,signal:wt,silence:I,sine:$l,sine2:Tn,size:Qa,slice:Gs,slide:Sa,slow:Np,slowChunk:_d,slowcat:$t,slowcatPrime:hn,slowchunk:vd,smear:Eu,sol2note:ih,someCycles:d0,someCyclesBy:p0,sometimes:h0,sometimesBy:f0,songPtr:Vu,sound:Xs,source:jo,sparsity:Bp,speak:j0,speed:bn,splice:nm,splitAt:on,spread:Lc,square:Fl,square2:Nm,squeeze:z0,squeezeBind:zh,squiz:lu,src:Lo,stack:K,stackBy:Ch,stackCentre:Ts,stackLeft:qs,stackRight:As,steady:Sm,stepBind:Ih,stepalt:Es,stepcat:ht,steps:Zd,stepsPerOctave:pa,stretch:au,striate:em,stringifyValues:cn,struct:Nh,strudelScope:cf,stut:hd,stutWith:ud,stutwith:ld,sub:Wh,superimpose:Bh,sus:hr,sustain:fr,sustainpedal:du,swing:Up,swingBy:Hp,sysex:Sl,sysexdata:Ol,sysexid:Ml,sz:Ka,take:Rs,time:Cn,timeCat:Vs,timecat:$d,toBipolar:pp,tokenizeNote:os,tour:Ds,tremolo:Nr,tremolodepth:Pr,tremolophase:Er,tremoloshape:Rr,tremoloskew:xr,tremolosync:Br,tri:Bm,tri2:Pm,triode:wu,tsdelay:Ou,uid:Ju,undegrade:l0,undegradeBy:u0,unicodeToBase64:ms,uniq:ch,uniqsort:ah,uniqsortr:ds,unison:jc,unit:uu,v:dc,val:Gu,valueToMidi:Jf,velocity:Wo,vib:hc,vibmod:yc,vibrato:pc,vmod:gc,voice:Oa,vowel:fu,warp:go,warpatt:vo,warpattack:bo,warpdc:No,warpdec:ko,warpdecay:_o,warpdepth:Mo,warpenv:zo,warpmode:Po,warprate:So,warprel:Co,warprelease:To,warpshape:Oo,warpskew:Bo,warpsus:Ao,warpsustain:qo,warpsync:Io,waveloss:hu,wavetablePhaseRand:Ro,wavetablePosition:to,wavetableWarp:wo,wavetableWarpMode:xo,wchoose:t0,wchooseCycles:tf,when:Yp,whenKey:_0,withValue:Ph,within:Id,wrandcat:e0,wt:Zs,wtatt:so,wtattack:no,wtdc:mo,wtdec:ro,wtdecay:oo,wtdepth:ho,wtenv:eo,wtphaserand:Eo,wtrate:lo,wtrel:uo,wtrelease:ao,wtshape:po,wtskew:yo,wtsus:co,wtsustain:io,wtsync:fo,xfade:Us,xsdelay:Mu,zcrush:cl,zdelay:al,zip:Ws,zipWith:Ee,zmod:il,znoise:rl,zoom:$p,zoomArc:Fp,zoomarc:Dp,zrand:Xu,zzfx:ul},Symbol.toStringTag,{value:"Module"}));function G0(t,e){function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n}function Ve(t,e,n,s){var o=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(o,Ve.prototype),o.expected=e,o.found=n,o.location=s,o.name="SyntaxError",o}G0(Ve,Error);function In(t,e,n){return n=n||" ",t.length>e?t:(e-=t.length,n+=n.repeat(e),t+n.slice(0,e))}if(Ve.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var n=null,s;for(s=0;s<t.length;s++)if(t[s].source===this.location.source){n=t[s].text.split(/\r\n|\n|\r/g);break}var o=this.location.start,r=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(o):o,i=this.location.source+":"+r.line+":"+r.column;if(n){var c=this.location.end,u=In("",r.line.toString().length," "),l=n[o.line-1],f=o.line===c.line?c.column:l.length+1,h=f-o.column||1;e+=`
 --> `+i+`
`+u+` |
`+r.line+" | "+l+`
`+u+" | "+In("",o.column-1," ")+In("",h,"^")}else e+=`
 at `+i}return e},Ve.buildMessage=function(t,e){var n={literal:function(l){return'"'+o(l.text)+'"'},class:function(l){var f=l.parts.map(function(h){return Array.isArray(h)?r(h[0])+"-"+r(h[1]):r(h)});return"["+(l.inverted?"^":"")+f.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(l){return l.description}};function s(l){return l.charCodeAt(0).toString(16).toUpperCase()}function o(l){return l.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(f){return"\\x0"+s(f)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(f){return"\\x"+s(f)})}function r(l){return l.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(f){return"\\x0"+s(f)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(f){return"\\x"+s(f)})}function i(l){return n[l.type](l)}function c(l){var f=l.map(i),h,d;if(f.sort(),f.length>0){for(h=1,d=1;h<f.length;h++)f[h-1]!==f[h]&&(f[d]=f[h],d++);f.length=d}switch(f.length){case 1:return f[0];case 2:return f[0]+" or "+f[1];default:return f.slice(0,-1).join(", ")+", or "+f[f.length-1]}}function u(l){return l?'"'+o(l)+'"':"end of input"}return"Expected "+c(t)+" but "+u(e)+" found."},typeof DelayNode<"u"){class t extends DelayNode{constructor(n,s,o,r){super(n),s=Math.abs(s),this.delayTime.value=o;const i=n.createGain();i.gain.value=Math.min(Math.abs(r),.995),this.feedback=i.gain;const c=n.createGain();return c.gain.value=s,this.delayGain=c,this.connect(i),this.connect(c),i.connect(this),this.connect=u=>c.connect(u),this}start(n){this.delayGain.gain.setValueAtTime(this.delayGain.gain.value,n+this.delayTime.value)}}AudioContext.prototype.createFeedbackDelay=function(e,n,s){return new t(this,e,n,s)}}var jn={};jn.generateReverb=function(t,e){for(var n=t.audioContext||new AudioContext,s=n.sampleRate,o=t.numChannels||2,r=t.decayTime*1.5,i=Math.round(t.decayTime*s),c=Math.round(r*s),u=Math.round((t.fadeInTime||0)*s),l=Math.pow(1/1e3,1/i),f=n.createBuffer(o,c,s),h=0;h<o;h++){for(var d=f.getChannelData(h),m=0;m<c;m++)d[m]=Q0()*Math.pow(l,m);for(var m=0;m<u;m++)d[m]*=m/u}H0(f,t.lpFreqStart||0,t.lpFreqEnd||0,t.decayTime,e)},jn.generateGraph=function(t,e,n,s,o){var r=document.createElement("canvas");r.width=e,r.height=n;var i=r.getContext("2d");i.fillStyle="#000",i.fillRect(0,0,r.width,r.height),i.fillStyle="#fff";for(var c=e/t.length,u=n/(o-s),l=0;l<t.length;l++)i.fillRect(l*c,n-(t[l]-s)*u,1,1);return r};var H0=function(t,e,n,s,o){if(e==0){o(t);return}var r=U0(t),i=new OfflineAudioContext(t.numberOfChannels,r[0].length,t.sampleRate),c=i.createBufferSource();c.buffer=t;var u=i.createBiquadFilter();e=Math.min(e,t.sampleRate/2),n=Math.min(n,t.sampleRate/2),u.type="lowpass",u.Q.value=1e-4,u.frequency.setValueAtTime(e,0),u.frequency.linearRampToValueAtTime(n,s),c.connect(u),u.connect(i.destination),c.start(),i.oncomplete=function(l){o(l.renderedBuffer),u.disconnect(),c.disconnect()},i.startRendering(),window.filterNode=u},U0=function(t){for(var e=[],n=0;n<t.numberOfChannels;n++)e[n]=t.getChannelData(n);return e},Q0=function(){return Math.random()*2-1};let df=t=>console.log(t);function K0(t,e="superdough"){process.env.NODE_ENV==="development"&&console.error(t),we(`[${e}] error: ${t.message}`)}const we=(...t)=>df(...t),Y0=t=>{df=t},ie=(t,e,n)=>Math.min(Math.max(t,e),n);function Qt(t,e=0,n){return isNaN(Number(t))?(!n&&we(`"${t}" is not a number, falling back to ${e}`,"warning"),e):t}const X0=(t,e)=>(t%e+e)%e;function Z0(t,e){return t/e}const Ln=(t,e)=>Object.fromEntries(Object.entries(e).map(([n,s])=>[n,t[s]]));typeof AudioContext<"u"&&(AudioContext.prototype.adjustLength=function(t,e,n=1,s=0){const o=Math.floor(ie(s,0,1)*e.length),r=e.sampleRate*t,i=this.createBuffer(e.numberOfChannels,e.length,e.sampleRate);for(let c=0;c<e.numberOfChannels;c++){let u=e.getChannelData(c),l=i.getChannelData(c);for(let f=0;f<r;f++){let h=(o+f*Math.abs(n))%u.length;n<1&&(h=h*-1),l[f]=u.at(h)||0}}return i},AudioContext.prototype.createReverb=function(t,e,n,s,o,r,i){const c=this.createConvolver();return c.generate=(u=2,l=.1,f=15e3,h=1e3,d,m,w)=>{c.duration=u,c.fade=l,c.lp=f,c.dim=h,c.ir=d,c.irspeed=m,c.irbegin=w,d?c.buffer=this.adjustLength(u,d,m,w):jn.generateReverb({audioContext:this,numChannels:2,decayTime:u,fadeInTime:l,lpFreqStart:f,lpFreqEnd:h},_=>{c.buffer=_})},c.generate(t,e,n,s,o,r,i),c});var mf={a:{freqs:[660,1120,2750,3e3,3350],gains:[1,.5012,.0708,.0631,.0126],qs:[80,90,120,130,140]},e:{freqs:[440,1800,2700,3e3,3300],gains:[1,.1995,.1259,.1,.1],qs:[70,80,100,120,120]},i:{freqs:[270,1850,2900,3350,3590],gains:[1,.0631,.0631,.0158,.0158],qs:[40,90,100,120,120]},o:{freqs:[430,820,2700,3e3,3300],gains:[1,.3162,.0501,.0794,.01995],qs:[40,80,100,120,120]},u:{freqs:[370,630,2750,3e3,3400],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]},ae:{freqs:[650,1515,2400,3e3,3350],gains:[1,.5,.1008,.0631,.0126],qs:[80,90,120,130,140]},aa:{freqs:[560,900,2570,3e3,3300],gains:[1,.5,.0708,.0631,.0126],qs:[80,90,120,130,140]},oe:{freqs:[500,1430,2300,3e3,3300],gains:[1,.2,.0708,.0316,.01995],qs:[40,60,100,120,120]},ue:{freqs:[250,1750,2150,3200,3300],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]},y:{freqs:[400,1460,2400,3e3,3300],gains:[1,.2,.0708,.0316,.02995],qs:[40,60,100,120,120]},uh:{freqs:[600,1250,2100,3100,3500],gains:[1,.3,.0608,.0316,.01995],qs:[40,70,100,120,130]},un:{freqs:[500,1240,2280,3e3,3500],gains:[1,.1,.1708,.0216,.02995],qs:[40,60,100,120,120]},en:{freqs:[600,1480,2450,3200,3300],gains:[1,.15,.0708,.0316,.02995],qs:[40,60,100,120,120]},an:{freqs:[700,1050,2500,3e3,3300],gains:[1,.1,.0708,.0316,.02995],qs:[40,60,100,120,120]},on:{freqs:[500,1080,2350,3e3,3300],gains:[1,.1,.0708,.0316,.02995],qs:[40,60,100,120,120]},get æ(){return this.ae},get ø(){return this.oe},get ɑ(){return this.aa},get å(){return this.aa},get ö(){return this.oe},get ü(){return this.ue},get ı(){return this.y}};if(typeof GainNode<"u"){class t extends GainNode{constructor(n,s){if(super(n),!mf[s])throw new Error("vowel: unknown vowel "+s);const{gains:o,qs:r,freqs:i}=mf[s];this.makeupGain=n.createGain(),this.audioNodes=[];for(let c=0;c<5;c++){const u=n.createGain();u.gain.value=o[c];const l=n.createBiquadFilter();l.type="bandpass",l.Q.value=r[c],l.frequency.value=i[c],super.connect(l),l.connect(u),this.audioNodes.push(l),u.connect(this.makeupGain),this.audioNodes.push(u)}return this.makeupGain.gain.value=8,this}connect(n){this.makeupGain.connect(n)}disconnect(){this.makeupGain.disconnect(),this.audioNodes.forEach(n=>n.disconnect()),super.disconnect(),this.makeupGain=null,this.audioNodes=null}}AudioContext.prototype.createVowelFilter=function(e){return new t(this,e)}}let Je;const ty=()=>(Je=new AudioContext,Je),xt=()=>Je||ty();function $n(t){const e=xt().createGain();return e.gain.value=t,e}function Fn(t,e,n){const s=$n(n);return t.connect(s),s.connect(e),s}const yf=(t,e,n,s)=>s-n===0?0:(e-t)/(s-n);function Et(t,e,n,s){const o=new AudioWorkletNode(t,e,s);return Object.entries(n).forEach(([r,i])=>{i!==void 0&&(o.parameters.get(r).value=i)}),o}const ey=(t,e,n,s,o,r,i,c,u,l="exponential")=>{e=Qt(e),n=Qt(n),s=Qt(s),o=Qt(o);const f=l==="exponential"?"exponentialRampToValueAtTime":"linearRampToValueAtTime";l==="exponential"&&(r=r===0?.001:r,i=i===0?.001:i);const h=i-r,d=i,m=r+s*h,w=u-c,_=A=>{let k;if(e>A){let E=yf(r,d,0,e);k=A*E+(r>d?r:0)}else k=(A-e)*yf(d,m,0,n)+d;return l==="exponential"&&(k=k||.001),k};t.setValueAtTime(r,c),e>w?t[f](_(w),u):e+n>w?(t[f](_(e),c+e),t[f](_(w),u)):(t[f](_(e),c+e),t[f](_(e+n),c+e+n),t.setValueAtTime(m,u)),t[f](r,u+o)};function ny(t){return typeof t=="number"?t%5:{tri:0,triangle:0,sine:1,ramp:2,saw:3,square:4}[t]??0}function Dn(t,e,n,s={}){const{shape:o=0,...r}=s,{dcoffset:i=-.5,depth:c=1}=s,u={frequency:1,depth:c,skew:.5,phaseoffset:0,time:e,begin:e,end:n,shape:ny(o),dcoffset:i,min:i*c,max:i*c+c,curve:1,...r};return Et(t,"lfo-processor",u)}function sy(t,e,n,s,o,r){const i={threshold:e??-3,ratio:n??10,knee:s??10,attack:o??.005,release:r??.05};return new DynamicsCompressorNode(t,i)}const oy=(t,e="linear",n)=>{const[i,c,u,l]=t;if(i==null&&c==null&&u==null&&l==null)return n??[.001,.001,1,.01];const f=u??(i!=null&&c==null||i==null&&c==null?1:.001);return[Math.max(i??0,.001),Math.max(c??0,.001),Math.min(f,1),Math.max(l??0,.01)]};function ry(t,e,n,s,o){let{defaultDepth:r=1,depth:i,dcoffset:c,...u}=o;i==null&&(i=Object.values(u).some(h=>h!=null)?r:0);let l;return i&&(l=Dn(t,n,s,{depth:i,dcoffset:c,...u}),l.connect(e)),l}function Wn(t,e,n,s,o,r){let{frequency:i,anchor:c,env:u,type:l,model:f,q:h=1,drive:d=.69,depth:m,depthfrequency:w,dcoffset:_=-.5,skew:A,shape:k,rate:E,sync:M}=s,O,N;f==="ladder"?(N=Et(t,"ladder-processor",{frequency:i,q:h,drive:d}),O=N.parameters.get("frequency")):(N=t.createBiquadFilter(),N.type=l,N.Q.value=h,N.frequency.value=i,O=N.frequency);const R=[s.attack,s.decay,s.sustain,s.release],[it,H,nt,B]=oy(R,"exponential",[.005,.14,0,.1]);if([...R,u].some(G=>G!==void 0)){u=Qt(u,1,!0),c=Qt(c,0,!0);const G=Math.abs(u),at=G*c;let Y=ie(2**-at*i,0,2e4),X=ie(2**(G-at)*i,0,2e4);u<0&&([Y,X]=[X,Y]),ey(O,it,H,nt,B,Y,X,e,n,"exponential")}M!=null&&(E=o*M);const J=[m,w,A,k,E].some(G=>G!==void 0);let ct;if(J){m=m??1;const G=r/o,Y={depth:w??(m??1)*i,dcoffset:_,skew:A,shape:k,frequency:E??o,min:-i+30,max:2e4-i,time:G,curve:1};ct=ry(t,O,e,n,Y)}return{filter:N,lfo:ct}}function iy(t,e,n,s){const o=new ConstantSourceNode(t),r=$n(0);return r.connect(t.destination),o.connect(r),o.onended=()=>{try{r.disconnect()}catch{}try{o.disconnect()}catch{}e()},o.start(n),o.stop(s),o}const gf=t=>t/(1+t),cy=(t,e)=>(t%e+e)%e,ay=(t,e)=>(1+e)*t/(1+e*Math.abs(t)),ce=(t,e)=>Math.tanh(t*(1+e)),uy=(t,e)=>ie((1+e)*t,-1,1),wf=(t,e)=>{let n=(1+.5*e)*t;const s=cy(n+1,4);return 1-Math.abs(s-2)},ly=(t,e)=>Math.sin(Math.PI/2*wf(t,e)),fy=(t,e)=>{const n=gf(Math.log1p(e)),s=(t-n/3*t*t*t)/(1-n/3);return ce(s,e)},bf=(t,e,n=!1)=>{const s=1+2*e,r=.07*gf(Math.log1p(e)),i=ce(t+r,2*e),c=ce(n?r:-t+r,2*e),u=i-c,l=1/Math.cosh(s*r),f=l*l,h=Math.max(1e-8,(n?1:2)*s*f);return ce(u/h,e)};Object.freeze(Object.keys({scurve:ay,soft:ce,hard:uy,cubic:fy,diode:bf,asym:(t,e)=>bf(t,e,!0),fold:wf,sinefold:ly,chebyshev:(t,e)=>{const n=10*Math.log1p(e);let s=1,o=t,r,i=0;for(let c=1;c<64;c++){if(c<2){i+=c==0?s:o;continue}r=2*t*s-o,o=s,s=r,c%2===0&&(i+=Math.min(1.3*n/c,2)*r)}return ce(i,n/20)}}));const hy=(t,e,n)=>Et(xt(),"distort-processor",{distort:t,postgain:e},{processorOptions:{algorithm:n}});let py=Symbol("clean"),At=[],Ft=0;const Ge=4;let dy=t=>{let e=[],n={get(){return n.lc||n.listen(()=>{})(),n.value},lc:0,listen(s){return n.lc=e.push(s),()=>{for(let r=Ft+Ge;r<At.length;)At[r]===s?At.splice(r,Ge):r+=Ge;let o=e.indexOf(s);~o&&(e.splice(o,1),--n.lc||n.off())}},notify(s,o){let r=!At.length;for(let i of e)At.push(i,n.value,s,o);if(r){for(Ft=0;Ft<At.length;Ft+=Ge)At[Ft](At[Ft+1],At[Ft+2],At[Ft+3]);At.length=0}},off(){},set(s){let o=n.value;o!==s&&(n.value=s,n.notify(o))},subscribe(s){let o=n.listen(s);return s(n.value),o},value:t};return process.env.NODE_ENV!=="production"&&(n[py]=()=>{e=[],n.lc=0,n.off()}),n},my=(t={})=>{let e=dy(t);return e.setKey=function(n,s){let o=e.value;typeof s>"u"&&n in e.value?(e.value={...e.value},delete e.value[n],e.notify(o,n)):e.value[n]!==s&&(e.value={...e.value,[n]:s},e.notify(o,n))},e};const Vn={};function yy(t,e){var n=1024;if(t<n)return t+" B";var s=["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],o=-1;do t/=n,++o;while(t>=n);return t.toFixed(1)+" "+s[o]}const gy=(t,e,n,s=0)=>{const o=n?`sound "${n}:${s}"`:"sample";if(t=t.replace("#","%23"),!Vn[t]){we(`[sampler] load ${o}..`,"load-sample",{url:t});const r=Date.now();Vn[t]=fetch(t).then(i=>i.arrayBuffer()).then(async i=>{const c=Date.now()-r,u=yy(i.byteLength);return we(`[sampler] load ${o}... done! loaded ${u} in ${c}ms`,"loaded-sample",{url:t}),await e.decodeAudioData(i)})}return Vn[t]};let ae=(t,e)=>t!==void 0&&t!==e;class wy{reverbNode;delayNode;output;summingNode;djfNode;audioContext;constructor(e){this.audioContext=e,this.output=new GainNode(e,{gain:1,channelCount:2,channelCountMode:"explicit"}),this.summingNode=new GainNode(e,{gain:1,channelCount:2,channelCountMode:"explicit"}),this.summingNode.connect(this.output)}disconnect(){this.output.disconnect(),this.summingNode.disconnect(),this.delayNode?.disconnect(),this.reverbNode?.disconnect()}getDjf(e,n=0){this.djfNode==null&&(this.djfNode=Et(this.audioContext,"djf-processor",{value:e}),this.summingNode.disconnect(),this.summingNode.connect(this.djfNode),this.djfNode.connect(this.output)),this.djfNode.parameters.get("value").setValueAtTime(e,n)}getDelay(e=0,n=.5,s){return n=ie(n,0,.98),this.delayNode==null&&(this.delayNode=this.audioContext.createFeedbackDelay(1,e,n),this.delayNode.connect(this.summingNode),this.delayNode.start?.(s)),this.delayNode.delayTime.value!==e&&this.delayNode.delayTime.setValueAtTime(e,s),this.delayNode.feedback.value!==n&&this.delayNode.feedback.setValueAtTime(n,s),this.delayNode}getReverb(e,n,s,o,r,i,c){return this.reverbNode==null&&(this.reverbNode=this.audioContext.createReverb(e,n,s,o,r,i,c),this.reverbNode.connect(this.summingNode)),(ae(e,this.reverbNode.duration)||ae(n,this.reverbNode.fade)||ae(s,this.reverbNode.lp)||ae(o,this.reverbNode.dim)||ae(i,this.reverbNode.irspeed)||ae(c,this.reverbNode.irbegin)||this.reverbNode.ir!==r)&&this.reverbNode.generate(e,n,s,o,r,i,c),this.reverbNode}sendReverb(e,n){return Fn(e,this.reverbNode,n)}sendDelay(e,n){return Fn(e,this.delayNode,n)}duck(e,n=0,s=.1,o=1){const r=n,i=Math.max(s,.002),c=this.output.gain;iy(this.audioContext,()=>{const u=this.audioContext.currentTime,l=c.value;c.cancelScheduledValues(u),c.setValueAtTime(l,u);const f=Math.max(e,u),h=ie(1-Math.sqrt(o),.01,l);c.exponentialRampToValueAtTime(h,f+r),c.exponentialRampToValueAtTime(1,f+r+i)},0,e-.01)}connectToOutput(e){e.connect(this.summingNode)}}class by{channelMerger;destinationGain;constructor(e){this.audioContext=e,this.initializeAudio()}initializeAudio(){const e=this.audioContext,n=e.destination.maxChannelCount;this.audioContext.destination.channelCount=n,this.channelMerger=new ChannelMergerNode(e,{numberOfInputs:e.destination.channelCount}),this.destinationGain=new GainNode(e),this.channelMerger.connect(this.destinationGain),this.destinationGain.connect(e.destination)}reset(){this.disconnect(),this.initializeAudio()}disconnect(){this.channelMerger.disconnect(),this.destinationGain.disconnect(),this.destinationGain=null,this.channelMerger=null}connectToDestination=(e,n=[0,1])=>{const s=new StereoPannerNode(this.audioContext);e.connect(s);const o=new ChannelSplitterNode(this.audioContext,{numberOfOutputs:s.channelCount});s.connect(o),n.forEach((r,i)=>{o.connect(this.channelMerger,i%s.channelCount,r%this.audioContext.destination.channelCount)})}}class vy{audioContext;output;nodes={};constructor(e){this.audioContext=e,this.output=new by(e)}reset(){Array.from(this.nodes).forEach(e=>{e.disconnect()}),this.nodes={},this.output.reset()}duck(e,n,s=0,o=.1,r=1){const i=[e].flat(),c=[s].flat(),u=[o].flat(),l=[r].flat();i.forEach((f,h)=>{const d=this.nodes[f];if(d==null){K0(new Error(`duck target orbit ${f} does not exist`),"superdough");return}const m=c[h]??c[0],w=Math.max(u[h]??u[0],.002),_=l[h]??l[0];d.duck(n,m,w,_)})}getOrbit(e,n){return this.nodes[e]==null&&(this.nodes[e]=new wy(this.audioContext),this.output.connectToDestination(this.nodes[e].output,n)),this.nodes[e]}}let _y=128;const vf=my();let ky=t=>t;function Dt(t){return ky(t)}function Jn(t){return typeof t!="string"?(console.warn(`getSound: expected string got "${t}". fall back to triangle`),vf.get().triangle):vf.get()[t.toLowerCase()]}let qy={s:"triangle",gain:.8,postgain:1,density:".03",channels:[1,2],phaserdepth:.75,shapevol:1,distortvol:1,distorttype:0,delay:0,byteBeatExpression:"0",delayfeedback:.5,delaysync:3/16,orbit:1,i:1,velocity:1,fft:8},Ay=new Map(Object.entries(qy));function ot(t){return Ay.get(t)}let Gn;function _f(){return Gn==null&&(Gn=new vy(xt())),Gn}function Ty(t,e){_f().output.connectToDestination(t,e)}function Cy(t,e,n=1,s=.5,o=1e3,r=2e3){const i=xt(),c=Dn(i,t,e,{frequency:n,depth:r*2}),u=2;let l=0;const f=[];for(let h=0;h<u;h++){const d=i.createBiquadFilter();d.type="notch",d.gain.value=1,d.frequency.value=o+l,d.Q.value=2-Math.min(Math.max(s*2,0),1.9),c.connect(d.detune),l+=282,h>0&&f[h-1].connect(d),f.push(d)}return{phaser:f[f.length-1],lfo:c}}function Sy(t){t=t??0;const e=["12db","ladder","24db"];return typeof t=="number"?e[Math.floor(X0(t,e.length))]:t}let vt={},be={};function My(t,e=1024,n=.5){if(!vt[t]){const s=xt().createAnalyser();s.fftSize=e,s.smoothingTimeConstant=n,vt[t]=s,be[t]=new Float32Array(vt[t].frequencyBinCount)}return vt[t].fftSize!==e&&(vt[t].fftSize=e,be[t]=new Float32Array(vt[t].frequencyBinCount)),vt[t]}function Hn(t="time",e=1){const n={time:()=>vt[e]?.getFloatTimeDomainData(be[e]),frequency:()=>vt[e]?.getFloatFrequencyData(be[e])}[t];if(!n)throw new Error(`getAnalyzerData: ${t} not supported. use one of ${Object.keys(n).join(", ")}`);return n(),be[e]}let ve=new Map;function kf(t){return(Array.isArray(t)?t:[t]).map(e=>e-1)}const Oy=async(t,e,n,s=.5,o=.5)=>{const r=xt(),i=_f();let{stretch:c}=t;if(c!=null&&(e=e-.04),typeof t!="object")throw new Error(`expected hap.value to be an object, but got "${t}". Hint: append .note() or .s() to the end`,"error");if(t.duration=n,e<r.currentTime){console.warn(`[superdough]: cannot schedule sounds in the past (target: ${e.toFixed(2)}, now: ${r.currentTime.toFixed(2)})`);return}let{tremolo:u,tremolosync:l,tremolodepth:f=1,tremoloskew:h,tremolophase:d=0,tremoloshape:m,s:w=ot("s"),bank:_,source:A,gain:k=ot("gain"),postgain:E=ot("postgain"),density:M=ot("density"),duckorbit:O,duckonset:N,duckattack:R,duckdepth:it,djf:H,fanchor:nt=ot("fanchor"),release:B=0,phaserrate:_t,phaserdepth:J=ot("phaserdepth"),phasersweep:ct,phasercenter:G,coarse:at,crush:Y,dry:X,shape:kt,shapevol:St=ot("shapevol"),distort:ue,distortvol:It=ot("distortvol"),distorttype:T=ot("distorttype"),pan:P,vowel:Wt,delay:$=ot("delay"),delayfeedback:Vt=ot("delayfeedback"),delaysync:pt=ot("delaysync"),delaytime:x,orbit:U=ot("orbit"),room:Mt,roomfade:Ot,roomlp:rt,roomdim:Ae,roomsize:Kn,ir:Te,irspeed:He,irbegin:Yt,i:Ce=ot("i"),velocity:Se=ot("velocity"),analyze:Me,fft:Ue=ot("fft"),compressor:Oe,compressorRatio:Xt,compressorKnee:Yn,compressorAttack:Qe,compressorRelease:Xn}=t;x=x??Z0(pt,s);const Ef=kf(ot("channels")),Zn=t.channels!=null?kf(t.channels):Ef,jt=i.getOrbit(U,Zn);O!=null&&i.duck(O,e,N,R,it),k=Dt(Qt(k,1)),E=Dt(E),St=Dt(St),It=Dt(It),$=Dt($),Se=Dt(Se),f=Dt(f),k*=Se;const Ke=e+n,Rf=Ke+B,zf=Math.round(Math.random()*1e6);for(let z=0;z<=ve.size-_y;z++){const D=ve.entries().next(),Q=D.value[1].deref(),Z=D.value[0],Tt=e+.25;Q?.node?.gain?.linearRampToValueAtTime(0,Tt),Q?.stop?.(Tt),ve.delete(Z)}let dt=[];if(["-","~","_"].includes(w))return;_&&w&&(w=`${_}_${w}`,t.s=w);let Ye;if(A)Ye=A(e,t,n,s);else if(Jn(w)){const{onTrigger:z}=Jn(w),Q=await z(e,t,()=>{dt.forEach(Z=>Z?.disconnect()),ve.delete(zf)},s);Q&&(Ye=Q.node,ve.set(zf,new WeakRef(Q)))}else throw new Error(`sound ${w} not found! Is it loaded?`);if(!Ye)return;if(r.currentTime>e){we("[webaudio] skip hap: still loading",r.currentTime-e);return}const F=[];F.push(Ye),c!==void 0&&F.push(Et(r,"phase-vocoder-processor",{pitchFactor:c})),F.push($n(k));const ts=Sy(t.ftype);if(t.cutoff!==void 0){const D=Ln(t,{frequency:"cutoff",q:"resonance",attack:"lpattack",decay:"lpdecay",sustain:"lpsustain",release:"lprelease",env:"lpenv",anchor:"fanchor",model:"ftype",drive:"drive",rate:"lprate",sync:"lpsync",depth:"lpdepth",depthfrequency:"lpdepthfrequency",shape:"lpshape",dcoffset:"lpdc",skew:"lpskew"});D.type="lowpass";const Q=()=>Wn(r,e,Ke,D,s,o),{filter:Z,lfo:Tt}=Q();if(F.push(Z),Tt&&dt.push(Tt),ts==="24db"){const{filter:Be,lfo:Jt}=Q();F.push(Be),Jt&&dt.push(Jt)}}if(t.hcutoff!==void 0){const D=Ln(t,{frequency:"hcutoff",q:"hresonance",attack:"hpattack",decay:"hpdecay",sustain:"hpsustain",release:"hprelease",env:"hpenv",anchor:"fanchor",model:"ftype",drive:"drive",rate:"hprate",sync:"hpsync",depth:"hpdepth",depthfrequency:"hpdepthfrequency",shape:"hpshape",dcoffset:"hpdc",skew:"hpskew"});D.type="highpass";const Q=()=>Wn(r,e,Ke,D,s,o),{filter:Z,lfo:Tt}=Q();if(F.push(Z),Tt&&dt.push(Tt),ts==="24db"){const{filter:Be,lfo:Jt}=Q();F.push(Be),Jt&&dt.push(Jt)}}if(t.bandf!==void 0){const D=Ln(t,{frequency:"bandf",q:"bandq",attack:"bpattack",decay:"bpdecay",sustain:"bpsustain",release:"bprelease",env:"bpenv",anchor:"fanchor",model:"ftype",drive:"drive",rate:"bprate",sync:"bpsync",depth:"bpdepth",depthfrequency:"bpdepthfrequency",shape:"bpshape",dcoffset:"bpdc",skew:"bpskew"});D.type="bandpass";const Q=()=>Wn(r,e,Ke,D,s,o),{filter:Z,lfo:Tt}=Q();if(F.push(Z),Tt&&dt.push(Tt),ts==="24db"){const{filter:Be,lfo:Jt}=Q();F.push(Be),Jt&&dt.push(Jt)}}if(Wt!==void 0){const z=r.createVowelFilter(Wt);F.push(z)}if(at!==void 0&&F.push(Et(r,"coarse-processor",{coarse:at})),Y!==void 0&&F.push(Et(r,"crush-processor",{crush:Y})),kt!==void 0&&F.push(Et(r,"shape-processor",{shape:kt,postgain:St})),ue!==void 0&&F.push(hy(ue,It,T)),l!=null&&(u=s*l),t.wtPosSynced!=null&&(t.wtPosRate/=s),t.wtWarpSynced!=null&&(t.wtWarpRate/=s),u!==void 0){const z=Math.max(1-f,0),D=new GainNode(r,{gain:z}),Q=o/s,Z=Dn(r,e,Rf,{skew:h??(m!=null?.5:1),frequency:u,depth:f,time:Q,dcoffset:0,shape:m,phaseoffset:d,min:0,max:1,curve:1.5});Z.connect(D.gain),dt.push(Z),F.push(D)}if(Oe!==void 0&&F.push(sy(r,Oe,Xt,Yn,Qe,Xn)),P!==void 0){const z=r.createStereoPanner();z.pan.value=2*P-1,F.push(z)}if(_t!==void 0&&J>0){const{phaser:z,lfo:D}=Cy(e,Rf,_t,J,G,ct);dt.push(D),F.push(z)}const Ne=new GainNode(r,{gain:E});if(F.push(Ne),$>0&&x>0&&Vt>0){jt.getDelay(x,Vt,e);const z=jt.sendDelay(Ne,$);dt.push(z)}if(Mt>0){let z;if(Te!==void 0){let Q,Z=Jn(Te);Array.isArray(Z)?Q=Z.data.samples[Ce%Z.data.samples.length]:typeof Z=="object"&&(Q=Object.values(Z.data.samples).flat()[Ce%Object.values(Z.data.samples).length]),z=await gy(Q,r,Te,0)}jt.getReverb(Kn,Ot,rt,Ae,z,He,Yt);const D=jt.sendReverb(Ne,Mt);dt.push(D)}if(H!=null&&jt.getDjf(H,e),Me){const z=My(Me,2**(Ue+5)),D=Fn(Ne,z,1);dt.push(D)}if(X!=null){X=Dt(X);const z=new GainNode(r,{gain:X});F.push(z),jt.connectToOutput(z)}else jt.connectToOutput(Ne);F.slice(1).reduce((z,D)=>z.connect(D),F[0]),dt=dt.concat(F)};typeof window<"u"&&window.addEventListener("message",t=>{t.data==="strudel-stop"||t.data?.dough});function Ny(t,e,n,s){window.postMessage({time:s,dough:t.value,currentTime:e,duration:t.duration,cps:n})}let _e;function By(){const t=xt();_e=Et(t,"dough-processor",{},{outputChannelCount:[2]}),Ty(_e)}const Un=new Map,qf=new Map;y.prototype.supradough=function(){return this.onTrigger((t,e,n,s)=>{t.value._begin=s,t.value._duration=t.duration/n,!_e&&By();const o=(t.value.bank?t.value.bank+"_":"")+t.value.s,r=t.value.n??0,i=`${o}:${r}`;if(Un.has(o)&&(t.value.s=i),Un.has(o)&&!qf.has(i)){const c=Un.get(o),u=c[r%c.length];console.log(`load ${i} from ${u}`);const l=Py(u);qf.set(i,l),l.then(({channels:f,sampleRate:h})=>_e.port.postMessage({sample:i,channels:f,sampleRate:h}))}_e.port.postMessage({spawn:t.value})},1)};async function Py(t){const e=await fetch(t).then(s=>s.arrayBuffer()).then(s=>xt().decodeAudioData(s));let n=[];for(let s=0;s<e.numberOfChannels;s++)n.push(e.getChannelData(s));return{channels:n,sampleRate:e.sampleRate}}typeof sampleRate<"u"&&sampleRate;const{Pattern:xy,logger:Ey,repl:Ry}=J0;Y0(Ey);const zy=t=>(t.ensureObjectValue(),t.value),Iy=(t,e,n,s,o)=>Oy(zy(t),o,n,s,t.whole?.begin.valueOf());function jy(t={}){return t={getTime:()=>xt().currentTime,defaultOutput:Iy,...t},Ry(t)}xy.prototype.dough=function(){return this.onTrigger(Ny,1)};const Kt=(t="test-canvas",e)=>{let{contextType:n="2d",pixelated:s=!1,pixelRatio:o=window.devicePixelRatio}={},r=document.querySelector("#"+t);if(!r){r=document.createElement("canvas"),r.id=t,r.width=window.innerWidth*o,r.height=window.innerHeight*o,r.style="pointer-events:none;width:100%;height:100%;position:fixed;top:0;left:0",s&&(r.style.imageRendering="pixelated"),document.body.prepend(r);let i;window.addEventListener("resize",()=>{i&&clearTimeout(i),i=setTimeout(()=>{r.width=window.innerWidth*o,r.height=window.innerHeight*o},200)})}return r.getContext(n,{willReadFrequently:!0})};let ke={};function Ly(t){ke[t]!==void 0&&(cancelAnimationFrame(ke[t]),delete ke[t])}let Rt={};y.prototype.draw=function(t,e){if(typeof window>"u")return this;let{id:n=1,lookbehind:s=0,lookahead:o=0}=e,r=Math.max(Rn(),0);Ly(n),s=Math.abs(s),Rt[n]=(Rt[n]||[]).filter(l=>!l.isInFuture(r));let i=this.queryArc(r,r+o).filter(l=>l.hasOnset());Rt[n]=Rt[n].concat(i);let c;const u=()=>{const l=Rn(),f=l+o;Rt[n]=Rt[n].filter(m=>m.isInNearPast(s,l));let h=Math.max(c||f,f-1/10);const d=this.queryArc(h,f).filter(m=>m.hasOnset());Rt[n]=Rt[n].concat(d),c=f,t(Rt[n],l,f,this),ke[n]=requestAnimationFrame(u)};return ke[n]=requestAnimationFrame(u),this},y.prototype.onPaint=function(t){return this.withState(e=>(e.controls.painters||(e.controls.painters=[]),e.controls.painters.push(t),e))},y.prototype.getPainters=function(){let t=[];return this.queryArc(0,0,{painters:t}),t};let $y={background:"#222",foreground:"#75baff",caret:"#ffcc00",selection:"rgba(128, 203, 196, 0.5)",selectionMatch:"#036dd626",lineHighlight:"#00000050",gutterBackground:"transparent",gutterForeground:"#8a919966"};function zt(){return $y}let Af="#22222210";y.prototype.animate=function({callback:t,sync:e=!1,smear:n=.5}={}){window.frame&&cancelAnimationFrame(window.frame);const s=Kt();let{clientWidth:o,clientHeight:r}=s.canvas;o*=window.devicePixelRatio,r*=window.devicePixelRatio;let i=n===0?"99":Number((1-n)*100).toFixed(0);i=i.length===1?`0${i}`:i,Af=`#200010${i}`;const c=u=>{let l;u=Math.round(u),l=this.slow(1e3).queryArc(u,u),s.fillStyle=Af,s.fillRect(0,0,o,r),l.forEach(f=>{let{x:h,y:d,w:m,h:w,s:_,r:A,angle:k=0,fill:E="darkseagreen"}=f.value;if(m*=o,w*=r,A!==void 0&&k!==void 0){const O=k*2*Math.PI,[N,R]=[(o-m)/2,(r-w)/2];h=N+Math.cos(O)*A*N,d=R+Math.sin(O)*A*R}else h*=o-m,d*=r-w;const M={...f.value,x:h,y:d,w:m,h:w};s.fillStyle=E,_==="rect"?s.fillRect(h,d,m,w):_==="ellipse"&&(s.beginPath(),s.ellipse(h+m/2,d+w/2,m/2,w/2,0,0,2*Math.PI),s.fill()),t&&t(s,M,f)}),window.frame=requestAnimationFrame(c)};return window.frame=requestAnimationFrame(c),I};const{x:Tf,y:eg,w:ng,h:sg,angle:og,r:rg,fill:ig,smear:cg}=vn("x","y","w","h","angle","r","fill","smear");p("rescale",function(t,e){return e.mul(Tf(t).w(t).y(t).h(t))}),p("moveXY",function(t,e,n){return n.add(Tf(t).y(e))}),p("zoomIn",function(t,e){const n=et(1).sub(t).div(2);return e.rescale(t).move(n,n)});const qe=(t,e,n)=>t*(n-e)+e,Cf=t=>{let{value:e}=t;typeof t.value!="object"&&(e={value:e});let{note:n,n:s,freq:o,s:r}=e;if(o)return en(o);if(n=n??s,typeof n=="string")try{return te(n)}catch{return 0}return typeof n=="number"?n:r?"_"+r:e};y.prototype.pianoroll=function(t={}){let{cycles:e=4,playhead:n=.5,overscan:s=0,hideNegative:o=!1,ctx:r=Kt(),id:i=1}=t,c=-e*n,u=e*(1-n);const l=(f,h)=>(!o||f.whole.begin>=0)&&f.isWithinTime(h+c,h+u);return this.draw((f,h)=>{Sf({...t,time:h,ctx:r,haps:f.filter(d=>l(d,h))})},{lookbehind:c-s,lookahead:u+s,id:i}),this};function Sf({time:t,haps:e,cycles:n=4,playhead:s=.5,flipTime:o=0,flipValues:r=0,hideNegative:i=!1,inactive:c=zt().foreground,active:u=zt().foreground,background:l="transparent",smear:f=0,playheadColor:h=zt().foreground,minMidi:d=10,maxMidi:m=90,autorange:w=0,timeframe:_,fold:A=1,vertical:k=0,labels:E=!1,fill:M=1,fillActive:O=!1,strokeActive:N=!0,stroke:R,hideInactive:it=0,colorizeInactive:H=1,fontFamily:nt,ctx:B,id:_t}={}){const J=B.canvas.width,ct=B.canvas.height;let G=-n*s,at=n*(1-s);_t&&(e=e.filter(x=>x.hasTag(_t))),_&&(console.warn("timeframe is deprecated! use from/to instead"),G=0,at=_);const Y=k?ct:J,X=k?J:ct;let kt=k?[Y,0]:[0,Y];const St=at-G,ue=k?[0,X]:[X,0];let It=m-d+1,T=X/It,P=[];o&&kt.reverse(),r&&ue.reverse();const{min:Wt,max:$,values:Vt}=e.reduce(({min:x,max:U,values:Mt},Ot)=>{const rt=Cf(Ot);return{min:rt<x?rt:x,max:rt>U?rt:U,values:Mt.includes(rt)?Mt:[...Mt,rt]}},{min:1/0,max:-1/0,values:[]});w&&(d=Wt,m=$,It=m-d+1),P=Vt.sort((x,U)=>typeof x=="number"&&typeof U=="number"?x-U:typeof x=="number"?1:String(x).localeCompare(String(U))),T=A?X/P.length:X/It,B.fillStyle=l,B.globalAlpha=1,f||(B.clearRect(0,0,J,ct),B.fillRect(0,0,J,ct)),e.forEach(x=>{const U=x.whole.begin<=t&&x.endClipped>t;let Mt=R??(N&&U),Ot=!U&&M||U&&O;if(it&&!U)return;let rt=x.value?.color;u=rt||u,c=H&&rt||c,rt=U?u:c,B.fillStyle=Ot?rt:"transparent",B.strokeStyle=rt;const{velocity:Ae=1,gain:Kn=1}=x.value||{};B.globalAlpha=Ae*Kn;const Te=(x.whole.begin-(o?at:G))/St,He=qe(Te,...kt);let Yt=qe(x.duration/St,0,Y);const Ce=Cf(x),Se=A?P.indexOf(Ce)/P.length:(Number(Ce)-d)/It,Me=qe(Se,...ue);let Ue=0;const Oe=qe(t/St,...kt);let Xt;if(k?Xt=[Me+1-(r?T:0),Y-Oe+He+Ue+1-(o?0:Yt),T-2,Yt-2]:Xt=[He-Oe+Ue+1-(o?Yt:0),Me+1-(r?0:T),Yt-2,T-2],Mt&&B.strokeRect(...Xt),Ot&&B.fillRect(...Xt),E){const Yn=x.value.note??x.value.s+(x.value.n?`:${x.value.n}`:""),{label:Qe,activeLabel:Xn}=x.value,Zn=(U&&Xn||Qe)??Yn;let jt=k?Yt:T*.75;B.font=`${jt}px ${nt||"monospace"}`,B.fillStyle=Ot?"black":rt,B.textBaseline="top",B.fillText(Zn,...Xt)}}),B.globalAlpha=1;const pt=qe(-G/St,...kt);return B.strokeStyle=h,B.beginPath(),k?(B.moveTo(0,pt),B.lineTo(X,pt)):(B.moveTo(pt,0),B.lineTo(pt,X)),B.stroke(),this}function Fy(t,e={}){let[n,s]=t;n=Math.abs(n);const o=s+n,r=o!==0?n/o:0;return{fold:1,...e,cycles:o,playhead:r}}const Dy=(t={})=>(e,n,s,o)=>Sf({ctx:e,time:n,haps:s,...Fy(o,t)});y.prototype.punchcard=function(t){return this.onPaint(Dy(t))},y.prototype.wordfall=function(t){return this.punchcard({vertical:1,labels:1,stroke:0,fillActive:1,active:"white",...t})};function Wy(t,e,n,s){const o=(t-90)*Math.PI/180;return[n+Math.cos(o)*e,s+Math.sin(o)*e]}const Mf=(t,e,n,s,o=0)=>Wy((t+o)*360,e*t,n,s);function Of(t){let{ctx:e,from:n=0,to:s=3,margin:o=50,cx:r=100,cy:i=100,rotate:c=0,thickness:u=o/2,color:l=zt().foreground,cap:f="round",stretch:h=1,fromOpacity:d=1,toOpacity:m=1}=t;n*=h,s*=h,c*=h,e.lineWidth=u,e.lineCap=f,e.strokeStyle=l,e.globalAlpha=d,e.beginPath();let[w,_]=Mf(n,o,r,i,c);e.moveTo(w,_);const A=1/60;let k=n;for(;k<=s;){const[E,M]=Mf(k,o,r,i,c);e.globalAlpha=(k-n)/(s-n)*m,e.lineTo(E,M),k+=A}e.stroke()}function Vy(t){let{stretch:e=1,size:n=80,thickness:s=n/2,cap:o="butt",inset:r=3,playheadColor:i="#ffffff",playheadLength:c=.02,playheadThickness:u=s,padding:l=0,steady:f=1,activeColor:h=zt().foreground,inactiveColor:d=zt().gutterForeground,colorizeInactive:m=0,fade:w=!0,ctx:_,time:A,haps:k,drawTime:E,id:M}=t;M&&(k=k.filter(J=>J.hasTag(M)));const[O,N]=[_.canvas.width,_.canvas.height];_.clearRect(0,0,O*2,N*2);const[R,it]=[O/2,N/2],H={margin:n/e,cx:R,cy:it,stretch:e,cap:o,thickness:s},nt={...H,thickness:u,from:r-c,to:r,color:i},[B]=E,_t=f*A;k.forEach(J=>{const ct=J.whole.begin<=A&&J.endClipped>A,G=J.whole.begin-A+r,at=J.endClipped-A+r-l,Y=J.value?.color||h,X=m||ct?Y:d,kt=w?1-Math.abs((J.whole.begin-A)/B):1;Of({ctx:_,...H,from:G,to:at,rotate:_t,color:X,fromOpacity:kt,toOpacity:kt})}),Of({ctx:_,...nt,rotate:_t})}y.prototype.spiral=function(t={}){return this.onPaint((e,n,s,o)=>Vy({ctx:e,time:n,haps:s,drawTime:o,...t}))};const Jy=Ht(36),Nf=(t,e,n,s)=>{s=s*Math.PI*2;const o=Math.sin(s)*n+t,r=Math.cos(s)*n+e;return[o,r]},Bf=(t,e)=>.5-Math.log2(t/e)%1;function Gy({haps:t,ctx:e,id:n,hapcircles:s=1,circle:o=0,edo:r=12,root:i=Jy,thickness:c=3,hapRadius:u=6,mode:l="flake",margin:f=10}={}){const h=l==="polygon",d=l==="flake",m=e.canvas.width,w=e.canvas.height;e.clearRect(0,0,m,w);const _=zt().foreground,k=Math.min(m,w)/2-c/2-u-f,E=m/2,M=w/2;n&&(t=t.filter(N=>N.hasTag(n))),e.strokeStyle=_,e.fillStyle=_,e.globalAlpha=1,e.lineWidth=c,o&&(e.beginPath(),e.arc(E,M,k,0,2*Math.PI),e.stroke()),r&&(Array.from({length:r},(N,R)=>{const it=Bf(i*Math.pow(2,R/r),i),[H,nt]=Nf(E,M,k,it);e.beginPath(),e.arc(H,nt,u,0,2*Math.PI),e.fill()}),e.stroke());let O=[];e.lineWidth=u,t.forEach(N=>{let R;try{R=us(N)}catch{return}const it=Bf(R,i),[H,nt]=Nf(E,M,k,it),B=N.value.color||_;e.strokeStyle=B,e.fillStyle=B;const{velocity:_t=1,gain:J=1}=N.value||{},ct=_t*J;e.globalAlpha=ct,O.push([H,nt,it,B,ct]),e.beginPath(),s&&(e.moveTo(H+u,nt),e.arc(H,nt,u,0,2*Math.PI),e.fill()),d&&(e.moveTo(E,M),e.lineTo(H,nt)),e.stroke()}),e.strokeStyle=_,e.globalAlpha=1,h&&O.length&&(O=O.sort((N,R)=>N[2]-R[2]),e.beginPath(),e.moveTo(O[0][0],O[0][1]),O.forEach(([N,R,it,H,nt])=>{e.strokeStyle=H,e.globalAlpha=nt,e.lineTo(N,R)}),e.lineTo(O[0][0],O[0][1]),e.stroke())}y.prototype.pitchwheel=function(t={}){let{ctx:e=Kt(),id:n=1}=t;return this.tag(n).onPaint((s,o,r)=>Gy({...t,ctx:e,haps:r.filter(i=>i.isActive(o)),id:n}))};function Hy(t,{align:e=!0,color:n="white",thickness:s=3,scale:o=.25,pos:r=.75,trigger:i=0,ctx:c=Kt(),id:u=1}={}){c.lineWidth=s,c.strokeStyle=n;let l=c.canvas;if(!t){c.beginPath();let _=r*l.height;c.moveTo(0,_),c.lineTo(l.width,_),c.stroke();return}const f=Hn("time",u);c.beginPath();const h=t.frequencyBinCount;let d=e?Array.from(f).findIndex((_,A,k)=>A&&k[A-1]>-i&&_<=-i):0;d=Math.max(d,0);const m=l.width*1/h;let w=0;for(let _=d;_<h;_++){const A=f[_]+1,k=(r-o*(A-1))*l.height;_===0?c.moveTo(w,k):c.lineTo(w,k),w+=m}c.stroke()}function Uy(t,{color:e="white",scale:n=.25,pos:s=.75,lean:o=.5,min:r=-150,max:i=0,ctx:c=Kt(),id:u=1}={}){if(!t){c.beginPath();let w=s*f.height;c.moveTo(0,w),c.lineTo(f.width,w),c.stroke();return}const l=Hn("frequency",u),f=c.canvas;c.fillStyle=e;const h=t.frequencyBinCount,d=f.width*1/h;let m=0;for(let w=0;w<h;w++){const A=Re((l[w]-r)/(i-r),0,1)*n,k=A*f.height,E=(s-A*o)*f.height;c.fillRect(m,E,Math.max(d,1),k),m+=d}}function Pf(t=0,e="0,0,0",n=Kt()){t?(n.fillStyle=`rgba(${e},${1-t})`,n.fillRect(0,0,n.canvas.width,n.canvas.height)):n.clearRect(0,0,n.canvas.width,n.canvas.height)}y.prototype.fscope=function(t={}){let e=t.id??1;return this.analyze(e).draw(()=>{Pf(t.smear,"0,0,0",t.ctx),vt[e]&&Uy(vt[e],t)},{id:e})},y.prototype.tscope=function(t={}){let e=t.id??1;return this.analyze(e).draw(n=>{t.color=n[0]?.value?.color||zt().foreground,t.color,Pf(t.smear,"0,0,0",t.ctx),Hy(vt[e],t)},{id:e})},y.prototype.scope=y.prototype.tscope;let xf={};y.prototype.spectrum=function(t={}){let e=t.id??1;return this.analyze(e).draw(n=>{t.color=n[0]?.value?.color||xf[e]||zt().foreground,xf[e]=t.color,Qy(vt[e],t)},{id:e})},y.prototype.scope=y.prototype.tscope;const Qn=new Map;function Qy(t,{thickness:e=3,speed:n=1,min:s=-80,max:o=0,ctx:r=Kt(),id:i=1,color:c}={}){if(r.lineWidth=e,r.strokeStyle=c,!t)return;const u=n,l=Hn("frequency",i),f=r.canvas;r.fillStyle=c;const h=t.frequencyBinCount;let d=Qn.get(i)||r.getImageData(0,0,f.width,f.height);Qn.set(i,d),r.clearRect(0,0,r.canvas.width,r.canvas.height),r.putImageData(d,-u,0);let m=f.width-n;for(let w=0;w<h;w++){const _=Re((l[w]-s)/(o-s),0,1);r.globalAlpha=_;const A=Math.log(w+1)/Math.log(h)*f.height;r.fillRect(m,f.height-A,u,2)}Qn.set(i,r.getImageData(0,0,f.width,f.height))}const{evaluate:ag}=jy()})();
