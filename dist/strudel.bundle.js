(function(){"use strict";typeof globalThis.process>"u"&&(globalThis.process={env:{}}),typeof globalThis.process.env>"u"&&(globalThis.process.env={}),typeof globalThis.process.env.NODE_ENV>"u"&&(globalThis.process.env.NODE_ENV="production"),typeof BigInt>"u"&&(BigInt=function(e){if(isNaN(e))throw new Error("");return e});const k=BigInt(0),E=BigInt(1),dn=BigInt(2),ls=BigInt(5),Be=BigInt(10),Xh=2e3,M={s:E,n:k,d:E};function ut(e,t){try{e=BigInt(e)}catch{throw bt()}return e*t}function Oe(e){return typeof e=="bigint"?e:Math.floor(e)}function de(e,t){if(t===k)throw ds();const n=Object.create(ce.prototype);n.s=e<k?-E:E,e=e<k?-e:e;const s=Ft(e,t);return n.n=e/s,n.d=t/s,n}function At(e){const t={};let n=e,s=dn,o=ls-E;for(;o<=n;){for(;n%s===k;)n/=s,t[s]=(t[s]||k)+E;o+=E+dn*s++}return n!==e?n>1&&(t[n]=(t[n]||k)+E):t[e]=(t[e]||k)+E,t}const We=function(e,t){let n=k,s=E,o=E;if(e!=null)if(t!==void 0){if(typeof e=="bigint")n=e;else{if(isNaN(e))throw bt();if(e%1!==0)throw zo();n=BigInt(e)}if(typeof t=="bigint")s=t;else{if(isNaN(t))throw bt();if(t%1!==0)throw zo();s=BigInt(t)}o=n*s}else if(typeof e=="object"){if("d"in e&&"n"in e)n=BigInt(e.n),s=BigInt(e.d),"s"in e&&(n*=BigInt(e.s));else if(0 in e)n=BigInt(e[0]),1 in e&&(s=BigInt(e[1]));else if(typeof e=="bigint")n=e;else throw bt();o=n*s}else if(typeof e=="number"){if(isNaN(e))throw bt();if(e<0&&(o=-E,e=-e),e%1===0)n=BigInt(e);else if(e>0){let r=1,i=0,u=1,a=1,l=1,p=1e7;for(e>=1&&(r=10**Math.floor(1+Math.log10(e)),e/=r);u<=p&&l<=p;){let f=(i+a)/(u+l);if(e===f){u+l<=p?(n=i+a,s=u+l):l>u?(n=a,s=l):(n=i,s=u);break}else e>f?(i+=a,u+=l):(a+=i,l+=u),u>p?(n=a,s=l):(n=i,s=u)}n=BigInt(n)*BigInt(r),s=BigInt(s)}}else if(typeof e=="string"){let r=0,i=k,u=k,a=k,l=E,p=E,f=e.replace(/_/g,"").match(/\d+|./g);if(f===null)throw bt();if(f[r]==="-"?(o=-E,r++):f[r]==="+"&&r++,f.length===r+1?u=ut(f[r++],o):f[r+1]==="."||f[r]==="."?(f[r]!=="."&&(i=ut(f[r++],o)),r++,(r+1===f.length||f[r+1]==="("&&f[r+3]===")"||f[r+1]==="'"&&f[r+3]==="'")&&(u=ut(f[r],o),l=Be**BigInt(f[r].length),r++),(f[r]==="("&&f[r+2]===")"||f[r]==="'"&&f[r+2]==="'")&&(a=ut(f[r+1],o),p=Be**BigInt(f[r+1].length)-E,r+=3)):f[r+1]==="/"||f[r+1]===":"?(u=ut(f[r],o),l=ut(f[r+2],E),r+=3):f[r+3]==="/"&&f[r+1]===" "&&(i=ut(f[r],o),u=ut(f[r+2],o),l=ut(f[r+4],E),r+=5),f.length<=r)s=l*p,o=n=a+s*i+p*u;else throw bt()}else if(typeof e=="bigint")n=e,o=e,s=E;else throw bt();if(s===k)throw ds();M.s=o<k?-E:E,M.n=n<k?-n:n,M.d=s<k?-s:s};function Gh(e,t,n){let s=E;for(;t>k;e=e*e%n,t>>=E)t&E&&(s=s*e%n);return s}function Zh(e,t){for(;t%dn===k;t/=dn);for(;t%ls===k;t/=ls);if(t===E)return k;let n=Be%t,s=1;for(;n!==E;s++)if(n=n*Be%t,s>Xh)return k;return BigInt(s)}function wh(e,t,n){let s=E,o=Gh(Be,n,t);for(let r=0;r<300;r++){if(s===o)return BigInt(r);s=s*Be%t,o=o*Be%t}return 0}function Ft(e,t){if(!e)return t;if(!t)return e;for(;;){if(e%=t,!e)return t;if(t%=e,!t)return e}}function ce(e,t){if(We(e,t),this instanceof ce)e=Ft(M.d,M.n),this.s=M.s,this.n=M.n/e,this.d=M.d/e;else return de(M.s*M.n,M.d)}var ds=function(){return new Error("Division by Zero")},bt=function(){return new Error("Invalid argument")},zo=function(){return new Error("Parameters must be integer")};ce.prototype={s:E,n:k,d:E,abs:function(){return de(this.n,this.d)},neg:function(){return de(-this.s*this.n,this.d)},add:function(e,t){return We(e,t),de(this.s*this.n*M.d+M.s*this.d*M.n,this.d*M.d)},sub:function(e,t){return We(e,t),de(this.s*this.n*M.d-M.s*this.d*M.n,this.d*M.d)},mul:function(e,t){return We(e,t),de(this.s*M.s*this.n*M.n,this.d*M.d)},div:function(e,t){return We(e,t),de(this.s*M.s*this.n*M.d,this.d*M.n)},clone:function(){return de(this.s*this.n,this.d)},mod:function(e,t){if(e===void 0)return de(this.s*this.n%this.d,E);if(We(e,t),k===M.n*this.d)throw ds();return de(this.s*(M.d*this.n)%(M.n*this.d),M.d*this.d)},gcd:function(e,t){return We(e,t),de(Ft(M.n,this.n)*Ft(M.d,this.d),M.d*this.d)},lcm:function(e,t){return We(e,t),M.n===k&&this.n===k?de(k,E):de(M.n*this.n,Ft(M.n,this.n)*Ft(M.d,this.d))},inverse:function(){return de(this.s*this.d,this.n)},pow:function(e,t){if(We(e,t),M.d===E)return M.s<k?de((this.s*this.d)**M.n,this.n**M.n):de((this.s*this.n)**M.n,this.d**M.n);if(this.s<k)return null;let n=At(this.n),s=At(this.d),o=E,r=E;for(let i in n)if(i!=="1"){if(i==="0"){o=k;break}if(n[i]*=M.n,n[i]%M.d===k)n[i]/=M.d;else return null;o*=BigInt(i)**n[i]}for(let i in s)if(i!=="1"){if(s[i]*=M.n,s[i]%M.d===k)s[i]/=M.d;else return null;r*=BigInt(i)**s[i]}return M.s<k?de(r,o):de(o,r)},log:function(e,t){if(We(e,t),this.s<=k||M.s<=k)return null;const n={},s=At(M.n),o=At(M.d),r=At(this.n),i=At(this.d);for(const l in o)s[l]=(s[l]||k)-o[l];for(const l in i)r[l]=(r[l]||k)-i[l];for(const l in s)l!=="1"&&(n[l]=!0);for(const l in r)l!=="1"&&(n[l]=!0);let u=null,a=null;for(const l in n){const p=s[l]||k,f=r[l]||k;if(p===k){if(f!==k)return null;continue}let g=f,X=p;const G=Ft(g,X);if(g/=G,X/=G,u===null&&a===null)u=g,a=X;else if(g*a!==u*X)return null}return u!==null&&a!==null?de(u,a):null},equals:function(e,t){return We(e,t),this.s*this.n*M.d===M.s*M.n*this.d},lt:function(e,t){return We(e,t),this.s*this.n*M.d<M.s*M.n*this.d},lte:function(e,t){return We(e,t),this.s*this.n*M.d<=M.s*M.n*this.d},gt:function(e,t){return We(e,t),this.s*this.n*M.d>M.s*M.n*this.d},gte:function(e,t){return We(e,t),this.s*this.n*M.d>=M.s*M.n*this.d},compare:function(e,t){We(e,t);let n=this.s*this.n*M.d-M.s*M.n*this.d;return(k<n)-(n<k)},ceil:function(e){return e=Be**BigInt(e||0),de(Oe(this.s*e*this.n/this.d)+(e*this.n%this.d>k&&this.s>=k?E:k),e)},floor:function(e){return e=Be**BigInt(e||0),de(Oe(this.s*e*this.n/this.d)-(e*this.n%this.d>k&&this.s<k?E:k),e)},round:function(e){return e=Be**BigInt(e||0),de(Oe(this.s*e*this.n/this.d)+this.s*((this.s>=k?E:k)+dn*(e*this.n%this.d)>this.d?E:k),e)},roundTo:function(e,t){We(e,t);const n=this.n*M.d,s=this.d*M.n,o=n%s;let r=Oe(n/s);return o+o>=s&&r++,de(this.s*r*M.n,M.d)},divisible:function(e,t){return We(e,t),!(!(M.n*this.d)||this.n*M.d%(M.n*this.d))},valueOf:function(){return Number(this.s*this.n)/Number(this.d)},toString:function(e){let t=this.n,n=this.d;e=e||15;let s=Zh(t,n),o=wh(t,n,s),r=this.s<k?"-":"";if(r+=Oe(t/n),t%=n,t*=Be,t&&(r+="."),s){for(let i=o;i--;)r+=Oe(t/n),t%=n,t*=Be;r+="(";for(let i=s;i--;)r+=Oe(t/n),t%=n,t*=Be;r+=")"}else for(let i=e;t&&i--;)r+=Oe(t/n),t%=n,t*=Be;return r},toFraction:function(e){let t=this.n,n=this.d,s=this.s<k?"-":"";if(n===E)s+=t;else{let o=Oe(t/n);e&&o>k&&(s+=o,s+=" ",t%=n),s+=t,s+="/",s+=n}return s},toLatex:function(e){let t=this.n,n=this.d,s=this.s<k?"-":"";if(n===E)s+=t;else{let o=Oe(t/n);e&&o>k&&(s+=o,t%=n),s+="\\frac{",s+=t,s+="}{",s+=n,s+="}"}return s},toContinued:function(){let e=this.n,t=this.d,n=[];do{n.push(Oe(e/t));let s=e%t;e=t,t=s}while(e!==E);return n},simplify:function(e){const t=BigInt(1/(e||.001)|0),n=this.abs(),s=n.toContinued();for(let o=1;o<s.length;o++){let r=de(s[o-1],E);for(let u=o-2;u>=0;u--)r=r.inverse().add(s[u]);let i=r.sub(n);if(i.n*t<i.d)return r.mul(this.s)}return this}};const ps="strudel.log";let Wh=1e3,Mo,Ro;function Yn(e,t="cyclist"){process.env.NODE_ENV==="development"&&console.error(e),Se(`[${t}] error: ${e.message}`)}function Se(e,t,n={}){let s=performance.now();Mo===e&&s-Ro<Wh||(Mo=e,Ro=s,console.log(`%c${e}`,"background-color: black;color:white;border-radius:15px"),typeof document<"u"&&typeof CustomEvent<"u"&&document.dispatchEvent(new CustomEvent(ps,{detail:{message:e,type:t,data:n}})))}Se.key=ps;const Fh=e=>/^[a-gA-G][#bsf]*[0-9]*$/.test(e),kn=e=>/^[a-gA-G][#bsf]*-?[0-9]*$/.test(e),xo=e=>{if(typeof e!="string")return[];const[t,n="",s]=e.match(/^([a-gA-G])([#bsf]*)(-?[0-9]*)$/)?.slice(1)||[];return t?[t,n,s?Number(s):void 0]:[]},vh={c:0,d:2,e:4,f:5,g:7,a:9,b:11},Vh={"#":1,b:-1,s:1,f:-1},Bo=e=>e?.split("").reduce((t,n)=>t+Vh[n],0)||0,Nt=(e,t=3)=>{const[n,s,o=t]=xo(e);if(!n)throw new Error('not a note: "'+e+'"');const r=vh[n.toLowerCase()],i=Bo(s);return(Number(o)+1)*12+r+i},vt=e=>Math.pow(2,(e-69)/12)*440,hs=e=>12*Math.log(e/440)/Math.LN2+69,Ch=(e,t)=>{if(typeof e!="object")throw new Error("valueToMidi: expected object value");let{freq:n,note:s}=e;if(typeof n=="number")return hs(n);if(typeof s=="string")return Nt(s);if(typeof s=="number")return s;if(!t)throw new Error("valueToMidi: expected freq or note to be set");return t},Lh=(e,t)=>(e-t)*1e3,So=e=>vt(typeof e=="number"?e:Nt(e)),zh=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],Mh=e=>{const t=Math.floor(e/12)-1;return zh[e%12]+t},pn=(e,t)=>(e%t+t)%t,Yo=e=>e.reduce((t,n)=>t+n)/e.length;function ko(e,t=0){return isNaN(Number(e))?(Se(`"${e}" is not a number, falling back to ${t}`,"warning"),t):e}const Rh=(e,t)=>pn(Math.round(ko(e??0,0)),t),xh=e=>{let{value:t,context:n}=e,s=t;if(typeof s=="object"&&!Array.isArray(s)&&(s=s.note||s.n||s.value,s===void 0))throw new Error(`cannot find a playable note for ${JSON.stringify(t)}`);if(typeof s=="number"&&n.type!=="frequency")s=vt(e.value);else if(typeof s=="number"&&n.type==="frequency")s=e.value;else if(typeof s!="string"||!kn(s))throw new Error("not a note: "+JSON.stringify(s));return s},To=e=>{let{value:t,context:n}=e;if(typeof t=="object")return t.freq?t.freq:So(t.note||t.n||t.value);if(typeof t=="number"&&n.type!=="frequency")t=vt(e.value);else if(typeof t=="string"&&kn(t))t=vt(Nt(e.value));else if(typeof t!="number")throw new Error("not a note or frequency: "+t);return t},Ao=(e,t)=>e.slice(t).concat(e.slice(0,t)),No=(...e)=>e.reduce((t,n)=>(...s)=>t(n(...s)),t=>t),Bh=(...e)=>No(...e.reverse()),_t=e=>e.filter(t=>t!=null),at=e=>[].concat(...e),Kt=e=>e,Sh=(e,t)=>e,hn=(e,t)=>Array.from({length:t-e+1},(n,s)=>s+e);function D(e,t,n=e.length){const s=function o(...r){if(r.length>=n)return e.apply(this,r);{const i=function(...u){return o.apply(this,r.concat(u))};return t&&t(i,r),i}};return t&&t(s,[]),s}function fs(e){const t=Number(e);if(!isNaN(t))return t;if(kn(e))return Nt(e);throw new Error(`cannot parse as numeral: "${e}"`)}function ms(e,t){return(...n)=>e(...n.map(t))}function Ae(e){return ms(e,fs)}function _o(e){const t=Number(e);if(!isNaN(t))return t;const n={pi:Math.PI,w:1,h:.5,q:.25,e:.125,s:.0625,t:1/3,f:.2,x:1/6}[e];if(typeof n<"u")return n;throw new Error(`cannot parse as fractional: "${e}"`)}const Yh=e=>ms(e,_o),ys=function(e,t){return[t.slice(0,e),t.slice(e)]},Tn=(e,t,n)=>t.map((s,o)=>e(s,n[o])),Ko=function(e){const t=[];for(let n=0;n<e.length-1;++n)t.push([e[n],e[n+1]]);return t},An=(e,t,n)=>Math.min(Math.max(e,t),n),kh=["Do","Reb","Re","Mib","Mi","Fa","Solb","Sol","Lab","La","Sib","Si"],Th=["Sa","Re","Ga","Ma","Pa","Dha","Ni"],Ah=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Hb","H"],Nh=["Ni","Pab","Pa","Voub","Vou","Ga","Dib","Di","Keb","Ke","Zob","Zo"],_h=["I","Ro","Ha","Ni","Ho","He","To"],Kh=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],Hh=(e,t="letters")=>{const s=(t==="solfeggio"?kh:t==="indian"?Th:t==="german"?Ah:t==="byzantine"?Nh:t==="japanese"?_h:Kh)[e%12],o=Math.floor(e/12)-1;return s+o};function Ph(e){var t={};return e.filter(function(n){return t.hasOwn(n)?!1:t[n]=!0})}function Eh(e){return e.sort().filter(function(t,n,s){return!n||t!=s[n-1]})}function Ho(e){return e.sort((t,n)=>t.compare(n)).filter(function(t,n,s){return!n||t.ne(s[n-1])})}function Po(e){const t=new TextEncoder().encode(e);return btoa(String.fromCharCode(...t))}function Eo(e){const t=new Uint8Array(atob(e).split("").map(s=>s.charCodeAt(0)));return new TextDecoder().decode(t)}function Dh(e){return encodeURIComponent(Po(e))}function Ih(e){return Eo(decodeURIComponent(e))}function Do(e,t){return Array.isArray(e)?e.map(t):Object.fromEntries(Object.entries(e).map(([n,s],o)=>[n,t(s,n,o)]))}function bs(e,t){return e/t}class Io{constructor({getTargetClockTime:t=jh,weight:n=16,offsetDelta:s=.005,checkAfterTime:o=2,resetAfterTime:r=8}){this.offsetTime,this.timeAtPrevOffsetSample,this.prevOffsetTimes=[],this.getTargetClockTime=t,this.weight=n,this.offsetDelta=s,this.checkAfterTime=o,this.resetAfterTime=r,this.reset=()=>{this.prevOffsetTimes=[],this.offsetTime=null,this.timeAtPrevOffsetSample=null}}calculateOffset(t){const n=this.getTargetClockTime(),s=n-this.timeAtPrevOffsetSample,o=n-t;if(s>this.resetAfterTime&&this.reset(),this.offsetTime==null&&(this.offsetTime=o),this.prevOffsetTimes.push(o),this.prevOffsetTimes.length>this.weight&&this.prevOffsetTimes.shift(),this.timeAtPrevOffsetSample==null||s>this.checkAfterTime){this.timeAtPrevOffsetSample=n;const r=Yo(this.prevOffsetTimes);Math.abs(r-this.offsetTime)>this.offsetDelta&&(this.offsetTime=r)}return this.offsetTime}calculateTimestamp(t,n){return this.calculateOffset(t)+n}}function Jh(){return performance.now()*.001}function jh(){return Date.now()*.001}const Jo=new Map([["control","Control"],["ctrl","Control"],["alt","Alt"],["shift","Shift"],["down","ArrowDown"],["up","ArrowUp"],["left","ArrowLeft"],["right","ArrowRight"]]);let fn;function jo(){if(fn==null){if(typeof window>"u")return;fn={},window.addEventListener("keydown",e=>{fn[e.key]=!0}),window.addEventListener("keyup",e=>{fn[e.key]=!1})}return{...fn}}function gs(e,t=!1){return typeof e=="object"?t?JSON.stringify(e).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(e):e}ce.prototype.sam=function(){return this.floor()},ce.prototype.nextSam=function(){return this.sam().add(1)},ce.prototype.wholeCycle=function(){return new be(this.sam(),this.nextSam())},ce.prototype.cyclePos=function(){return this.sub(this.sam())},ce.prototype.lt=function(e){return this.compare(e)<0},ce.prototype.gt=function(e){return this.compare(e)>0},ce.prototype.lte=function(e){return this.compare(e)<=0},ce.prototype.gte=function(e){return this.compare(e)>=0},ce.prototype.eq=function(e){return this.compare(e)==0},ce.prototype.ne=function(e){return this.compare(e)!=0},ce.prototype.max=function(e){return this.gt(e)?this:e},ce.prototype.maximum=function(...e){return e=e.map(t=>new ce(t)),e.reduce((t,n)=>n.max(t),this)},ce.prototype.min=function(e){return this.lt(e)?this:e},ce.prototype.mulmaybe=function(e){return e!==void 0?this.mul(e):void 0},ce.prototype.divmaybe=function(e){return e!==void 0?this.div(e):void 0},ce.prototype.addmaybe=function(e){return e!==void 0?this.add(e):void 0},ce.prototype.submaybe=function(e){return e!==void 0?this.sub(e):void 0},ce.prototype.show=function(){return this.s*this.n+"/"+this.d},ce.prototype.or=function(e){return this.eq(0)?e:this};const Xs=e=>ce(e),Oh=(...e)=>{if(e=_t(e),e.length!==0)return e.reduce((t,n)=>t.gcd(n),Xs(1))},Ue=(...e)=>{if(e=_t(e),e.length===0)return;const t=e.pop();return e.reduce((n,s)=>n===void 0||s===void 0?void 0:n.lcm(s),t)},Uh=e=>e instanceof ce;Xs._original=ce;const C=Xs;class be{constructor(t,n){this.begin=C(t),this.end=C(n)}get spanCycles(){const t=[];var n=this.begin;const s=this.end,o=s.sam();if(n.equals(s))return[new be(n,s)];for(;s.gt(n);){if(n.sam().equals(o)){t.push(new be(n,this.end));break}const r=n.nextSam();t.push(new be(n,r)),n=r}return t}get duration(){return this.end.sub(this.begin)}cycleArc(){const t=this.begin.cyclePos(),n=t.add(this.duration);return new be(t,n)}withTime(t){return new be(t(this.begin),t(this.end))}withEnd(t){return new be(this.begin,t(this.end))}withCycle(t){const n=this.begin.sam(),s=n.add(t(this.begin.sub(n))),o=n.add(t(this.end.sub(n)));return new be(s,o)}intersection(t){const n=this.begin.max(t.begin),s=this.end.min(t.end);if(!n.gt(s)&&!(n.equals(s)&&(n.equals(this.end)&&this.begin.lt(this.end)||n.equals(t.end)&&t.begin.lt(t.end))))return new be(n,s)}intersection_e(t){const n=this.intersection(t);if(n==null)throw"TimeSpans do not intersect";return n}midpoint(){return this.begin.add(this.duration.div(C(2)))}equals(t){return this.begin.equals(t.begin)&&this.end.equals(t.end)}show(){return this.begin.show()+" → "+this.end.show()}}class ge{constructor(t,n,s,o={},r=!1){this.whole=t,this.part=n,this.value=s,this.context=o,this.stateful=r,r&&console.assert(typeof this.value=="function","Stateful values must be functions")}get duration(){let t;return typeof this.value?.duration=="number"?t=C(this.value.duration):t=this.whole.end.sub(this.whole.begin),typeof this.value?.clip=="number"?t.mul(this.value.clip):t}get endClipped(){return this.whole.begin.add(this.duration)}isActive(t){return this.whole.begin<=t&&this.endClipped>=t}isInPast(t){return t>this.endClipped}isInNearPast(t,n){return n-t<=this.endClipped}isInFuture(t){return t<this.whole.begin}isInNearFuture(t,n){return n<this.whole.begin&&n>this.whole.begin-t}isWithinTime(t,n){return this.whole.begin<=n&&this.endClipped>=t}wholeOrPart(){return this.whole?this.whole:this.part}withSpan(t){const n=this.whole?t(this.whole):void 0;return new ge(n,t(this.part),this.value,this.context)}withValue(t){return new ge(this.whole,this.part,t(this.value),this.context)}hasOnset(){return this.whole!=null&&this.whole.begin.equals(this.part.begin)}hasTag(t){return this.context.tags?.includes(t)}resolveState(t){if(this.stateful&&this.hasOnset()){console.log("stateful");const n=this.value,[s,o]=n(t);return[s,new ge(this.whole,this.part,o,this.context,!1)]}return[t,this]}spanEquals(t){return this.whole==null&&t.whole==null||this.whole.equals(t.whole)}equals(t){return this.spanEquals(t)&&this.part.equals(t.part)&&this.value===t.value}show(t=!1){const n=typeof this.value=="object"?t?JSON.stringify(this.value).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(this.value):this.value;var s="";if(this.whole==null)s="~"+this.part.show;else{var o=this.whole.begin.equals(this.part.begin)&&this.whole.end.equals(this.part.end);this.whole.begin.equals(this.part.begin)||(s=this.whole.begin.show()+" ⇜ "),o||(s+="("),s+=this.part.show(),o||(s+=")"),this.whole.end.equals(this.part.end)||(s+=" ⇝ "+this.whole.end.show())}return"[ "+s+" | "+n+" ]"}showWhole(t=!1){return`${this.whole==null?"~":this.whole.show()}: ${gs(this.value,t)}`}combineContext(t){const n=this;return{...n.context,...t.context,locations:(n.context.locations||[]).concat(t.context.locations||[])}}setContext(t){return new ge(this.whole,this.part,this.value,t)}ensureObjectValue(){if(typeof this.value!="object")throw new Error(`expected hap.value to be an object, but got "${this.value}". Hint: append .note() or .s() to the end`,"error")}}class Ht{constructor(t,n={}){this.span=t,this.controls=n}setSpan(t){return new Ht(t,this.controls)}withSpan(t){return this.setSpan(t(this.span))}setControls(t){return new Ht(this.span,{...this.controls,...t})}}function Qh(e,t,n){if(t?.value!==void 0&&Object.keys(t).length===1)return Se("[warn]: Can't do arithmetic on control pattern."),e;const s=Object.keys(e).filter(o=>Object.keys(t).includes(o));return Object.assign({},e,t,Object.fromEntries(s.map(o=>[o,n(e[o],t[o])])))}D((e,t)=>e*t),D((e,t)=>t.map(e));function Oo(e,t=60){let n=0,s=C(0),o=[""],r="";for(;o[0].length<t;){const i=e.queryArc(n,n+1),u=i.filter(p=>p.hasOnset()).map(p=>p.duration),a=Oh(...u),l=a.inverse();o=o.map(p=>p+"|"),r+="|";for(let p=0;p<l;p++){const[f,g]=[s,s.add(a)],X=i.filter(w=>w.whole.begin.lte(f)&&w.whole.end.gte(g)),G=X.length-o.length;G>0&&(o=o.concat(Array(G).fill(r))),o=o.map((w,F)=>{const v=X[F];if(v){const B=v.whole.begin.eq(f)?""+v.value:"-";return w+B}return w+"."}),r+=".",s=s.add(a)}n++}return o.join(`
`)}let Gs,Ne=!0;const qh=function(e){Ne=!!e},Uo=e=>Gs=e;let L=class ve{constructor(t,n=void 0){this.query=t,this._Pattern=!0,this._steps=n}get _steps(){return this.__steps}set _steps(t){this.__steps=t===void 0?void 0:C(t)}setSteps(t){return this._steps=t,this}withSteps(t){return Ne?new ve(this.query,this._steps===void 0?void 0:t(this._steps)):this}get hasSteps(){return this._steps!==void 0}withValue(t){const n=new ve(s=>this.query(s).map(o=>o.withValue(t)));return n._steps=this._steps,n}withState(t){return new ve(n=>this.query(t(n)))}fmap(t){return this.withValue(t)}appWhole(t,n){const s=this,o=function(r){const i=s.query(r),u=n.query(r),a=function(l,p){const f=l.part.intersection(p.part);if(f!=null)return new ge(t(l.whole,p.whole),f,l.value(p.value),p.combineContext(l))};return at(i.map(l=>_t(u.map(p=>a(l,p)))))};return new ve(o)}appBoth(t){const n=this,s=function(r,i){if(!(r==null||i==null))return r.intersection_e(i)},o=n.appWhole(s,t);return Ne&&(o._steps=Ue(t._steps,n._steps)),o}appLeft(t){const n=this,s=function(r){const i=[];for(const u of n.query(r)){const a=t.query(r.setSpan(u.wholeOrPart()));for(const l of a){const p=u.whole,f=u.part.intersection(l.part);if(f){const g=u.value(l.value),X=l.combineContext(u),G=new ge(p,f,g,X);i.push(G)}}}return i},o=new ve(s);return o._steps=this._steps,o}appRight(t){const n=this,s=function(r){const i=[];for(const u of t.query(r)){const a=n.query(r.setSpan(u.wholeOrPart()));for(const l of a){const p=u.whole,f=l.part.intersection(u.part);if(f){const g=l.value(u.value),X=u.combineContext(l),G=new ge(p,f,g,X);i.push(G)}}}return i},o=new ve(s);return o._steps=t._steps,o}bindWhole(t,n){const s=this,o=function(r){const i=function(a,l){return new ge(t(a.whole,l.whole),l.part,l.value,Object.assign({},a.context,l.context,{locations:(a.context.locations||[]).concat(l.context.locations||[])}))},u=function(a){return n(a.value).query(r.setSpan(a.part)).map(l=>i(a,l))};return at(s.query(r).map(a=>u(a)))};return new ve(o)}bind(t){const n=function(s,o){if(!(s==null||o==null))return s.intersection_e(o)};return this.bindWhole(n,t)}join(){return this.bind(Kt)}outerBind(t){return this.bindWhole(n=>n,t).setSteps(this._steps)}outerJoin(){return this.outerBind(Kt)}innerBind(t){return this.bindWhole((n,s)=>s,t)}innerJoin(){return this.innerBind(Kt)}resetJoin(t=!1){const n=this;return new ve(s=>n.discreteOnly().query(s).map(o=>o.value.late(t?o.whole.begin:o.whole.begin.cyclePos()).query(s).map(r=>new ge(r.whole?r.whole.intersection(o.whole):void 0,r.part.intersection(o.part),r.value).setContext(o.combineContext(r))).filter(r=>r.part)).flat())}restartJoin(){return this.resetJoin(!0)}squeezeJoin(){const t=this;function n(s){const o=t.discreteOnly().query(s);function r(u){const l=u.value._focusSpan(u.wholeOrPart()).query(s.setSpan(u.part));function p(f,g){let X;if(g.whole&&f.whole&&(X=g.whole.intersection(f.whole),!X))return;const G=g.part.intersection(f.part);if(!G)return;const w=g.combineContext(f);return new ge(X,G,g.value,w)}return l.map(f=>p(u,f))}return at(o.map(r)).filter(u=>u)}return new ve(n)}squeezeBind(t){return this.fmap(t).squeezeJoin()}polyJoin=function(){const t=this;return t.fmap(n=>n.extend(t._steps.div(n._steps))).outerJoin()};polyBind(t){return this.fmap(t).polyJoin()}queryArc(t,n,s={}){try{return this.query(new Ht(new be(t,n),s))}catch(o){return Yn(o,"query"),[]}}splitQueries(){const t=this,n=s=>at(s.span.spanCycles.map(o=>t.query(s.setSpan(o))));return new ve(n)}withQuerySpan(t){return new ve(n=>this.query(n.withSpan(t)))}withQuerySpanMaybe(t){const n=this;return new ve(s=>{const o=s.withSpan(t);return o.span?n.query(o):[]})}withQueryTime(t){return new ve(n=>this.query(n.withSpan(s=>s.withTime(t))))}withHapSpan(t){return new ve(n=>this.query(n).map(s=>s.withSpan(t)))}withHapTime(t){return this.withHapSpan(n=>n.withTime(t))}withHaps(t){const n=new ve(s=>t(this.query(s),s));return n._steps=this._steps,n}withHap(t){return this.withHaps(n=>n.map(t))}setContext(t){return this.withHap(n=>n.setContext(t))}withContext(t){const n=this.withHap(s=>s.setContext(t(s.context)));return this.__pure!==void 0&&(n.__pure=this.__pure,n.__pure_loc=this.__pure_loc),n}stripContext(){return this.withHap(t=>t.setContext({}))}withLoc(t,n){const s={start:t,end:n},o=this.withContext(r=>{const i=(r.locations||[]).concat([s]);return{...r,locations:i}});return this.__pure&&(o.__pure=this.__pure,o.__pure_loc=s),o}filterHaps(t){return new ve(n=>this.query(n).filter(t))}filterValues(t){return new ve(n=>this.query(n).filter(s=>t(s.value))).setSteps(this._steps)}removeUndefineds(){return this.filterValues(t=>t!=null)}onsetsOnly(){return this.filterHaps(t=>t.hasOnset())}discreteOnly(){return this.filterHaps(t=>t.whole)}defragmentHaps(){return this.discreteOnly().withHaps(n=>{const s=[];for(var o=0;o<n.length;++o){for(var r=!0,i=n[o];r;){const l=JSON.stringify(n[o].value);for(var u=!1,a=o+1;a<n.length;a++){const p=n[a];if(i.whole.equals(p.whole)){if(i.part.begin.eq(p.part.end)){if(l===JSON.stringify(p.value)){i=new ge(i.whole,new be(p.part.begin,i.part.end),i.value),n.splice(a,1),u=!0;break}}else if(p.part.begin.eq(i.part.end)&&l==JSON.stringify(p.value)){i=new ge(i.whole,new be(i.part.begin,p.part.end),i.value),n.splice(a,1),u=!0;break}}}r=u}s.push(i)}return s})}firstCycle(t=!1){var n=this;return t||(n=n.stripContext()),n.query(new Ht(new be(C(0),C(1))))}get firstCycleValues(){return this.firstCycle().map(t=>t.value)}get showFirstCycle(){return this.firstCycle().map(t=>`${t.value}: ${t.whole.begin.toFraction()} - ${t.whole.end.toFraction()}`)}sortHapsByPart(){return this.withHaps(t=>t.sort((n,s)=>n.part.begin.sub(s.part.begin).or(n.part.end.sub(s.part.end)).or(n.whole.begin.sub(s.whole.begin).or(n.whole.end.sub(s.whole.end)))))}asNumber(){return this.fmap(fs)}_opIn(t,n){return this.fmap(n).appLeft(V(t))}_opOut(t,n){return this.fmap(n).appRight(V(t))}_opMix(t,n){return this.fmap(n).appBoth(V(t))}_opSqueeze(t,n){const s=V(t);return this.fmap(o=>s.fmap(r=>n(o)(r))).squeezeJoin()}_opSqueezeOut(t,n){const s=this;return V(t).fmap(r=>s.fmap(i=>n(i)(r))).squeezeJoin()}_opReset(t,n){return V(t).fmap(o=>this.fmap(r=>n(r)(o))).resetJoin()}_opRestart(t,n){return V(t).fmap(o=>this.fmap(r=>n(r)(o))).restartJoin()}_opPoly(t,n){const s=V(t);return this.fmap(o=>s.fmap(r=>n(r)(o))).polyJoin()}layer(...t){return me(...t.map(n=>n(this)))}superimpose(...t){return this.stack(...t.map(n=>n(this)))}stack(...t){return me(this,...t)}sequence(...t){return Qe(this,...t)}seq(...t){return Qe(this,...t)}cat(...t){return mn(this,...t)}fastcat(...t){return Ce(this,...t)}slowcat(...t){return gt(this,...t)}onTrigger(t,n=!0){return this.withHap(s=>s.setContext({...s.context,onTrigger:(...o)=>{s.context.onTrigger?.(...o),t(...o)},dominantTrigger:s.context.dominantTrigger||n}))}log(t=s=>`[hap] ${s.showWhole(!0)}`,n=s=>({hap:s})){return this.onTrigger((...s)=>{Se(t(...s),void 0,n(...s))},!1)}logValues(t=n=>`[hap] ${gs(n,!0)}`){return this.log(n=>t(n.value))}drawLine(){return console.log(Oo(this)),this}unjoin(t,n=Kt){return t.withHap(s=>s.withValue(o=>o?n(this.ribbon(s.whole.begin,s.whole.duration)):this))}into(t,n){return this.unjoin(t,n).innerJoin()}};function $h(e,t){let n=[];return t.forEach(s=>{const o=n.findIndex(([r])=>e(s,r));o===-1?n.push([s]):n[o].push(s)}),n}const ef=(e,t)=>e.spanEquals(t);L.prototype.collect=function(){return this.withHaps(e=>$h(ef,e).map(t=>new ge(t[0].whole,t[0].part,t,{})))};const tf=Z("arpWith",(e,t)=>t.collect().fmap(n=>V(e(n))).innerJoin().withHap(n=>new ge(n.whole,n.part,n.value.value,n.combineContext(n.value)))),nf=Z("arp",(e,t)=>t.arpWith(n=>V(e).fmap(s=>n[s%n.length])),!1);function Nn(e){return!Array.isArray(e)&&typeof e=="object"&&!Uh(e)}function sf(e,t,n){return Nn(e)||Nn(t)?(Nn(e)||(e={value:e}),Nn(t)||(t={value:t}),Qh(e,t,n)):n(e,t)}(function(){const e={set:[(n,s)=>s],keep:[n=>n],keepif:[(n,s)=>s?n:void 0],add:[Ae((n,s)=>n+s)],sub:[Ae((n,s)=>n-s)],mul:[Ae((n,s)=>n*s)],div:[Ae((n,s)=>n/s)],mod:[Ae(pn)],pow:[Ae(Math.pow)],log2:[Ae(Math.log2)],band:[Ae((n,s)=>n&s)],bor:[Ae((n,s)=>n|s)],bxor:[Ae((n,s)=>n^s)],blshift:[Ae((n,s)=>n<<s)],brshift:[Ae((n,s)=>n>>s)],lt:[(n,s)=>n<s],gt:[(n,s)=>n>s],lte:[(n,s)=>n<=s],gte:[(n,s)=>n>=s],eq:[(n,s)=>n==s],eqt:[(n,s)=>n===s],ne:[(n,s)=>n!=s],net:[(n,s)=>n!==s],and:[(n,s)=>n&&s],or:[(n,s)=>n||s],func:[(n,s)=>s(n)]},t=["In","Out","Mix","Squeeze","SqueezeOut","Reset","Restart","Poly"];for(const[n,[s,o]]of Object.entries(e)){L.prototype["_"+n]=function(r){return this.fmap(i=>s(i,r))},Object.defineProperty(L.prototype,n,{get:function(){const r=this,i=(...u)=>r[n].in(...u);for(const u of t)i[u.toLowerCase()]=function(...a){var l=r;a=Qe(a),o&&(l=o(l),a=o(a));var p;return n==="keepif"?(p=l["_op"+u](a,f=>g=>s(f,g)),p=p.removeUndefineds()):p=l["_op"+u](a,f=>g=>sf(f,g,s)),p};return i.squeezein=i.squeeze,i}});for(const r of t)L.prototype[r.toLowerCase()]=function(...i){return this.set[r.toLowerCase()](i)}}L.prototype.struct=function(...n){return this.keepif.out(...n)},L.prototype.structAll=function(...n){return this.keep.out(...n)},L.prototype.mask=function(...n){return this.keepif.in(...n)},L.prototype.maskAll=function(...n){return this.keep.in(...n)},L.prototype.reset=function(...n){return this.keepif.reset(...n)},L.prototype.resetAll=function(...n){return this.keep.reset(...n)},L.prototype.restart=function(...n){return this.keepif.restart(...n)},L.prototype.restartAll=function(...n){return this.keep.restart(...n)}})();const of=me,rf=me,cf=_n,Pt=e=>new L(()=>[],e),se=Pt(1),_e=Pt(0);function Xe(e){function t(s){return s.span.spanCycles.map(o=>new ge(C(o.begin).wholeCycle(),o,e))}const n=new L(t,1);return n.__pure=e,n}function Zs(e){return e instanceof L||e?._Pattern}function V(e){return Zs(e)?e:Gs&&typeof e=="string"?Gs(e):Xe(e)}function Qo(e){let t=Xe([]);for(const n of e)t=t.bind(s=>n.fmap(o=>s.concat([o])));return t}function me(...e){e=e.map(s=>Array.isArray(s)?Qe(...s):V(s));const t=s=>at(e.map(o=>o.query(s))),n=new L(t);return Ne&&(n._steps=Ue(...e.map(s=>s._steps))),n}function ws(e,t){if(t=t.map(r=>Array.isArray(r)?Qe(...r):V(r)),t.length===0)return se;if(t.length===1)return t[0];const[n,...s]=t.map(r=>r._steps),o=Ne?n.maximum(...s):void 0;return me(...e(o,t))}function qo(...e){return ws((t,n)=>n.map(s=>s._steps.eq(t)?s:Ye(s,Pt(t.sub(s._steps)))),e)}function $o(...e){return ws((t,n)=>n.map(s=>s._steps.eq(t)?s:Ye(Pt(t.sub(s._steps)),s)),e)}function er(...e){return ws((t,n)=>n.map(s=>{if(s._steps.eq(t))return s;const o=Pt(t.sub(s._steps).div(2));return Ye(o,s,o)}),e)}function uf(e,...t){const[n,...s]=t.map(i=>i._steps),o=n.maximum(...s),r={centre:er,left:qo,right:$o,expand:me,repeat:(...i)=>_n(...i).steps(o)};return e.inhabit(r).fmap(i=>i(...t)).innerJoin().setSteps(o)}function gt(...e){if(e=e.map(s=>Array.isArray(s)?Ce(...s):V(s)),e.length==1)return e[0];const t=function(s){const o=s.span,r=pn(o.begin.sam(),e.length),i=e[r];if(!i)return[];const u=o.begin.floor().sub(o.begin.div(e.length).floor());return i.withHapTime(a=>a.add(u)).query(s.setSpan(o.withTime(a=>a.sub(u))))},n=Ne?Ue(...e.map(s=>s._steps)):void 0;return new L(t).splitQueries().setSteps(n)}function Ws(...e){e=e.map(V);const t=function(n){const s=Math.floor(n.span.begin)%e.length;return e[s]?.query(n)||[]};return new L(t).splitQueries()}function mn(...e){return gt(...e)}function af(...e){const t=e.reduce((n,[s])=>n+s,0);return e=e.map(([n,s])=>[n,s.fast(n)]),Ye(...e).slow(t)}function lf(...e){let t=C(0);for(let n of e)n.length==2&&n.unshift(t),t=n[1];return me(...e.map(([n,s,o])=>Xe(V(o)).compress(C(n).div(t),C(s).div(t)))).slow(t).innerJoin()}function Ce(...e){let t=gt(...e);return e.length>1&&(t=t._fast(e.length),t._steps=e.length),e.length==1&&e[0].__steps_source&&(e._steps=e[0]._steps),t}function Qe(...e){return Ce(...e)}function tr(...e){return Ce(...e)}function Fs(e){return Array.isArray(e)?e.length==0?[se,0]:e.length==1?Fs(e[0]):[Ce(...e.map(t=>Fs(t)[0])),e.length]:[V(e),1]}const df=D((e,t)=>V(t).mask(e)),pf=D((e,t)=>V(t).struct(e)),hf=D((e,t)=>V(t).superimpose(...e)),ff=D((e,t)=>V(t).withValue(e)),mf=D((e,t)=>V(t).bind(e)),yf=D((e,t)=>V(t).innerBind(e)),bf=D((e,t)=>V(t).outerBind(e)),gf=D((e,t)=>V(t).squeezeBind(e)),Xf=D((e,t)=>V(t).stepBind(e)),Gf=D((e,t)=>V(t).polyBind(e)),Zf=D((e,t)=>V(t).set(e)),wf=D((e,t)=>V(t).keep(e)),Wf=D((e,t)=>V(t).keepif(e)),Ff=D((e,t)=>V(t).add(e)),vf=D((e,t)=>V(t).sub(e)),Vf=D((e,t)=>V(t).mul(e)),Cf=D((e,t)=>V(t).div(e)),Lf=D((e,t)=>V(t).mod(e)),zf=D((e,t)=>V(t).pow(e)),Mf=D((e,t)=>V(t).band(e)),Rf=D((e,t)=>V(t).bor(e)),xf=D((e,t)=>V(t).bxor(e)),Bf=D((e,t)=>V(t).blshift(e)),Sf=D((e,t)=>V(t).brshift(e)),Yf=D((e,t)=>V(t).lt(e)),kf=D((e,t)=>V(t).gt(e)),Tf=D((e,t)=>V(t).lte(e)),Af=D((e,t)=>V(t).gte(e)),Nf=D((e,t)=>V(t).eq(e)),_f=D((e,t)=>V(t).eqt(e)),Kf=D((e,t)=>V(t).ne(e)),Hf=D((e,t)=>V(t).net(e)),Pf=D((e,t)=>V(t).and(e)),Ef=D((e,t)=>V(t).or(e)),Df=D((e,t)=>V(t).func(e));function Z(e,t,n=!0,s=!1,o=r=>r.innerJoin()){if(Array.isArray(e)){const u={};for(const a of e)u[a]=Z(a,t,n,s,o);return u}const r=t.length;var i;return n?i=function(...u){u=u.map(V);const a=u[u.length-1];let l;if(r===1)l=t(a);else{const p=u.slice(0,-1);if(p.every(f=>f.__pure!=null)){const f=p.map(X=>X.__pure),g=p.filter(X=>X.__pure_loc).map(X=>X.__pure_loc);l=t(...f,a),l=l.withContext(X=>{const G=(X.locations||[]).concat(g);return{...X,locations:G}})}else{const[f,...g]=p;let X=(...G)=>t(...G,a);X=D(X,null,r-1),l=o(g.reduce((G,w)=>G.appLeft(w),f.fmap(X)))}}return s&&(l._steps=a._steps),l}:i=function(...u){u=u.map(V);const a=t(...u);return s&&(a._steps=u[u.length-1]._steps),a},L.prototype[e]=function(...u){if(r===2&&u.length!==1)u=[Qe(...u)];else if(r!==u.length+1)throw new Error(`.${e}() expects ${r-1} inputs but got ${u.length}.`);return u=u.map(V),i(...u,this)},r>1&&(L.prototype["_"+e]=function(...u){const a=t(...u,this);return s&&a.setSteps(this._steps),a}),D(i,null,r)}function Et(e,t,n=!0,s=!1,o=r=>r.stepJoin()){return Z(e,t,n,s,o)}const If=Z("round",function(e){return e.asNumber().fmap(t=>Math.round(t))}),Jf=Z("floor",function(e){return e.asNumber().fmap(t=>Math.floor(t))}),jf=Z("ceil",function(e){return e.asNumber().fmap(t=>Math.ceil(t))}),Of=Z("toBipolar",function(e){return e.fmap(t=>t*2-1)}),Uf=Z("fromBipolar",function(e){return e.fmap(t=>(t+1)/2)}),Qf=Z("range",function(e,t,n){return n.mul(t-e).add(e)}),qf=Z("rangex",function(e,t,n){return n._range(Math.log(e),Math.log(t)).fmap(Math.exp)}),$f=Z("range2",function(e,t,n){return n.fromBipolar()._range(e,t)}),em=Z("ratio",e=>e.fmap(t=>Array.isArray(t)?t.slice(1).reduce((n,s)=>n/s,t[0]):t)),tm=Z("compress",function(e,t,n){return e=C(e),t=C(t),e.gt(t)||e.gt(1)||t.gt(1)||e.lt(0)||t.lt(0)?se:n._fastGap(C(1).div(t.sub(e)))._late(e)}),{compressSpan:nm,compressspan:sm}=Z(["compressSpan","compressspan"],function(e,t){return t._compress(e.begin,e.end)}),{fastGap:om,fastgap:rm}=Z(["fastGap","fastgap"],function(e,t){const n=function(o){const r=o.begin.sam(),i=o.begin.sub(r).mul(e).min(1),u=o.end.sub(r).mul(e).min(1);if(!(i>=1))return new be(r.add(i),r.add(u))},s=function(o){const r=o.part.begin,i=o.part.end,u=r.sam(),a=r.sub(u).div(e).min(1),l=i.sub(u).div(e).min(1),p=new be(u.add(a),u.add(l)),f=o.whole?new be(p.begin.sub(r.sub(o.whole.begin).div(e)),p.end.add(o.whole.end.sub(i).div(e))):void 0;return new ge(f,p,o.value,o.context)};return t.withQuerySpanMaybe(n).withHap(s).splitQueries()}),cm=Z("focus",function(e,t,n){return e=C(e),t=C(t),n._early(e.sam())._fast(C(1).div(t.sub(e)))._late(e)}),{focusSpan:im,focusspan:um}=Z(["focusSpan","focusspan"],function(e,t){return t._focus(e.begin,e.end)}),am=Z("ply",function(e,t){const n=t.fmap(s=>Xe(s)._fast(e)).squeezeJoin();return Ne&&(n._steps=C(e).mulmaybe(t._steps)),n}),{fast:lm,density:rG}=Z(["fast","density"],function(e,t){return e===0?se:(e=C(e),t.withQueryTime(s=>s.mul(e)).withHapTime(s=>s.div(e)).setSteps(t._steps))},!0,!0),dm=Z("hurry",function(e,t){return t._fast(e).mul(Xe({speed:e}))}),{slow:pm,sparsity:hm}=Z(["slow","sparsity"],function(e,t){return e===0?se:t._fast(C(1).div(e))}),fm=Z("inside",function(e,t,n){return t(n._slow(e))._fast(e)}),mm=Z("outside",function(e,t,n){return t(n._fast(e))._slow(e)}),ym=Z("lastOf",function(e,t,n){const s=Array(e-1).fill(n);return s.push(t(n)),Ws(...s)}),{firstOf:bm,every:gm}=Z(["firstOf","every"],function(e,t,n){const s=Array(e-1).fill(n);return s.unshift(t(n)),Ws(...s)}),Xm=Z("apply",function(e,t){return e(t)}),Gm=Z("cpm",function(e,t){return t._fast(e/60/1)}),Zm=Z("early",function(e,t){return e=C(e),t.withQueryTime(n=>n.add(e)).withHapTime(n=>n.sub(e))},!0,!0),nr=Z("late",function(e,t){return e=C(e),t._early(C(0).sub(e))},!0,!0),wm=Z("zoom",function(e,t,n){if(t=C(t),e=C(e),e.gte(t))return _e;const s=t.sub(e),o=Ne?n._steps?.mulmaybe(s):void 0;return n.withQuerySpan(r=>r.withCycle(i=>i.mul(s).add(e))).withHapSpan(r=>r.withCycle(i=>i.sub(e).div(s))).splitQueries().setSteps(o)}),{zoomArc:Wm,zoomarc:Fm}=Z(["zoomArc","zoomarc"],function(e,t){return t.zoom(e.begin,e.end)}),vm=Z("bite",(e,t,n)=>t.fmap(s=>o=>{const r=C(s).div(o).mod(1),i=r.add(C(1).div(o));return n.zoom(r,i)}).appLeft(e).squeezeJoin(),!1),Vm=Z("linger",function(e,t){return e==0?se:e<0?t._zoom(e.add(1),1)._slow(e):t._zoom(0,e)._slow(e)},!0,!0),{segment:Cm,seg:Lm}=Z(["segment","seg"],function(e,t){return t.struct(Xe(!0)._fast(e)).setSteps(e)}),zm=Z("swingBy",(e,t,n)=>n.inside(t,nr(tr(0,e/2)))),Mm=Z("swing",(e,t)=>t.swingBy(1/3,e)),{invert:Rm,inv:xm}=Z(["invert","inv"],function(e){return e.fmap(t=>!t)},!0,!0),Bm=Z("when",function(e,t,n){return e?t(n):n}),Sm=Z("off",function(e,t,n){return me(n,t(n.late(e)))}),Ym=Z("brak",function(e){return e.when(gt(!1,!0),t=>Ce(t,se)._late(.25))}),sr=Z("rev",function(e){const t=function(n){const s=n.span,o=s.begin.sam(),r=s.begin.nextSam(),i=function(a){const l=a.withTime(f=>o.add(r.sub(f))),p=l.begin;return l.begin=l.end,l.end=p,l};return e.query(n.setSpan(i(s))).map(a=>a.withSpan(i))};return new L(t).splitQueries()},!1,!0),km=Z("revv",function(e){const t=n=>new be(C(0).sub(n.end),C(0).sub(n.begin));return e.withQuerySpan(t).withHapSpan(t)}),Tm=Z("pressBy",function(e,t){return t.fmap(n=>Xe(n).compress(e,1)).squeezeJoin()}),Am=Z("press",function(e){return e._pressBy(.5)});L.prototype.hush=function(){return se};const Nm=Z("palindrome",function(e){return e.lastOf(2,sr)},!0,!0),{juxBy:_m,juxby:Km}=Z(["juxBy","juxby"],function(e,t,n){e/=2;const s=function(i,u,a){return u in i?i[u]:a},o=n.withValue(i=>Object.assign({},i,{pan:s(i,"pan",.5)-e})),r=t(n.withValue(i=>Object.assign({},i,{pan:s(i,"pan",.5)+e})));return me(o,r).setSteps(Ne?Ue(o._steps,r._steps):void 0)}),Hm=Z("jux",function(e,t){return t._juxBy(1,e,t)}),{echoWith:Pm,echowith:Em,stutWith:Dm,stutwith:Im}=Z(["echoWith","echowith","stutWith","stutwith"],function(e,t,n,s){return me(...hn(0,e-1).map(o=>n(s.late(C(t).mul(o)),o)))}),Jm=Z("echo",function(e,t,n,s){return s._echoWith(e,t,(o,r)=>o.gain(Math.pow(n,r)))}),jm=Z("stut",function(e,t,n,s){return s._echoWith(e,n,(o,r)=>o.gain(Math.pow(t,r)))}),or=Z("applyN",function(e,t,n){let s=n;for(let o=0;o<e;o++)s=t(s);return s}),Om=Z(["plyWith","plywith"],function(e,t,n){const s=n.fmap(o=>mn(...hn(0,e-1).map(r=>or(r,t,o)))._fast(e)).squeezeJoin();return Ne&&(s._steps=C(e).mulmaybe(n._steps)),s}),Um=Z(["plyForEach","plyforeach"],function(e,t,n){const s=n.fmap(o=>mn(mn(Xe(o),...hn(1,e-1).map(r=>t(Xe(o),r))))._fast(e)).squeezeJoin();return Ne&&(s._steps=C(e).mulmaybe(n._steps)),s}),vs=function(e,t,n=!1){return e=C(e),gt(...hn(0,e.sub(1)).map(s=>n?t.late(C(s).div(e)):t.early(C(s).div(e))))},Qm=Z("iter",function(e,t){return vs(e,t,!1)},!0,!0),{iterBack:qm,iterback:$m}=Z(["iterBack","iterback"],function(e,t){return vs(e,t,!0)},!0,!0),{repeatCycles:e1}=Z("repeatCycles",function(e,t){return new L(function(n){const s=n.span.begin.sam(),o=s.div(e).sam(),r=s.sub(o);return n=n.withSpan(i=>i.withTime(u=>u.sub(r))),t.query(n).map(i=>i.withSpan(u=>u.withTime(a=>a.add(r))))}).splitQueries()},!0,!0),Vs=function(e,t,n,s=!1,o=!1){const r=Array(e-1).fill(!1);r.unshift(!0);const i=vs(e,Qe(...r),!s);return o||(n=n.repeatCycles(e)),n.when(i,t)},{chunk:t1,slowchunk:n1,slowChunk:s1}=Z(["chunk","slowchunk","slowChunk"],function(e,t,n){return Vs(e,t,n,!1,!1)},!0,!0),{chunkBack:o1,chunkback:r1}=Z(["chunkBack","chunkback"],function(e,t,n){return Vs(e,t,n,!0)},!0,!0),{fastchunk:c1,fastChunk:i1}=Z(["fastchunk","fastChunk"],function(e,t,n){return Vs(e,t,n,!1,!0)},!0,!0),{chunkinto:u1,chunkInto:a1}=Z(["chunkinto","chunkInto"],function(e,t,n){return n.into(Ce(!0,...Array(e-1).fill(!1))._iterback(e),t)}),{chunkbackinto:l1,chunkBackInto:d1}=Z(["chunkbackinto","chunkBackInto"],function(e,t,n){return n.into(Ce(!0,...Array(e-1).fill(!1))._iter(e)._early(1),t)}),p1=Z("bypass",function(e,t){return e=!!parseInt(e),e?se:t},!0,!0),{ribbon:h1,rib:f1}=Z(["ribbon","rib"],(e,t,n)=>n.early(e).restart(Xe(1).slow(t))),m1=Z("hsla",(e,t,n,s,o)=>o.color(`hsla(${e}turn,${t*100}%,${n*100}%,${s})`)),y1=Z("hsl",(e,t,n,s)=>s.color(`hsl(${e}turn,${t*100}%,${n*100}%)`));L.prototype.tag=function(e){return this.withContext(t=>({...t,tags:(t.tags||[]).concat([e])}))};const b1=Z("filter",(e,t)=>t.withHaps(n=>n.filter(e))),g1=Z("filterWhen",(e,t)=>t.filter(n=>e(n.whole.begin))),X1=Z("within",(e,t,n,s)=>me(n(s.filterWhen(o=>o.cyclePos()>=e&&o.cyclePos()<=t)),s.filterWhen(o=>o.cyclePos()<e||o.cyclePos()>t)));L.prototype.stepJoin=function(){const e=this,t=Ye(...Cs(Ls(e.queryArc(0,1))))._steps,n=function(s){const r=e.early(s.span.begin.sam()).query(s.setSpan(new be(C(0),C(1))));return Ye(...Cs(Ls(r))).query(s)};return new L(n,t)},L.prototype.stepBind=function(e){return this.fmap(e).stepJoin()};function Cs(e){const t=e.filter((r,i)=>i.hasSteps).reduce((r,i)=>r.add(i),C(0)),n=_t(e.map((r,i)=>i._steps)).reduce((r,i)=>r.add(i),C(0)),s=t.eq(0)?void 0:n.div(t);function o(r,i){return i._steps===void 0?[r.mulmaybe(s),i]:[i._steps,i]}return e.map(r=>o(...r))}function Ls(e){const t=at(e.map(o=>[o.part.begin,o.part.end])),n=Ho([C(0),C(1),...t]);return Ko(n).map(o=>[o[1].sub(o[0]),me(...rr(new be(...o),e).map(r=>r.value.withHap(i=>i.setContext(i.combineContext(r)))))])}function rr(e,t){return _t(t.map(n=>cr(e,n)))}function cr(e,t){const n=e.intersection(t.part);if(n!=null)return new ge(t.whole,n,t.value,t.context)}const ir=Z("pace",function(e,t){return t._steps===void 0?t:t._steps.eq(C(0))?_e:t._fast(C(e).div(t._steps)).setSteps(e)});function ur(e,...t){const n=t.map(o=>Fs(o));if(n.length==0)return se;e==0&&(e=n[0][1]);const s=[];for(const o of n)o[1]!=0&&(e==o[1]?s.push(o[0]):s.push(o[0]._fast(C(e).div(C(o[1])))));return me(...s)}function _n(...e){if(Array.isArray(e[0]))return ur(0,...e);if(e=e.filter(s=>s.hasSteps),e.length==0)return se;const t=Ue(...e.map(s=>s._steps));if(t.eq(C(0)))return _e;const n=me(...e.map(s=>s.pace(t)));return n._steps=t,n}function Ye(...e){if(e.length===0)return _e;const t=i=>Array.isArray(i)?i:[i._steps??1,i];if(e=e.map(t),e.find(i=>i[0]===void 0)){const i=e.map(a=>a[0]).filter(a=>a!==void 0);if(i.length===0)return Ce(...e.map(a=>a[1]));if(i.length===e.length)return _e;const u=i.reduce((a,l)=>a.add(l),C(0)).div(i.length);for(let a of e)a[0]===void 0&&(a[0]=u)}if(e.length==1)return V(e[0][1]).withSteps(u=>e[0][0]);const n=e.map(i=>i[0]).reduce((i,u)=>i.add(u),C(0));let s=C(0);const o=[];for(const[i,u]of e){if(C(i).eq(0))continue;const a=s.add(i);o.push(V(u)._compress(s.div(n),a.div(n))),s=a}const r=me(...o);return r._steps=n,r}function ar(...e){e=e.map(o=>Array.isArray(o)?o.map(V):[V(o)]);const t=Ue(...e.map(o=>C(o.length)));let n=[];for(let o=0;o<t;++o)n.push(...e.map(r=>r.length==0?se:r[o%r.length]));n=n.filter(o=>o.hasSteps&&o._steps>0);const s=n.reduce((o,r)=>o.add(r._steps),C(0));return n=Ye(...n),n._steps=s,n}const lr=Et("take",function(e,t){if(!t.hasSteps||t._steps.lte(0)||(e=C(e),e.eq(0)))return _e;const n=e<0;n&&(e=e.abs());const s=e.div(t._steps);return s.lte(0)?_e:s.gte(1)?t:n?t.zoom(C(1).sub(s),1):t.zoom(0,s)}),dr=Et("drop",function(e,t){return t.hasSteps?(e=C(e),e.lt(0)?t.take(t._steps.add(e)):t.take(C(0).sub(t._steps.sub(e)))):_e}),pr=Et("extend",function(e,t){return t.fast(e).expand(e)}),G1=Et("replicate",function(e,t){return t.repeatCycles(e).fast(e).expand(e)}),hr=Et("expand",function(e,t){return t.withSteps(n=>n.mul(C(e)))}),fr=Et("contract",function(e,t){return t.withSteps(n=>n.div(C(e)))});L.prototype.shrinklist=function(e){const t=this;if(!t.hasSteps)return[t];let[n,s]=Array.isArray(e)?e:[e,t._steps];if(n=C(n),s===0||n===0)return[t];const o=n>0,r=[];if(o){const i=C(1).div(t._steps).mul(n);for(let u=0;u<s;++u){const a=i.mul(u);if(a.gt(1))break;r.push([a,1])}}else{n=C(0).sub(n);const i=C(1).div(t._steps).mul(n);for(let u=0;u<s;++u){const a=C(1).sub(i.mul(u));if(a.lt(0))break;r.push([C(0),a])}}return r.map(i=>t.zoom(...i))};const mr=(e,t)=>t.shrinklist(e),yr=Z("shrink",function(e,t){if(!t.hasSteps)return _e;const n=t.shrinklist(e),s=Ye(...n);return s._steps=n.reduce((o,r)=>o.add(r._steps),C(0)),s},!0,!1,e=>e.stepJoin()),Z1=Z("grow",function(e,t){if(!t.hasSteps)return _e;const n=t.shrinklist(C(0).sub(e));n.reverse();const s=Ye(...n);return s._steps=n.reduce((o,r)=>o.add(r._steps),C(0)),s},!0,!1,e=>e.stepJoin()),br=function(e,...t){return e.tour(...t)};L.prototype.tour=function(...e){return Ye(...[].concat(...e.map((t,n)=>[...e.slice(0,e.length-n),this,...e.slice(e.length-n)]),this,...e))};const gr=function(...e){e=e.filter(s=>s.hasSteps);const t=gt(...e.map(s=>s._slow(s._steps))),n=Ue(...e.map(s=>s._steps));return t._fast(n).setSteps(n)},w1=Ye,zs=Ye,W1=Ye,F1=ar,v1=_n;L.prototype.s_polymeter=L.prototype.polymeter;const V1=yr;L.prototype.s_taper=L.prototype.shrink;const C1=mr;L.prototype.s_taperlist=L.prototype.shrinklist;const L1=lr;L.prototype.s_add=L.prototype.take;const z1=dr;L.prototype.s_sub=L.prototype.drop;const M1=hr;L.prototype.s_expand=L.prototype.expand;const R1=pr;L.prototype.s_extend=L.prototype.extend;const x1=fr;L.prototype.s_contract=L.prototype.contract;const B1=br;L.prototype.s_tour=L.prototype.tour;const S1=gr;L.prototype.s_zip=L.prototype.zip;const Y1=ir;L.prototype.steps=L.prototype.pace;const k1=Z("chop",function(e,t){const s=Array.from({length:e},(i,u)=>u).map(i=>({begin:i/e,end:(i+1)/e})),o=function(i,u){if("begin"in i&&"end"in i&&i.begin!==void 0&&i.end!==void 0){const a=i.end-i.begin;u={begin:i.begin+u.begin*a,end:i.begin+u.end*a}}return Object.assign({},i,u)},r=function(i){return Qe(s.map(u=>o(i,u)))};return t.squeezeBind(r).setSteps(Ne?C(e).mulmaybe(t._steps):void 0)}),T1=Z("striate",function(e,t){const s=Array.from({length:e},(r,i)=>i).map(r=>({begin:r/e,end:(r+1)/e})),o=gt(...s);return t.set(o)._fast(e).setSteps(Ne?C(e).mulmaybe(t._steps):void 0)}),Xr=function(e,t,n=.5){return t.speed(1/e*n).unit("c").slow(e)},Gr=Z("slice",function(e,t,n){return e.innerBind(s=>t.outerBind(o=>n.outerBind(r=>{r=r instanceof Object?r:{s:r};const i=Array.isArray(s)?s[o]:o/s,u=Array.isArray(s)?s[o+1]:(o+1)/s;return Xe({begin:i,end:u,_slices:s,...r})}))).setSteps(t._steps)},!1);L.prototype.onTriggerTime=function(e){return this.onTrigger((t,n,s,o)=>{const r=o-n;window.setTimeout(()=>{e(t)},r*1e3)},!1)};const A1=Z("splice",function(e,t,n){const s=Gr(e,t,n);return new L(o=>{const r=o.controls._cps||1;return s.query(o).map(u=>u.withValue(a=>({speed:r/a._slices/u.whole.duration*(a.speed||1),unit:"c",...a})))}).setSteps(t._steps)},!1),{loopAt:N1,loopat:_1}=Z(["loopAt","loopat"],function(e,t){const n=t._steps?t._steps.div(e):void 0;return new L(s=>Xr(e,t,s.controls._cps).query(s),n)}),K1=Z("fit",e=>e.withHaps((t,n)=>t.map(s=>s.withValue(o=>{const r=("end"in o?o.end:1)-("begin"in o?o.begin:0);return{...o,speed:(n.controls._cps||1)/s.whole.duration*r,unit:"c"}})))),{loopAtCps:H1,loopatcps:P1}=Z(["loopAtCps","loopatcps"],function(e,t,n){return Xr(e,n,t)}),E1=e=>Xe(1).withValue(()=>V(e())).innerJoin();let Zr=e=>e<.5?1:1-(e-.5)/.5,wr=(e,t,n)=>{t=V(t),e=V(e),n=V(n);let s=t.fmap(r=>({gain:Zr(r)})),o=t.fmap(r=>({gain:Zr(1-r)}));return me(e.mul(s),n.mul(o))};L.prototype.xfade=function(e,t){return wr(this,e,t)};const D1=e=>(t,n,s)=>{t=C(t).mod(n),n=C(n);const o=t.div(n),r=t.add(1).div(n);return e(s.fmap(i=>Xe(i)._compress(o,r)))},{beat:I1}=Z(["beat"],D1(e=>e.innerJoin())),Ms=(e,t,n)=>{n=C(n);const s=C(1).div(e.length),o=u=>{const a=[];for(const[l,p]of u.entries())p&&a.push([C(l).div(u.length),p]);return a},r=Tn(([u,a],[l,p])=>{const f=n.mul(l-u).add(u),g=f.add(s);return new be(f,g)},o(e),o(t));function i(u){const a=u.span.begin.sam(),l=u.span.cycleArc(),p=[];for(const f of r){const g=f.intersection(l);g!==void 0&&p.push(new ge(f.withTime(X=>X.add(a)),g.withTime(X=>X.add(a)),!0))}return p}return new L(i).splitQueries()},J1=(e,t,n)=>(e=V(e),t=V(t),n=V(n),e.innerBind(s=>t.innerBind(o=>n.innerBind(r=>Ms(s,o,r))))),j1=["scurve","soft","hard","cubic","diode","asym","fold","sinefold","chebyshev"];for(const e of j1)L.prototype[e]=function(t){const n=V(t).fmap(s=>Array.isArray(s)?[...s,e]:[s,1,e]);return this.distort(n)};const Wr=e=>{let n=Xe(D((...s)=>s,null,e.length));for(const s of e)n=n.appBoth(V(s));return n},Kn=e=>Array.isArray(e)?Wr(e):V(e);L.prototype.partials=function(e){return this.withValue(t=>n=>({...t,partials:n})).appLeft(Kn(e))};const O1=e=>Kn(e).as("partials");L.prototype.phases=function(e){return this.withValue(t=>n=>({...t,phases:n})).appLeft(Kn(e))};const U1=e=>Kn(e).as("phases");function Hn(e){let t=Array.isArray(e);e=t?e:[e];const n=e[0],s=r=>{let i;if(typeof r=="object"&&r.value!==void 0&&(i={...r},r=r.value,delete i.value),t&&Array.isArray(r)){const u=i||{};return r.forEach((a,l)=>{l<e.length&&(u[e[l]]=a)}),u}else return i?(i[n]=r,i):{[n]:r}},o=function(r,i){return i?typeof r>"u"?i.fmap(s):i.set(V(r).withValue(s)):V(r).withValue(s)};return L.prototype[n]=function(r){return o(r,this)},o}const yn=new Map;function Fr(e){return yn.has(e)}function h(e,...t){const n=Array.isArray(e)?e[0]:e;let s={};return s[n]=Hn(e),yn.set(n,n),t.forEach(o=>{s[o]=s[n],yn.set(o,n),L.prototype[o]=L.prototype[n]}),s}const{s:vr,sound:Vr}=h(["s","n","gain"],"sound"),{wt:Cr,wavetablePosition:Lr}=h("wt","wavetablePosition"),{wtenv:zr}=h("wtenv"),{wtattack:Mr,wtatt:Rr}=h("wtattack","wtatt"),{wtdecay:xr,wtdec:Br}=h("wtdecay","wtdec"),{wtsustain:Sr,wtsus:Yr}=h("wtsustain","wtsus"),{wtrelease:kr,wtrel:Tr}=h("wtrelease","wtrel"),{wtrate:Ar}=h("wtrate"),{wtsync:Nr}=h("wtsync"),{wtdepth:_r}=h("wtdepth"),{wtshape:Kr}=h("wtshape"),{wtdc:Hr}=h("wtdc"),{wtskew:Pr}=h("wtskew"),{warp:Er,wavetableWarp:Dr}=h("warp","wavetableWarp"),{warpattack:Ir,warpatt:Jr}=h("warpattack","warpatt"),{warpdecay:jr,warpdec:Or}=h("warpdecay","warpdec"),{warpsustain:Ur,warpsus:Qr}=h("warpsustain","warpsus"),{warprelease:qr,warprel:$r}=h("warprelease","warprel"),{warprate:ec}=h("warprate"),{warpdepth:tc}=h("warpdepth"),{warpshape:nc}=h("warpshape"),{warpdc:sc}=h("warpdc"),{warpskew:oc}=h("warpskew"),{warpmode:rc,wavetableWarpMode:cc}=h("warpmode","wavetableWarpMode"),{wtphaserand:ic,wavetablePhaseRand:uc}=h("wtphaserand","wavetablePhaseRand"),{warpenv:ac}=h("warpenv"),{warpsync:lc}=h("warpsync"),{source:dc,src:pc}=h("source","src"),{n:hc}=h("n"),{note:fc}=h(["note","n"]),{accelerate:mc}=h("accelerate"),{velocity:yc}=h("velocity"),{gain:bc}=h("gain"),{postgain:gc}=h("postgain"),{amp:Xc}=h("amp"),{attack:Gc,att:Zc}=h("attack","att"),{fmh:wc}=h(["fmh","fmi"],"fmh"),{fmi:Wc,fm:Fc}=h(["fmi","fmh"],"fm"),{fmenv:vc}=h("fmenv"),{fmattack:Vc}=h("fmattack"),{fmwave:Cc}=h("fmwave"),{fmdecay:Lc}=h("fmdecay"),{fmsustain:zc}=h("fmsustain"),{fmrelease:Mc}=h("fmrelease"),{fmvelocity:Rc}=h("fmvelocity"),{bank:xc}=h("bank"),{chorus:Bc}=h("chorus"),{analyze:Sc}=h("analyze"),{fft:Yc}=h("fft"),{decay:kc,dec:Tc}=h("decay","dec"),{sustain:Ac,sus:Nc}=h("sustain","sus"),{release:_c,rel:Kc}=h("release","rel"),{hold:Hc}=h("hold"),{bandf:Pc,bpf:Ec,bp:Dc}=h(["bandf","bandq","bpenv"],"bpf","bp"),{bandq:Ic,bpq:Jc}=h("bandq","bpq"),{begin:jc}=h("begin"),{end:Oc}=h("end"),{loop:Uc}=h("loop"),{loopBegin:Qc,loopb:qc}=h("loopBegin","loopb"),{loopEnd:$c,loope:ei}=h("loopEnd","loope"),{crush:ti}=h("crush"),{coarse:ni}=h("coarse"),{tremolo:si}=h(["tremolo","tremolodepth","tremoloskew","tremolophase"],"trem"),{tremolosync:oi}=h(["tremolosync","tremolodepth","tremoloskew","tremolophase"],"tremsync"),{tremolodepth:ri}=h("tremolodepth","tremdepth"),{tremoloskew:ci}=h("tremoloskew","tremskew"),{tremolophase:ii}=h("tremolophase","tremphase"),{tremoloshape:ui}=h("tremoloshape","tremshape"),{drive:ai}=h("drive"),{duck:li}=h("duckorbit","duck"),{duckdepth:di}=h("duckdepth"),{duckonset:pi}=h("duckonset","duckons"),{duckattack:hi}=h("duckattack","duckatt"),{byteBeatExpression:fi,bbexpr:mi}=h("byteBeatExpression","bbexpr"),{byteBeatStartTime:yi,bbst:bi}=h("byteBeatStartTime","bbst"),{channels:gi,ch:Xi}=h("channels","ch"),{pw:Gi}=h(["pw","pwrate","pwsweep"]),{pwrate:Zi}=h("pwrate"),{pwsweep:wi}=h("pwsweep"),{phaserrate:Wi,ph:Fi,phaser:vi}=h(["phaserrate","phaserdepth","phasercenter","phasersweep"],"ph","phaser"),{phasersweep:Vi,phs:Ci}=h("phasersweep","phs"),{phasercenter:Li,phc:zi}=h("phasercenter","phc"),{phaserdepth:Mi,phd:Ri,phasdp:xi}=h("phaserdepth","phd","phasdp"),{channel:Bi}=h("channel"),{cut:Si}=h("cut"),{cutoff:Yi,ctf:ki,lpf:Ti,lp:Ai}=h(["cutoff","resonance","lpenv"],"ctf","lpf","lp"),{lpenv:Ni,lpe:_i}=h("lpenv","lpe"),{hpenv:Ki,hpe:Hi}=h("hpenv","hpe"),{bpenv:Pi,bpe:Ei}=h("bpenv","bpe"),{lpattack:Di,lpa:Ii}=h("lpattack","lpa"),{hpattack:Ji,hpa:ji}=h("hpattack","hpa"),{bpattack:Oi,bpa:Ui}=h("bpattack","bpa"),{lpdecay:Qi,lpd:qi}=h("lpdecay","lpd"),{hpdecay:$i,hpd:eu}=h("hpdecay","hpd"),{bpdecay:tu,bpd:nu}=h("bpdecay","bpd"),{lpsustain:su,lps:ou}=h("lpsustain","lps"),{hpsustain:ru,hps:cu}=h("hpsustain","hps"),{bpsustain:iu,bps:uu}=h("bpsustain","bps"),{lprelease:au,lpr:lu}=h("lprelease","lpr"),{hprelease:du,hpr:pu}=h("hprelease","hpr"),{bprelease:hu,bpr:fu}=h("bprelease","bpr"),{ftype:mu}=h("ftype"),{fanchor:yu}=h("fanchor"),{lprate:bu}=h("lprate"),{lpsync:gu}=h("lpsync"),{lpdepth:Xu}=h("lpdepth"),{lpdepthfrequency:Gu}=h("lpdepthfrequency","lpdepthfreq"),{lpshape:Zu}=h("lpshape"),{lpdc:wu}=h("lpdc"),{lpskew:Wu}=h("lpskew"),{bprate:Fu}=h("bprate"),{bpsync:vu}=h("bpsync"),{bpdepth:Vu}=h("bpdepth"),{bpdepthfrequency:Cu}=h("bpdepthfrequency","bpdepthfreq"),{bpshape:Lu}=h("bpshape"),{bpdc:zu}=h("bpdc"),{bpskew:Mu}=h("bpskew"),{hprate:Ru}=h("hprate"),{hpsync:xu}=h("hpsync"),{hpdepth:Bu,hpdepthfreq:Su}=h("hpdepth"),{hpdepthfrequency:Yu}=h("hpdepthfrequency","hpdepthfreq"),{hpshape:ku}=h("hpshape"),{hpdc:Tu}=h("hpdc"),{hpskew:Au}=h("hpskew"),{vib:Nu,vibrato:_u,v:Ku}=h(["vib","vibmod"],"vibrato","v"),{noise:Hu}=h("noise"),{vibmod:Pu,vmod:Eu}=h(["vibmod","vib"],"vmod"),{hcutoff:Du,hpf:Iu,hp:Ju}=h(["hcutoff","hresonance","hpenv"],"hpf","hp"),{hresonance:ju,hpq:Ou}=h("hresonance","hpq"),{resonance:Uu,lpq:Qu}=h("resonance","lpq"),{djf:qu}=h("djf"),{delay:$u}=h(["delay","delaytime","delayfeedback"]),{delayfeedback:ea,delayfb:ta,dfb:na}=h("delayfeedback","delayfb","dfb"),{delayspeed:sa}=h("delayspeed"),{delaytime:oa,delayt:ra,dt:ca}=h("delaytime","delayt","dt"),{delaysync:ia}=h("delaysync"),{lock:ua}=h("lock"),{detune:aa,det:la}=h("detune","det"),{unison:da}=h("unison"),{spread:pa}=h("spread"),{dry:ha}=h("dry"),{fadeTime:fa,fadeOutTime:ma}=h("fadeTime","fadeOutTime"),{fadeInTime:ya}=h("fadeInTime"),{freq:ba}=h("freq"),{pattack:ga,patt:Xa}=h("pattack","patt"),{pdecay:Ga,pdec:Za}=h("pdecay","pdec"),{psustain:wa,psus:Wa}=h("psustain","psus"),{prelease:Fa,prel:va}=h("prelease","prel"),{penv:Va}=h("penv"),{pcurve:Ca}=h("pcurve"),{panchor:La}=h("panchor"),{gate:za,gat:Ma}=h("gate","gat"),{leslie:Ra}=h("leslie"),{lrate:xa}=h("lrate"),{lsize:Ba}=h("lsize"),{activeLabel:Sa}=h("activeLabel"),{label:Ya}=h(["label","activeLabel"]),{degree:ka}=h("degree"),{mtranspose:Ta}=h("mtranspose"),{ctranspose:Aa}=h("ctranspose"),{harmonic:Na}=h("harmonic"),{stepsPerOctave:_a}=h("stepsPerOctave"),{octaveR:Ka}=h("octaveR"),{nudge:Ha}=h("nudge"),{octave:Pa,oct:Ea}=h("octave","oct"),{orbit:Da}=h("orbit","o"),{overgain:Ia}=h("overgain"),{overshape:Ja}=h("overshape"),{pan:ja}=h("pan"),{panspan:Oa}=h("panspan"),{pansplay:Ua}=h("pansplay"),{panwidth:Qa}=h("panwidth"),{panorient:qa}=h("panorient"),{rate:$a}=h("rate"),{slide:el}=h("slide"),{semitone:tl}=h("semitone"),{voice:nl}=h("voice"),{chord:sl}=h("chord"),{dictionary:ol,dict:rl}=h("dictionary","dict"),{anchor:cl}=h("anchor"),{offset:il}=h("offset"),{octaves:ul}=h("octaves"),{mode:al}=h(["mode","anchor"]),{room:ll}=h(["room","size"]),{roomlp:dl,rlp:pl}=h("roomlp","rlp"),{roomdim:hl,rdim:fl}=h("roomdim","rdim"),{roomfade:ml,rfade:yl}=h("roomfade","rfade"),{ir:bl,iresponse:gl}=h(["ir","i"],"iresponse"),{irspeed:Xl}=h("irspeed"),{irbegin:Gl}=h("irbegin"),{roomsize:Zl,size:wl,sz:Wl,rsize:Fl}=h("roomsize","size","sz","rsize"),{shape:vl}=h(["shape","shapevol"]),{distort:Vl,dist:Cl}=h(["distort","distortvol","distorttype"],"dist"),{distortvol:Ll}=h("distortvol","distvol"),{distorttype:zl}=h("distorttype","disttype"),{compressor:Ml}=h(["compressor","compressorRatio","compressorKnee","compressorAttack","compressorRelease"]),{compressorKnee:Rl}=h("compressorKnee"),{compressorRatio:xl}=h("compressorRatio"),{compressorAttack:Bl}=h("compressorAttack"),{compressorRelease:Sl}=h("compressorRelease"),{speed:Rs}=h("speed"),{stretch:Yl}=h("stretch"),{unit:kl}=h("unit"),{squiz:Tl}=h("squiz"),{vowel:Al}=h("vowel"),{waveloss:Nl}=h("waveloss"),{density:Q1}=h("density"),{expression:_l}=h("expression"),{sustainpedal:Kl}=h("sustainpedal"),{fshift:Hl}=h("fshift"),{fshiftnote:Pl}=h("fshiftnote"),{fshiftphase:El}=h("fshiftphase"),{triode:Dl}=h("triode"),{krush:Il}=h("krush"),{kcutoff:Jl}=h("kcutoff"),{octer:jl}=h("octer"),{octersub:Ol}=h("octersub"),{octersubsub:Ul}=h("octersubsub"),{ring:Ql}=h("ring"),{ringf:ql}=h("ringf"),{ringdf:$l}=h("ringdf"),{freeze:ed}=h("freeze"),{xsdelay:td}=h("xsdelay"),{tsdelay:nd}=h("tsdelay"),{real:sd}=h("real"),{imag:od}=h("imag"),{enhance:rd}=h("enhance"),{comb:cd}=h("comb"),{smear:id}=h("smear"),{scram:ud}=h("scram"),{binshift:ad}=h("binshift"),{hbrick:ld}=h("hbrick"),{lbrick:dd}=h("lbrick"),{frameRate:pd}=h("frameRate"),{frames:hd}=h("frames"),{hours:fd}=h("hours"),{minutes:md}=h("minutes"),{seconds:yd}=h("seconds"),{songPtr:bd}=h("songPtr"),{uid:gd}=h("uid"),{val:Xd}=h("val"),{cps:Gd}=h("cps"),{clip:Zd,legato:wd}=h("clip","legato"),{duration:Wd,dur:Fd}=h("duration","dur"),{zrand:vd}=h("zrand"),{curve:Vd}=h("curve"),{deltaSlide:Cd}=h("deltaSlide"),{pitchJump:Ld}=h("pitchJump"),{pitchJumpTime:zd}=h("pitchJumpTime"),{lfo:Md,repeatTime:Rd}=h("lfo","repeatTime"),{znoise:xd}=h("znoise"),{zmod:Bd}=h("zmod"),{zcrush:Sd}=h("zcrush"),{zdelay:Yd}=h("zdelay"),{zzfx:kd}=h("zzfx"),{color:Td,colour:Ad}=h(["color","colour"]);let xs=(...e)=>e.reduce((t,n)=>Object.assign(t,{[n]:Hn(n)}),{});const Nd=Z("adsr",(e,t)=>{e=Array.isArray(e)?e:[e];const[n,s,o,r]=e;return t.set({attack:n,decay:s,sustain:o,release:r})}),_d=Z("ad",(e,t)=>{e=Array.isArray(e)?e:[e];const[n,s=n]=e;return t.attack(n).decay(s)}),Kd=Z("ds",(e,t)=>{e=Array.isArray(e)?e:[e];const[n,s=0]=e;return t.set({decay:n,sustain:s})}),Hd=Z("ar",(e,t)=>{e=Array.isArray(e)?e:[e];const[n,s=n]=e;return t.set({attack:n,release:s})}),{midichan:Pd}=h("midichan"),{midimap:Ed}=h("midimap"),{midiport:Dd}=h("midiport"),{midicmd:Id}=h("midicmd"),Jd=Z("control",(e,t)=>{if(!Array.isArray(e))throw new Error("control expects an array of [ccn, ccv]");const[n,s]=e;return t.ccn(n).ccv(s)}),{ccn:jd}=h("ccn"),{ccv:Od}=h("ccv"),{ctlNum:Ud}=h("ctlNum"),{nrpnn:Qd}=h("nrpnn"),{nrpv:qd}=h("nrpv"),{progNum:$d}=h("progNum"),e0=Z("sysex",(e,t)=>{if(!Array.isArray(e))throw new Error("sysex expects an array of [id, data]");const[n,s]=e;return t.sysexid(n).sysexdata(s)}),{sysexid:t0}=h("sysexid"),{sysexdata:n0}=h("sysexdata"),{midibend:s0}=h("midibend"),{miditouch:o0}=h("miditouch"),{polyTouch:r0}=h("polyTouch"),{oschost:c0}=h("oschost"),{oscport:i0}=h("oscport"),Bs=e=>yn.has(e)?yn.get(e):e,u0=Z("as",(e,t)=>(e=Array.isArray(e)?e:[e],t.fmap(n=>(n=Array.isArray(n)?n:[n],n=Object.fromEntries(e.map((s,o)=>[Bs(s),n[o]])),n)))),a0=Z("scrub",(e,t)=>e.outerBind(n=>{Array.isArray(n)||(n=[n]);const[s,o=1]=n;return t.begin(s).mul(Rs(o)).clip(1)}),!1),q1=Object.freeze(Object.defineProperty({__proto__:null,accelerate:mc,activeLabel:Sa,ad:_d,adsr:Nd,amp:Xc,analyze:Sc,anchor:cl,ar:Hd,as:u0,att:Zc,attack:Gc,bandf:Pc,bandq:Ic,bank:xc,bbexpr:mi,bbst:bi,begin:jc,binshift:ad,bp:Dc,bpa:Ui,bpattack:Oi,bpd:nu,bpdc:zu,bpdecay:tu,bpdepth:Vu,bpdepthfrequency:Cu,bpe:Ei,bpenv:Pi,bpf:Ec,bpq:Jc,bpr:fu,bprate:Fu,bprelease:hu,bps:uu,bpshape:Lu,bpskew:Mu,bpsustain:iu,bpsync:vu,byteBeatExpression:fi,byteBeatStartTime:yi,ccn:jd,ccv:Od,ch:Xi,channel:Bi,channels:gi,chord:sl,chorus:Bc,clip:Zd,coarse:ni,color:Td,colour:Ad,comb:cd,compressor:Ml,compressorAttack:Bl,compressorKnee:Rl,compressorRatio:xl,compressorRelease:Sl,control:Jd,cps:Gd,createParam:Hn,createParams:xs,crush:ti,ctf:ki,ctlNum:Ud,ctranspose:Aa,curve:Vd,cut:Si,cutoff:Yi,dec:Tc,decay:kc,degree:ka,delay:$u,delayfb:ta,delayfeedback:ea,delayspeed:sa,delaysync:ia,delayt:ra,delaytime:oa,deltaSlide:Cd,density:Q1,det:la,detune:aa,dfb:na,dict:rl,dictionary:ol,dist:Cl,distort:Vl,distorttype:zl,distortvol:Ll,djf:qu,drive:ai,dry:ha,ds:Kd,dt:ca,duck:li,duckattack:hi,duckdepth:di,duckonset:pi,dur:Fd,duration:Wd,end:Oc,enhance:rd,expression:_l,fadeInTime:ya,fadeOutTime:ma,fadeTime:fa,fanchor:yu,fft:Yc,fm:Fc,fmattack:Vc,fmdecay:Lc,fmenv:vc,fmh:wc,fmi:Wc,fmrelease:Mc,fmsustain:zc,fmvelocity:Rc,fmwave:Cc,frameRate:pd,frames:hd,freeze:ed,freq:ba,fshift:Hl,fshiftnote:Pl,fshiftphase:El,ftype:mu,gain:bc,gat:Ma,gate:za,getControlName:Bs,harmonic:Na,hbrick:ld,hcutoff:Du,hold:Hc,hours:fd,hp:Ju,hpa:ji,hpattack:Ji,hpd:eu,hpdc:Tu,hpdecay:$i,hpdepth:Bu,hpdepthfreq:Su,hpdepthfrequency:Yu,hpe:Hi,hpenv:Ki,hpf:Iu,hpq:Ou,hpr:pu,hprate:Ru,hprelease:du,hps:cu,hpshape:ku,hpskew:Au,hpsustain:ru,hpsync:xu,hresonance:ju,imag:od,ir:bl,irbegin:Gl,iresponse:gl,irspeed:Xl,isControlName:Fr,kcutoff:Jl,krush:Il,label:Ya,lbrick:dd,legato:wd,leslie:Ra,lfo:Md,lock:ua,loop:Uc,loopBegin:Qc,loopEnd:$c,loopb:qc,loope:ei,lp:Ai,lpa:Ii,lpattack:Di,lpd:qi,lpdc:wu,lpdecay:Qi,lpdepth:Xu,lpdepthfrequency:Gu,lpe:_i,lpenv:Ni,lpf:Ti,lpq:Qu,lpr:lu,lprate:bu,lprelease:au,lps:ou,lpshape:Zu,lpskew:Wu,lpsustain:su,lpsync:gu,lrate:xa,lsize:Ba,midibend:s0,midichan:Pd,midicmd:Id,midimap:Ed,midiport:Dd,miditouch:o0,minutes:md,mode:al,mtranspose:Ta,n:hc,noise:Hu,note:fc,nrpnn:Qd,nrpv:qd,nudge:Ha,oct:Ea,octave:Pa,octaveR:Ka,octaves:ul,octer:jl,octersub:Ol,octersubsub:Ul,offset:il,orbit:Da,oschost:c0,oscport:i0,overgain:Ia,overshape:Ja,pan:ja,panchor:La,panorient:qa,panspan:Oa,pansplay:Ua,panwidth:Qa,patt:Xa,pattack:ga,pcurve:Ca,pdec:Za,pdecay:Ga,penv:Va,ph:Fi,phasdp:xi,phaser:vi,phasercenter:Li,phaserdepth:Mi,phaserrate:Wi,phasersweep:Vi,phc:zi,phd:Ri,phs:Ci,pitchJump:Ld,pitchJumpTime:zd,polyTouch:r0,postgain:gc,prel:va,prelease:Fa,progNum:$d,psus:Wa,psustain:wa,pw:Gi,pwrate:Zi,pwsweep:wi,rate:$a,rdim:fl,real:sd,registerControl:h,rel:Kc,release:_c,repeatTime:Rd,resonance:Uu,rfade:yl,ring:Ql,ringdf:$l,ringf:ql,rlp:pl,room:ll,roomdim:hl,roomfade:ml,roomlp:dl,roomsize:Zl,rsize:Fl,s:vr,scram:ud,scrub:a0,seconds:yd,semitone:tl,shape:vl,size:wl,slide:el,smear:id,songPtr:bd,sound:Vr,source:dc,speed:Rs,spread:pa,squiz:Tl,src:pc,stepsPerOctave:_a,stretch:Yl,sus:Nc,sustain:Ac,sustainpedal:Kl,sysex:e0,sysexdata:n0,sysexid:t0,sz:Wl,tremolo:si,tremolodepth:ri,tremolophase:ii,tremoloshape:ui,tremoloskew:ci,tremolosync:oi,triode:Dl,tsdelay:nd,uid:gd,unison:da,unit:kl,v:Ku,val:Xd,velocity:yc,vib:Nu,vibmod:Pu,vibrato:_u,vmod:Eu,voice:nl,vowel:Al,warp:Er,warpatt:Jr,warpattack:Ir,warpdc:sc,warpdec:Or,warpdecay:jr,warpdepth:tc,warpenv:ac,warpmode:rc,warprate:ec,warprel:$r,warprelease:qr,warpshape:nc,warpskew:oc,warpsus:Qr,warpsustain:Ur,warpsync:lc,waveloss:Nl,wavetablePhaseRand:uc,wavetablePosition:Lr,wavetableWarp:Dr,wavetableWarpMode:cc,wt:Cr,wtatt:Rr,wtattack:Mr,wtdc:Hr,wtdec:Br,wtdecay:xr,wtdepth:_r,wtenv:zr,wtphaserand:ic,wtrate:Ar,wtrel:Tr,wtrelease:kr,wtshape:Kr,wtskew:Pr,wtsus:Yr,wtsustain:Sr,wtsync:Nr,xsdelay:td,zcrush:Sd,zdelay:Yd,zmod:Bd,znoise:xd,zrand:vd,zzfx:kd},Symbol.toStringTag,{value:"Module"})),$1=function(e,t){const[n,s]=e,[o,r]=t,[i,u]=ys(s,o);return[[s,n-s],[Tn((a,l)=>a.concat(l),i,r),u]]},ey=function(e,t){const[n,s]=e,[o,r]=t,[i,u]=ys(n,r);return[[n,s-n],[Tn((l,p)=>l.concat(p),o,i),u]]},l0=function(e,t){const[n,s]=e;return Math.min(n,s)<=1?[e,t]:l0(...n>s?$1(e,t):ey(e,t))},Ss=function(e,t){const n=e<0,s=Math.abs(e),o=t-s,r=Array(s).fill([1]),i=Array(o).fill([0]),u=l0([s,o],[r,i]),a=at(u[1][0]).concat(at(u[1][1]));return n?a.map(l=>1-l):a},Pn=function(e,t,n){const s=Ss(e,t);return n?Ao(s,-n):s},ty=Z("euclid",function(e,t,n){return n.struct(Pn(e,t,0))}),ny=Z("bjork",function(e,t){Array.isArray(e)||(e=[e]);const[n,s=n,o=0]=e;return t.struct(Pn(n,s,o))}),{euclidrot:sy,euclidRot:oy}=Z(["euclidrot","euclidRot"],function(e,t,n,s){return s.struct(Pn(e,t,n))}),d0=function(e,t,n,s){if(e<1)return se;const r=Pn(e,t,0).join("").split("1").slice(1).map(i=>[i.length+1,!0]);return s.struct(zs(...r)).late(C(n).div(t))},ry=Z(["euclidLegato"],function(e,t,n){return d0(e,t,0,n)}),cy=Z(["euclidLegatoRot"],function(e,t,n,s){return d0(e,t,n,s)}),{euclidish:iy,eish:uy}=Z(["euclidish","eish"],function(e,t,n,s){const o=Ms(Ss(e,t),new Array(e).fill(1),n);return s.struct(o).setSteps(t)});function p0(e,t,n=.05,s=.1,o=.1,r=globalThis.setInterval,i=globalThis.clearInterval,u=!0){let a=0,l=0,p=10**4,f=.01;const g=x=>n=x(n);o=o||s/2;const X=()=>{const x=e(),R=x+s+o;for(l===0&&(l=x+f);l<R;)l=u?Math.round(l*p)/p:l,t(l,n,a,x),l+=n,a++};let G;const w=()=>{F(),X(),G=r(X,s*1e3)},F=()=>{G!==void 0&&i(G),G=void 0};return{setDuration:g,start:w,stop:()=>{a=0,l=0,F()},pause:()=>F(),duration:n,interval:s,getPhase:()=>l,minLatency:f}}function ay(e){return new L(t=>[new ge(void 0,t.span,e)])}const Ke=e=>{const t=n=>[new ge(void 0,n.span,e(n.span.begin))];return new L(t)},bn=Ke(e=>e%1),Ys=bn.toBipolar(),En=Ke(e=>1-e%1),ks=En.toBipolar(),Ts=Ke(e=>Math.sin(Math.PI*2*e)),h0=Ts.fromBipolar(),ly=h0._early(C(1).div(4)),dy=Ts._early(C(1).div(4)),f0=Ke(e=>Math.floor(e*2%2)),py=f0.toBipolar(),hy=Ce(bn,En),fy=Ce(Ys,ks),my=Ce(En,bn),yy=Ce(ks,Ys),As=Ke(Kt);let Ns=0,_s=0;typeof window<"u"&&document.addEventListener("mousemove",e=>{Ns=e.clientY/document.body.clientHeight,_s=e.clientX/document.body.clientWidth});const by=Ke(()=>Ns),gy=Ke(()=>Ns),Xy=Ke(()=>_s),Gy=Ke(()=>_s),m0=e=>{const t=e<<13^e,n=t>>17^t;return n<<5^n},Zy=e=>e-Math.trunc(e),y0=e=>m0(Math.trunc(Zy(e/300)*536870912)),b0=e=>e%536870912/536870912,gn=e=>Math.abs(b0(y0(e))),wy=(e,t)=>{const n=[];for(let s=0;s<t;++s)n.push(b0(e)),e=m0(e);return n},g0=(e,t)=>wy(y0(e),t),X0=e=>bn.range(0,e).round().segment(e),Wy=e=>{const t=V(e).log2(0).floor().add(1);return G0(e,t)},G0=(e,t=16)=>{t=V(t);const n=X0(t).mul(-1).add(t.sub(1));return V(e).segment(t).brshift(n).band(Xe(1))},Fy=e=>{const t=V(e).log2(0).floor().add(1);return Z0(e,t)},Z0=(e,t=16)=>V(e).withValue(n=>s=>{const o=[];for(let r=s-1;r>=0;r--)o.push(n>>r&1);return o}).appLeft(V(t)),vy=e=>Ke(t=>n=>g0(t,n).map(Math.abs)).appLeft(V(e)),w0=e=>Ke(t=>{const s=g0(t.floor().add(.5),e).map((r,i)=>[r,i]).sort((r,i)=>(r[0]>i[0])-(r[0]<i[0])).map(r=>r[1]),o=t.cyclePos().mul(e).floor()%e;return s[o]})._segment(e),W0=(e,t,n)=>{const s=[...Array(t).keys()].map(o=>n.zoom(C(o).div(t),C(o+1).div(t)));return e.fmap(o=>s[o].repeatCycles(t)._fast(t)).innerJoin()},Vy=Z("shuffle",(e,t)=>W0(w0(e),e,t)),Cy=Z("scramble",(e,t)=>W0(Hs(e)._segment(e),e,t)),Me=Ke(gn),Ly=Me.toBipolar(),Ks=e=>Me.fmap(t=>t<e),zy=e=>V(e).fmap(Ks).innerJoin(),My=Ks(.5),Hs=e=>Me.fmap(t=>Math.trunc(t*e)),Ry=e=>V(e).fmap(Hs).innerJoin(),Ps=(e,t)=>(t=t.map(V),t.length==0?se:e.range(0,t.length).fmap(n=>{const s=Math.min(Math.max(Math.floor(n),0),t.length-1);return t[s]})),Dn=(e,t)=>Ps(e,t).outerJoin(),In=(e,t)=>Ps(e,t).innerJoin(),F0=(...e)=>Dn(Me,e),xy=(...e)=>In(Me,e),By=F0;L.prototype.choose=function(...e){return Dn(this,e)},L.prototype.choose2=function(...e){return Dn(this.fromBipolar(),e)};const v0=(...e)=>In(Me.segment(1),e),Sy=v0,V0=function(e,...t){const n=t.map(u=>V(u[0])),s=[];let o=Xe(0);for(const u of t)o=o.add(u[1]),s.push(o);const r=Qo(s),i=function(u){const a=o.mul(u);return r.fmap(l=>p=>n[l.findIndex(f=>f>p,l)]).appLeft(a)};return e.bind(i)},Yy=(...e)=>V0(...e).outerJoin(),ky=(...e)=>Yy(Me,...e),C0=(...e)=>V0(Me.segment(1),...e).innerJoin(),Ty=C0;function Ay(e){let t=Math.floor(e),n=t+1;const s=i=>6*i**5-15*i**4+10*i**3;return(i=>u=>a=>u+s(i)*(a-u))(e-t)(gn(t))(gn(n))}const L0=e=>e.fmap(Ay);function Ny(e){const t=Math.floor(e),n=t+1,s=gn(t),o=gn(n)+s,r=(e-t)/(n-t);return((u,a,l)=>u+(a-u)*l)(s,o,r)/2}const z0=e=>e.fmap(Ny),_y=L0(As.fmap(e=>Number(e))),Ky=z0(As.fmap(e=>Number(e))),Hy=Z("degradeByWith",(e,t,n)=>n.fmap(s=>o=>s).appLeft(e.filterValues(s=>s>t)),!0,!0),Py=Z("degradeBy",function(e,t){return t._degradeByWith(Me,e)},!0,!0),Ey=Z("degrade",e=>e._degradeBy(.5),!0,!0),Dy=Z("undegradeBy",function(e,t){return t._degradeByWith(Me.fmap(n=>1-n),e)},!0,!0),Iy=Z("undegrade",e=>e._undegradeBy(.5),!0,!0),Jy=Z("sometimesBy",function(e,t,n){return V(e).fmap(s=>me(n._degradeBy(s),t(n._undegradeBy(1-s)))).innerJoin()}),jy=Z("sometimes",function(e,t){return t._sometimesBy(.5,e)}),Oy=Z("someCyclesBy",function(e,t,n){return V(e).fmap(s=>me(n._degradeByWith(Me._segment(1),s),t(n._degradeByWith(Me.fmap(o=>1-o)._segment(1),1-s)))).innerJoin()}),Uy=Z("someCycles",function(e,t){return t._someCyclesBy(.5,e)}),Qy=Z("often",function(e,t){return t.sometimesBy(.75,e)}),qy=Z("rarely",function(e,t){return t.sometimesBy(.25,e)}),$y=Z("almostNever",function(e,t){return t.sometimesBy(.1,e)}),eb=Z("almostAlways",function(e,t){return t.sometimesBy(.9,e)}),tb=Z("never",function(e,t){return t}),nb=Z("always",function(e,t){return e(t)});function Es(e){Array.isArray(e)===!1&&(e=[e]);const t=jo();return e.every(n=>{const s=Jo.get(n)??n;return t[s]})}const sb=Z("whenKey",function(e,t,n){return n.when(Es(e),t)}),ob=Z("keyDown",function(e){return e.fmap(Es)}),st=function(e,t,n=!0){const s=Array.isArray(e),o=Object.keys(e).length;return e=Do(e,V),o===0?se:t.fmap(r=>{let i=r;return s&&(i=n?Math.round(i)%o:An(Math.round(i),0,e.length-1)),e[i]})},M0=function(e,t){return Array.isArray(t)&&([t,e]=[e,t]),rb(e,t)},rb=Z("pick",function(e,t){return st(e,t,!1).innerJoin()}),R0=Z("pickmod",function(e,t){return st(e,t,!0).innerJoin()}),cb=Z("pickF",function(e,t,n){return n.apply(M0(e,t))}),ib=Z("pickmodF",function(e,t,n){return n.apply(R0(e,t))}),ub=Z("pickOut",function(e,t){return st(e,t,!1).outerJoin()}),ab=Z("pickmodOut",function(e,t){return st(e,t,!0).outerJoin()}),lb=Z("pickRestart",function(e,t){return st(e,t,!1).restartJoin()}),db=Z("pickmodRestart",function(e,t){return st(e,t,!0).restartJoin()}),pb=Z("pickReset",function(e,t){return st(e,t,!1).resetJoin()}),hb=Z("pickmodReset",function(e,t){return st(e,t,!0).resetJoin()}),{inhabit:fb,pickSqueeze:mb}=Z(["inhabit","pickSqueeze"],function(e,t){return st(e,t,!1).squeezeJoin()}),{inhabitmod:yb,pickmodSqueeze:bb}=Z(["inhabitmod","pickmodSqueeze"],function(e,t){return st(e,t,!0).squeezeJoin()}),gb=(e,t)=>(t=t.map(V),t.length==0?se:e.fmap(n=>{const s=pn(Math.round(n),t.length);return t[s]}).squeezeJoin());let Jn;try{Jn=window?.speechSynthesis}catch{console.warn("cannot use window: not in browser?")}let x0=Jn?.getVoices();function Xb(e,t,n){Jn.cancel();const s=new SpeechSynthesisUtterance(e);s.lang=t,x0=Jn.getVoices();const o=x0.filter(r=>r.lang.includes(t));typeof n=="number"?s.voice=o[n%o.length]:typeof n=="string"&&(s.voice=o.find(r=>r.name===r)),speechSynthesis.speak(s)}const Gb=Z("speak",function(e,t,n){return n.onTrigger(s=>{Xb(s.value,e,t)})}),B0={},S0=async(...e)=>{const t=await Promise.allSettled(e),n=t.filter(s=>s.status==="fulfilled").map(s=>s.value);return t.forEach((s,o)=>{s.status==="rejected"&&console.warn(`evalScope: module with index ${o} could not be loaded:`,s.reason)}),n.forEach(s=>{Object.entries(s).forEach(([o,r])=>{globalThis[o]=r,B0[o]=r})}),n};function Zb(e,t={}){const{wrapExpression:n=!0,wrapAsync:s=!0}=t;n&&(e=`{${e}}`),s&&(e=`(async ()=>${e})()`);const o=`"use strict";return (${e})`;return Function(o)()}const Y0=async(e,t,n)=>{let s={};if(t){const i=t(e,n);e=i.output,s=i}return{mode:"javascript",pattern:await Zb(e,{wrapExpression:!!t}),meta:s}},k0=`(function(){"use strict";function L(){return performance.now()*.001}let _=0,r=0,o=.5;const h=new Map,m=.1,M=new BroadcastChannel("strudeltick"),b=(s,e)=>{M.postMessage({type:s,payload:e})},C=E(L,(s,e,t,n)=>{const i=r*e,d=s-n,c=n+d,u=i*o,l=_+u,g=n-c-e,f=e*o,p=l+f,y=l+g*o;b("tick",{begin:l,end:p,cps:o,time:n,cycle:y}),r++},m);let k=!1;const I=s=>{h.set(s,{started:!0}),!k&&(C.start(),k=!0)},A=async s=>{h.set(s,{started:!1});const e=Array.from(h.values()).some(t=>t.started);!k||e||(C.stop(),w(0),k=!1)},w=s=>{r=0,_=s},D=s=>{const{type:e,payload:t}=s;switch(e){case"cpschange":{if(t.cps!==o){const n=r*m;_=_+n*o,o=t.cps,r=0}break}case"setcycle":{w(t.cycle);break}case"toggle":{t.started?I(s.id):A(s.id);break}}};self.onconnect=function(s){const e=s.ports[0];e.addEventListener("message",function(t){D(t.data)}),e.start()};function E(s,e,t=.05,n=.1,i=.1){let d=0,c=0,u=10**4,l=.01;const g=a=>t=a(t);i=i||n/2;const f=()=>{const a=s(),O=a+n+i;for(c===0&&(c=a+l);c<O;)c=Math.round(c*u)/u,c>=a&&e(c,t,d,a),c<a&&console.log("TOO LATE",c),c+=t,d++};let p;const y=()=>{T(),f(),p=setInterval(f,n*1e3)},T=()=>p!==void 0&&clearInterval(p);return{setDuration:g,start:y,stop:()=>{d=0,c=0,T()},pause:()=>T(),duration:t,interval:n,getPhase:()=>c,minLatency:l}}})();
`,T0=typeof self<"u"&&self.Blob&&new Blob(["(self.URL || self.webkitURL).revokeObjectURL(self.location.href);",k0],{type:"text/javascript;charset=utf-8"});function wb(e){let t;try{if(t=T0&&(self.URL||self.webkitURL).createObjectURL(T0),!t)throw"";const n=new Worker(t,{name:e?.name});return n.addEventListener("error",()=>{(self.URL||self.webkitURL).revokeObjectURL(t)}),n}catch{return new Worker("data:text/javascript;charset=utf-8,"+encodeURIComponent(k0),{name:e?.name})}}class Wb{constructor({onTrigger:t,onToggle:n,getTime:s}){this.started=!1,this.cps=.5,this.getTime=s,this.time_at_last_tick_message=0,this.collator=new Io({getTargetClockTime:s}),this.onToggle=n,this.latency=.1,this.cycle=0,this.id=Math.round(Date.now()*Math.random()),this.worker=new SharedWorker(wb),this.worker.port.start(),this.channel=new BroadcastChannel("strudeltick");const o=i=>{const{cps:u,begin:a,end:l,cycle:p,time:f}=i;this.cps=u,this.cycle=p;const g=this.collator.calculateOffset(f)+f;r(a,l,g),this.time_at_last_tick_message=g},r=(i,u,a)=>{if(this.started===!1)return;this.pattern.queryArc(i,u,{_cps:this.cps,cyclist:"neocyclist"}).forEach(p=>{if(p.hasOnset()){const g=bs(p.whole.begin-this.cycle,this.cps)+a+this.latency,X=bs(p.duration,this.cps);t?.(p,0,X,this.cps,g)}})};this.channel.onmessage=i=>{if(!this.started)return;const{payload:u,type:a}=i.data;switch(a){case"tick":o(u)}}}sendMessage(t,n){this.worker.port.postMessage({type:t,payload:n,id:this.id})}now(){const t=(this.getTime()-this.time_at_last_tick_message)*this.cps;return this.cycle+t}setCps(t=1){this.sendMessage("cpschange",{cps:t})}setCycle(t){this.sendMessage("setcycle",{cycle:t})}setStarted(t){this.sendMessage("toggle",{started:t}),this.started=t,this.onToggle?.(t)}start(){Se("[cyclist] start"),this.setStarted(!0)}stop(){Se("[cyclist] stop"),this.collator.reset(),this.setStarted(!1)}setPattern(t,n=!1){this.pattern=t,n&&!this.started&&this.start()}log(t,n,s){const o=s.filter(r=>r.hasOnset());console.log(`${t.toFixed(4)} - ${n.toFixed(4)} ${Array(o.length).fill("I").join("")}`)}}class A0{constructor({interval:t,onTrigger:n,onToggle:s,onError:o,getTime:r,latency:i=.1,setInterval:u,clearInterval:a,beforeStart:l}){this.started=!1,this.beforeStart=l,this.cps=.5,this.num_ticks_since_cps_change=0,this.lastTick=0,this.lastBegin=0,this.lastEnd=0,this.getTime=r,this.num_cycles_at_cps_change=0,this.seconds_at_cps_change,this.onToggle=s,this.latency=i,this.clock=p0(r,(p,f,g,X)=>{this.num_ticks_since_cps_change===0&&(this.num_cycles_at_cps_change=this.lastEnd,this.seconds_at_cps_change=p),this.num_ticks_since_cps_change++;const w=this.num_ticks_since_cps_change*f*this.cps;try{const F=this.lastEnd;this.lastBegin=F;const v=this.num_cycles_at_cps_change+w;if(this.lastEnd=v,this.lastTick=p,p<X){console.log("skip query: too late");return}this.pattern.queryArc(F,v,{_cps:this.cps,cyclist:"cyclist"}).forEach(B=>{if(B.hasOnset()){const x=(B.whole.begin-this.num_cycles_at_cps_change)/this.cps+this.seconds_at_cps_change+i,R=B.duration/this.cps,N=x-p;n?.(B,N,R,this.cps,x),B.value.cps!==void 0&&this.cps!=B.value.cps&&(this.cps=B.value.cps,this.num_ticks_since_cps_change=0)}})}catch(F){Yn(F),o?.(F)}},t,.1,.1,u,a)}now(){if(!this.started)return 0;const t=this.getTime()-this.lastTick-this.clock.duration;return this.lastBegin+t*this.cps}setStarted(t){this.started=t,this.onToggle?.(t)}async start(){if(await this.beforeStart?.(),this.num_ticks_since_cps_change=0,this.num_cycles_at_cps_change=0,!this.pattern)throw new Error("Scheduler: no pattern set! call .setPattern first.");Se("[cyclist] start"),this.clock.start(),this.setStarted(!0)}pause(){Se("[cyclist] pause"),this.clock.pause(),this.setStarted(!1)}stop(){Se("[cyclist] stop"),this.clock.stop(),this.lastEnd=0,this.setStarted(!1)}async setPattern(t,n=!1){this.pattern=t,n&&!this.started&&await this.start()}setCps(t=.5){this.cps!==t&&(this.cps=t,this.num_ticks_since_cps_change=0)}log(t,n,s){const o=s.filter(r=>r.hasOnset());console.log(`${t.toFixed(4)} - ${n.toFixed(4)} ${Array(o.length).fill("I").join("")}`)}}let Ds;function Is(){if(!Ds)throw new Error("no time set! use setTime to define a time source");return Ds()}function Js(e){Ds=e}function Fb({defaultOutput:e,onEvalError:t,beforeEval:n,beforeStart:s,afterEval:o,getTime:r,transpiler:i,onToggle:u,editPattern:a,onUpdateState:l,sync:p=!1,setInterval:f,clearInterval:g,id:X,mondo:G=!1}){const w={schedulerError:void 0,evalError:void 0,code:"// LOADING",activeCode:"// LOADING",pattern:void 0,miniLocations:[],widgets:[],pending:!1,started:!1},F={id:X},v=K=>{Object.assign(w,K),w.isDirty=w.code!==w.activeCode,w.error=w.evalError||w.schedulerError,l?.(w)},z={onTrigger:N0({defaultOutput:e,getTime:r}),getTime:r,onToggle:K=>{v({started:K}),u?.(K)},setInterval:f,clearInterval:g,beforeStart:s},B=p&&typeof SharedWorker<"u"?new Wb(z):new A0(z);let x={},R=0,N;const O=function(){return x={},R=0,N=void 0,se};function j(K){return K._Pattern?K.__pure:K}const te=async(K,I=!0)=>(K=a?.(K)||K,await B.setPattern(K,I),K);Js(()=>B.now());const T=()=>B.stop(),ue=()=>B.start(),H=()=>B.pause(),q=()=>B.toggle(),U=K=>(B.setCps(j(K)),se),pe=K=>(B.setCps(j(K)/60),se);let $=[];const oe=function(K){return $.push(K),se},he=function(K){return N=K,se},Ve=()=>{L.prototype.p=function(I){return typeof I=="string"&&(I.startsWith("_")||I.endsWith("_"))?se:(I.includes("$")&&(I=`${I}${R}`,R++),x[I]=this,this)},L.prototype.q=function(I){return se};try{for(let I=1;I<10;++I)Object.defineProperty(L.prototype,`d${I}`,{get(){return this.p(I)},configurable:!0}),Object.defineProperty(L.prototype,`p${I}`,{get(){return this.p(I)},configurable:!0}),L.prototype[`q${I}`]=se}catch(I){console.warn("injectPatternMethods: error:",I)}const K=Z("cpm",function(I,et){return et._fast(I/60/B.cps)});return S0({all:oe,each:he,hush:O,cpm:K,setCps:U,setcps:U,setCpm:pe,setcpm:pe})};return{scheduler:B,evaluate:async(K,I=!0,et=!0)=>{if(!K)throw new Error("no code to evaluate");try{v({code:K,pending:!0}),await Ve(),Js(()=>B.now()),await n?.({code:K}),$=[],et&&O(),G&&(K=`mondolang\`${K}\``);let{pattern:ie,meta:rt}=await Y0(K,i,F);if(Object.keys(x).length){let Le=[],ee=!1;for(const[re,Ie]of Object.entries(x)){const Je=re.length>1&&re.startsWith("S");if(Je&&ee===!1&&(Le=[],ee=!0),!ee||ee&&Je){const we=Ie.withState(Zt=>Zt.setControls({id:re}));Le.push(we)}}N&&(Le=Le.map(re=>N(re))),ie=me(...Le)}else N&&(ie=N(ie));if($.length)for(const Le of $)ie=Le(ie);return Zs(ie)||(ie=se),Se("[eval] code updated"),ie=await te(ie,I),v({miniLocations:rt?.miniLocations||[],widgets:rt?.widgets||[],activeCode:K,pattern:ie,evalError:void 0,schedulerError:void 0,pending:!1}),o?.({code:K,pattern:ie,meta:rt}),ie}catch(ie){Se(`[eval] error: ${ie.message}`,"error"),console.error(ie),v({evalError:ie,pending:!1}),t?.(ie)}},start:ue,stop:T,pause:H,setCps:U,setPattern:te,setCode:K=>v({code:K}),toggle:q,state:w}}const N0=({getTime:e,defaultOutput:t})=>async(n,s,o,r,i)=>{try{(!n.context.onTrigger||!n.context.dominantTrigger)&&await t(n,s,o,r,i),n.context.onTrigger&&await n.context.onTrigger(n,e(),r,i)}catch(u){Yn(u,"getTrigger")}},vb=function(e,t={}){const n=document.getElementById("code"),s="background-image:url("+e+");background-size:contain;";n.style=s;const{className:o}=n,r=(a,l)=>{({style:()=>n.style=s+";"+l,className:()=>n.className=l+" "+o})[a]()},i=Object.entries(t).filter(([a,l])=>typeof l=="function");Object.entries(t).filter(([a,l])=>typeof l=="string").forEach(([a,l])=>r(a,l)),i.length},Vb=()=>{const e=document.getElementById("code");e&&(e.style="")};Se("🌀 @strudel/core loaded 🌀"),globalThis._strudelLoaded&&console.warn(`@strudel/core was loaded more than once...
This might happen when you have multiple versions of strudel installed. 
Please check with "npm ls @strudel/core".`),globalThis._strudelLoaded=!0;const js=Object.freeze(Object.defineProperty({__proto__:null,ClockCollator:Io,Cyclist:A0,Fraction:C,Hap:ge,Pattern:L,State:Ht,TimeSpan:be,__chooseWith:Ps,_brandBy:Ks,_fitslice:rr,_irand:Hs,_keyDown:Es,_match:cr,_mod:pn,_morph:Ms,_polymeterListSteps:ur,_retime:Cs,_slices:Ls,accelerate:mc,activeLabel:Sa,ad:_d,add:Ff,adsr:Nd,almostAlways:eb,almostNever:$y,always:nb,amp:Xc,analyze:Sc,anchor:cl,and:Pf,apply:Xm,applyN:or,ar:Hd,arp:nf,arpWith:tf,arrange:af,as:u0,att:Zc,attack:Gc,averageArray:Yo,backgroundImage:vb,band:Mf,bandf:Pc,bandq:Ic,bank:xc,base64ToUnicode:Eo,bbexpr:mi,bbst:bi,beat:I1,begin:jc,berlin:Ky,berlinWith:z0,binary:Wy,binaryL:Fy,binaryN:G0,binaryNL:Z0,bind:mf,binshift:ad,bite:vm,bjork:ny,bjorklund:Ss,blshift:Bf,bor:Rf,bp:Dc,bpa:Ui,bpattack:Oi,bpd:nu,bpdc:zu,bpdecay:tu,bpdepth:Vu,bpdepthfrequency:Cu,bpe:Ei,bpenv:Pi,bpf:Ec,bpq:Jc,bpr:fu,bprate:Fu,bprelease:hu,bps:uu,bpshape:Lu,bpskew:Mu,bpsustain:iu,bpsync:vu,brak:Ym,brand:My,brandBy:zy,brshift:Sf,bxor:xf,bypass:p1,byteBeatExpression:fi,byteBeatStartTime:yi,calculateSteps:qh,cat:mn,ccn:jd,ccv:Od,ceil:jf,ch:Xi,channel:Bi,channels:gi,choose:F0,chooseCycles:v0,chooseIn:xy,chooseInWith:In,chooseOut:By,chooseWith:Dn,chop:k1,chord:sl,chorus:Bc,chunk:t1,chunkBack:o1,chunkBackInto:d1,chunkInto:a1,chunkback:r1,chunkbackinto:l1,chunkinto:u1,clamp:An,cleanupUi:Vb,clip:Zd,coarse:ni,code2hash:Dh,color:Td,colour:Ad,comb:cd,compose:Bh,compress:tm,compressSpan:nm,compressor:Ml,compressorAttack:Bl,compressorKnee:Rl,compressorRatio:xl,compressorRelease:Sl,compressspan:sm,constant:Sh,contract:fr,control:Jd,controls:q1,cosine:ly,cosine2:dy,cpm:Gm,cps:Gd,createClock:p0,createParam:Hn,createParams:xs,crush:ti,ctf:ki,ctlNum:Ud,ctranspose:Aa,curry:D,curve:Vd,cut:Si,cutoff:Yi,cycleToSeconds:bs,dec:Tc,decay:kc,degrade:Ey,degradeBy:Py,degradeByWith:Hy,degree:ka,delay:$u,delayfb:ta,delayfeedback:ea,delayspeed:sa,delaysync:ia,delayt:ra,delaytime:oa,deltaSlide:Cd,det:la,detune:aa,dfb:na,dict:rl,dictionary:ol,dist:Cl,distort:Vl,distorttype:zl,distortvol:Ll,div:Cf,djf:qu,drawLine:Oo,drive:ai,drop:dr,dry:ha,ds:Kd,dt:ca,duck:li,duckattack:hi,duckdepth:di,duckonset:pi,dur:Fd,duration:Wd,early:Zm,echo:Jm,echoWith:Pm,echowith:Em,eish:uy,end:Oc,enhance:rd,eq:Nf,eqt:_f,errorLogger:Yn,euclid:ty,euclidLegato:ry,euclidLegatoRot:cy,euclidRot:oy,euclidish:iy,euclidrot:sy,evalScope:S0,evaluate:Y0,every:gm,expand:hr,expression:_l,extend:pr,fadeInTime:ya,fadeOutTime:ma,fadeTime:fa,fanchor:yu,fast:lm,fastChunk:i1,fastGap:om,fastcat:Ce,fastchunk:c1,fastgap:rm,fft:Yc,filter:b1,filterWhen:g1,firstOf:bm,fit:K1,flatten:at,floor:Jf,fm:Fc,fmattack:Vc,fmdecay:Lc,fmenv:vc,fmh:wc,fmi:Wc,fmrelease:Mc,fmsustain:zc,fmvelocity:Rc,fmwave:Cc,focus:cm,focusSpan:im,focusspan:um,fractionalArgs:Yh,frameRate:pd,frames:hd,freeze:ed,freq:ba,freqToMidi:hs,fromBipolar:Uf,fshift:Hl,fshiftnote:Pl,fshiftphase:El,ftype:mu,func:Df,gain:bc,gap:Pt,gat:Ma,gate:za,getAccidentalsOffset:Bo,getControlName:Bs,getCurrentKeyboardState:jo,getEventOffsetMs:Lh,getFreq:So,getFrequency:To,getPerformanceTimeSeconds:Jh,getPlayableNoteValue:xh,getSoundIndex:Rh,getTime:Is,getTrigger:N0,grow:Z1,gt:kf,gte:Af,harmonic:Na,hash2code:Ih,hbrick:ld,hcutoff:Du,hold:Hc,hours:fd,hp:Ju,hpa:ji,hpattack:Ji,hpd:eu,hpdc:Tu,hpdecay:$i,hpdepth:Bu,hpdepthfreq:Su,hpdepthfrequency:Yu,hpe:Hi,hpenv:Ki,hpf:Iu,hpq:Ou,hpr:pu,hprate:Ru,hprelease:du,hps:cu,hpshape:ku,hpskew:Au,hpsustain:ru,hpsync:xu,hresonance:ju,hsl:y1,hsla:m1,hurry:dm,id:Kt,imag:od,inhabit:fb,inhabitmod:yb,innerBind:yf,inside:fm,inv:xm,invert:Rm,ir:bl,irand:Ry,irbegin:Gl,iresponse:gl,irspeed:Xl,isControlName:Fr,isNote:kn,isNoteWithOctave:Fh,isPattern:Zs,isaw:En,isaw2:ks,iter:Qm,iterBack:qm,iterback:$m,itri:my,itri2:yy,jux:Hm,juxBy:_m,juxby:Km,kcutoff:Jl,keep:wf,keepif:Wf,keyAlias:Jo,keyDown:ob,krush:Il,label:Ya,lastOf:ym,late:nr,lbrick:dd,legato:wd,leslie:Ra,lfo:Md,linger:Vm,listRange:hn,lock:ua,logKey:ps,logger:Se,loop:Uc,loopAt:N1,loopAtCps:H1,loopBegin:Qc,loopEnd:$c,loopat:_1,loopatcps:P1,loopb:qc,loope:ei,lp:Ai,lpa:Ii,lpattack:Di,lpd:qi,lpdc:wu,lpdecay:Qi,lpdepth:Xu,lpdepthfrequency:Gu,lpe:_i,lpenv:Ni,lpf:Ti,lpq:Qu,lpr:lu,lprate:bu,lprelease:au,lps:ou,lpshape:Zu,lpskew:Wu,lpsustain:su,lpsync:gu,lrate:xa,lsize:Ba,lt:Yf,lte:Tf,mapArgs:ms,mask:df,midi2note:Mh,midiToFreq:vt,midibend:s0,midichan:Pd,midicmd:Id,midimap:Ed,midiport:Dd,miditouch:o0,minutes:md,mod:Lf,mode:al,morph:J1,mouseX:Gy,mouseY:gy,mousex:Xy,mousey:by,mtranspose:Ta,mul:Vf,n:hc,nanFallback:ko,ne:Kf,net:Hf,never:tb,noise:Hu,note:fc,noteToMidi:Nt,nothing:_e,nrpnn:Qd,nrpv:qd,nudge:Ha,numeralArgs:Ae,objectMap:Do,oct:Ea,octave:Pa,octaveR:Ka,octaves:ul,octer:jl,octersub:Ol,octersubsub:Ul,off:Sm,offset:il,often:Qy,or:Ef,orbit:Da,oschost:c0,oscport:i0,outerBind:bf,outside:mm,overgain:Ia,overshape:Ja,pace:ir,pairs:Ko,palindrome:Nm,pan:ja,panchor:La,panorient:qa,panspan:Oa,pansplay:Ua,panwidth:Qa,parray:Wr,parseFractional:_o,parseNumeral:fs,partials:O1,patt:Xa,pattack:ga,pcurve:Ca,pdec:Za,pdecay:Ga,penv:Va,perlin:_y,perlinWith:L0,ph:Fi,phasdp:xi,phaser:vi,phasercenter:Li,phaserdepth:Mi,phaserrate:Wi,phasersweep:Vi,phases:U1,phc:zi,phd:Ri,phs:Ci,pick:M0,pickF:cb,pickOut:ub,pickReset:pb,pickRestart:lb,pickSqueeze:mb,pickmod:R0,pickmodF:ib,pickmodOut:ab,pickmodReset:hb,pickmodRestart:db,pickmodSqueeze:bb,pipe:No,pitchJump:Ld,pitchJumpTime:zd,ply:am,plyForEach:Um,plyWith:Om,pm:cf,polyBind:Gf,polyTouch:r0,polymeter:_n,polyrhythm:of,postgain:gc,pow:zf,pr:rf,prel:va,prelease:Fa,press:Am,pressBy:Tm,progNum:$d,psus:Wa,psustain:wa,pure:Xe,pw:Gi,pwrate:Zi,pwsweep:wi,rand:Me,rand2:Ly,randL:vy,randcat:Sy,randrun:w0,range:Qf,range2:$f,rangex:qf,rarely:qy,rate:$a,ratio:em,rdim:fl,real:sd,ref:E1,register:Z,registerControl:h,reify:V,rel:Kc,release:_c,removeUndefineds:_t,repeatCycles:e1,repeatTime:Rd,repl:Fb,replicate:G1,resonance:Uu,rev:sr,revv:km,rfade:yl,rib:f1,ribbon:h1,ring:Ql,ringdf:$l,ringf:ql,rlp:pl,room:ll,roomdim:hl,roomfade:ml,roomlp:dl,roomsize:Zl,rotate:Ao,round:If,rsize:Fl,run:X0,s:vr,s_add:L1,s_alt:F1,s_cat:W1,s_contract:x1,s_expand:M1,s_extend:R1,s_polymeter:v1,s_sub:z1,s_taper:V1,s_taperlist:C1,s_tour:B1,s_zip:S1,saw:bn,saw2:Ys,scram:ud,scramble:Cy,scrub:a0,seconds:yd,seg:Lm,segment:Cm,semitone:tl,seq:tr,seqPLoop:lf,sequence:Qe,sequenceP:Qo,set:Zf,setStringParser:Uo,setTime:Js,shape:vl,shrink:yr,shrinklist:mr,shuffle:Vy,signal:Ke,silence:se,sine:h0,sine2:Ts,size:wl,slice:Gr,slide:el,slow:pm,slowChunk:s1,slowcat:gt,slowcatPrime:Ws,slowchunk:n1,smear:id,sol2note:Hh,someCycles:Uy,someCyclesBy:Oy,sometimes:jy,sometimesBy:Jy,songPtr:bd,sound:Vr,source:dc,sparsity:hm,speak:Gb,speed:Rs,splice:A1,splitAt:ys,spread:pa,square:f0,square2:py,squeeze:gb,squeezeBind:gf,squiz:Tl,src:pc,stack:me,stackBy:uf,stackCentre:er,stackLeft:qo,stackRight:$o,steady:ay,stepBind:Xf,stepalt:ar,stepcat:Ye,steps:Y1,stepsPerOctave:_a,stretch:Yl,striate:T1,stringifyValues:gs,struct:pf,strudelScope:B0,stut:jm,stutWith:Dm,stutwith:Im,sub:vf,superimpose:hf,sus:Nc,sustain:Ac,sustainpedal:Kl,swing:Mm,swingBy:zm,sysex:e0,sysexdata:n0,sysexid:t0,sz:Wl,take:lr,time:As,timeCat:zs,timecat:w1,toBipolar:Of,tokenizeNote:xo,tour:br,tremolo:si,tremolodepth:ri,tremolophase:ii,tremoloshape:ui,tremoloskew:ci,tremolosync:oi,tri:hy,tri2:fy,triode:Dl,tsdelay:nd,uid:gd,undegrade:Iy,undegradeBy:Dy,unicodeToBase64:Po,uniq:Ph,uniqsort:Eh,uniqsortr:Ho,unison:da,unit:kl,v:Ku,val:Xd,valueToMidi:Ch,velocity:yc,vib:Nu,vibmod:Pu,vibrato:_u,vmod:Eu,voice:nl,vowel:Al,warp:Er,warpatt:Jr,warpattack:Ir,warpdc:sc,warpdec:Or,warpdecay:jr,warpdepth:tc,warpenv:ac,warpmode:rc,warprate:ec,warprel:$r,warprelease:qr,warpshape:nc,warpskew:oc,warpsus:Qr,warpsustain:Ur,warpsync:lc,waveloss:Nl,wavetablePhaseRand:uc,wavetablePosition:Lr,wavetableWarp:Dr,wavetableWarpMode:cc,wchoose:ky,wchooseCycles:C0,when:Bm,whenKey:sb,withValue:ff,within:X1,wrandcat:Ty,wt:Cr,wtatt:Rr,wtattack:Mr,wtdc:Hr,wtdec:Br,wtdecay:xr,wtdepth:_r,wtenv:zr,wtphaserand:ic,wtrate:Ar,wtrel:Tr,wtrelease:kr,wtshape:Kr,wtskew:Pr,wtsus:Yr,wtsustain:Sr,wtsync:Nr,xfade:wr,xsdelay:td,zcrush:Sd,zdelay:Yd,zip:gr,zipWith:Tn,zmod:Bd,znoise:xd,zoom:wm,zoomArc:Wm,zoomarc:Fm,zrand:vd,zzfx:kd},Symbol.toStringTag,{value:"Module"}));function Cb(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}function Vt(e,t,n,s){var o=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(o,Vt.prototype),o.expected=t,o.found=n,o.location=s,o.name="SyntaxError",o}Cb(Vt,Error);function Os(e,t,n){return n=n||" ",e.length>t?e:(t-=e.length,n+=n.repeat(t),e+n.slice(0,t))}Vt.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var n=null,s;for(s=0;s<e.length;s++)if(e[s].source===this.location.source){n=e[s].text.split(/\r\n|\n|\r/g);break}var o=this.location.start,r=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(o):o,i=this.location.source+":"+r.line+":"+r.column;if(n){var u=this.location.end,a=Os("",r.line.toString().length," "),l=n[o.line-1],p=o.line===u.line?u.column:l.length+1,f=p-o.column||1;t+=`
 --> `+i+`
`+a+` |
`+r.line+" | "+l+`
`+a+" | "+Os("",o.column-1," ")+Os("",f,"^")}else t+=`
 at `+i}return t},Vt.buildMessage=function(e,t){var n={literal:function(l){return'"'+o(l.text)+'"'},class:function(l){var p=l.parts.map(function(f){return Array.isArray(f)?r(f[0])+"-"+r(f[1]):r(f)});return"["+(l.inverted?"^":"")+p.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(l){return l.description}};function s(l){return l.charCodeAt(0).toString(16).toUpperCase()}function o(l){return l.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(p){return"\\x0"+s(p)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(p){return"\\x"+s(p)})}function r(l){return l.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(p){return"\\x0"+s(p)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(p){return"\\x"+s(p)})}function i(l){return n[l.type](l)}function u(l){var p=l.map(i),f,g;if(p.sort(),p.length>0){for(f=1,g=1;f<p.length;f++)p[f-1]!==p[f]&&(p[g]=p[f],g++);p.length=g}switch(p.length){case 1:return p[0];case 2:return p[0]+" or "+p[1];default:return p.slice(0,-1).join(", ")+", or "+p[p.length-1]}}function a(l){return l?'"'+o(l)+'"':"end of input"}return"Expected "+u(e)+" but "+a(t)+" found."};function _0(e,t){t=t!==void 0?t:{};var n={},s=t.grammarSource,o={start:dh},r=dh,i=".",u="-",a="0",l=",",p="|",f="[",g="]",X="{",G="}",w="%",F="<",v=">",z="!",B="(",x=")",R="/",N="*",O="?",j=":",te="..",T="^",ue="struct",H="target",q="euclid",U="slow",pe="rotL",$="rotR",oe="fast",he="scale",Ve="//",He="cat",Te="$",K="setcps",I="setbpm",et="hush",ie=/^[1-9]/,rt=/^[eE]/,Le=/^[+\-]/,ee=/^[0-9]/,re=/^[ \n\r\t\xA0]/,Ie=/^["']/,Je=/^[#\--.0-9A-Z\^-_a-z~\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376-\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E-\u066F\u0671-\u06D3\u06D5\u06E5-\u06E6\u06EE-\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4-\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F-\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC-\u09DD\u09DF-\u09E1\u09F0-\u09F1\u09FC\u0A05-\u0A0A\u0A0F-\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32-\u0A33\u0A35-\u0A36\u0A38-\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2-\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0-\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F-\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32-\u0B33\u0B35-\u0B39\u0B3D\u0B5C-\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99-\u0B9A\u0B9C\u0B9E-\u0B9F\u0BA3-\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60-\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0-\u0CE1\u0CF1-\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32-\u0E33\u0E40-\u0E46\u0E81-\u0E82\u0E84\u0E87-\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA-\u0EAB\u0EAD-\u0EB0\u0EB2-\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065-\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE-\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5-\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEF\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A-\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7B9\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD-\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5-\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40-\uFB41\uFB43-\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,we=/^[@_]/,Zt=/^[^\n]/,Ln=Fo("number"),wt=Q(".",!1),$t=mt([["1","9"]],!1,!1),ft=mt(["e","E"],!1,!1),Rt=mt(["+","-"],!1,!1),xt=Q("-",!1),Bt=Q("0",!1),en=mt([["0","9"]],!1,!1),St=Fo("whitespace"),ct=mt([" ",`
`,"\r","	"," "],!1,!1),zn=Q(",",!1),tn=Q("|",!1),Mn=mt(['"',"'"],!1,!1),ss=Fo('a letter, a number, "-", "#", ".", "^", "_"'),Rn=mt(["#",["-","."],["0","9"],["A","Z"],["^","_"],["a","z"],"~","ª","µ","º",["À","Ö"],["Ø","ö"],["ø","ˁ"],["ˆ","ˑ"],["ˠ","ˤ"],"ˬ","ˮ",["Ͱ","ʹ"],["Ͷ","ͷ"],["ͺ","ͽ"],"Ϳ","Ά",["Έ","Ί"],"Ό",["Ύ","Ρ"],["Σ","ϵ"],["Ϸ","ҁ"],["Ҋ","ԯ"],["Ա","Ֆ"],"ՙ",["ՠ","ֈ"],["א","ת"],["ׯ","ײ"],["ؠ","ي"],["ٮ","ٯ"],["ٱ","ۓ"],"ە",["ۥ","ۦ"],["ۮ","ۯ"],["ۺ","ۼ"],"ۿ","ܐ",["ܒ","ܯ"],["ݍ","ޥ"],"ޱ",["ߊ","ߪ"],["ߴ","ߵ"],"ߺ",["ࠀ","ࠕ"],"ࠚ","ࠤ","ࠨ",["ࡀ","ࡘ"],["ࡠ","ࡪ"],["ࢠ","ࢴ"],["ࢶ","ࢽ"],["ऄ","ह"],"ऽ","ॐ",["क़","ॡ"],["ॱ","ঀ"],["অ","ঌ"],["এ","ঐ"],["ও","ন"],["প","র"],"ল",["শ","হ"],"ঽ","ৎ",["ড়","ঢ়"],["য়","ৡ"],["ৰ","ৱ"],"ৼ",["ਅ","ਊ"],["ਏ","ਐ"],["ਓ","ਨ"],["ਪ","ਰ"],["ਲ","ਲ਼"],["ਵ","ਸ਼"],["ਸ","ਹ"],["ਖ਼","ੜ"],"ਫ਼",["ੲ","ੴ"],["અ","ઍ"],["એ","ઑ"],["ઓ","ન"],["પ","ર"],["લ","ળ"],["વ","હ"],"ઽ","ૐ",["ૠ","ૡ"],"ૹ",["ଅ","ଌ"],["ଏ","ଐ"],["ଓ","ନ"],["ପ","ର"],["ଲ","ଳ"],["ଵ","ହ"],"ଽ",["ଡ଼","ଢ଼"],["ୟ","ୡ"],"ୱ","ஃ",["அ","ஊ"],["எ","ஐ"],["ஒ","க"],["ங","ச"],"ஜ",["ஞ","ட"],["ண","த"],["ந","ப"],["ம","ஹ"],"ௐ",["అ","ఌ"],["ఎ","ఐ"],["ఒ","న"],["ప","హ"],"ఽ",["ౘ","ౚ"],["ౠ","ౡ"],"ಀ",["ಅ","ಌ"],["ಎ","ಐ"],["ಒ","ನ"],["ಪ","ಳ"],["ವ","ಹ"],"ಽ","ೞ",["ೠ","ೡ"],["ೱ","ೲ"],["അ","ഌ"],["എ","ഐ"],["ഒ","ഺ"],"ഽ","ൎ",["ൔ","ൖ"],["ൟ","ൡ"],["ൺ","ൿ"],["අ","ඖ"],["ක","න"],["ඳ","ර"],"ල",["ව","ෆ"],["ก","ะ"],["า","ำ"],["เ","ๆ"],["ກ","ຂ"],"ຄ",["ງ","ຈ"],"ຊ","ຍ",["ດ","ທ"],["ນ","ຟ"],["ມ","ຣ"],"ລ","ວ",["ສ","ຫ"],["ອ","ະ"],["າ","ຳ"],"ຽ",["ເ","ໄ"],"ໆ",["ໜ","ໟ"],"ༀ",["ཀ","ཇ"],["ཉ","ཬ"],["ྈ","ྌ"],["က","ဪ"],"ဿ",["ၐ","ၕ"],["ၚ","ၝ"],"ၡ",["ၥ","ၦ"],["ၮ","ၰ"],["ၵ","ႁ"],"ႎ",["Ⴀ","Ⴥ"],"Ⴧ","Ⴭ",["ა","ჺ"],["ჼ","ቈ"],["ቊ","ቍ"],["ቐ","ቖ"],"ቘ",["ቚ","ቝ"],["በ","ኈ"],["ኊ","ኍ"],["ነ","ኰ"],["ኲ","ኵ"],["ኸ","ኾ"],"ዀ",["ዂ","ዅ"],["ወ","ዖ"],["ዘ","ጐ"],["ጒ","ጕ"],["ጘ","ፚ"],["ᎀ","ᎏ"],["Ꭰ","Ᏽ"],["ᏸ","ᏽ"],["ᐁ","ᙬ"],["ᙯ","ᙿ"],["ᚁ","ᚚ"],["ᚠ","ᛪ"],["ᛮ","ᛸ"],["ᜀ","ᜌ"],["ᜎ","ᜑ"],["ᜠ","ᜱ"],["ᝀ","ᝑ"],["ᝠ","ᝬ"],["ᝮ","ᝰ"],["ក","ឳ"],"ៗ","ៜ",["ᠠ","ᡸ"],["ᢀ","ᢄ"],["ᢇ","ᢨ"],"ᢪ",["ᢰ","ᣵ"],["ᤀ","ᤞ"],["ᥐ","ᥭ"],["ᥰ","ᥴ"],["ᦀ","ᦫ"],["ᦰ","ᧉ"],["ᨀ","ᨖ"],["ᨠ","ᩔ"],"ᪧ",["ᬅ","ᬳ"],["ᭅ","ᭋ"],["ᮃ","ᮠ"],["ᮮ","ᮯ"],["ᮺ","ᯥ"],["ᰀ","ᰣ"],["ᱍ","ᱏ"],["ᱚ","ᱽ"],["ᲀ","ᲈ"],["Ა","Ჺ"],["Ჽ","Ჿ"],["ᳩ","ᳬ"],["ᳮ","ᳱ"],["ᳵ","ᳶ"],["ᴀ","ᶿ"],["Ḁ","ἕ"],["Ἐ","Ἕ"],["ἠ","ὅ"],["Ὀ","Ὅ"],["ὐ","ὗ"],"Ὑ","Ὓ","Ὕ",["Ὗ","ώ"],["ᾀ","ᾴ"],["ᾶ","ᾼ"],"ι",["ῂ","ῄ"],["ῆ","ῌ"],["ῐ","ΐ"],["ῖ","Ί"],["ῠ","Ῥ"],["ῲ","ῴ"],["ῶ","ῼ"],"ⁱ","ⁿ",["ₐ","ₜ"],"ℂ","ℇ",["ℊ","ℓ"],"ℕ",["ℙ","ℝ"],"ℤ","Ω","ℨ",["K","ℭ"],["ℯ","ℹ"],["ℼ","ℿ"],["ⅅ","ⅉ"],"ⅎ",["Ⅰ","ↈ"],["Ⰰ","Ⱞ"],["ⰰ","ⱞ"],["Ⱡ","ⳤ"],["Ⳬ","ⳮ"],["Ⳳ","ⳳ"],["ⴀ","ⴥ"],"ⴧ","ⴭ",["ⴰ","ⵧ"],"ⵯ",["ⶀ","ⶖ"],["ⶠ","ⶦ"],["ⶨ","ⶮ"],["ⶰ","ⶶ"],["ⶸ","ⶾ"],["ⷀ","ⷆ"],["ⷈ","ⷎ"],["ⷐ","ⷖ"],["ⷘ","ⷞ"],"ⸯ",["々","〇"],["〡","〩"],["〱","〵"],["〸","〼"],["ぁ","ゖ"],["ゝ","ゟ"],["ァ","ヺ"],["ー","ヿ"],["ㄅ","ㄯ"],["ㄱ","ㆎ"],["ㆠ","ㆺ"],["ㇰ","ㇿ"],["㐀","䶵"],["一","鿯"],["ꀀ","ꒌ"],["ꓐ","ꓽ"],["ꔀ","ꘌ"],["ꘐ","ꘟ"],["ꘪ","ꘫ"],["Ꙁ","ꙮ"],["ꙿ","ꚝ"],["ꚠ","ꛯ"],["ꜗ","ꜟ"],["Ꜣ","ꞈ"],["Ꞌ","ꞹ"],["ꟷ","ꠁ"],["ꠃ","ꠅ"],["ꠇ","ꠊ"],["ꠌ","ꠢ"],["ꡀ","ꡳ"],["ꢂ","ꢳ"],["ꣲ","ꣷ"],"ꣻ",["ꣽ","ꣾ"],["ꤊ","ꤥ"],["ꤰ","ꥆ"],["ꥠ","ꥼ"],["ꦄ","ꦲ"],"ꧏ",["ꧠ","ꧤ"],["ꧦ","ꧯ"],["ꧺ","ꧾ"],["ꨀ","ꨨ"],["ꩀ","ꩂ"],["ꩄ","ꩋ"],["ꩠ","ꩶ"],"ꩺ",["ꩾ","ꪯ"],"ꪱ",["ꪵ","ꪶ"],["ꪹ","ꪽ"],"ꫀ","ꫂ",["ꫛ","ꫝ"],["ꫠ","ꫪ"],["ꫲ","ꫴ"],["ꬁ","ꬆ"],["ꬉ","ꬎ"],["ꬑ","ꬖ"],["ꬠ","ꬦ"],["ꬨ","ꬮ"],["ꬰ","ꭚ"],["ꭜ","ꭥ"],["ꭰ","ꯢ"],["가","힣"],["ힰ","ퟆ"],["ퟋ","ퟻ"],["豈","舘"],["並","龎"],["ﬀ","ﬆ"],["ﬓ","ﬗ"],"יִ",["ײַ","ﬨ"],["שׁ","זּ"],["טּ","לּ"],"מּ",["נּ","סּ"],["ףּ","פּ"],["צּ","ﮱ"],["ﯓ","ﴽ"],["ﵐ","ﶏ"],["ﶒ","ﷇ"],["ﷰ","ﷻ"],["ﹰ","ﹴ"],["ﹶ","ﻼ"],["Ａ","Ｚ"],["ａ","ｚ"],["ｦ","ﾾ"],["ￂ","ￇ"],["ￊ","ￏ"],["ￒ","ￗ"],["ￚ","ￜ"]],!1,!1),je=Q("[",!1),Yt=Q("]",!1),os=Q("{",!1),rs=Q("}",!1),ze=Q("%",!1),nn=Q("<",!1),ae=Q(">",!1),xn=mt(["@","_"],!1,!1),kt=Q("!",!1),ne=Q("(",!1),le=Q(")",!1),ye=Q("/",!1),Ge=Q("*",!1),Pe=Q("?",!1),Tt=Q(":",!1),it=Q("..",!1),h2=Q("^",!1),f2=Q("struct",!1),m2=Q("target",!1),y2=Q("euclid",!1),b2=Q("slow",!1),g2=Q("rotL",!1),X2=Q("rotR",!1),G2=Q("fast",!1),Z2=Q("scale",!1),w2=Q("//",!1),ih=mt([`
`],!0,!1),W2=Q("cat",!1),F2=Q("$",!1),v2=Q("setcps",!1),V2=Q("setbpm",!1),C2=Q("hush",!1),L2=function(){return parseFloat(hX())},z2=function(c){const d=c.join("");return d==="."||d==="_"},M2=function(c){return new nG(c.join(""))},R2=function(c){return c},x2=function(c,d){return c.arguments_.stepsPerCycle=d,c},B2=function(c){return c},S2=function(c){return c.arguments_.alignment="polymeter_slowcat",c},Y2=function(c){return d=>d.options_.weight=(d.options_.weight??1)+(c??2)-1},k2=function(c){return d=>{const y=(d.options_.reps??1)+(c??2)-1;d.options_.reps=y,d.options_.ops=d.options_.ops.filter(W=>W.type_!=="replicate"),d.options_.ops.push({type_:"replicate",arguments_:{amount:y}}),d.options_.weight=y}},T2=function(c,d,y){return W=>W.options_.ops.push({type_:"bjorklund",arguments_:{pulse:c,step:d,rotation:y}})},A2=function(c){return d=>d.options_.ops.push({type_:"stretch",arguments_:{amount:c,type:"slow"}})},N2=function(c){return d=>d.options_.ops.push({type_:"stretch",arguments_:{amount:c,type:"fast"}})},_2=function(c){return d=>d.options_.ops.push({type_:"degradeBy",arguments_:{amount:c,seed:Lo++}})},K2=function(c){return d=>d.options_.ops.push({type_:"tail",arguments_:{element:c}})},H2=function(c){return d=>d.options_.ops.push({type_:"range",arguments_:{element:c}})},P2=function(c,d){const y=new oG(c,{ops:[],weight:1,reps:1});for(const W of d)W(y);return y},E2=function(c,d){return new as(d,"fastcat",void 0,!!c)},D2=function(c){return{alignment:"stack",list:c}},I2=function(c){return{alignment:"rand",list:c,seed:Lo++}},J2=function(c){return{alignment:"feet",list:c,seed:Lo++}},j2=function(c,d){return d&&d.list.length>0?new as([c,...d.list],d.alignment,d.seed):c},O2=function(c,d){return new as(d?[c,...d.list]:[c],"polymeter")},U2=function(c){return c},Q2=function(c){return{name:"struct",args:{mini:c}}},q2=function(c){return{name:"target",args:{name:c}}},$2=function(c,d,y){return{name:"bjorklund",args:{pulse:c,step:parseInt(d)}}},eX=function(c){return{name:"stretch",args:{amount:c}}},tX=function(c){return{name:"shift",args:{amount:"-"+c}}},nX=function(c){return{name:"shift",args:{amount:c}}},sX=function(c){return{name:"stretch",args:{amount:"1/"+c}}},oX=function(c){return{name:"scale",args:{scale:c.join("")}}},uh=function(c,d){return d},rX=function(c,d){return d.unshift(c),new as(d,"slowcat")},cX=function(c){return c},iX=function(c,d){return new sG(c.name,c.args,d)},uX=function(c){return c},aX=function(c){return c},lX=function(c){return new Co("setcps",{value:c})},dX=function(c){return new Co("setcps",{value:c/120/2})},pX=function(){return new Co("hush")},m=t.peg$currPos|0,P=m,sn=[{line:1,column:1}],tt=m,cs=t.peg$maxFailExpected||[],S=t.peg$silentFails|0,Bn;if(t.startRule){if(!(t.startRule in o))throw new Error(`Can't start parsing from rule "`+t.startRule+'".');r=o[t.startRule]}function hX(){return e.substring(P,m)}function ah(){return vo(P,m)}function Q(c,d){return{type:"literal",text:c,ignoreCase:d}}function mt(c,d,y){return{type:"class",parts:c,inverted:d,ignoreCase:y}}function fX(){return{type:"end"}}function Fo(c){return{type:"other",description:c}}function lh(c){var d=sn[c],y;if(d)return d;if(c>=sn.length)y=sn.length-1;else for(y=c;!sn[--y];);for(d=sn[y],d={line:d.line,column:d.column};y<c;)e.charCodeAt(y)===10?(d.line++,d.column=1):d.column++,y++;return sn[c]=d,d}function vo(c,d,y){var W=lh(c),Y=lh(d),fe={source:s,start:{offset:c,line:W.line,column:W.column},end:{offset:d,line:Y.line,column:Y.column}};return fe}function A(c){m<tt||(m>tt&&(tt=m,cs=[]),cs.push(c))}function mX(c,d,y){return new Vt(Vt.buildMessage(c,d),c,d,y)}function dh(){var c;return c=tG(),c}function yt(){var c,d;return S++,c=m,ZX(),d=is(),d!==n?(GX(),XX(),P=c,c=L2()):(m=c,c=n),S--,c===n&&S===0&&A(Ln),c}function yX(){var c;return e.charCodeAt(m)===46?(c=i,m++):(c=n,S===0&&A(wt)),c}function bX(){var c;return c=e.charAt(m),ie.test(c)?m++:(c=n,S===0&&A($t)),c}function gX(){var c;return c=e.charAt(m),rt.test(c)?m++:(c=n,S===0&&A(ft)),c}function XX(){var c,d,y,W,Y;if(c=m,d=gX(),d!==n){if(y=e.charAt(m),Le.test(y)?m++:(y=n,S===0&&A(Rt)),y===n&&(y=null),W=[],Y=on(),Y!==n)for(;Y!==n;)W.push(Y),Y=on();else W=n;W!==n?(d=[d,y,W],c=d):(m=c,c=n)}else m=c,c=n;return c}function GX(){var c,d,y,W;if(c=m,d=yX(),d!==n){if(y=[],W=on(),W!==n)for(;W!==n;)y.push(W),W=on();else y=n;y!==n?(d=[d,y],c=d):(m=c,c=n)}else m=c,c=n;return c}function is(){var c,d,y,W;if(c=wX(),c===n)if(c=m,d=bX(),d!==n){for(y=[],W=on();W!==n;)y.push(W),W=on();d=[d,y],c=d}else m=c,c=n;return c}function ZX(){var c;return e.charCodeAt(m)===45?(c=u,m++):(c=n,S===0&&A(xt)),c}function wX(){var c;return e.charCodeAt(m)===48?(c=a,m++):(c=n,S===0&&A(Bt)),c}function on(){var c;return c=e.charAt(m),ee.test(c)?m++:(c=n,S===0&&A(en)),c}function _(){var c,d;for(S++,c=[],d=e.charAt(m),re.test(d)?m++:(d=n,S===0&&A(ct));d!==n;)c.push(d),d=e.charAt(m),re.test(d)?m++:(d=n,S===0&&A(ct));return S--,d=n,S===0&&A(St),c}function rn(){var c,d,y,W;return c=m,d=_(),e.charCodeAt(m)===44?(y=l,m++):(y=n,S===0&&A(zn)),y!==n?(W=_(),d=[d,y,W],c=d):(m=c,c=n),c}function ph(){var c,d,y,W;return c=m,d=_(),e.charCodeAt(m)===124?(y=p,m++):(y=n,S===0&&A(tn)),y!==n?(W=_(),d=[d,y,W],c=d):(m=c,c=n),c}function hh(){var c,d,y,W;return c=m,d=_(),e.charCodeAt(m)===46?(y=i,m++):(y=n,S===0&&A(wt)),y!==n?(W=_(),d=[d,y,W],c=d):(m=c,c=n),c}function cn(){var c;return c=e.charAt(m),Ie.test(c)?m++:(c=n,S===0&&A(Mn)),c}function us(){var c;return S++,c=e.charAt(m),Je.test(c)?m++:(c=n,S===0&&A(Rn)),S--,c===n&&S===0&&A(ss),c}function fh(){var c,d,y,W;if(c=m,_(),d=[],y=us(),y!==n)for(;y!==n;)d.push(y),y=us();else d=n;return d!==n?(y=_(),P=m,W=z2(d),W?W=n:W=void 0,W!==n?(P=c,c=M2(d)):(m=c,c=n)):(m=c,c=n),c}function WX(){var c,d,y,W;return c=m,_(),e.charCodeAt(m)===91?(d=f,m++):(d=n,S===0&&A(je)),d!==n?(_(),y=bh(),y!==n?(_(),e.charCodeAt(m)===93?(W=g,m++):(W=n,S===0&&A(Yt)),W!==n?(_(),P=c,c=R2(y)):(m=c,c=n)):(m=c,c=n)):(m=c,c=n),c}function FX(){var c,d,y,W,Y;return c=m,_(),e.charCodeAt(m)===123?(d=X,m++):(d=n,S===0&&A(os)),d!==n?(_(),y=gh(),y!==n?(_(),e.charCodeAt(m)===125?(W=G,m++):(W=n,S===0&&A(rs)),W!==n?(Y=vX(),Y===n&&(Y=null),_(),P=c,c=x2(y,Y)):(m=c,c=n)):(m=c,c=n)):(m=c,c=n),c}function vX(){var c,d,y;return c=m,e.charCodeAt(m)===37?(d=w,m++):(d=n,S===0&&A(ze)),d!==n?(y=un(),y!==n?(P=c,c=B2(y)):(m=c,c=n)):(m=c,c=n),c}function VX(){var c,d,y,W;return c=m,_(),e.charCodeAt(m)===60?(d=F,m++):(d=n,S===0&&A(nn)),d!==n?(_(),y=gh(),y!==n?(_(),e.charCodeAt(m)===62?(W=v,m++):(W=n,S===0&&A(ae)),W!==n?(_(),P=c,c=S2(y)):(m=c,c=n)):(m=c,c=n)):(m=c,c=n),c}function un(){var c;return c=fh(),c===n&&(c=WX(),c===n&&(c=FX(),c===n&&(c=VX()))),c}function mh(){var c;return c=CX(),c===n&&(c=zX(),c===n&&(c=MX(),c===n&&(c=RX(),c===n&&(c=LX(),c===n&&(c=xX(),c===n&&(c=BX(),c===n&&(c=SX()))))))),c}function CX(){var c,d,y;return c=m,_(),d=e.charAt(m),we.test(d)?m++:(d=n,S===0&&A(xn)),d!==n?(y=yt(),y===n&&(y=null),P=c,c=Y2(y)):(m=c,c=n),c}function LX(){var c,d,y;return c=m,_(),e.charCodeAt(m)===33?(d=z,m++):(d=n,S===0&&A(kt)),d!==n?(y=yt(),y===n&&(y=null),P=c,c=k2(y)):(m=c,c=n),c}function zX(){var c,d,y,W,Y,fe,nt;return c=m,e.charCodeAt(m)===40?(d=B,m++):(d=n,S===0&&A(ne)),d!==n?(_(),y=Sn(),y!==n?(_(),W=rn(),W!==n?(_(),Y=Sn(),Y!==n?(_(),rn(),_(),fe=Sn(),fe===n&&(fe=null),_(),e.charCodeAt(m)===41?(nt=x,m++):(nt=n,S===0&&A(le)),nt!==n?(P=c,c=T2(y,Y,fe)):(m=c,c=n)):(m=c,c=n)):(m=c,c=n)):(m=c,c=n)):(m=c,c=n),c}function MX(){var c,d,y;return c=m,e.charCodeAt(m)===47?(d=R,m++):(d=n,S===0&&A(ye)),d!==n?(y=un(),y!==n?(P=c,c=A2(y)):(m=c,c=n)):(m=c,c=n),c}function RX(){var c,d,y;return c=m,e.charCodeAt(m)===42?(d=N,m++):(d=n,S===0&&A(Ge)),d!==n?(y=un(),y!==n?(P=c,c=N2(y)):(m=c,c=n)):(m=c,c=n),c}function xX(){var c,d,y;return c=m,e.charCodeAt(m)===63?(d=O,m++):(d=n,S===0&&A(Pe)),d!==n?(y=yt(),y===n&&(y=null),P=c,c=_2(y)):(m=c,c=n),c}function BX(){var c,d,y;return c=m,e.charCodeAt(m)===58?(d=j,m++):(d=n,S===0&&A(Tt)),d!==n?(y=un(),y!==n?(P=c,c=K2(y)):(m=c,c=n)):(m=c,c=n),c}function SX(){var c,d,y;return c=m,e.substr(m,2)===te?(d=te,m+=2):(d=n,S===0&&A(it)),d!==n?(y=un(),y!==n?(P=c,c=H2(y)):(m=c,c=n)):(m=c,c=n),c}function Sn(){var c,d,y,W;if(c=m,d=un(),d!==n){for(y=[],W=mh();W!==n;)y.push(W),W=mh();P=c,c=P2(d,y)}else m=c,c=n;return c}function Wt(){var c,d,y,W;if(c=m,e.charCodeAt(m)===94?(d=T,m++):(d=n,S===0&&A(h2)),d===n&&(d=null),y=[],W=Sn(),W!==n)for(;W!==n;)y.push(W),W=Sn();else y=n;return y!==n?(P=c,c=E2(d,y)):(m=c,c=n),c}function yh(){var c,d,y,W,Y;if(c=m,d=[],y=m,W=rn(),W!==n?(Y=Wt(),Y!==n?y=Y:(m=y,y=n)):(m=y,y=n),y!==n)for(;y!==n;)d.push(y),y=m,W=rn(),W!==n?(Y=Wt(),Y!==n?y=Y:(m=y,y=n)):(m=y,y=n);else d=n;return d!==n&&(P=c,d=D2(d)),c=d,c}function YX(){var c,d,y,W,Y;if(c=m,d=[],y=m,W=ph(),W!==n?(Y=Wt(),Y!==n?y=Y:(m=y,y=n)):(m=y,y=n),y!==n)for(;y!==n;)d.push(y),y=m,W=ph(),W!==n?(Y=Wt(),Y!==n?y=Y:(m=y,y=n)):(m=y,y=n);else d=n;return d!==n&&(P=c,d=I2(d)),c=d,c}function kX(){var c,d,y,W,Y;if(c=m,d=[],y=m,W=hh(),W!==n?(Y=Wt(),Y!==n?y=Y:(m=y,y=n)):(m=y,y=n),y!==n)for(;y!==n;)d.push(y),y=m,W=hh(),W!==n?(Y=Wt(),Y!==n?y=Y:(m=y,y=n)):(m=y,y=n);else d=n;return d!==n&&(P=c,d=J2(d)),c=d,c}function bh(){var c,d,y;return c=m,d=Wt(),d!==n?(y=yh(),y===n&&(y=YX(),y===n&&(y=kX())),y===n&&(y=null),P=c,c=j2(d,y)):(m=c,c=n),c}function gh(){var c,d,y;return c=m,d=Wt(),d!==n?(y=yh(),y===n&&(y=null),P=c,c=O2(d,y)):(m=c,c=n),c}function TX(){var c,d,y,W;return c=m,_(),d=cn(),d!==n?(_(),y=bh(),y!==n?(_(),W=cn(),W!==n?(P=c,c=U2(y)):(m=c,c=n)):(m=c,c=n)):(m=c,c=n),c}function AX(){var c;return c=IX(),c===n&&(c=HX(),c===n&&(c=DX(),c===n&&(c=_X(),c===n&&(c=KX(),c===n&&(c=NX(),c===n&&(c=EX(),c===n&&(c=PX()))))))),c}function NX(){var c,d,y;return c=m,e.substr(m,6)===ue?(d=ue,m+=6):(d=n,S===0&&A(f2)),d!==n?(_(),y=an(),y!==n?(P=c,c=Q2(y)):(m=c,c=n)):(m=c,c=n),c}function _X(){var c,d,y,W,Y;return c=m,e.substr(m,6)===H?(d=H,m+=6):(d=n,S===0&&A(m2)),d!==n?(_(),y=cn(),y!==n?(W=fh(),W!==n?(Y=cn(),Y!==n?(P=c,c=q2(W)):(m=c,c=n)):(m=c,c=n)):(m=c,c=n)):(m=c,c=n),c}function KX(){var c,d,y,W;return c=m,e.substr(m,6)===q?(d=q,m+=6):(d=n,S===0&&A(y2)),d!==n?(_(),y=is(),y!==n?(_(),W=is(),W!==n?(_(),is(),P=c,c=$2(y,W)):(m=c,c=n)):(m=c,c=n)):(m=c,c=n),c}function HX(){var c,d,y;return c=m,e.substr(m,4)===U?(d=U,m+=4):(d=n,S===0&&A(b2)),d!==n?(_(),y=yt(),y!==n?(P=c,c=eX(y)):(m=c,c=n)):(m=c,c=n),c}function PX(){var c,d,y;return c=m,e.substr(m,4)===pe?(d=pe,m+=4):(d=n,S===0&&A(g2)),d!==n?(_(),y=yt(),y!==n?(P=c,c=tX(y)):(m=c,c=n)):(m=c,c=n),c}function EX(){var c,d,y;return c=m,e.substr(m,4)===$?(d=$,m+=4):(d=n,S===0&&A(X2)),d!==n?(_(),y=yt(),y!==n?(P=c,c=nX(y)):(m=c,c=n)):(m=c,c=n),c}function DX(){var c,d,y;return c=m,e.substr(m,4)===oe?(d=oe,m+=4):(d=n,S===0&&A(G2)),d!==n?(_(),y=yt(),y!==n?(P=c,c=sX(y)):(m=c,c=n)):(m=c,c=n),c}function IX(){var c,d,y,W,Y;if(c=m,e.substr(m,5)===he?(d=he,m+=5):(d=n,S===0&&A(Z2)),d!==n)if(_(),y=cn(),y!==n){if(W=[],Y=us(),Y!==n)for(;Y!==n;)W.push(Y),Y=us();else W=n;W!==n?(Y=cn(),Y!==n?(P=c,c=oX(W)):(m=c,c=n)):(m=c,c=n)}else m=c,c=n;else m=c,c=n;return c}function Vo(){var c,d,y,W;if(c=m,e.substr(m,2)===Ve?(d=Ve,m+=2):(d=n,S===0&&A(w2)),d!==n){for(y=[],W=e.charAt(m),Zt.test(W)?m++:(W=n,S===0&&A(ih));W!==n;)y.push(W),W=e.charAt(m),Zt.test(W)?m++:(W=n,S===0&&A(ih));d=[d,y],c=d}else m=c,c=n;return c}function JX(){var c,d,y,W,Y,fe,nt,ln;if(c=m,e.substr(m,3)===He?(d=He,m+=3):(d=n,S===0&&A(W2)),d!==n)if(_(),e.charCodeAt(m)===91?(y=f,m++):(y=n,S===0&&A(je)),y!==n)if(_(),W=an(),W!==n){for(Y=[],fe=m,nt=rn(),nt!==n?(ln=an(),ln!==n?(P=fe,fe=uh(W,ln)):(m=fe,fe=n)):(m=fe,fe=n);fe!==n;)Y.push(fe),fe=m,nt=rn(),nt!==n?(ln=an(),ln!==n?(P=fe,fe=uh(W,ln)):(m=fe,fe=n)):(m=fe,fe=n);fe=_(),e.charCodeAt(m)===93?(nt=g,m++):(nt=n,S===0&&A(Yt)),nt!==n?(P=c,c=rX(W,Y)):(m=c,c=n)}else m=c,c=n;else m=c,c=n;else m=c,c=n;return c}function jX(){var c;return c=JX(),c===n&&(c=TX()),c}function an(){var c,d,y,W,Y;if(c=m,d=jX(),d!==n){for(_(),y=[],W=Vo();W!==n;)y.push(W),W=Vo();P=c,c=cX(d)}else m=c,c=n;return c===n&&(c=m,d=AX(),d!==n?(_(),e.charCodeAt(m)===36?(y=Te,m++):(y=n,S===0&&A(F2)),y!==n?(W=_(),Y=an(),Y!==n?(P=c,c=iX(d,Y)):(m=c,c=n)):(m=c,c=n)):(m=c,c=n)),c}function OX(){var c,d;return c=m,d=an(),d!==n&&(P=c,d=uX(d)),c=d,c===n&&(c=Vo()),c}function UX(){var c;return c=OX(),c}function QX(){var c,d;return c=m,_(),d=qX(),d===n&&(d=$X(),d===n&&(d=eG())),d!==n?(_(),P=c,c=aX(d)):(m=c,c=n),c}function qX(){var c,d,y;return c=m,e.substr(m,6)===K?(d=K,m+=6):(d=n,S===0&&A(v2)),d!==n?(_(),y=yt(),y!==n?(P=c,c=lX(y)):(m=c,c=n)):(m=c,c=n),c}function $X(){var c,d,y;return c=m,e.substr(m,6)===I?(d=I,m+=6):(d=n,S===0&&A(V2)),d!==n?(_(),y=yt(),y!==n?(P=c,c=dX(y)):(m=c,c=n)):(m=c,c=n),c}function eG(){var c,d;return c=m,e.substr(m,4)===et?(d=et,m+=4):(d=n,S===0&&A(C2)),d!==n&&(P=c,d=pX()),c=d,c}function tG(){var c;return c=UX(),c===n&&(c=QX()),c}var nG=function(c){this.type_="atom",this.source_=c,this.location_=ah()},as=function(c,d,y,W){this.type_="pattern",this.arguments_={alignment:d,_steps:W},y!==void 0&&(this.arguments_.seed=y),this.source_=c},sG=function(c,d,y){this.type_=c,this.arguments_=d,this.source_=y},oG=function(c,d){this.type_="element",this.source_=c,this.options_=d,this.location_=ah()},Co=function(c,d){this.type_="command",this.name_=c,this.options_=d},Lo=0;if(Bn=r(),t.peg$library)return{peg$result:Bn,peg$currPos:m,peg$FAILED:n,peg$maxFailExpected:cs,peg$maxFailPos:tt};if(Bn!==n&&m===e.length)return Bn;throw Bn!==n&&m<e.length&&A(fX()),mX(cs,tt<e.length?e.charAt(tt):null,tt<e.length?vo(tt,tt+1):vo(tt,tt))}const Lb=["start"],K0=3e-4,zb=(e,t)=>(n,s)=>{const i=e.source_[s].options_?.ops,u=n.__steps_source;if(i)for(const a of i)switch(a.type_){case"stretch":{const l=["fast","slow"],{type:p,amount:f}=a.arguments_;if(!l.includes(p))throw new Error(`mini: stretch: type must be one of ${l.join("|")} but got ${p}`);n=V(n)[p](t(f));break}case"replicate":{const{amount:l}=a.arguments_;n=V(n),n=n._repeatCycles(l)._fast(l);break}case"bjorklund":{a.arguments_.rotation?n=n.euclidRot(t(a.arguments_.pulse),t(a.arguments_.step),t(a.arguments_.rotation)):n=n.euclid(t(a.arguments_.pulse),t(a.arguments_.step));break}case"degradeBy":{n=V(n)._degradeByWith(Me.early(K0*a.arguments_.seed),a.arguments_.amount??.5);break}case"tail":{const l=t(a.arguments_.element);n=n.fmap(p=>f=>Array.isArray(p)?[...p,f]:[p,f]).appLeft(l);break}case"range":{const l=t(a.arguments_.element);n=V(n);const p=(g,X,G=1)=>Array.from({length:Math.abs(X-g)/G+1},(w,F)=>g<X?g+F*G:g-F*G);n=((g,X)=>g.squeezeBind(G=>X.bind(w=>Ce(...p(G,w)))))(n,l);break}default:console.warn(`operator "${a.type_}" not implemented`)}return n.__steps_source=n.__steps_source||u,n};function Dt(e,t,n,s=0){n?.(e);const o=r=>Dt(r,t,n,s);switch(e.type_){case"pattern":{const r=e.source_.map(l=>o(l)).map(zb(e,o)),i=e.arguments_.alignment,u=r.filter(l=>l.__steps_source);let a;switch(i){case"stack":{a=me(...r),u.length&&(a._steps=Ue(...u.map(l=>C(l._steps))));break}case"polymeter_slowcat":{a=me(...r.map(l=>l._slow(l.__weight))),u.length&&(a._steps=Ue(...u.map(l=>C(l._steps))));break}case"polymeter":{const l=e.arguments_.stepsPerCycle?o(e.arguments_.stepsPerCycle).fmap(f=>C(f)):Xe(C(r.length>0?r[0].__weight:1)),p=r.map(f=>f.fast(l.fmap(g=>g.div(f.__weight))));a=me(...p);break}case"rand":{a=In(Me.early(K0*e.arguments_.seed).segment(1),r),u.length&&(a._steps=Ue(...u.map(l=>C(l._steps))));break}case"feet":{a=Ce(...r);break}default:{if(e.source_.some(p=>!!p.options_?.weight)){const p=e.source_.reduce((f,g)=>f.add(g.options_?.weight||C(1)),C(0));a=zs(...e.source_.map((f,g)=>[f.options_?.weight||C(1),r[g]])),a.__weight=p,a._steps=p,u.length&&(a._steps=a._steps.mul(Ue(...u.map(f=>C(f._steps)))))}else a=Qe(...r),a._steps=r.length;e.arguments_._steps&&(a.__steps_source=!0)}}return u.length&&(a.__steps_source=!0),a}case"element":return o(e.source_);case"atom":{if(e.source_==="~"||e.source_==="-")return se;if(!e.location_)return console.warn("no location for",e),e.source_;const r=isNaN(Number(e.source_))?e.source_:Number(e.source_);if(s===-1)return Xe(r);const[i,u]=Us(t,e,s);return Xe(r).withLoc(i,u)}case"stretch":return o(e.source_).slow(o(e.arguments_.amount));default:return console.warn(`node type "${e.type_}" not implemented -> returning silence`),se}}const Us=(e,t,n=0)=>{const{start:s,end:o}=t.location_,r=e?.split("").slice(s.offset,o.offset).join(""),[i=0,u=0]=r?r.split(t.source_).map(a=>a.split("").filter(l=>l===" ").length):[];return[s.offset+i+n,o.offset-u+n]},Xn=(e,t=0,n=e)=>{try{return _0(e)}catch(s){const o=[s.location.start.offset+t,s.location.end.offset+t],r=n.slice(0,o[0]).split(`
`).length;throw new Error(`[mini] parse error at line ${r}: ${s.message}`)}},H0=(e,t,n)=>{const s=Xn(e,t,n);let o=[];return Dt(s,e,r=>{r.type_==="atom"&&o.push(r)},-1),o},Mb=(e,t=0,n)=>H0(e,t,n).map(s=>Us(e,s,t)),Qs=(...e)=>{const t=e.map(n=>{const s=`"${n}"`,o=Xn(s);return Dt(o,s)});return Qe(...t)},Rb=(e,t)=>{const n=`"${e}"`,s=Xn(n);return Dt(s,n,null,t)},xb=e=>{const t=Xn(e);return Dt(t,e)};function Bb(e){return typeof e=="string"?Qs(e):V(e)}function P0(){Uo(Qs)}const Sb=Object.freeze(Object.defineProperty({__proto__:null,StartRules:Lb,SyntaxError:Vt,getLeafLocation:Us,getLeafLocations:Mb,getLeaves:H0,h:xb,m:Rb,mini:Qs,mini2ast:Xn,miniAllStrings:P0,minify:Bb,parse:_0,patternifyAST:Dt},Symbol.toStringTag,{value:"Module"}));if(typeof DelayNode<"u"){class e extends DelayNode{constructor(n,s,o,r){super(n),s=Math.abs(s),this.delayTime.value=o;const i=n.createGain();i.gain.value=Math.min(Math.abs(r),.995),this.feedback=i.gain;const u=n.createGain();return u.gain.value=s,this.delayGain=u,this.connect(i),this.connect(u),i.connect(this),this.connect=a=>u.connect(a),this}start(n){this.delayGain.gain.setValueAtTime(this.delayGain.gain.value,n+this.delayTime.value)}}AudioContext.prototype.createFeedbackDelay=function(t,n,s){return new e(this,t,n,s)}}var qs={};qs.generateReverb=function(e,t){for(var n=e.audioContext||new AudioContext,s=n.sampleRate,o=e.numChannels||2,r=e.decayTime*1.5,i=Math.round(e.decayTime*s),u=Math.round(r*s),a=Math.round((e.fadeInTime||0)*s),l=Math.pow(1/1e3,1/i),p=n.createBuffer(o,u,s),f=0;f<o;f++){for(var g=p.getChannelData(f),X=0;X<u;X++)g[X]=Tb()*Math.pow(l,X);for(var X=0;X<a;X++)g[X]*=X/a}Yb(p,e.lpFreqStart||0,e.lpFreqEnd||0,e.decayTime,t)},qs.generateGraph=function(e,t,n,s,o){var r=document.createElement("canvas");r.width=t,r.height=n;var i=r.getContext("2d");i.fillStyle="#000",i.fillRect(0,0,r.width,r.height),i.fillStyle="#fff";for(var u=t/e.length,a=n/(o-s),l=0;l<e.length;l++)i.fillRect(l*u,n-(e[l]-s)*a,1,1);return r};var Yb=function(e,t,n,s,o){if(t==0){o(e);return}var r=kb(e),i=new OfflineAudioContext(e.numberOfChannels,r[0].length,e.sampleRate),u=i.createBufferSource();u.buffer=e;var a=i.createBiquadFilter();t=Math.min(t,e.sampleRate/2),n=Math.min(n,e.sampleRate/2),a.type="lowpass",a.Q.value=1e-4,a.frequency.setValueAtTime(t,0),a.frequency.linearRampToValueAtTime(n,s),u.connect(a),a.connect(i.destination),u.start(),i.oncomplete=function(l){o(l.renderedBuffer),a.disconnect(),u.disconnect()},i.startRendering(),window.filterNode=a},kb=function(e){for(var t=[],n=0;n<e.numberOfChannels;n++)t[n]=e.getChannelData(n);return t},Tb=function(){return Math.random()*2-1};let E0=e=>console.log(e);function D0(e,t="superdough"){process.env.NODE_ENV==="development"&&console.error(e),Ze(`[${t}] error: ${e.message}`)}const Ze=(...e)=>E0(...e),I0=e=>{E0=e},Ab=e=>{if(typeof e!="string")return[];const[t,n="",s]=e.match(/^([a-gA-G])([#bsf]*)(-?[0-9]*)$/)?.slice(1)||[];return t?[t,n,s?Number(s):void 0]:[]},Nb={c:0,d:2,e:4,f:5,g:7,a:9,b:11},_b={"#":1,b:-1,s:1,f:-1},Kb=e=>e?.split("").reduce((t,n)=>t+_b[n],0)||0,jn=(e,t=3)=>{const[n,s,o=t]=Ab(e);if(!n)throw new Error('not a note: "'+e+'"');const r=Nb[n.toLowerCase()],i=Kb(s);return(Number(o)+1)*12+r+i},J0=e=>Math.pow(2,(e-69)/12)*440,Xt=(e,t,n)=>Math.min(Math.max(e,t),n),Hb=e=>12*Math.log(e/440)/Math.LN2+69,Pb=(e,t)=>{if(typeof e!="object")throw new Error("valueToMidi: expected object value");let{freq:n,note:s}=e;return typeof n=="number"?Hb(n):typeof s=="string"?jn(s):typeof s=="number"?s:t};function lt(e,t=0,n){return isNaN(Number(e))?(!n&&Ze(`"${e}" is not a number, falling back to ${t}`,"warning"),t):e}const j0=(e,t)=>(e%t+t)%t,O0=(e,t)=>j0(Math.round(lt(e,0)),t);function Eb(e,t){return e/t}function U0(e,t){const{s:n,n:s=0}=e;let o=Pb(e,36),r=o-36,i,u=0;if(Array.isArray(t))u=O0(s,t.length),i=t[u];else{const l=f=>jn(f)-o,p=Object.keys(t).filter(f=>!f.startsWith("_")).reduce((f,g,X)=>!f||Math.abs(l(g))<Math.abs(l(f))?g:f,null);r=-l(p),u=O0(s,t[p].length),i=t[p][u]}const a=`${n}:${u}`;return{transpose:r,url:i,index:u,midi:o,label:a}}const $s=(e,t)=>Object.fromEntries(Object.entries(t).map(([n,s])=>[n,e[s]])),Q0=e=>{try{return new URL(".",new URL(e)).href.replace(/\/$/,"")}catch{return e.split("/").slice(0,-1).join("/")}};typeof AudioContext<"u"&&(AudioContext.prototype.adjustLength=function(e,t,n=1,s=0){const o=Math.floor(Xt(s,0,1)*t.length),r=t.sampleRate*e,i=this.createBuffer(t.numberOfChannels,t.length,t.sampleRate);for(let u=0;u<t.numberOfChannels;u++){let a=t.getChannelData(u),l=i.getChannelData(u);for(let p=0;p<r;p++){let f=(o+p*Math.abs(n))%a.length;n<1&&(f=f*-1),l[p]=a.at(f)||0}}return i},AudioContext.prototype.createReverb=function(e,t,n,s,o,r,i){const u=this.createConvolver();return u.generate=(a=2,l=.1,p=15e3,f=1e3,g,X,G)=>{u.duration=a,u.fade=l,u.lp=p,u.dim=f,u.ir=g,u.irspeed=X,u.irbegin=G,g?u.buffer=this.adjustLength(a,g,X,G):qs.generateReverb({audioContext:this,numChannels:2,decayTime:a,fadeInTime:l,lpFreqStart:p,lpFreqEnd:f},w=>{u.buffer=w})},u.generate(e,t,n,s,o,r,i),u});var q0={a:{freqs:[660,1120,2750,3e3,3350],gains:[1,.5012,.0708,.0631,.0126],qs:[80,90,120,130,140]},e:{freqs:[440,1800,2700,3e3,3300],gains:[1,.1995,.1259,.1,.1],qs:[70,80,100,120,120]},i:{freqs:[270,1850,2900,3350,3590],gains:[1,.0631,.0631,.0158,.0158],qs:[40,90,100,120,120]},o:{freqs:[430,820,2700,3e3,3300],gains:[1,.3162,.0501,.0794,.01995],qs:[40,80,100,120,120]},u:{freqs:[370,630,2750,3e3,3400],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]},ae:{freqs:[650,1515,2400,3e3,3350],gains:[1,.5,.1008,.0631,.0126],qs:[80,90,120,130,140]},aa:{freqs:[560,900,2570,3e3,3300],gains:[1,.5,.0708,.0631,.0126],qs:[80,90,120,130,140]},oe:{freqs:[500,1430,2300,3e3,3300],gains:[1,.2,.0708,.0316,.01995],qs:[40,60,100,120,120]},ue:{freqs:[250,1750,2150,3200,3300],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]},y:{freqs:[400,1460,2400,3e3,3300],gains:[1,.2,.0708,.0316,.02995],qs:[40,60,100,120,120]},uh:{freqs:[600,1250,2100,3100,3500],gains:[1,.3,.0608,.0316,.01995],qs:[40,70,100,120,130]},un:{freqs:[500,1240,2280,3e3,3500],gains:[1,.1,.1708,.0216,.02995],qs:[40,60,100,120,120]},en:{freqs:[600,1480,2450,3200,3300],gains:[1,.15,.0708,.0316,.02995],qs:[40,60,100,120,120]},an:{freqs:[700,1050,2500,3e3,3300],gains:[1,.1,.0708,.0316,.02995],qs:[40,60,100,120,120]},on:{freqs:[500,1080,2350,3e3,3300],gains:[1,.1,.0708,.0316,.02995],qs:[40,60,100,120,120]},get æ(){return this.ae},get ø(){return this.oe},get ɑ(){return this.aa},get å(){return this.aa},get ö(){return this.oe},get ü(){return this.ue},get ı(){return this.y}};if(typeof GainNode<"u"){class e extends GainNode{constructor(n,s){if(super(n),!q0[s])throw new Error("vowel: unknown vowel "+s);const{gains:o,qs:r,freqs:i}=q0[s];this.makeupGain=n.createGain(),this.audioNodes=[];for(let u=0;u<5;u++){const a=n.createGain();a.gain.value=o[u];const l=n.createBiquadFilter();l.type="bandpass",l.Q.value=r[u],l.frequency.value=i[u],super.connect(l),l.connect(a),this.audioNodes.push(l),a.connect(this.makeupGain),this.audioNodes.push(a)}return this.makeupGain.gain.value=8,this}connect(n){this.makeupGain.connect(n)}disconnect(){this.makeupGain.disconnect(),this.audioNodes.forEach(n=>n.disconnect()),super.disconnect(),this.makeupGain=null,this.audioNodes=null}}AudioContext.prototype.createVowelFilter=function(t){return new e(this,t)}}const Db="data:text/javascript;base64,dmFyIF89KGZ1bmN0aW9uKGZ0KXsidXNlIHN0cmljdCI7Y2xhc3Mga3QgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3J7Y29uc3RydWN0b3IodCl7c3VwZXIodCksdGhpcy5zdGFydGVkPSExLHRoaXMubmJJbnB1dHM9dC5udW1iZXJPZklucHV0cyx0aGlzLm5iT3V0cHV0cz10Lm51bWJlck9mT3V0cHV0cyx0aGlzLmJsb2NrU2l6ZT10LnByb2Nlc3Nvck9wdGlvbnMuYmxvY2tTaXplLHRoaXMuaG9wU2l6ZT0xMjgsdGhpcy5uYk92ZXJsYXBzPXRoaXMuYmxvY2tTaXplL3RoaXMuaG9wU2l6ZSx0aGlzLmlucHV0QnVmZmVycz1uZXcgQXJyYXkodGhpcy5uYklucHV0cyksdGhpcy5pbnB1dEJ1ZmZlcnNIZWFkPW5ldyBBcnJheSh0aGlzLm5iSW5wdXRzKSx0aGlzLmlucHV0QnVmZmVyc1RvU2VuZD1uZXcgQXJyYXkodGhpcy5uYklucHV0cyk7Zm9yKGxldCBlPTA7ZTx0aGlzLm5iSW5wdXRzO2UrKyl0aGlzLmFsbG9jYXRlSW5wdXRDaGFubmVscyhlLDEpO3RoaXMub3V0cHV0QnVmZmVycz1uZXcgQXJyYXkodGhpcy5uYk91dHB1dHMpLHRoaXMub3V0cHV0QnVmZmVyc1RvUmV0cmlldmU9bmV3IEFycmF5KHRoaXMubmJPdXRwdXRzKTtmb3IobGV0IGU9MDtlPHRoaXMubmJPdXRwdXRzO2UrKyl0aGlzLmFsbG9jYXRlT3V0cHV0Q2hhbm5lbHMoZSwxKX1yZWFsbG9jYXRlQ2hhbm5lbHNJZk5lZWRlZCh0LGUpe2ZvcihsZXQgcz0wO3M8dGhpcy5uYklucHV0cztzKyspe2xldCByPXRbc10ubGVuZ3RoO3IhPXRoaXMuaW5wdXRCdWZmZXJzW3NdLmxlbmd0aCYmdGhpcy5hbGxvY2F0ZUlucHV0Q2hhbm5lbHMocyxyKX1mb3IobGV0IHM9MDtzPHRoaXMubmJPdXRwdXRzO3MrKyl7bGV0IHI9ZVtzXS5sZW5ndGg7ciE9dGhpcy5vdXRwdXRCdWZmZXJzW3NdLmxlbmd0aCYmdGhpcy5hbGxvY2F0ZU91dHB1dENoYW5uZWxzKHMscil9fWFsbG9jYXRlSW5wdXRDaGFubmVscyh0LGUpe3RoaXMuaW5wdXRCdWZmZXJzW3RdPW5ldyBBcnJheShlKTtmb3IobGV0IHM9MDtzPGU7cysrKXRoaXMuaW5wdXRCdWZmZXJzW3RdW3NdPW5ldyBGbG9hdDMyQXJyYXkodGhpcy5ibG9ja1NpemUrMTI4KSx0aGlzLmlucHV0QnVmZmVyc1t0XVtzXS5maWxsKDApO3RoaXMuaW5wdXRCdWZmZXJzSGVhZFt0XT1uZXcgQXJyYXkoZSksdGhpcy5pbnB1dEJ1ZmZlcnNUb1NlbmRbdF09bmV3IEFycmF5KGUpO2ZvcihsZXQgcz0wO3M8ZTtzKyspdGhpcy5pbnB1dEJ1ZmZlcnNIZWFkW3RdW3NdPXRoaXMuaW5wdXRCdWZmZXJzW3RdW3NdLnN1YmFycmF5KDAsdGhpcy5ibG9ja1NpemUpLHRoaXMuaW5wdXRCdWZmZXJzVG9TZW5kW3RdW3NdPW5ldyBGbG9hdDMyQXJyYXkodGhpcy5ibG9ja1NpemUpfWFsbG9jYXRlT3V0cHV0Q2hhbm5lbHModCxlKXt0aGlzLm91dHB1dEJ1ZmZlcnNbdF09bmV3IEFycmF5KGUpO2ZvcihsZXQgcz0wO3M8ZTtzKyspdGhpcy5vdXRwdXRCdWZmZXJzW3RdW3NdPW5ldyBGbG9hdDMyQXJyYXkodGhpcy5ibG9ja1NpemUpLHRoaXMub3V0cHV0QnVmZmVyc1t0XVtzXS5maWxsKDApO3RoaXMub3V0cHV0QnVmZmVyc1RvUmV0cmlldmVbdF09bmV3IEFycmF5KGUpO2ZvcihsZXQgcz0wO3M8ZTtzKyspdGhpcy5vdXRwdXRCdWZmZXJzVG9SZXRyaWV2ZVt0XVtzXT1uZXcgRmxvYXQzMkFycmF5KHRoaXMuYmxvY2tTaXplKSx0aGlzLm91dHB1dEJ1ZmZlcnNUb1JldHJpZXZlW3RdW3NdLmZpbGwoMCl9cmVhZElucHV0cyh0KXtpZih0WzBdLmxlbmd0aCYmdFswXVswXS5sZW5ndGg9PTApe2ZvcihsZXQgZT0wO2U8dGhpcy5uYklucHV0cztlKyspZm9yKGxldCBzPTA7czx0aGlzLmlucHV0QnVmZmVyc1tlXS5sZW5ndGg7cysrKXRoaXMuaW5wdXRCdWZmZXJzW2VdW3NdLmZpbGwoMCx0aGlzLmJsb2NrU2l6ZSk7cmV0dXJufWZvcihsZXQgZT0wO2U8dGhpcy5uYklucHV0cztlKyspZm9yKGxldCBzPTA7czx0aGlzLmlucHV0QnVmZmVyc1tlXS5sZW5ndGg7cysrKXtsZXQgcj10W2VdW3NdO3RoaXMuaW5wdXRCdWZmZXJzW2VdW3NdLnNldChyLHRoaXMuYmxvY2tTaXplKX19d3JpdGVPdXRwdXRzKHQpe2ZvcihsZXQgZT0wO2U8dGhpcy5uYklucHV0cztlKyspZm9yKGxldCBzPTA7czx0aGlzLmlucHV0QnVmZmVyc1tlXS5sZW5ndGg7cysrKXtsZXQgcj10aGlzLm91dHB1dEJ1ZmZlcnNbZV1bc10uc3ViYXJyYXkoMCwxMjgpO3RbZV1bc10uc2V0KHIpfX1zaGlmdElucHV0QnVmZmVycygpe2ZvcihsZXQgdD0wO3Q8dGhpcy5uYklucHV0czt0KyspZm9yKGxldCBlPTA7ZTx0aGlzLmlucHV0QnVmZmVyc1t0XS5sZW5ndGg7ZSsrKXRoaXMuaW5wdXRCdWZmZXJzW3RdW2VdLmNvcHlXaXRoaW4oMCwxMjgpfXNoaWZ0T3V0cHV0QnVmZmVycygpe2ZvcihsZXQgdD0wO3Q8dGhpcy5uYk91dHB1dHM7dCsrKWZvcihsZXQgZT0wO2U8dGhpcy5vdXRwdXRCdWZmZXJzW3RdLmxlbmd0aDtlKyspdGhpcy5vdXRwdXRCdWZmZXJzW3RdW2VdLmNvcHlXaXRoaW4oMCwxMjgpLHRoaXMub3V0cHV0QnVmZmVyc1t0XVtlXS5zdWJhcnJheSh0aGlzLmJsb2NrU2l6ZS0xMjgpLmZpbGwoMCl9cHJlcGFyZUlucHV0QnVmZmVyc1RvU2VuZCgpe2ZvcihsZXQgdD0wO3Q8dGhpcy5uYklucHV0czt0KyspZm9yKGxldCBlPTA7ZTx0aGlzLmlucHV0QnVmZmVyc1t0XS5sZW5ndGg7ZSsrKXRoaXMuaW5wdXRCdWZmZXJzVG9TZW5kW3RdW2VdLnNldCh0aGlzLmlucHV0QnVmZmVyc0hlYWRbdF1bZV0pfWhhbmRsZU91dHB1dEJ1ZmZlcnNUb1JldHJpZXZlKCl7Zm9yKGxldCB0PTA7dDx0aGlzLm5iT3V0cHV0czt0KyspZm9yKGxldCBlPTA7ZTx0aGlzLm91dHB1dEJ1ZmZlcnNbdF0ubGVuZ3RoO2UrKylmb3IobGV0IHM9MDtzPHRoaXMuYmxvY2tTaXplO3MrKyl0aGlzLm91dHB1dEJ1ZmZlcnNbdF1bZV1bc10rPXRoaXMub3V0cHV0QnVmZmVyc1RvUmV0cmlldmVbdF1bZV1bc10vdGhpcy5uYk92ZXJsYXBzfXByb2Nlc3ModCxlLHMpe2NvbnN0IGk9dFswXVswXSE9PXZvaWQgMDtyZXR1cm4gdGhpcy5zdGFydGVkJiYhaT8hMToodGhpcy5zdGFydGVkPWksdGhpcy5yZWFsbG9jYXRlQ2hhbm5lbHNJZk5lZWRlZCh0LGUpLHRoaXMucmVhZElucHV0cyh0KSx0aGlzLnNoaWZ0SW5wdXRCdWZmZXJzKCksdGhpcy5wcmVwYXJlSW5wdXRCdWZmZXJzVG9TZW5kKCksdGhpcy5wcm9jZXNzT0xBKHRoaXMuaW5wdXRCdWZmZXJzVG9TZW5kLHRoaXMub3V0cHV0QnVmZmVyc1RvUmV0cmlldmUscyksdGhpcy5oYW5kbGVPdXRwdXRCdWZmZXJzVG9SZXRyaWV2ZSgpLHRoaXMud3JpdGVPdXRwdXRzKGUpLHRoaXMuc2hpZnRPdXRwdXRCdWZmZXJzKCksITApfXByb2Nlc3NPTEEodCxlLHMpe2NvbnNvbGUuYXNzZXJ0KCExLCJOb3Qgb3ZlcnJpZGVuIil9fWNsYXNzIEV0e2NvbnN0cnVjdG9yKHQpe2lmKHRoaXMuc2l6ZT10fDAsdGhpcy5zaXplPD0xfHwodGhpcy5zaXplJnRoaXMuc2l6ZS0xKSE9PTApdGhyb3cgbmV3IEVycm9yKCJGRlQgc2l6ZSBtdXN0IGJlIGEgcG93ZXIgb2YgdHdvIGFuZCBiaWdnZXIgdGhhbiAxIik7dGhpcy5fY3NpemU9dDw8MTtmb3IodmFyIGU9bmV3IEFycmF5KHRoaXMuc2l6ZSoyKSxzPTA7czxlLmxlbmd0aDtzKz0yKXtjb25zdCBjPU1hdGguUEkqcy90aGlzLnNpemU7ZVtzXT1NYXRoLmNvcyhjKSxlW3MrMV09LU1hdGguc2luKGMpfXRoaXMudGFibGU9ZTtmb3IodmFyIHI9MCxpPTE7dGhpcy5zaXplPmk7aTw8PTEpcisrO3RoaXMuX3dpZHRoPXIlMj09PTA/ci0xOnIsdGhpcy5fYml0cmV2PW5ldyBBcnJheSgxPDx0aGlzLl93aWR0aCk7Zm9yKHZhciBvPTA7bzx0aGlzLl9iaXRyZXYubGVuZ3RoO28rKyl7dGhpcy5fYml0cmV2W29dPTA7Zm9yKHZhciBhPTA7YTx0aGlzLl93aWR0aDthKz0yKXt2YXIgdT10aGlzLl93aWR0aC1hLTI7dGhpcy5fYml0cmV2W29dfD0obz4+PmEmMyk8PHV9fXRoaXMuX291dD1udWxsLHRoaXMuX2RhdGE9bnVsbCx0aGlzLl9pbnY9MH1mcm9tQ29tcGxleEFycmF5KHQsZSl7Zm9yKHZhciBzPWV8fG5ldyBBcnJheSh0Lmxlbmd0aD4+PjEpLHI9MDtyPHQubGVuZ3RoO3IrPTIpc1tyPj4+MV09dFtyXTtyZXR1cm4gc31jcmVhdGVDb21wbGV4QXJyYXkoKXtjb25zdCB0PW5ldyBBcnJheSh0aGlzLl9jc2l6ZSk7Zm9yKHZhciBlPTA7ZTx0Lmxlbmd0aDtlKyspdFtlXT0wO3JldHVybiB0fXRvQ29tcGxleEFycmF5KHQsZSl7Zm9yKHZhciBzPWV8fHRoaXMuY3JlYXRlQ29tcGxleEFycmF5KCkscj0wO3I8cy5sZW5ndGg7cis9MilzW3JdPXRbcj4+PjFdLHNbcisxXT0wO3JldHVybiBzfWNvbXBsZXRlU3BlY3RydW0odCl7Zm9yKHZhciBlPXRoaXMuX2NzaXplLHM9ZT4+PjEscj0yO3I8cztyKz0yKXRbZS1yXT10W3JdLHRbZS1yKzFdPS10W3IrMV19dHJhbnNmb3JtKHQsZSl7aWYodD09PWUpdGhyb3cgbmV3IEVycm9yKCJJbnB1dCBhbmQgb3V0cHV0IGJ1ZmZlcnMgbXVzdCBiZSBkaWZmZXJlbnQiKTt0aGlzLl9vdXQ9dCx0aGlzLl9kYXRhPWUsdGhpcy5faW52PTAsdGhpcy5fdHJhbnNmb3JtNCgpLHRoaXMuX291dD1udWxsLHRoaXMuX2RhdGE9bnVsbH1yZWFsVHJhbnNmb3JtKHQsZSl7aWYodD09PWUpdGhyb3cgbmV3IEVycm9yKCJJbnB1dCBhbmQgb3V0cHV0IGJ1ZmZlcnMgbXVzdCBiZSBkaWZmZXJlbnQiKTt0aGlzLl9vdXQ9dCx0aGlzLl9kYXRhPWUsdGhpcy5faW52PTAsdGhpcy5fcmVhbFRyYW5zZm9ybTQoKSx0aGlzLl9vdXQ9bnVsbCx0aGlzLl9kYXRhPW51bGx9aW52ZXJzZVRyYW5zZm9ybSh0LGUpe2lmKHQ9PT1lKXRocm93IG5ldyBFcnJvcigiSW5wdXQgYW5kIG91dHB1dCBidWZmZXJzIG11c3QgYmUgZGlmZmVyZW50Iik7dGhpcy5fb3V0PXQsdGhpcy5fZGF0YT1lLHRoaXMuX2ludj0xLHRoaXMuX3RyYW5zZm9ybTQoKTtmb3IodmFyIHM9MDtzPHQubGVuZ3RoO3MrKyl0W3NdLz10aGlzLnNpemU7dGhpcy5fb3V0PW51bGwsdGhpcy5fZGF0YT1udWxsfV90cmFuc2Zvcm00KCl7dmFyIHQ9dGhpcy5fb3V0LGU9dGhpcy5fY3NpemUscz10aGlzLl93aWR0aCxyPTE8PHMsaT1lL3I8PDEsbyxhLHU9dGhpcy5fYml0cmV2O2lmKGk9PT00KWZvcihvPTAsYT0wO288ZTtvKz1pLGErKyl7Y29uc3QgbT11W2FdO3RoaXMuX3NpbmdsZVRyYW5zZm9ybTIobyxtLHIpfWVsc2UgZm9yKG89MCxhPTA7bzxlO28rPWksYSsrKXtjb25zdCBtPXVbYV07dGhpcy5fc2luZ2xlVHJhbnNmb3JtNChvLG0scil9dmFyIGM9dGhpcy5faW52Py0xOjEsaD10aGlzLnRhYmxlO2ZvcihyPj49MjtyPj0yO3I+Pj0yKXtpPWUvcjw8MTt2YXIgZj1pPj4+Mjtmb3Iobz0wO288ZTtvKz1pKWZvcih2YXIgZD1vK2YsbD1vLHA9MDtsPGQ7bCs9MixwKz1yKXtjb25zdCBtPWwsST1tK2YsZz1JK2Ysdj1nK2Ysdz10W21dLFA9dFttKzFdLFM9dFtJXSxWPXRbSSsxXSxNPXRbZ10seD10W2crMV0seT10W3ZdLEE9dFt2KzFdLFc9dyxOPVAsRT1oW3BdLE89YypoW3ArMV0sRj1TKkUtVipPLEQ9UypPK1YqRSxMPWhbMipwXSxDPWMqaFsyKnArMV0sZXQ9TSpMLXgqQyxzdD1NKkMreCpMLHJ0PWhbMypwXSxudD1jKmhbMypwKzFdLGl0PXkqcnQtQSpudCxvdD15Km50K0EqcnQsYXQ9VytldCwkPU4rc3QsRz1XLWV0LGN0PU4tc3QsdXQ9RitpdCxRPUQrb3QsSj1jKihGLWl0KSxodD1jKihELW90KSxsdD1hdCt1dCxidD0kK1EsSXQ9YXQtdXQsX3Q9JC1RLEJ0PUcraHQsd3Q9Y3QtSixUdD1HLWh0LFB0PWN0K0o7dFttXT1sdCx0W20rMV09YnQsdFtJXT1CdCx0W0krMV09d3QsdFtnXT1JdCx0W2crMV09X3QsdFt2XT1UdCx0W3YrMV09UHR9fX1fc2luZ2xlVHJhbnNmb3JtMih0LGUscyl7Y29uc3Qgcj10aGlzLl9vdXQsaT10aGlzLl9kYXRhLG89aVtlXSxhPWlbZSsxXSx1PWlbZStzXSxjPWlbZStzKzFdLGg9byt1LGY9YStjLGQ9by11LGw9YS1jO3JbdF09aCxyW3QrMV09ZixyW3QrMl09ZCxyW3QrM109bH1fc2luZ2xlVHJhbnNmb3JtNCh0LGUscyl7Y29uc3Qgcj10aGlzLl9vdXQsaT10aGlzLl9kYXRhLG89dGhpcy5faW52Py0xOjEsYT1zKjIsdT1zKjMsYz1pW2VdLGg9aVtlKzFdLGY9aVtlK3NdLGQ9aVtlK3MrMV0sbD1pW2UrYV0scD1pW2UrYSsxXSxtPWlbZSt1XSxJPWlbZSt1KzFdLGc9YytsLHY9aCtwLHc9Yy1sLFA9aC1wLFM9ZittLFY9ZCtJLE09byooZi1tKSx4PW8qKGQtSSkseT1nK1MsQT12K1YsVz13K3gsTj1QLU0sRT1nLVMsTz12LVYsRj13LXgsRD1QK007clt0XT15LHJbdCsxXT1BLHJbdCsyXT1XLHJbdCszXT1OLHJbdCs0XT1FLHJbdCs1XT1PLHJbdCs2XT1GLHJbdCs3XT1EfV9yZWFsVHJhbnNmb3JtNCgpe3ZhciB0PXRoaXMuX291dCxlPXRoaXMuX2NzaXplLHM9dGhpcy5fd2lkdGgscj0xPDxzLGk9ZS9yPDwxLG8sYSx1PXRoaXMuX2JpdHJldjtpZihpPT09NClmb3Iobz0wLGE9MDtvPGU7bys9aSxhKyspe2NvbnN0IE10PXVbYV07dGhpcy5fc2luZ2xlUmVhbFRyYW5zZm9ybTIobyxNdD4+PjEscj4+PjEpfWVsc2UgZm9yKG89MCxhPTA7bzxlO28rPWksYSsrKXtjb25zdCBNdD11W2FdO3RoaXMuX3NpbmdsZVJlYWxUcmFuc2Zvcm00KG8sTXQ+Pj4xLHI+Pj4xKX12YXIgYz10aGlzLl9pbnY/LTE6MSxoPXRoaXMudGFibGU7Zm9yKHI+Pj0yO3I+PTI7cj4+PTIpe2k9ZS9yPDwxO3ZhciBmPWk+Pj4xLGQ9Zj4+PjEsbD1kPj4+MTtmb3Iobz0wO288ZTtvKz1pKWZvcih2YXIgcD0wLG09MDtwPD1sO3ArPTIsbSs9cil7dmFyIEk9bytwLGc9SStkLHY9ZytkLHc9ditkLFA9dFtJXSxTPXRbSSsxXSxWPXRbZ10sTT10W2crMV0seD10W3ZdLHk9dFt2KzFdLEE9dFt3XSxXPXRbdysxXSxOPVAsRT1TLE89aFttXSxGPWMqaFttKzFdLEQ9VipPLU0qRixMPVYqRitNKk8sQz1oWzIqbV0sZXQ9YypoWzIqbSsxXSxzdD14KkMteSpldCxydD14KmV0K3kqQyxudD1oWzMqbV0saXQ9YypoWzMqbSsxXSxvdD1BKm50LVcqaXQsYXQ9QSppdCtXKm50LCQ9TitzdCxHPUUrcnQsY3Q9Ti1zdCx1dD1FLXJ0LFE9RCtvdCxKPUwrYXQsaHQ9YyooRC1vdCksbHQ9YyooTC1hdCksYnQ9JCtRLEl0PUcrSixfdD1jdCtsdCxCdD11dC1odDtpZih0W0ldPWJ0LHRbSSsxXT1JdCx0W2ddPV90LHRbZysxXT1CdCxwPT09MCl7dmFyIHd0PSQtUSxUdD1HLUo7dFt2XT13dCx0W3YrMV09VHQ7Y29udGludWV9aWYocCE9PWwpe3ZhciBQdD1jdCxnZT0tdXQsYmU9JCxJZT0tRyxfZT0tYypsdCxCZT0tYypodCx3ZT0tYypKLFRlPS1jKlEsUGU9UHQrX2UsTWU9Z2UrQmUsU2U9YmUrVGUsVmU9SWUtd2UsQ3Q9bytkLXAsUnQ9bytmLXA7dFtDdF09UGUsdFtDdCsxXT1NZSx0W1J0XT1TZSx0W1J0KzFdPVZlfX19fV9zaW5nbGVSZWFsVHJhbnNmb3JtMih0LGUscyl7Y29uc3Qgcj10aGlzLl9vdXQsaT10aGlzLl9kYXRhLG89aVtlXSxhPWlbZStzXSx1PW8rYSxjPW8tYTtyW3RdPXUsclt0KzFdPTAsclt0KzJdPWMsclt0KzNdPTB9X3NpbmdsZVJlYWxUcmFuc2Zvcm00KHQsZSxzKXtjb25zdCByPXRoaXMuX291dCxpPXRoaXMuX2RhdGEsbz10aGlzLl9pbnY/LTE6MSxhPXMqMix1PXMqMyxjPWlbZV0saD1pW2Urc10sZj1pW2UrYV0sZD1pW2UrdV0sbD1jK2YscD1jLWYsbT1oK2QsST1vKihoLWQpLGc9bCttLHY9cCx3PS1JLFA9bC1tLFM9cCxWPUk7clt0XT1nLHJbdCsxXT0wLHJbdCsyXT12LHJbdCszXT13LHJbdCs0XT1QLHJbdCs1XT0wLHJbdCs2XT1TLHJbdCs3XT1WfX1sZXQgRHQ9bj0+Y29uc29sZS5sb2cobik7Y29uc3QgenQ9KC4uLm4pPT5EdCguLi5uKSxXdD0obix0LGUpPT5NYXRoLm1pbihNYXRoLm1heChuLHQpLGUpLFN0PW49Pm4vKDErbikscXQ9KG4sdCk9PihuJXQrdCkldCxMdD0obix0KT0+KDErdCkqbi8oMSt0Kk1hdGguYWJzKG4pKSxZPShuLHQpPT5NYXRoLnRhbmgobiooMSt0KSksWXQ9KG4sdCk9Pld0KCgxK3QpKm4sLTEsMSksVnQ9KG4sdCk9PntsZXQgZT0oMSsuNSp0KSpuO2NvbnN0IHM9cXQoZSsxLDQpO3JldHVybiAxLU1hdGguYWJzKHMtMil9LGp0PShuLHQpPT5NYXRoLnNpbihNYXRoLlBJLzIqVnQobix0KSksSHQ9KG4sdCk9Pntjb25zdCBlPVN0KE1hdGgubG9nMXAodCkpLHM9KG4tZS8zKm4qbipuKS8oMS1lLzMpO3JldHVybiBZKHMsdCl9LHh0PShuLHQsZT0hMSk9Pntjb25zdCBzPTErMip0LGk9LjA3KlN0KE1hdGgubG9nMXAodCkpLG89WShuK2ksMip0KSxhPVkoZT9pOi1uK2ksMip0KSx1PW8tYSxjPTEvTWF0aC5jb3NoKHMqaSksaD1jKmMsZj1NYXRoLm1heCgxZS04LChlPzE6MikqcypoKTtyZXR1cm4gWSh1L2YsdCl9LHl0PXtzY3VydmU6THQsc29mdDpZLGhhcmQ6WXQsY3ViaWM6SHQsZGlvZGU6eHQsYXN5bToobix0KT0+eHQobix0LCEwKSxmb2xkOlZ0LHNpbmVmb2xkOmp0LGNoZWJ5c2hldjoobix0KT0+e2NvbnN0IGU9MTAqTWF0aC5sb2cxcCh0KTtsZXQgcz0xLHI9bixpLG89MDtmb3IobGV0IGE9MTthPDY0O2ErKyl7aWYoYTwyKXtvKz1hPT0wP3M6cjtjb250aW51ZX1pPTIqbipzLXIscj1zLHM9aSxhJTI9PT0wJiYobys9TWF0aC5taW4oMS4zKmUvYSwyKSppKX1yZXR1cm4gWShvLGUvMjApfX0sWD1PYmplY3QuZnJlZXplKE9iamVjdC5rZXlzKHl0KSksS3Q9bj0+e2xldCB0PW47dHlwZW9mIG49PSJzdHJpbmciJiYodD1YLmluZGV4T2YobiksdD09PS0xJiYoenQoYFtzdXBlcmRvdWdoXSBDb3VsZCBub3QgZmluZCB3YXZlc2hhcGluZyBhbGdvcml0aG0gJHtufS4KICAgICAgICBBdmFpbGFibGUgb3B0aW9ucyBhcmUgJHtYLmpvaW4oIiwgIil9LgogICAgICAgIERlZmF1bHRpbmcgdG8gJHtYWzBdfS5gKSx0PTApKTtjb25zdCBlPVhbdCVYLmxlbmd0aF07cmV0dXJuIHl0W2VdfSxqPTEyOCxSPU1hdGguUEksaz0yKlIscT0xL3NhbXBsZVJhdGUsVD0obix0LGUpPT5NYXRoLm1pbihNYXRoLm1heChuLHQpLGUpLFV0PShuLHQsZSk9PmUqKHQtbikrbixiPShuLHQpPT5uW3RdPz9uWzBdLEg9bj0+bi1NYXRoLmZsb29yKG4pLEs9bj0+bnwwLFU9bj0+SyhuKy41KSxadD1uPT5LKG4rMSksQXQ9bj0+bi1LKG4pLHo9bj0+e2NvbnN0IHQ9bioqMjtyZXR1cm4gbiooMjcrdCkvKDI3KzkqdCl9LE50PShuLHQpPT57aWYobjwyKXJldHVybiByPT4wO2NvbnN0IGU9dC8obi0xKSxzPXQqLjU7cmV0dXJuIHI9PnIqZS1zfSxaPShuLHQpPT5uKk1hdGgucG93KDIsdC8xMik7ZnVuY3Rpb24gJHQobix0KXt0PU1hdGgubWluKHQsMS10KTtjb25zdCBlPTEvdDtyZXR1cm4gbjx0PyhuKj1lLDIqbi1uKioyLTEpOm4+MS10PyhuPShuLTEpKmUsbioqMisyKm4rMSk6MH1jb25zdCBkdD17dHJpKG4sdD0uNSl7Y29uc3QgZT0xLXQ7cmV0dXJuIG4+PXQ/MS9lLW4vZTpuL3R9LHNpbmUobil7cmV0dXJuIE1hdGguc2luKGsqbikqLjUrLjV9LHJhbXAobil7cmV0dXJuIG59LHNhdyhuKXtyZXR1cm4gMS1ufSxzcXVhcmUobix0PS41KXtyZXR1cm4gbj49dD8wOjF9LGN1c3RvbShuLHQ9WzAsMV0pe2NvbnN0IGU9dC5sZW5ndGgtMSxzPU1hdGguZmxvb3IobiplKSxyPTEvZSxpPVQodFtzXSwwLDEpLGE9VCh0W3MrMV0sMCwxKSx1PWksYz0wLGg9cjtyZXR1cm4oYS11KS8oaC1jKSoobi1yKnMpK2l9LHNhd2JsZXAobix0KXtyZXR1cm4gMipuLTEtJHQobix0KX19LEd0PU9iamVjdC5rZXlzKGR0KTtjbGFzcyBRdCBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3NvcntzdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCl7cmV0dXJuW3tuYW1lOiJiZWdpbiIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJ0aW1lIixkZWZhdWx0VmFsdWU6MH0se25hbWU6ImVuZCIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJmcmVxdWVuY3kiLGRlZmF1bHRWYWx1ZTouNX0se25hbWU6InNrZXciLGRlZmF1bHRWYWx1ZTouNX0se25hbWU6ImRlcHRoIixkZWZhdWx0VmFsdWU6MX0se25hbWU6InBoYXNlb2Zmc2V0IixkZWZhdWx0VmFsdWU6MH0se25hbWU6InNoYXBlIixkZWZhdWx0VmFsdWU6MH0se25hbWU6ImN1cnZlIixkZWZhdWx0VmFsdWU6MX0se25hbWU6ImRjb2Zmc2V0IixkZWZhdWx0VmFsdWU6MH0se25hbWU6Im1pbiIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJtYXgiLGRlZmF1bHRWYWx1ZToxfV19Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMucGhhc2V9aW5jcmVtZW50UGhhc2UodCl7dGhpcy5waGFzZSs9dCx0aGlzLnBoYXNlPjEmJih0aGlzLnBoYXNlPXRoaXMucGhhc2UtMSl9cHJvY2Vzcyh0LGUscyl7Y29uc3Qgcj1zLmJlZ2luWzBdO2lmKGN1cnJlbnRUaW1lPj1zLmVuZFswXSlyZXR1cm4hMTtpZihjdXJyZW50VGltZTw9cilyZXR1cm4hMDtjb25zdCBpPWVbMF0sbz1zLmZyZXF1ZW5jeVswXSxhPXMudGltZVswXSx1PXMuZGVwdGhbMF0sYz1zLnNrZXdbMF0saD1zLnBoYXNlb2Zmc2V0WzBdLGY9cy5jdXJ2ZVswXSxkPXMuZGNvZmZzZXRbMF0sbD1zLm1pblswXSxwPXMubWF4WzBdLG09R3Rbcy5zaGFwZVswXV0sST1pWzBdLmxlbmd0aD8/MDt0aGlzLnBoYXNlPT1udWxsJiYodGhpcy5waGFzZT1BdChhKm8raCkpO2NvbnN0IGc9bypxO2ZvcihsZXQgdj0wO3Y8STt2Kyspe2ZvcihsZXQgdz0wO3c8aS5sZW5ndGg7dysrKXtsZXQgUD0oZHRbbV0odGhpcy5waGFzZSxjKStkKSp1O1A9TWF0aC5wb3coUCxmKSxpW3ddW3ZdPVQoUCxsLHApfXRoaXMuaW5jcmVtZW50UGhhc2UoZyl9cmV0dXJuITB9fXJlZ2lzdGVyUHJvY2Vzc29yKCJsZm8tcHJvY2Vzc29yIixRdCk7Y2xhc3MgSnQgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3J7c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToiY29hcnNlIixkZWZhdWx0VmFsdWU6MX1dfWNvbnN0cnVjdG9yKCl7c3VwZXIoKSx0aGlzLnN0YXJ0ZWQ9ITF9cHJvY2Vzcyh0LGUscyl7Y29uc3Qgcj10WzBdLGk9ZVswXSxvPXJbMF0hPT12b2lkIDA7aWYodGhpcy5zdGFydGVkJiYhbylyZXR1cm4hMTt0aGlzLnN0YXJ0ZWQ9bztsZXQgYT1zLmNvYXJzZVswXT8/MDthPU1hdGgubWF4KDEsYSk7Zm9yKGxldCB1PTA7dTxqO3UrKylmb3IobGV0IGM9MDtjPHIubGVuZ3RoO2MrKylpW2NdW3VdPXUlYT09PTA/cltjXVt1XTppW2NdW3UtMV07cmV0dXJuITB9fXJlZ2lzdGVyUHJvY2Vzc29yKCJjb2Fyc2UtcHJvY2Vzc29yIixKdCk7Y2xhc3MgWHQgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3J7c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToiY3J1c2giLGRlZmF1bHRWYWx1ZTowfV19Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMuc3RhcnRlZD0hMX1wcm9jZXNzKHQsZSxzKXtjb25zdCByPXRbMF0saT1lWzBdLG89clswXSE9PXZvaWQgMDtpZih0aGlzLnN0YXJ0ZWQmJiFvKXJldHVybiExO3RoaXMuc3RhcnRlZD1vO2xldCBhPXMuY3J1c2hbMF0/Pzg7YT1NYXRoLm1heCgxLGEpO2ZvcihsZXQgdT0wO3U8ajt1KyspZm9yKGxldCBjPTA7YzxyLmxlbmd0aDtjKyspe2NvbnN0IGg9TWF0aC5wb3coMixhLTEpO2lbY11bdV09TWF0aC5yb3VuZChyW2NdW3VdKmgpL2h9cmV0dXJuITB9fXJlZ2lzdGVyUHJvY2Vzc29yKCJjcnVzaC1wcm9jZXNzb3IiLFh0KTtjbGFzcyB0ZSBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3NvcntzdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCl7cmV0dXJuW3tuYW1lOiJzaGFwZSIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJwb3N0Z2FpbiIsZGVmYXVsdFZhbHVlOjF9XX1jb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5zdGFydGVkPSExfXByb2Nlc3ModCxlLHMpe2NvbnN0IHI9dFswXSxpPWVbMF0sbz1yWzBdIT09dm9pZCAwO2lmKHRoaXMuc3RhcnRlZCYmIW8pcmV0dXJuITE7dGhpcy5zdGFydGVkPW87bGV0IGE9cy5zaGFwZVswXTthPWE8MT9hOi45OTk5OTk5OTk2LGE9MiphLygxLWEpO2NvbnN0IHU9TWF0aC5tYXgoLjAwMSxNYXRoLm1pbigxLHMucG9zdGdhaW5bMF0pKTtmb3IobGV0IGM9MDtjPGo7YysrKWZvcihsZXQgaD0wO2g8ci5sZW5ndGg7aCsrKWlbaF1bY109KDErYSkqcltoXVtjXS8oMSthKk1hdGguYWJzKHJbaF1bY10pKSp1O3JldHVybiEwfX1yZWdpc3RlclByb2Nlc3Nvcigic2hhcGUtcHJvY2Vzc29yIix0ZSk7Y2xhc3MgT3R7czA9MDtzMT0wO3VwZGF0ZSh0LGUscz0wKXtzPVQocywwLDEpLGU9VChlLDAsc2FtcGxlUmF0ZS8yLTEpO2NvbnN0IHI9VCgyKk1hdGguc2luKGUqUipxKSwwLDEuMTQpLG89MS1NYXRoLnBvdyguNSw4KnMrMSkqcjtyZXR1cm4gdGhpcy5zMD1vKnRoaXMuczAtcip0aGlzLnMxK3IqdCx0aGlzLnMxPW8qdGhpcy5zMStyKnRoaXMuczAsdGhpcy5zMX19Y2xhc3MgZWUgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3J7c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToidmFsdWUiLGRlZmF1bHRWYWx1ZTouNX1dfWNvbnN0cnVjdG9yKCl7c3VwZXIoKSx0aGlzLmZpbHRlcnM9W25ldyBPdCxuZXcgT3RdfXByb2Nlc3ModCxlLHMpe2NvbnN0IHI9dFswXSxpPWVbMF0sbz1yWzBdIT09dm9pZCAwO3RoaXMuc3RhcnRlZD1vO2NvbnN0IGE9VChzLnZhbHVlWzBdLDAsMSk7bGV0IHU9Im5vbmUiLGMsaD0xO2E+LjUxPyh1PSJoaXBhc3MiLGg9KGEtLjUpKjIpOmE8LjQ5JiYodT0ibG9wYXNzIixoPWEqMiksYz1NYXRoLnBvdyhoKjExLDQpO2ZvcihsZXQgZj0wO2Y8ci5sZW5ndGg7ZisrKWZvcihsZXQgZD0wO2Q8ajtkKyspdT09Im5vbmUiP2lbZl1bZF09cltmXVtkXToodGhpcy5maWx0ZXJzW2ZdLnVwZGF0ZShyW2ZdW2RdLGMsLjEpLHU9PT0ibG9wYXNzIj9pW2ZdW2RdPXRoaXMuZmlsdGVyc1tmXS5zMTp1PT09ImhpcGFzcyI/aVtmXVtkXT1yW2ZdW2RdLXRoaXMuZmlsdGVyc1tmXS5zMTppW2ZdW2RdPXJbZl1bZF0pO3JldHVybiEwfX1yZWdpc3RlclByb2Nlc3NvcigiZGpmLXByb2Nlc3NvciIsZWUpO2NsYXNzIHNlIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29ye3N0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKXtyZXR1cm5be25hbWU6ImZyZXF1ZW5jeSIsZGVmYXVsdFZhbHVlOjUwMH0se25hbWU6InEiLGRlZmF1bHRWYWx1ZToxfSx7bmFtZToiZHJpdmUiLGRlZmF1bHRWYWx1ZTouNjl9XX1jb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5zdGFydGVkPSExLHRoaXMucDA9WzAsMF0sdGhpcy5wMT1bMCwwXSx0aGlzLnAyPVswLDBdLHRoaXMucDM9WzAsMF0sdGhpcy5wMzI9WzAsMF0sdGhpcy5wMzM9WzAsMF0sdGhpcy5wMzQ9WzAsMF19cHJvY2Vzcyh0LGUscyl7Y29uc3Qgcj10WzBdLGk9ZVswXSxvPXJbMF0hPT12b2lkIDA7aWYodGhpcy5zdGFydGVkJiYhbylyZXR1cm4hMTt0aGlzLnN0YXJ0ZWQ9bztjb25zdCBhPXMucVswXSx1PVQoTWF0aC5leHAocy5kcml2ZVswXSksLjEsMmUzKTtsZXQgYz1zLmZyZXF1ZW5jeVswXTtjPWMqaypxLGM9Yz4xPzE6Yztjb25zdCBoPU1hdGgubWluKDgsYSouMTMpO2xldCBmPTEvdSpNYXRoLm1pbigxLjc1LDEraCk7Zm9yKGxldCBkPTA7ZDxqO2QrKylmb3IobGV0IGw9MDtsPHIubGVuZ3RoO2wrKyl7Y29uc3QgcD10aGlzLnAzW2xdKi4zNjA4OTErdGhpcy5wMzJbbF0qLjQxNzI5K3RoaXMucDMzW2xdKi4xNzc4OTYrdGhpcy5wMzRbbF0qLjA0Mzk3MjU7dGhpcy5wMzRbbF09dGhpcy5wMzNbbF0sdGhpcy5wMzNbbF09dGhpcy5wMzJbbF0sdGhpcy5wMzJbbF09dGhpcy5wM1tsXSx0aGlzLnAwW2xdKz0oeihyW2xdW2RdKnUtaCpwKS16KHRoaXMucDBbbF0pKSpjLHRoaXMucDFbbF0rPSh6KHRoaXMucDBbbF0pLXoodGhpcy5wMVtsXSkpKmMsdGhpcy5wMltsXSs9KHoodGhpcy5wMVtsXSkteih0aGlzLnAyW2xdKSkqYyx0aGlzLnAzW2xdKz0oeih0aGlzLnAyW2xdKS16KHRoaXMucDNbbF0pKSpjLGlbbF1bZF09cCpmfXJldHVybiEwfX1yZWdpc3RlclByb2Nlc3NvcigibGFkZGVyLXByb2Nlc3NvciIsc2UpO2NsYXNzIHJlIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29ye3N0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKXtyZXR1cm5be25hbWU6ImRpc3RvcnQiLGRlZmF1bHRWYWx1ZTowfSx7bmFtZToicG9zdGdhaW4iLGRlZmF1bHRWYWx1ZToxfV19Y29uc3RydWN0b3Ioe3Byb2Nlc3Nvck9wdGlvbnM6dH0pe3N1cGVyKCksdGhpcy5zdGFydGVkPSExLHRoaXMuYWxnb3JpdGhtPUt0KHQuYWxnb3JpdGhtKX1wcm9jZXNzKHQsZSxzKXtjb25zdCByPXRbMF0saT1lWzBdLG89clswXSE9PXZvaWQgMDtpZih0aGlzLnN0YXJ0ZWQmJiFvKXJldHVybiExO3RoaXMuc3RhcnRlZD1vO2ZvcihsZXQgYT0wO2E8ajthKyspe2NvbnN0IHU9VChiKHMucG9zdGdhaW4sYSksLjAwMSwxKSxjPU1hdGguZXhwbTEoYihzLmRpc3RvcnQsYSkpO2ZvcihsZXQgaD0wO2g8ci5sZW5ndGg7aCsrKXtjb25zdCBmPXJbaF1bYV07aVtoXVthXT11KnRoaXMuYWxnb3JpdGhtKGYsYyl9fXJldHVybiEwfX1yZWdpc3RlclByb2Nlc3NvcigiZGlzdG9ydC1wcm9jZXNzb3IiLHJlKTtjbGFzcyBuZSBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3Nvcntjb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5waGFzZT1bXX1zdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCl7cmV0dXJuW3tuYW1lOiJiZWdpbiIsZGVmYXVsdFZhbHVlOjAsbWF4Ok51bWJlci5QT1NJVElWRV9JTkZJTklUWSxtaW46MH0se25hbWU6ImVuZCIsZGVmYXVsdFZhbHVlOjAsbWF4Ok51bWJlci5QT1NJVElWRV9JTkZJTklUWSxtaW46MH0se25hbWU6ImZyZXF1ZW5jeSIsZGVmYXVsdFZhbHVlOjQ0MCxtaW46TnVtYmVyLkVQU0lMT059LHtuYW1lOiJwYW5zcHJlYWQiLGRlZmF1bHRWYWx1ZTouNCxtaW46MCxtYXg6MX0se25hbWU6ImZyZXFzcHJlYWQiLGRlZmF1bHRWYWx1ZTouMixtaW46MH0se25hbWU6ImRldHVuZSIsZGVmYXVsdFZhbHVlOjAsbWluOjB9LHtuYW1lOiJ2b2ljZXMiLGRlZmF1bHRWYWx1ZTo1LG1pbjoxLGF1dG9tYXRpb25SYXRlOiJrLXJhdGUifV19cHJvY2Vzcyh0LGUscyl7aWYoY3VycmVudFRpbWU8PXMuYmVnaW5bMF0pcmV0dXJuITA7aWYoY3VycmVudFRpbWU+PXMuZW5kWzBdKXJldHVybiExO2NvbnN0IHI9ZVswXSxpPXMudm9pY2VzWzBdO2ZvcihsZXQgbz0wO288clswXS5sZW5ndGg7bysrKXtjb25zdCBhPWIocy5kZXR1bmUsbyksdT1iKHMuZnJlcXNwcmVhZCxvKSxjPWIocy5wYW5zcHJlYWQsbykqLjUrLjU7bGV0IGg9TWF0aC5zcXJ0KDEtYyksZj1NYXRoLnNxcnQoYyksZD1iKHMuZnJlcXVlbmN5LG8pO2Q9WihkLGEvMTAwKTtjb25zdCBsPU50KGksdSk7Zm9yKGxldCBwPTA7cDxpO3ArKyl7Y29uc3QgbT1aKGQsbChwKSksST1IKG0qcSk7dGhpcy5waGFzZVtwXT10aGlzLnBoYXNlW3BdPz9NYXRoLnJhbmRvbSgpO2NvbnN0IGc9ZHQuc2F3YmxlcCh0aGlzLnBoYXNlW3BdLEkpO3JbMF1bb10rPWcqaCxyWzFdW29dKz1nKmY7bGV0IHY9dGhpcy5waGFzZVtwXStJO3Y+PTEmJih2LT0xKSx0aGlzLnBoYXNlW3BdPXY7Y29uc3Qgdz1oO2g9ZixmPXd9fXJldHVybiEwfX1yZWdpc3RlclByb2Nlc3Nvcigic3VwZXJzYXctb3NjaWxsYXRvciIsbmUpO2NvbnN0IGllPTIwNDgscHQ9bmV3IE1hcDtmdW5jdGlvbiBvZShuKXtpZighcHQuaGFzKG4pKXtjb25zdCB0PW5ldyBGbG9hdDMyQXJyYXkobik7Zm9yKGxldCBlPTA7ZTxuO2UrKyl0W2VdPS41KigxLU1hdGguY29zKGsqZS9uKSk7cHQuc2V0KG4sdCl9cmV0dXJuIHB0LmdldChuKX1jbGFzcyBhZSBleHRlbmRzIGt0e3N0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKXtyZXR1cm5be25hbWU6InBpdGNoRmFjdG9yIixkZWZhdWx0VmFsdWU6MX1dfWNvbnN0cnVjdG9yKHQpe3QucHJvY2Vzc29yT3B0aW9ucz17YmxvY2tTaXplOmllfSxzdXBlcih0KSx0aGlzLnRpbWVDdXJzb3I9MCx0aGlzLmZmdFNpemU9dGhpcy5ibG9ja1NpemUsdGhpcy5pbnZmZnRTaXplPTEvdGhpcy5mZnRTaXplLHRoaXMuaGFubldpbmRvdz1vZSh0aGlzLmZmdFNpemUpLHRoaXMuZmZ0PW5ldyBFdCh0aGlzLmZmdFNpemUpLHRoaXMuZnJlcUNvbXBsZXhCdWZmZXI9dGhpcy5mZnQuY3JlYXRlQ29tcGxleEFycmF5KCksdGhpcy5mcmVxQ29tcGxleEJ1ZmZlclNoaWZ0ZWQ9dGhpcy5mZnQuY3JlYXRlQ29tcGxleEFycmF5KCksdGhpcy50aW1lQ29tcGxleEJ1ZmZlcj10aGlzLmZmdC5jcmVhdGVDb21wbGV4QXJyYXkoKSx0aGlzLm1hZ25pdHVkZXM9bmV3IEZsb2F0MzJBcnJheSh0aGlzLmZmdFNpemUvMisxKSx0aGlzLnBlYWtJbmRleGVzPW5ldyBJbnQzMkFycmF5KHRoaXMubWFnbml0dWRlcy5sZW5ndGgpLHRoaXMubmJQZWFrcz0wfXByb2Nlc3NPTEEodCxlLHMpe2xldCByPXMucGl0Y2hGYWN0b3Jbcy5waXRjaEZhY3Rvci5sZW5ndGgtMV07cjwwJiYocj1yKi4yNSkscj1NYXRoLm1heCgwLHIrMSk7Zm9yKGxldCBpPTA7aTx0aGlzLm5iSW5wdXRzO2krKylmb3IobGV0IG89MDtvPHRbaV0ubGVuZ3RoO28rKyl7Y29uc3QgYT10W2ldW29dLHU9ZVtpXVtvXTt0aGlzLmFwcGx5SGFubldpbmRvdyhhKSx0aGlzLmZmdC5yZWFsVHJhbnNmb3JtKHRoaXMuZnJlcUNvbXBsZXhCdWZmZXIsYSksdGhpcy5jb21wdXRlTWFnbml0dWRlcygpLHRoaXMuZmluZFBlYWtzKCksdGhpcy5zaGlmdFBlYWtzKHIpLHRoaXMuZmZ0LmNvbXBsZXRlU3BlY3RydW0odGhpcy5mcmVxQ29tcGxleEJ1ZmZlclNoaWZ0ZWQpLHRoaXMuZmZ0LmludmVyc2VUcmFuc2Zvcm0odGhpcy50aW1lQ29tcGxleEJ1ZmZlcix0aGlzLmZyZXFDb21wbGV4QnVmZmVyU2hpZnRlZCksdGhpcy5mZnQuZnJvbUNvbXBsZXhBcnJheSh0aGlzLnRpbWVDb21wbGV4QnVmZmVyLHUpLHRoaXMuYXBwbHlIYW5uV2luZG93KHUpfXRoaXMudGltZUN1cnNvcis9dGhpcy5ob3BTaXplfWFwcGx5SGFubldpbmRvdyh0KXtmb3IobGV0IGU9MDtlPHRoaXMuYmxvY2tTaXplO2UrKyl0W2VdKj10aGlzLmhhbm5XaW5kb3dbZV0qMS42Mn1jb21wdXRlTWFnbml0dWRlcygpe2xldCB0PTAsZT0wO2Zvcig7dDx0aGlzLm1hZ25pdHVkZXMubGVuZ3RoOyl7Y29uc3Qgcz10aGlzLmZyZXFDb21wbGV4QnVmZmVyW2VdLHI9dGhpcy5mcmVxQ29tcGxleEJ1ZmZlcltlKzFdO3RoaXMubWFnbml0dWRlc1t0XT1zKioyK3IqKjIsdCs9MSxlKz0yfX1maW5kUGVha3MoKXt0aGlzLm5iUGVha3M9MDtsZXQgdD0yO2NvbnN0IGU9dGhpcy5tYWduaXR1ZGVzLmxlbmd0aC0yO2Zvcig7dDxlOyl7Y29uc3Qgcz10aGlzLm1hZ25pdHVkZXNbdF07aWYodGhpcy5tYWduaXR1ZGVzW3QtMV0+PXN8fHRoaXMubWFnbml0dWRlc1t0LTJdPj1zKXt0Kys7Y29udGludWV9aWYodGhpcy5tYWduaXR1ZGVzW3QrMV0+PXN8fHRoaXMubWFnbml0dWRlc1t0KzJdPj1zKXt0Kys7Y29udGludWV9dGhpcy5wZWFrSW5kZXhlc1t0aGlzLm5iUGVha3NdPXQsdGhpcy5uYlBlYWtzKyssdCs9Mn19c2hpZnRQZWFrcyh0KXt0aGlzLmZyZXFDb21wbGV4QnVmZmVyU2hpZnRlZC5maWxsKDApO2ZvcihsZXQgZT0wO2U8dGhpcy5uYlBlYWtzO2UrKyl7Y29uc3Qgcz10aGlzLnBlYWtJbmRleGVzW2VdLHI9VShzKnQpO2lmKHI+dGhpcy5tYWduaXR1ZGVzLmxlbmd0aClicmVhaztsZXQgaT0wLG89dGhpcy5mZnRTaXplO2U+MCYmKGk9cy1VKChzLXRoaXMucGVha0luZGV4ZXNbZS0xXSkvMikpLGU8dGhpcy5uYlBlYWtzLTEmJihvPXMrWnQoKHRoaXMucGVha0luZGV4ZXNbZSsxXS1zKS8yKSk7Y29uc3QgYT1pLXMsdT1vLXMsYz1rKnRoaXMuaW52ZmZ0U2l6ZSooci1zKSxoPU1hdGguY29zKGMqdGhpcy50aW1lQ3Vyc29yKSxmPU1hdGguc2luKGMqdGhpcy50aW1lQ3Vyc29yKTtmb3IobGV0IGQ9YTtkPHU7ZCsrKXtjb25zdCBsPXMrZCxwPXIrZDtpZihwPj10aGlzLm1hZ25pdHVkZXMubGVuZ3RoKWJyZWFrO2NvbnN0IG09MipsLEk9bSsxLGc9dGhpcy5mcmVxQ29tcGxleEJ1ZmZlclttXSx2PXRoaXMuZnJlcUNvbXBsZXhCdWZmZXJbSV0sdz1nKmgtdipmLFA9ZypmK3YqaCxTPTIqcCxWPVMrMTt0aGlzLmZyZXFDb21wbGV4QnVmZmVyU2hpZnRlZFtTXSs9dyx0aGlzLmZyZXFDb21wbGV4QnVmZmVyU2hpZnRlZFtWXSs9UH19fX1yZWdpc3RlclByb2Nlc3NvcigicGhhc2Utdm9jb2Rlci1wcm9jZXNzb3IiLGFlKTtjbGFzcyBjZSBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3Nvcntjb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5waGk9LVIsdGhpcy5ZMD0wLHRoaXMuWTE9MCx0aGlzLlBXPVIsdGhpcy5CPTIuMyx0aGlzLmRwaGlmPTAsdGhpcy5lbnZmPTB9c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToiYmVnaW4iLGRlZmF1bHRWYWx1ZTowLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksbWluOjB9LHtuYW1lOiJlbmQiLGRlZmF1bHRWYWx1ZTowLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksbWluOjB9LHtuYW1lOiJmcmVxdWVuY3kiLGRlZmF1bHRWYWx1ZTo0NDAsbWluOk51bWJlci5FUFNJTE9OfSx7bmFtZToiZGV0dW5lIixkZWZhdWx0VmFsdWU6MCxtaW46TnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFl9LHtuYW1lOiJwdWxzZXdpZHRoIixkZWZhdWx0VmFsdWU6MSxtaW46MCxtYXg6TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZfV19cHJvY2Vzcyh0LGUscyl7aWYodGhpcy5kaXNjb25uZWN0ZWQpcmV0dXJuITE7aWYoY3VycmVudFRpbWU8PXMuYmVnaW5bMF0pcmV0dXJuITA7aWYoY3VycmVudFRpbWU+PXMuZW5kWzBdKXJldHVybiExO2NvbnN0IHI9ZVswXTtsZXQgaT0xLG87Zm9yKGxldCBhPTA7YTwoclswXS5sZW5ndGg/PzApO2ErKyl7Y29uc3QgdT0oMS1UKGIocy5wdWxzZXdpZHRoLGEpLC0uOTksLjk5KSkqUixjPWIocy5kZXR1bmUsYSksaD1aKGIocy5mcmVxdWVuY3ksYSksYy8xMDApO289aCprKnEsdGhpcy5kcGhpZis9LjEqKG8tdGhpcy5kcGhpZiksaSo9Ljk5OTgsdGhpcy5lbnZmKz0uMSooaS10aGlzLmVudmYpLHRoaXMuQj0yLjMqKDEtMWUtNCpoKSx0aGlzLkI8MCYmKHRoaXMuQj0wKSx0aGlzLnBoaSs9dGhpcy5kcGhpZix0aGlzLnBoaT49UiYmKHRoaXMucGhpLT1rKTtsZXQgZj1NYXRoLmNvcyh0aGlzLnBoaSt0aGlzLkIqdGhpcy5ZMCk7dGhpcy5ZMD0uNSooZit0aGlzLlkwKTtsZXQgZD1NYXRoLmNvcyh0aGlzLnBoaSt0aGlzLkIqdGhpcy5ZMSt1KTt0aGlzLlkxPS41KihkK3RoaXMuWTEpO2ZvcihsZXQgbD0wO2w8ci5sZW5ndGg7bCsrKXJbbF1bYV09LjE1KihmLWQpKnRoaXMuZW52Zn1yZXR1cm4hMH19cmVnaXN0ZXJQcm9jZXNzb3IoInB1bHNlLW9zY2lsbGF0b3IiLGNlKTtjb25zdCBtdD17Yml0QzpmdW5jdGlvbihuLHQsZSl7cmV0dXJuIG4mdD9lOjB9LGJyOmZ1bmN0aW9uKG4sdD04KXtpZih0PjMyKXRocm93IG5ldyBFcnJvcigiYnIoKSBTaXplIGNhbm5vdCBiZSBncmVhdGVyIHRoYW4gMzIiKTtsZXQgZT0wO2ZvcihsZXQgcz0wO3M8dDtzKyspZXw9bXQuYml0QyhuLDE8PHMsMTw8dC0ocysxKSk7cmV0dXJuIGV9LHNpbmY6ZnVuY3Rpb24obil7cmV0dXJuIE1hdGguc2luKG4qUi8xMjgpfSxjb3NmOmZ1bmN0aW9uKG4pe3JldHVybiBNYXRoLmNvcyhuKlIvMTI4KX0sdGFuZjpmdW5jdGlvbihuKXtyZXR1cm4gTWF0aC50YW4obipSLzEyOCl9LHJlZ0c6ZnVuY3Rpb24obix0KXtyZXR1cm4gdC50ZXN0KG4udG9TdHJpbmcoMikpfX07bGV0IHR0LHZ0O2Z1bmN0aW9uIHVlKG4pe2lmKHR0PT1udWxsKXt0dD1PYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhNYXRoKSx2dD10dC5tYXAocz0+TWF0aFtzXSk7Y29uc3QgdD1PYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhtdCksZT10Lm1hcChzPT5tdFtzXSk7dHQucHVzaCgiaW50Iiwid2luZG93IiwuLi50KSx2dC5wdXNoKE1hdGguZmxvb3IsZ2xvYmFsVGhpcywuLi5lKX1yZXR1cm4gbmV3IEZ1bmN0aW9uKC4uLnR0LCJ0IixgcmV0dXJuIDAsCiR7bnx8MH07YCkuYmluZChnbG9iYWxUaGlzLC4uLnZ0KX1jbGFzcyBoZSBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3Nvcntjb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5wb3J0Lm9ubWVzc2FnZT10PT57bGV0e2NvZGVUZXh0OmV9PXQuZGF0YTtjb25zdHtieXRlQmVhdFN0YXJ0VGltZTpzfT10LmRhdGE7cyE9bnVsbCYmKHRoaXMudD0wLHRoaXMuaW5pdGlhbE9mZnNldD1NYXRoLmZsb29yKHMpKSxlPWUudHJpbSgpLnJlcGxhY2UoL15ldmFsXCh1bmVzY2FwZVwoZXNjYXBlKD86YHxcKCd8XCgifFwoYCkoLio/KSg/OmB8J1wpfCJcKXxgXCkpLnJlcGxhY2VcKFwvdVwoXC5cLlwpXC9nLFsiJ2BdXCQxJVsiJ2BdXClcKVwpJC8sKHIsaSk9PnVuZXNjYXBlKGVzY2FwZShpKS5yZXBsYWNlKC91KC4uKS9nLCIkMSUiKSkpLHRoaXMuZnVuYz11ZShlKX0sdGhpcy5pbml0aWFsT2Zmc2V0PTAsdGhpcy50PW51bGwsdGhpcy5mdW5jPW51bGx9c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToiYmVnaW4iLGRlZmF1bHRWYWx1ZTowLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksbWluOjB9LHtuYW1lOiJmcmVxdWVuY3kiLGRlZmF1bHRWYWx1ZTo0NDAsbWluOk51bWJlci5FUFNJTE9OfSx7bmFtZToiZGV0dW5lIixkZWZhdWx0VmFsdWU6MCxtaW46TnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFl9LHtuYW1lOiJlbmQiLGRlZmF1bHRWYWx1ZTowLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksbWluOjB9XX1wcm9jZXNzKHQsZSxzKXtpZih0aGlzLmRpc2Nvbm5lY3RlZClyZXR1cm4hMTtpZihjdXJyZW50VGltZTw9cy5iZWdpblswXSlyZXR1cm4hMDtpZihjdXJyZW50VGltZT49cy5lbmRbMF0pcmV0dXJuITE7dGhpcy50PT1udWxsJiYodGhpcy50PXMuYmVnaW5bMF0qc2FtcGxlUmF0ZSk7Y29uc3Qgcj1lWzBdLGk9MjU2KnE7Zm9yKGxldCBvPTA7bzxyWzBdLmxlbmd0aDtvKyspe2NvbnN0IGE9YihzLmRldHVuZSxvKSx1PVooYihzLmZyZXF1ZW5jeSxvKSxhLzEwMCksYz1pKnUqdGhpcy50K3RoaXMuaW5pdGlhbE9mZnNldCxmPSh0aGlzLmZ1bmMoYykmMjU1KS8xMjcuNS0xLGQ9VChmKi4yLC0uNCwuNCk7Zm9yKGxldCBsPTA7bDxyLmxlbmd0aDtsKyspcltsXVtvXT1kO3RoaXMudCsrfXJldHVybiEwfX1yZWdpc3RlclByb2Nlc3NvcigiYnl0ZS1iZWF0LXByb2Nlc3NvciIsaGUpO2NsYXNzIGxlIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29ye3N0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKXtyZXR1cm5be25hbWU6ImJlZ2luIixkZWZhdWx0VmFsdWU6MH0se25hbWU6ImVuZCIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJhdHRhY2siLGRlZmF1bHRWYWx1ZTouMDA1LG1pblZhbHVlOjB9LHtuYW1lOiJkZWNheSIsZGVmYXVsdFZhbHVlOi4xNCxtaW5WYWx1ZTowfSx7bmFtZToic3VzdGFpbiIsZGVmYXVsdFZhbHVlOjAsbWluVmFsdWU6MCxtYXhWYWx1ZToxfSx7bmFtZToicmVsZWFzZSIsZGVmYXVsdFZhbHVlOi4xLG1pblZhbHVlOjB9LHtuYW1lOiJhdHRhY2tDdXJ2ZSIsZGVmYXVsdFZhbHVlOjAsbWluVmFsdWU6LTEsbWF4VmFsdWU6MX0se25hbWU6ImRlY2F5Q3VydmUiLGRlZmF1bHRWYWx1ZTowLG1pblZhbHVlOi0xLG1heFZhbHVlOjF9LHtuYW1lOiJyZWxlYXNlQ3VydmUiLGRlZmF1bHRWYWx1ZTowLG1pblZhbHVlOi0xLG1heFZhbHVlOjF9LHtuYW1lOiJwZWFrIixkZWZhdWx0VmFsdWU6MX0se25hbWU6InJldHJpZ2dlciIsZGVmYXVsdFZhbHVlOjEsbWluVmFsdWU6MCxtYXhWYWx1ZToxfV19Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMudmFsPTAsdGhpcy5zZWdJZHg9MCx0aGlzLnN0YXRlPTAsdGhpcy5iZWdpblRpbWU9MCx0aGlzLmVuZFRpbWU9MCx0aGlzLmF0dGFja1N0YXJ0PTB9X3dhcnAodCxlLHM9OCl7aWYodD09PTB8fHQ9PT0xKXJldHVybiB0O2lmKGU+MCl7Y29uc3Qgcj0xK3MqZTtyZXR1cm4gMS1NYXRoLnBvdygxLXQscil9ZWxzZXtjb25zdCByPTEtcyplO3JldHVybiBNYXRoLnBvdyh0LHIpfX1fYWR2YW5jZSh0LGUscyxyKXtpZihzPT09MHx8dD09PWUpdGhpcy52YWw9ZTtlbHNle2NvbnN0IGk9TWF0aC5taW4oMSwoY3VycmVudFRpbWUtdGhpcy5iZWdpblRpbWUpL3MpLG89dGhpcy5fd2FycChpLHIpO3RoaXMudmFsPXQrKGUtdCkqb319cHJvY2Vzcyh0LGUscyl7Y29uc3Qgcj1lWzBdWzBdO2lmKCFyKXJldHVybiEwO2NvbnN0IGk9YihzLmJlZ2luLDApLG89YihzLnJldHJpZ2dlciwwKT49LjU7aSE9PXRoaXMuYmVnaW5UaW1lJiYodGhpcy5zdGF0ZT09PTB8fG8pJiYodGhpcy5iZWdpblRpbWU9aSx0aGlzLnN0YXRlPTEsdGhpcy5lbmRUaW1lPWIocy5lbmQsMCksdGhpcy5hdHRhY2tTdGFydD10aGlzLnZhbCk7Y29uc3QgYT10aGlzLmVuZFRpbWUtdGhpcy5iZWdpblRpbWU7Zm9yKGxldCB1PTA7dTxyLmxlbmd0aDt1Kyspe2NvbnN0IGM9YihzLmF0dGFjayx1KSxoPWIocy5kZWNheSx1KSxmPWIocy5zdXN0YWluLHUpLGQ9YihzLnJlbGVhc2UsdSksbD1iKHMuYXR0YWNrQ3VydmUsdSkscD1iKHMuZGVjYXlDdXJ2ZSx1KSxtPWIocy5yZWxlYXNlQ3VydmUsdSksST1iKHMucGVhayx1KSxnPVt7dGltZTpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksc3RhcnQ6MCx0YXJnZXQ6MH0se3RpbWU6YyxzdGFydDp0aGlzLmF0dGFja1N0YXJ0LHRhcmdldDoxLGN1cnZlOmx9LHt0aW1lOmMraCxzdGFydDoxLHRhcmdldDpmLGN1cnZlOnB9LHt0aW1lOmEsc3RhcnQ6Zix0YXJnZXQ6Zn0se3RpbWU6YStkLHN0YXJ0OmYsdGFyZ2V0OjAsY3VydmU6bX1dO2xldHt0aW1lOnYsc3RhcnQ6dyx0YXJnZXQ6UCxjdXJ2ZTpTfT1nW3RoaXMuc3RhdGVdO2Zvcih0aGlzLl9hZHZhbmNlKHcsUCx2LFMpO2N1cnJlbnRUaW1lLXRoaXMuYmVnaW5UaW1lPj12Oyl0aGlzLnN0YXRlPSh0aGlzLnN0YXRlKzEpJWcubGVuZ3RoLHY9Z1t0aGlzLnN0YXRlXS50aW1lO3JbdV09dGhpcy52YWwqSX1yZXR1cm4hMH19cmVnaXN0ZXJQcm9jZXNzb3IoImVudmVsb3BlLXByb2Nlc3NvciIsbGUpO2NvbnN0IEI9T2JqZWN0LmZyZWV6ZSh7Tk9ORTowLEFTWU06MSxNSVJST1I6MixCRU5EUDozLEJFTkRNOjQsQkVORE1QOjUsU1lOQzo2LFFVQU5UOjcsRk9MRDo4LFBXTTo5LE9SQklUOjEwLFNQSU46MTEsQ0hBT1M6MTIsUFJJTUVTOjEzLEJJTkFSWToxNCxCUk9XTklBTjoxNSxSRUNJUFJPQ0FMOjE2LFdPUk1IT0xFOjE3LExPR0lTVElDOjE4LFNJR01PSUQ6MTksRlJBQ1RBTDoyMCxGTElQOjIxfSk7ZnVuY3Rpb24gZmUobil7cmV0dXJuIG49bisyMTI3OTEyMjE0KyhuPDwxMiksbj1uXjMzNDUwNzI3MDBebj4+PjE5LG49biszNzQ3NjEzOTMrKG48PDUpLG49biszNTUwNjM1MTE2Xm48PDksbj1uKzQyNTE5OTM3OTcrKG48PDMpLG49bl4zMDQyNTk0NTY5Xm4+Pj4xNixuPj4+MH1jb25zdCBGdD1uPT4oZmUobik+Pj44KS8xNjc3NzIxNjtmdW5jdGlvbiBkZShuLHQpe2xldCBlPTA7Zm9yKGxldCBzPTA7czx0O3MrKyllPWU8PDF8biYxLG4+Pj49MTtyZXR1cm4gZX1mdW5jdGlvbiBwZShuKXtjb25zdCB0PU1hdGguZmxvb3IobiksZT1uLXQscz1GdCh0KSxyPUZ0KHQrMSk7cmV0dXJuIHMrKHItcykqZX1mdW5jdGlvbiBtZShuLHQ9NCl7bGV0IGU9LjUscz0wLHI9MCxpPTE7Zm9yKGxldCBvPTA7bzx0O28rKylzKz1lKnBlKG4qaSkscis9ZSxlKj0uNSxpKj0yO3JldHVybiBzL3IqMi0xfWNvbnN0IGd0PXt9O2NsYXNzIHZlIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29ye3N0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKXtyZXR1cm5be25hbWU6ImJlZ2luIixkZWZhdWx0VmFsdWU6MCxtaW46MCxtYXg6TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZfSx7bmFtZToiZW5kIixkZWZhdWx0VmFsdWU6MCxtaW46MCxtYXg6TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZfSx7bmFtZToiZnJlcXVlbmN5IixkZWZhdWx0VmFsdWU6NDQwLG1pbjpOdW1iZXIuRVBTSUxPTn0se25hbWU6ImRldHVuZSIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJmcmVxc3ByZWFkIixkZWZhdWx0VmFsdWU6LjE4LG1pbjowfSx7bmFtZToicG9zaXRpb24iLGRlZmF1bHRWYWx1ZTowLG1pbjowLG1heDoxfSx7bmFtZToid2FycCIsZGVmYXVsdFZhbHVlOjAsbWluOjAsbWF4OjF9LHtuYW1lOiJ3YXJwTW9kZSIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJ2b2ljZXMiLGRlZmF1bHRWYWx1ZToxLG1pbjoxLGF1dG9tYXRpb25SYXRlOiJrLXJhdGUifSx7bmFtZToicGFuc3ByZWFkIixkZWZhdWx0VmFsdWU6LjcsbWluOjAsbWF4OjF9LHtuYW1lOiJwaGFzZXJhbmQiLGRlZmF1bHRWYWx1ZTowLG1pbjowLG1heDoxfV19Y29uc3RydWN0b3IodCl7c3VwZXIodCksdGhpcy5mcmFtZUxlbj0wLHRoaXMubnVtRnJhbWVzPTAsdGhpcy5waGFzZT1bXSx0aGlzLnBvcnQub25tZXNzYWdlPWU9Pntjb25zdHt0eXBlOnMscGF5bG9hZDpyfT1lLmRhdGF8fHt9O2lmKHM9PT0idGFibGUiKXtjb25zdCBpPXIua2V5O2lmKHRoaXMuZnJhbWVMZW49ci5mcmFtZUxlbiwhZ3RbaV0pe2NvbnN0IG89W3IuZnJhbWVzXTtsZXQgYT1vWzBdO2ZvcihsZXQgdT0xO3U8MTt1Kyspe2NvbnN0IGM9YS5sZW5ndGg+PjEsaD1hLm1hcChmPT57Y29uc3QgZD1uZXcgRmxvYXQzMkFycmF5KGMpO2ZvcihsZXQgbD0wO2w8YztsKyspZFtsXT0oZlsyKmxdK2ZbMipsKzFdKS8yO3JldHVybiBkfSk7aWYoby5wdXNoKGgpLGE9aCxjPD0zMilicmVha31ndFtpXT1vfXRoaXMudGFibGVzPWd0W2ldLHRoaXMubnVtRnJhbWVzPXRoaXMudGFibGVzWzBdLmxlbmd0aH19fV9taXJyb3IodCl7cmV0dXJuIDEtTWF0aC5hYnMoMip0LTEpfV90b0JpdHModCxlPTIscz0xMil7Y29uc3Qgcj1zKyhlLXMpKnQ7cmV0dXJue2I6cixuOlUoTWF0aC5wb3coMixyKSl9fV93YXJwUGhhc2UodCxlLHMpe3N3aXRjaChzKXtjYXNlIEIuTk9ORTpyZXR1cm4gdDtjYXNlIEIuQVNZTTp7Y29uc3Qgcj0uMDErLjk5KmU7cmV0dXJuIHQ8cj8uNSp0L3I6LjUrLjUqKHQtcikvKDEtcil9Y2FzZSBCLk1JUlJPUjpyZXR1cm4gdGhpcy5fbWlycm9yKHRoaXMuX3dhcnBQaGFzZSh0LGUsQi5BU1lNKSk7Y2FzZSBCLkJFTkRQOnJldHVybiBNYXRoLnBvdyh0LDErMyplKTtjYXNlIEIuQkVORE06cmV0dXJuIE1hdGgucG93KHQsMS8oMSszKmUpKTtjYXNlIEIuQkVORE1QOnJldHVybiBlPC41P3RoaXMuX3dhcnBQaGFzZSh0LDEtMiplLDMpOnRoaXMuX3dhcnBQaGFzZSh0LDIqZS0xLDIpO2Nhc2UgQi5TWU5DOntjb25zdCByPU1hdGgucG93KDE2LGUqKjIpO3JldHVybiB0KnIlMX1jYXNlIEIuUVVBTlQ6e2NvbnN0e246cn09dGhpcy5fdG9CaXRzKGUpO3JldHVybiBLKHQqcikvcn1jYXNlIEIuRk9MRDp7Y29uc3QgaT0xK01hdGgubWF4KDEsVSg3KmUpKTtyZXR1cm4gTWF0aC5hYnMoQXQoaSp0KS0uNSkqMn1jYXNlIEIuUFdNOntjb25zdCByPVQoLjUrLjQ5KigyKmUtMSksMCwxKTtyZXR1cm4gdDxyP3QvciouNTouNSsodC1yKS8oMS1yKSouNX1jYXNlIEIuT1JCSVQ6e2NvbnN0IHI9LjUqZTtyZXR1cm4gSCh0K3IqTWF0aC5zaW4oayozKnQpKX1jYXNlIEIuU1BJTjp7Y29uc3Qgcj0uNSplLHtuOml9PXRoaXMuX3RvQml0cyhlLDEsNik7cmV0dXJuIEgodCtyKk1hdGguc2luKGsqaSp0KSl9Y2FzZSBCLkNIQU9TOntjb25zdCBpPSgzLjcrLjMqZSkqdCooMS10KTtyZXR1cm4gVCgoMS1lKSp0K2UqaSwwLDEpfWNhc2UgQi5QUklNRVM6e2NvbnN0IHI9bz0+e2lmKG88MilyZXR1cm4hMTtpZihvJTI9PT0wKXJldHVybiBvPT09Mjtmb3IobGV0IGE9MzthKioyPD1vO2ErPTIpaWYobyVhPT09MClyZXR1cm4hMTtyZXR1cm4hMH07bGV0e246aX09dGhpcy5fdG9CaXRzKGUsMyk7Zm9yKDshcihpKTspaSsrO3JldHVybiBLKHQqaSkvaX1jYXNlIEIuQklOQVJZOntsZXR7YjpyfT10aGlzLl90b0JpdHMoZSwzKTtyPVUocik7Y29uc3QgaT0xPDxyLG89Syh0KmkpO3JldHVybiBkZShvLHIpL2l9Y2FzZSBCLkJST1dOSUFOOntjb25zdCByPS4yNSplKm1lKDY0KnQsNCk7cmV0dXJuIEgodCtyKX1jYXNlIEIuUkVDSVBST0NBTDp7Y29uc3Qgcj0yKzQqZSxpPXQqcixvPXQrKDEtdCkqcixhPW8+MWUtMTI/aS9vOjA7cmV0dXJuIFQoYSwwLDEpfWNhc2UgQi5XT1JNSE9MRTp7Y29uc3Qgcj1UKC44KmUsMCwxKSxpPS41KigxLXIpLG89LjUqKDErcik7cmV0dXJuIHQ8aT90L2kqLjU6dD5vPy41KigxKyh0LW8pLygxLW8pKTouNX1jYXNlIEIuTE9HSVNUSUM6e2xldCByPXQ7Y29uc3QgaT0zLjYrLjQqZSxvPTErVSgyKmUpO2ZvcihsZXQgYT0wO2E8bzthKyspcj1pKnIqKDEtcik7cmV0dXJuIFQociwwLDEpfWNhc2UgQi5TSUdNT0lEOntjb25zdCByPTErMTAqZSxpPXQtLjUsbz0xLygxK01hdGguZXhwKC1yKmkpKSxhPTEvKDErTWF0aC5leHAoLjUqcikpLHU9MS8oMStNYXRoLmV4cCgtLjUqcikpO3JldHVybihvLWEpLyh1LWEpfWNhc2UgQi5GUkFDVEFMOntjb25zdCByPS41Kk1hdGguc2luKGsqdCkqZTtyZXR1cm4gSCh0K3IpfWNhc2UgQi5GTElQOnJldHVybiB0O2RlZmF1bHQ6cmV0dXJuIHR9fV9zYW1wbGVGcmFtZSh0LGUpe2NvbnN0IHM9dC5sZW5ndGgscj1lKnM7bGV0IGk9cnwwO2k+PXMmJihpPTApO2NvbnN0IG89ci1pLGE9dFtpXTtsZXQgdT1pKzE7dT49cyYmKHU9MCk7Y29uc3QgYz10W3VdO3JldHVybiBhKyhjLWEpKm99X2Nob29zZU1pcCh0KXtjb25zdCBlPVQodCwxZS02LDY0KTtsZXQgcz0wO2Zvcig7cysxPCh0aGlzLnRhYmxlcz8ubGVuZ3RofHwxKSYmZTx0aGlzLnRhYmxlc1tzXVswXS5sZW5ndGgvODspcysrO3JldHVybiBzfXByb2Nlc3ModCxlLHMpe2lmKGN1cnJlbnRUaW1lPj1zLmVuZFswXSlyZXR1cm4hMTtpZihjdXJyZW50VGltZTw9cy5iZWdpblswXSlyZXR1cm4hMDtjb25zdCByPWVbMF1bMF0saT1lWzBdWzFdfHxlWzBdWzBdO2lmKCF0aGlzLnRhYmxlcylyZXR1cm4gci5maWxsKDApLGkhPT1yJiZpLnNldChyKSwhMDtjb25zdCBvPXMudm9pY2VzWzBdO2ZvcihsZXQgYT0wO2E8ci5sZW5ndGg7YSsrKXtjb25zdCB1PWIocy5kZXR1bmUsYSksYz1iKHMuZnJlcXNwcmVhZCxhKSxmPVQoYihzLnBvc2l0aW9uLGEpLDAsMSkqKHRoaXMubnVtRnJhbWVzLTEpLGQ9ZnwwLGw9Zi1kLHA9VChiKHMud2FycCxhKSwwLDEpLG09YihzLndhcnBNb2RlLGEpLEk9VChiKHMucGhhc2VyYW5kLGEpLDAsMSksZz1vPjE/VChiKHMucGFuc3ByZWFkLGEpLDAsMSk6MCx2PU1hdGguc3FydCguNS0uNSpnKSx3PU1hdGguc3FydCguNSsuNSpnKTtsZXQgUD1iKHMuZnJlcXVlbmN5LGEpO1A9WihQLHUvMTAwKTtjb25zdCBTPTEvTWF0aC5zcXJ0KG8pLFY9TnQobyxjKTtmb3IobGV0IE09MDtNPG87TSsrKXtjb25zdCB4PShNJjEpPT0xO2xldCB5PXYsQT13O3gmJih5PXcsQT12KTtjb25zdCBOPVooUCxWKE0pKSpxLEU9dGhpcy5fY2hvb3NlTWlwKE4pLE89dGhpcy50YWJsZXNbRV07dGhpcy5waGFzZVtNXT10aGlzLnBoYXNlW01dPz9NYXRoLnJhbmRvbSgpKkk7Y29uc3QgRj10aGlzLl93YXJwUGhhc2UodGhpcy5waGFzZVtNXSxwLG0pLEQ9dGhpcy5fc2FtcGxlRnJhbWUoT1tkXSxGKSxMPXRoaXMuX3NhbXBsZUZyYW1lKE9bTWF0aC5taW4odGhpcy5udW1GcmFtZXMtMSxkKzEpXSxGKTtsZXQgQz1VdChELEwsbCk7bT09PUIuRkxJUCYmdGhpcy5waGFzZVtNXTxwJiYoQz0tQyksclthXSs9Qyp5KlMsaVthXSs9QypBKlMsdGhpcy5waGFzZVtNXT1IKHRoaXMucGhhc2VbTV0rTil9fXJldHVybiEwfX1yZXR1cm4gcmVnaXN0ZXJQcm9jZXNzb3IoIndhdmV0YWJsZS1vc2NpbGxhdG9yLXByb2Nlc3NvciIsdmUpLGZ0LldhcnBNb2RlPUIsT2JqZWN0LmRlZmluZVByb3BlcnR5KGZ0LFN5bWJvbC50b1N0cmluZ1RhZyx7dmFsdWU6Ik1vZHVsZSJ9KSxmdH0pKHt9KTsK";let On;const $0=()=>(On=new AudioContext,On),J=()=>On||$0();function Ib(){return J().currentTime}let eo={};function ep(e,t){const n=J();if(eo[e])return eo[e];const s=2*n.sampleRate,o=n.createBuffer(1,s,n.sampleRate),r=o.getChannelData(0);let i=0,u,a,l,p,f,g,X;u=a=l=p=f=g=X=0;for(let G=0;G<s;G++)if(e==="white")r[G]=Math.random()*2-1;else if(e==="brown"){let w=Math.random()*2-1;r[G]=(i+.02*w)/1.02,i=r[G]}else if(e==="pink"){let w=Math.random()*2-1;u=.99886*u+w*.0555179,a=.99332*a+w*.0750759,l=.969*l+w*.153852,p=.8665*p+w*.3104856,f=.55*f+w*.5329522,g=-.7616*g-w*.016898,r[G]=u+a+l+p+f+g+X+w*.5362,r[G]*=.11,X=w*.115926}else if(e==="crackle"){const w=t*.01;Math.random()<w?r[G]=Math.random()*2-1:r[G]=0}return e!=="crackle"&&(eo[e]=o),o}function to(e="white",t,n=.02){const o=J().createBufferSource();return o.buffer=ep(e,n),o.loop=!0,o.start(t),{node:o,stop:r=>o.stop(r)}}function Jb(e,t,n){const s=to("pink",n),o=op(e,s.node,t);return s.node.onended=()=>o.onended(),{node:o.node,stop:r=>s?.stop(r)}}const no=["pink","white","brown","crackle"];function Re(e){const t=J().createGain();return t.gain.value=e,t}function Un(e,t,n){const s=Re(n);return e.connect(s),s.connect(t),s}const tp=(e,t,n,s)=>s-n===0?0:(t-e)/(s-n);function ke(e,t,n,s){const o=new AudioWorkletNode(e,t,s);return Object.entries(n).forEach(([r,i])=>{i!==void 0&&(o.parameters.get(r).value=i)}),o}const Ee=(e,t,n,s,o,r,i,u,a,l="exponential")=>{t=lt(t),n=lt(n),s=lt(s),o=lt(o);const p=l==="exponential"?"exponentialRampToValueAtTime":"linearRampToValueAtTime";l==="exponential"&&(r=r===0?.001:r,i=i===0?.001:i);const f=i-r,g=i,X=r+s*f,G=a-u,w=F=>{let v;if(t>F){let z=tp(r,g,0,t);v=F*z+(r>g?r:0)}else v=(F-t)*tp(g,X,0,n)+g;return l==="exponential"&&(v=v||.001),v};e.setValueAtTime(r,u),t>G?e[p](w(G),a):t+n>G?(e[p](w(t),u+t),e[p](w(G),a)):(e[p](w(t),u+t),e[p](w(t+n),u+t+n),e.setValueAtTime(X,a)),e[p](r,a+o)};function jb(e){return typeof e=="number"?e%5:{tri:0,triangle:0,sine:1,ramp:2,saw:3,square:4}[e]??0}function Gn(e,t,n,s={}){const{shape:o=0,...r}=s,{dcoffset:i=-.5,depth:u=1}=s,a={frequency:1,depth:u,skew:.5,phaseoffset:0,time:t,begin:t,end:n,shape:jb(o),dcoffset:i,min:i*u,max:i*u+u,curve:1,...r};return ke(e,"lfo-processor",a)}function np(e,t,n,s,o,r){const i={threshold:t??-3,ratio:n??10,knee:s??10,attack:o??.005,release:r??.05};return new DynamicsCompressorNode(e,i)}const De=(e,t="linear",n)=>{const[i,u,a,l]=e;if(i==null&&u==null&&a==null&&l==null)return n??[.001,.001,1,.01];const p=a??(i!=null&&u==null||i==null&&u==null?1:.001);return[Math.max(i??0,.001),Math.max(u??0,.001),Math.min(p,1),Math.max(l??0,.01)]};function so(e,t,n,s,o){let{defaultDepth:r=1,depth:i,dcoffset:u,...a}=o;i==null&&(i=Object.values(a).some(f=>f!=null)?r:0);let l;return i&&(l=Gn(e,n,s,{depth:i,dcoffset:u,...a}),l.connect(t)),l}function oo(e,t,n,s,o,r){let{amount:i,offset:u,defaultAmount:a=1,curve:l="linear",values:p,holdEnd:f,defaultValues:g}=o;i==null&&(i=p.some(z=>z!=null)?a:0);const X=u??0,G=i+X;if(Math.abs(G-X)){const[v,z,B,x]=De(p,l,g);Ee(t,v,z,B,x,X,G,n,f,l)}const F=so(e,t,n,s,r);return{lfo:F,disconnect:()=>F?.disconnect()}}function Qn(e,t,n,s,o,r){let{frequency:i,anchor:u,env:a,type:l,model:p,q:f=1,drive:g=.69,depth:X,depthfrequency:G,dcoffset:w=-.5,skew:F,shape:v,rate:z,sync:B}=s,x,R;p==="ladder"?(R=ke(e,"ladder-processor",{frequency:i,q:f,drive:g}),x=R.parameters.get("frequency")):(R=e.createBiquadFilter(),R.type=l,R.Q.value=f,R.frequency.value=i,x=R.frequency);const N=[s.attack,s.decay,s.sustain,s.release],[O,j,te,T]=De(N,"exponential",[.005,.14,0,.1]);if([...N,a].some(U=>U!==void 0)){a=lt(a,1,!0),u=lt(u,0,!0);const U=Math.abs(a),pe=U*u;let $=Xt(2**-pe*i,0,2e4),oe=Xt(2**(U-pe)*i,0,2e4);a<0&&([$,oe]=[oe,$]),Ee(x,O,j,te,T,$,oe,t,n,"exponential")}B!=null&&(z=o*B);const H=[X,G,F,v,z].some(U=>U!==void 0);let q;if(H){X=X??1;const U=r/o,$={depth:G??(X??1)*i,dcoffset:w,skew:F,shape:v,frequency:z??o,min:-i+30,max:2e4-i,time:U,curve:1};q=so(e,x,t,n,$)}return{filter:R,lfo:q}}let sp=e=>e<.5?1:1-(e-.5)/.5;function op(e,t,n=0){const s=J();if(!n)return e;let o=s.createGain(),r=s.createGain();e.connect(o),t.connect(r),o.gain.value=sp(n),r.gain.value=sp(1-n);let i=s.createGain();return o.connect(i),r.connect(i),{node:i,onended:()=>{o.disconnect(i),r.disconnect(i),e.disconnect(o),t.disconnect(r)}}}let Ob=["linear","exponential"];function It(e,t,n,s){if((t.pattack??t.pdecay??t.psustain??t.prelease??t.penv)===void 0)return;const r=lt(t.penv,1,!0),i=Ob[t.pcurve??0];let[u,a,l,p]=De([t.pattack,t.pdecay,t.psustain,t.prelease],i,[.2,.001,1,.001]),f=t.panchor??l;const g=r*100,X=0-g*f,G=g-g*f;Ee(e,u,a,l,p,X,G,n,s,i)}function Jt(e,t,n){const{vibmod:s=.5,vib:o}=t;let r;if(o>0){r=J().createOscillator(),r.frequency.value=o;const i=J().createGain();return i.gain.value=s*100,r.connect(i),i.connect(e),r.onended=()=>{i.disconnect(e),r.disconnect(i)},r.start(n),r}}function Ub(e,t,n=J()){const s=n.currentTime;Ct(n,e,s,t)}function Ct(e,t,n,s){const o=new ConstantSourceNode(e),r=Re(0);return r.connect(e.destination),o.connect(r),o.onended=()=>{try{r.disconnect()}catch{}try{o.disconnect()}catch{}t()},o.start(n),o.stop(s),o}const Qb=(e,t=1,n="sine")=>{const s=J();let o;no.includes(n)?(o=s.createBufferSource(),o.buffer=ep(n,2),o.loop=!0):(o=s.createOscillator(),o.type=n,o.frequency.value=e),o.start();const r=Re(t);return o.connect(r),{node:r,stop:i=>o.stop(i),osc:o}},qb=(e,t,n,s="sine")=>{const r=e.value*t,i=r*n;return Qb(r,i,s)};function Zn(e,t,n){const{fmh:s=1,fmi:o,fmenv:r="exp",fmattack:i,fmdecay:u,fmsustain:a,fmrelease:l,fmvelocity:p,fmwave:f="sine",duration:g}=t;let X,G=()=>{};if(o){const F=J().createGain(),v=qb(e,s,o,f);if(X=v.node,G=v.stop,![i,u,a,l,p].some(z=>z!==void 0))X.connect(e);else{const[z,B,x,R]=De([i,u,a,l]),N=n+g;Ee(F.gain,z,B,x,R,0,1,n,N,r==="exp"?"exponential":"linear"),X.connect(F),F.connect(e)}v.osc.onended=()=>{F.disconnect(),X.disconnect(),v.osc.disconnect()}}return{stop:G}}const rp=e=>e/(1+e),$b=(e,t)=>(e%t+t)%t,eg=(e,t)=>(1+t)*e/(1+t*Math.abs(e)),jt=(e,t)=>Math.tanh(e*(1+t)),tg=(e,t)=>Xt((1+t)*e,-1,1),cp=(e,t)=>{let n=(1+.5*t)*e;const s=$b(n+1,4);return 1-Math.abs(s-2)},ng=(e,t)=>Math.sin(Math.PI/2*cp(e,t)),sg=(e,t)=>{const n=rp(Math.log1p(t)),s=(e-n/3*e*e*e)/(1-n/3);return jt(s,t)},ip=(e,t,n=!1)=>{const s=1+2*t,r=.07*rp(Math.log1p(t)),i=jt(e+r,2*t),u=jt(n?r:-e+r,2*t),a=i-u,l=1/Math.cosh(s*r),p=l*l,f=Math.max(1e-8,(n?1:2)*s*p);return jt(a/f,t)},ro={scurve:eg,soft:jt,hard:tg,cubic:sg,diode:ip,asym:(e,t)=>ip(e,t,!0),fold:cp,sinefold:ng,chebyshev:(e,t)=>{const n=10*Math.log1p(t);let s=1,o=e,r,i=0;for(let u=1;u<64;u++){if(u<2){i+=u==0?s:o;continue}r=2*e*s-o,o=s,s=r,u%2===0&&(i+=Math.min(1.3*n/u,2)*r)}return jt(i,n/20)}},wn=Object.freeze(Object.keys(ro)),og=e=>{let t=e;typeof e=="string"&&(t=wn.indexOf(e),t===-1&&(Ze(`[superdough] Could not find waveshaping algorithm ${e}.
        Available options are ${wn.join(", ")}.
        Defaulting to ${wn[0]}.`),t=0));const n=wn[t%wn.length];return ro[n]},up=(e,t,n)=>ke(J(),"distort-processor",{distort:e,postgain:t},{processorOptions:{algorithm:n}}),Lt=(e,t=36)=>{let{note:n,freq:s,octave:o=0}=e;return n=n||t,typeof n=="string"&&(n=jn(n)),!s&&typeof n=="number"&&(s=J0(n)),s*=Math.pow(2,o),Number(s)},Ot=e=>{e!=null&&(e.disconnect(),e.parameters.get("end")?.setValueAtTime(0,0))};let rg=Symbol("clean"),qe=[],Gt=0;const qn=4;let cg=e=>{let t=[],n={get(){return n.lc||n.listen(()=>{})(),n.value},lc:0,listen(s){return n.lc=t.push(s),()=>{for(let r=Gt+qn;r<qe.length;)qe[r]===s?qe.splice(r,qn):r+=qn;let o=t.indexOf(s);~o&&(t.splice(o,1),--n.lc||n.off())}},notify(s,o){let r=!qe.length;for(let i of t)qe.push(i,n.value,s,o);if(r){for(Gt=0;Gt<qe.length;Gt+=qn)qe[Gt](qe[Gt+1],qe[Gt+2],qe[Gt+3]);qe.length=0}},off(){},set(s){let o=n.value;o!==s&&(n.value=s,n.notify(o))},subscribe(s){let o=n.listen(s);return s(n.value),o},value:e};return process.env.NODE_ENV!=="production"&&(n[rg]=()=>{t=[],n.lc=0,n.off()}),n},ig=(e={})=>{let t=cg(e);return t.setKey=function(n,s){let o=t.value;typeof s>"u"&&n in t.value?(t.value={...t.value},delete t.value[n],t.notify(o,n)):t.value[n]!==s&&(t.value={...t.value,[n]:s},t.notify(o,n))},t};const co={},io={},ug=e=>co[e];function ag(e,t){var n=1024;if(e<n)return e+" B";var s=["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],o=-1;do e/=n,++o;while(e>=n);return e.toFixed(1)+" "+s[o]}function ap(e,t){const{speed:n=1}=e,{transpose:s,url:o,index:r,midi:i,label:u}=U0(e,t);let a=Math.abs(n)*Math.pow(2,s/12);return{transpose:s,url:o,index:r,midi:i,label:u,playbackRate:a}}const lp=async(e,t,n)=>{let{url:s,label:o,playbackRate:r}=ap(e,t);n&&(s=await n(s));const i=J(),u=await uo(s,i,o);return e.unit==="c"&&(r=r*u.duration),{buffer:u,playbackRate:r}},dp=async(e,t,n)=>{let{buffer:s,playbackRate:o}=await lp(e,t,n);e.speed<0&&(s=pp(s));const i=J().createBufferSource();i.buffer=s,i.playbackRate.value=o;const{loopBegin:u=0,loopEnd:a=1,begin:l=0,end:p=1}=e,f=l*i.buffer.duration;e.loop&&(i.loop=!0,i.loopStart=u*i.buffer.duration-f,i.loopEnd=a*i.buffer.duration-f);const X=i.buffer.duration/i.playbackRate.value,G=(p-l)*X;return{bufferSource:i,offset:f,bufferDuration:X,sliceDuration:G}},uo=(e,t,n,s=0)=>{const o=n?`sound "${n}:${s}"`:"sample";if(e=e.replace("#","%23"),!io[e]){Ze(`[sampler] load ${o}..`,"load-sample",{url:e});const r=Date.now();io[e]=fetch(e).then(i=>i.arrayBuffer()).then(async i=>{const u=Date.now()-r,a=ag(i.byteLength);Ze(`[sampler] load ${o}... done! loaded ${a} in ${u}ms`,"loaded-sample",{url:e});const l=await t.decodeAudioData(i);return co[e]=l,l})}return io[e]};function pp(e){const t=J(),n=t.createBuffer(e.numberOfChannels,e.length,t.sampleRate);for(let s=0;s<e.numberOfChannels;s++)n.copyToChannel(e.getChannelData(s).slice().reverse(),s,s);return n}const lg=e=>co[e];function hp(e){if(e.startsWith("bubo:")){const[t,n]=e.split(":");e=`github:Bubobubobubobubo/dough-${n}`}return e}function fp(e,t=""){if(!e.startsWith("github:"))throw new Error('expected "github:" at the start of pseudoUrl');let n=e.slice(7);n=n.endsWith("/")?n.slice(0,-1):n;let s=n.split("/"),o=s[0],r=s.length>=2?s[1]:"samples",i=s.length>=3?s[2]:"main",u=s.slice(3);return u.push(t||""),u=u.join("/"),`https://raw.githubusercontent.com/${o}/${r}/${i}/${u}`}const mp=(e,t,n=e._base||"")=>Object.entries(e).forEach(([s,o])=>{if(typeof o=="string"&&(o=[o]),typeof o!="object")throw new Error("wrong sample map format for "+s);n=o._base||n,n=hp(n),n.startsWith("github:")&&(n=fp(n,""));const r=i=>n+i;Array.isArray(o)?o=o.map(r):o=Object.fromEntries(Object.entries(o).map(([i,u])=>[i,(typeof u=="string"?[u]:u).map(r)])),t(s,o)});let yp={};function dg(e,t){yp[e]=t}function pg(e){const t=Object.entries(yp).find(([n])=>e.startsWith(n));if(t)return t[1]}async function hg(e){const t=pg(e);if(t)return t(e);if(e=hp(e),e.startsWith("github:")&&(e=fp(e,"strudel.json")),e.startsWith("local:")&&(e="http://localhost:5432"),e.startsWith("shabda:")){let[o,r]=e.split("shabda:");e=`https://shabda.ndre.gr/${r}.json?strudel=1`}if(e.startsWith("shabda/speech")){let[o,r]=e.split("shabda/speech");r=r.startsWith("/")?r.substring(1):r;let[i,u]=r.split(":"),a="f",l="en-GB";i&&([l,a]=i.split("/")),e=`https://shabda.ndre.gr/speech/${u}.json?gender=${a}&language=${l}&strudel=1'`}if(typeof fetch!="function")return;const n=Q0(e);if(typeof fetch>"u")return;const s=await fetch(e).then(o=>o.json()).catch(o=>{throw console.error(o),new Error(`error loading "${e}"`)});return[s,s._base||n]}const ao=async(e,t=e._base||"",n={})=>{if(typeof e=="string"){const[r,i]=await hg(e);return ao(r,t||i,n)}const{prebake:s,tag:o}=n;mp(e,(r,i)=>{Xp(r,i,{baseUrl:t,prebake:s,tag:o})},t)},bp=[];async function gp(e,t,n,s,o){let{s:r,nudge:i=0,cut:u,loop:a,clip:l=void 0,n:p=0,speed:f=1,duration:g}=t;if(f===0)return;const X=J();let[G,w,F,v]=De([t.attack,t.decay,t.sustain,t.release]);const{bufferSource:z,sliceDuration:B,offset:x}=await dp(t,s,o);if(X.currentTime>e){Ze(`[sampler] still loading sound "${r}:${p}"`,"highlight");return}if(!z){Ze(`[sampler] could not load "${r}:${p}"`,"error");return}let R=Jt(z.detune,t,e);const N=e+i;z.start(N,x);const O=X.createGain(),j=z.connect(O);l==null&&a==null&&t.release==null&&(g=B);let te=e+g;Ee(j.gain,G,w,F,v,0,1,e,te,"linear"),It(z.detune,t,e,te);const T=X.createGain();j.connect(T),z.onended=function(){z.disconnect(),R?.stop(),j.disconnect(),T.disconnect(),n()};let ue=te+v+.01;z.stop(ue);const q={node:T,bufferSource:z,stop:U=>{z.stop(U)}};if(u!==void 0){const U=bp[u];U&&(U.node.gain.setValueAtTime(1,N),U.node.gain.linearRampToValueAtTime(0,N+.01)),bp[u]=q}return q}function fg(e,t,n){ot(e,(s,o,r)=>gp(s,o,r,t),{type:"sample",samples:t,...n})}function Xp(e,t,n){e.startsWith("wt_")?wo(e,t,n):fg(e,t,n)}let Ut=(e,t)=>e!==void 0&&e!==t;class mg{reverbNode;delayNode;output;summingNode;djfNode;audioContext;constructor(t){this.audioContext=t,this.output=new GainNode(t,{gain:1,channelCount:2,channelCountMode:"explicit"}),this.summingNode=new GainNode(t,{gain:1,channelCount:2,channelCountMode:"explicit"}),this.summingNode.connect(this.output)}disconnect(){this.output.disconnect(),this.summingNode.disconnect(),this.delayNode?.disconnect(),this.reverbNode?.disconnect()}getDjf(t,n=0){this.djfNode==null&&(this.djfNode=ke(this.audioContext,"djf-processor",{value:t}),this.summingNode.disconnect(),this.summingNode.connect(this.djfNode),this.djfNode.connect(this.output)),this.djfNode.parameters.get("value").setValueAtTime(t,n)}getDelay(t=0,n=.5,s){return n=Xt(n,0,.98),this.delayNode==null&&(this.delayNode=this.audioContext.createFeedbackDelay(1,t,n),this.delayNode.connect(this.summingNode),this.delayNode.start?.(s)),this.delayNode.delayTime.value!==t&&this.delayNode.delayTime.setValueAtTime(t,s),this.delayNode.feedback.value!==n&&this.delayNode.feedback.setValueAtTime(n,s),this.delayNode}getReverb(t,n,s,o,r,i,u){return this.reverbNode==null&&(this.reverbNode=this.audioContext.createReverb(t,n,s,o,r,i,u),this.reverbNode.connect(this.summingNode)),(Ut(t,this.reverbNode.duration)||Ut(n,this.reverbNode.fade)||Ut(s,this.reverbNode.lp)||Ut(o,this.reverbNode.dim)||Ut(i,this.reverbNode.irspeed)||Ut(u,this.reverbNode.irbegin)||this.reverbNode.ir!==r)&&this.reverbNode.generate(t,n,s,o,r,i,u),this.reverbNode}sendReverb(t,n){return Un(t,this.reverbNode,n)}sendDelay(t,n){return Un(t,this.delayNode,n)}duck(t,n=0,s=.1,o=1){const r=n,i=Math.max(s,.002),u=this.output.gain;Ct(this.audioContext,()=>{const a=this.audioContext.currentTime,l=u.value;u.cancelScheduledValues(a),u.setValueAtTime(l,a);const p=Math.max(t,a),f=Xt(1-Math.sqrt(o),.01,l);u.exponentialRampToValueAtTime(f,p+r),u.exponentialRampToValueAtTime(1,p+r+i)},0,t-.01)}connectToOutput(t){t.connect(this.summingNode)}}class yg{channelMerger;destinationGain;constructor(t){this.audioContext=t,this.initializeAudio()}initializeAudio(){const t=this.audioContext,n=t.destination.maxChannelCount;this.audioContext.destination.channelCount=n,this.channelMerger=new ChannelMergerNode(t,{numberOfInputs:t.destination.channelCount}),this.destinationGain=new GainNode(t),this.channelMerger.connect(this.destinationGain),this.destinationGain.connect(t.destination)}reset(){this.disconnect(),this.initializeAudio()}disconnect(){this.channelMerger.disconnect(),this.destinationGain.disconnect(),this.destinationGain=null,this.channelMerger=null}connectToDestination=(t,n=[0,1])=>{const s=new StereoPannerNode(this.audioContext);t.connect(s);const o=new ChannelSplitterNode(this.audioContext,{numberOfOutputs:s.channelCount});s.connect(o),n.forEach((r,i)=>{o.connect(this.channelMerger,i%s.channelCount,r%this.audioContext.destination.channelCount)})}}class bg{audioContext;output;nodes={};constructor(t){this.audioContext=t,this.output=new yg(t)}reset(){Array.from(this.nodes).forEach(t=>{t.disconnect()}),this.nodes={},this.output.reset()}duck(t,n,s=0,o=.1,r=1){const i=[t].flat(),u=[s].flat(),a=[o].flat(),l=[r].flat();i.forEach((p,f)=>{const g=this.nodes[p];if(g==null){D0(new Error(`duck target orbit ${p} does not exist`),"superdough");return}const X=u[f]??u[0],G=Math.max(a[f]??a[0],.002),w=l[f]??l[0];g.duck(n,X,G,w)})}getOrbit(t,n){return this.nodes[t]==null&&(this.nodes[t]=new mg(this.audioContext),this.output.connectToDestination(this.nodes[t].output,n)),this.nodes[t]}}const lo=128,po="System Standard";let Gp=lo;function Zp(e){Gp=parseInt(e)??lo}let wp=!1;function Wp(e){wp=e==!0}const $e=ig();function ot(e,t,n={}){e=e.toLowerCase().replace(/\s+/g,"_"),$e.setKey(e,{onTrigger:t,data:n})}let Fp=e=>e;function dt(e){return Fp(e)}function gg(e){Fp=e}function ho(e){for(const n in e)e[n.toLowerCase()]=e[n];const t=$e.get();for(const n in t){const[s,o]=n.split("_");if(!o)continue;const r=e[s];if(r){if(typeof r=="string")t[`${r}_${o}`.toLowerCase()]=t[n];else if(Array.isArray(r))for(const i of r)t[`${i}_${o}`.toLowerCase()]=t[n]}}$e.set({...t})}async function Xg(e){const n=await(await fetch(e)).json();ho(n)}async function Gg(...e){switch(e.length){case 1:return typeof e[0]=="string"?Xg(e[0]):ho(e[0]);case 2:return ho({[e[0]]:e[1]});default:throw new Error("aliasMap expects 1 or 2 arguments, received "+e.length)}}function Zg(e,t){if(Qt(e)==null){Ze("soundAlias: original sound not found");return}$e.setKey(t,Qt(e))}function Qt(e){return typeof e!="string"?(console.warn(`getSound: expected string got "${e}". fall back to triangle`),$e.get().triangle):$e.get()[e.toLowerCase()]}const vp=async()=>{await navigator.mediaDevices.getUserMedia({audio:!0});let e=await navigator.mediaDevices.enumerateDevices();e=e.filter(n=>n.kind==="audiooutput"&&n.deviceId!=="default");const t=new Map;return t.set(po,""),e.forEach(n=>{t.set(n.label,n.deviceId)}),t};let Wn={s:"triangle",gain:.8,postgain:1,density:".03",channels:[1,2],phaserdepth:.75,shapevol:1,distortvol:1,distorttype:0,delay:0,byteBeatExpression:"0",delayfeedback:.5,delaysync:3/16,orbit:1,i:1,velocity:1,fft:8};const wg=Object.freeze({...Wn});function Wg(e,t){Wn[e]=t}function Fg(){Wn={...wg}}let fo=new Map(Object.entries(Wn));function mo(e,t){fo.set(e,t)}function Fe(e){return fo.get(e)}function vg(e){Object.keys(e).forEach(t=>{mo(t,e[t])})}function Vp(){fo=new Map(Object.entries(Wn))}function Vg(e){Vp(),e==="1.0"&&mo("fanchor",.5)}const Cg=()=>$e.set({});let Cp=[];function Lp(e){Cp.push(e)}let yo;function Lg(){if(!yo){const e=J(),t=Cp.concat([Db]);yo=Promise.all(t.map(n=>e.audioWorklet.addModule(n)))}return yo}async function bo(e={}){const{disableWorklets:t=!1,maxPolyphony:n,audioDeviceName:s=po,multiChannelOrbits:o=!1}=e;if(Zp(n),Wp(o),typeof window>"u")return;const r=J();if(s!=null&&s!=po)try{const u=(await vp()).get(s),a=(u??"").length>0;r.sinkId!==u&&a&&await r.setSinkId(u),Ze(`[superdough] Audio Device set to ${s}, it might take a few seconds before audio plays on all output channels`)}catch{Ze("[superdough] failed to set audio interface","warning")}if(await r.resume(),t){Ze("[superdough]: AudioWorklets disabled with disableWorklets");return}try{await Lg(),Ze("[superdough] AudioWorklets loaded")}catch(i){console.warn("could not load AudioWorklet effects",i)}Ze("[superdough] ready")}let go;async function zg(e){return go||(go=new Promise(t=>{document.addEventListener("mousedown",async function n(){document.removeEventListener("mousedown",n),await bo(e),t()})})),go}let $n;function es(){return $n==null&&($n=new bg(J())),$n}function zp(e,t){es().output.connectToDestination(e,t)}function Mg(e,t,n=1,s=.5,o=1e3,r=2e3){const i=J(),u=Gn(i,e,t,{frequency:n,depth:r*2}),a=2;let l=0;const p=[];for(let f=0;f<a;f++){const g=i.createBiquadFilter();g.type="notch",g.gain.value=1,g.frequency.value=o+l,g.Q.value=2-Math.min(Math.max(s*2,0),1.9),u.connect(g.detune),l+=282,f>0&&p[f-1].connect(g),p.push(g)}return{phaser:p[p.length-1],lfo:u}}function Rg(e){e=e??0;const t=["12db","ladder","24db"];return typeof e=="number"?t[Math.floor(j0(e,t.length))]:e}let xe={},zt={};function Mp(e,t=1024,n=.5){if(!xe[e]){const s=J().createAnalyser();s.fftSize=t,s.smoothingTimeConstant=n,xe[e]=s,zt[e]=new Float32Array(xe[e].frequencyBinCount)}return xe[e].fftSize!==t&&(xe[e].fftSize=t,zt[e]=new Float32Array(xe[e].frequencyBinCount)),xe[e]}function ts(e="time",t=1){const n={time:()=>xe[t]?.getFloatTimeDomainData(zt[t]),frequency:()=>xe[t]?.getFloatFrequencyData(zt[t])}[e];if(!n)throw new Error(`getAnalyzerData: ${e} not supported. use one of ${Object.keys(n).join(", ")}`);return n(),zt[t]}function xg(){$n?.reset(),xe={},zt={}}let Fn=new Map;function Rp(e){return(Array.isArray(e)?e:[e]).map(t=>t-1)}const Xo=async(e,t,n,s=.5,o=.5)=>{const r=J(),i=es();let{stretch:u}=e;if(u!=null&&(t=t-.04),typeof e!="object")throw new Error(`expected hap.value to be an object, but got "${e}". Hint: append .note() or .s() to the end`,"error");if(e.duration=n,t<r.currentTime){console.warn(`[superdough]: cannot schedule sounds in the past (target: ${t.toFixed(2)}, now: ${r.currentTime.toFixed(2)})`);return}let{tremolo:a,tremolosync:l,tremolodepth:p=1,tremoloskew:f,tremolophase:g=0,tremoloshape:X,s:G=Fe("s"),bank:w,source:F,gain:v=Fe("gain"),postgain:z=Fe("postgain"),density:B=Fe("density"),duckorbit:x,duckonset:R,duckattack:N,duckdepth:O,djf:j,fanchor:te=Fe("fanchor"),release:T=0,phaserrate:ue,phaserdepth:H=Fe("phaserdepth"),phasersweep:q,phasercenter:U,coarse:pe,crush:$,dry:oe,shape:he,shapevol:Ve=Fe("shapevol"),distort:He,distortvol:Te=Fe("distortvol"),distorttype:K=Fe("distorttype"),pan:I,vowel:et,delay:ie=Fe("delay"),delayfeedback:rt=Fe("delayfeedback"),delaysync:Le=Fe("delaysync"),delaytime:ee,orbit:re=Fe("orbit"),room:Ie,roomfade:Je,roomlp:we,roomdim:Zt,roomsize:Ln,ir:wt,irspeed:$t,irbegin:ft,i:Rt=Fe("i"),velocity:xt=Fe("velocity"),analyze:Bt,fft:en=Fe("fft"),compressor:St,compressorRatio:ct,compressorKnee:zn,compressorAttack:tn,compressorRelease:Mn}=e;ee=ee??Eb(Le,s);const ss=Rp(wp&&re>0?[re*2-1,re*2]:Fe("channels")),Rn=e.channels!=null?Rp(e.channels):ss,je=i.getOrbit(re,Rn);x!=null&&i.duck(x,t,R,N,O),v=dt(lt(v,1)),z=dt(z),Ve=dt(Ve),Te=dt(Te),ie=dt(ie),xt=dt(xt),p=dt(p),v*=xt;const Yt=t+n,os=Yt+T,rs=Math.round(Math.random()*1e6);for(let ne=0;ne<=Fn.size-Gp;ne++){const le=Fn.entries().next(),ye=le.value[1].deref(),Ge=le.value[0],Pe=t+.25;ye?.node?.gain?.linearRampToValueAtTime(0,Pe),ye?.stop?.(Pe),Fn.delete(Ge)}let ze=[];if(["-","~","_"].includes(G))return;w&&G&&(G=`${w}_${G}`,e.s=G);let nn;if(F)nn=F(t,e,n,s);else if(Qt(G)){const{onTrigger:ne}=Qt(G),ye=await ne(t,e,()=>{ze.forEach(Ge=>Ge?.disconnect()),Fn.delete(rs)},s);ye&&(nn=ye.node,Fn.set(rs,new WeakRef(ye)))}else throw new Error(`sound ${G} not found! Is it loaded?`);if(!nn)return;if(r.currentTime>t){Ze("[webaudio] skip hap: still loading",r.currentTime-t);return}const ae=[];ae.push(nn),u!==void 0&&ae.push(ke(r,"phase-vocoder-processor",{pitchFactor:u})),ae.push(Re(v));const xn=Rg(e.ftype);if(e.cutoff!==void 0){const le=$s(e,{frequency:"cutoff",q:"resonance",attack:"lpattack",decay:"lpdecay",sustain:"lpsustain",release:"lprelease",env:"lpenv",anchor:"fanchor",model:"ftype",drive:"drive",rate:"lprate",sync:"lpsync",depth:"lpdepth",depthfrequency:"lpdepthfrequency",shape:"lpshape",dcoffset:"lpdc",skew:"lpskew"});le.type="lowpass";const ye=()=>Qn(r,t,Yt,le,s,o),{filter:Ge,lfo:Pe}=ye();if(ae.push(Ge),Pe&&ze.push(Pe),xn==="24db"){const{filter:Tt,lfo:it}=ye();ae.push(Tt),it&&ze.push(it)}}if(e.hcutoff!==void 0){const le=$s(e,{frequency:"hcutoff",q:"hresonance",attack:"hpattack",decay:"hpdecay",sustain:"hpsustain",release:"hprelease",env:"hpenv",anchor:"fanchor",model:"ftype",drive:"drive",rate:"hprate",sync:"hpsync",depth:"hpdepth",depthfrequency:"hpdepthfrequency",shape:"hpshape",dcoffset:"hpdc",skew:"hpskew"});le.type="highpass";const ye=()=>Qn(r,t,Yt,le,s,o),{filter:Ge,lfo:Pe}=ye();if(ae.push(Ge),Pe&&ze.push(Pe),xn==="24db"){const{filter:Tt,lfo:it}=ye();ae.push(Tt),it&&ze.push(it)}}if(e.bandf!==void 0){const le=$s(e,{frequency:"bandf",q:"bandq",attack:"bpattack",decay:"bpdecay",sustain:"bpsustain",release:"bprelease",env:"bpenv",anchor:"fanchor",model:"ftype",drive:"drive",rate:"bprate",sync:"bpsync",depth:"bpdepth",depthfrequency:"bpdepthfrequency",shape:"bpshape",dcoffset:"bpdc",skew:"bpskew"});le.type="bandpass";const ye=()=>Qn(r,t,Yt,le,s,o),{filter:Ge,lfo:Pe}=ye();if(ae.push(Ge),Pe&&ze.push(Pe),xn==="24db"){const{filter:Tt,lfo:it}=ye();ae.push(Tt),it&&ze.push(it)}}if(et!==void 0){const ne=r.createVowelFilter(et);ae.push(ne)}if(pe!==void 0&&ae.push(ke(r,"coarse-processor",{coarse:pe})),$!==void 0&&ae.push(ke(r,"crush-processor",{crush:$})),he!==void 0&&ae.push(ke(r,"shape-processor",{shape:he,postgain:Ve})),He!==void 0&&ae.push(up(He,Te,K)),l!=null&&(a=s*l),e.wtPosSynced!=null&&(e.wtPosRate/=s),e.wtWarpSynced!=null&&(e.wtWarpRate/=s),a!==void 0){const ne=Math.max(1-p,0),le=new GainNode(r,{gain:ne}),ye=o/s,Ge=Gn(r,t,os,{skew:f??(X!=null?.5:1),frequency:a,depth:p,time:ye,dcoffset:0,shape:X,phaseoffset:g,min:0,max:1,curve:1.5});Ge.connect(le.gain),ze.push(Ge),ae.push(le)}if(St!==void 0&&ae.push(np(r,St,ct,zn,tn,Mn)),I!==void 0){const ne=r.createStereoPanner();ne.pan.value=2*I-1,ae.push(ne)}if(ue!==void 0&&H>0){const{phaser:ne,lfo:le}=Mg(t,os,ue,H,U,q);ze.push(le),ae.push(ne)}const kt=new GainNode(r,{gain:z});if(ae.push(kt),ie>0&&ee>0&&rt>0){je.getDelay(ee,rt,t);const ne=je.sendDelay(kt,ie);ze.push(ne)}if(Ie>0){let ne;if(wt!==void 0){let ye,Ge=Qt(wt);Array.isArray(Ge)?ye=Ge.data.samples[Rt%Ge.data.samples.length]:typeof Ge=="object"&&(ye=Object.values(Ge.data.samples).flat()[Rt%Object.values(Ge.data.samples).length]),ne=await uo(ye,r,wt,0)}je.getReverb(Ln,Je,we,Zt,ne,$t,ft);const le=je.sendReverb(kt,Ie);ze.push(le)}if(j!=null&&je.getDjf(j,t),Bt){const ne=Mp(Bt,2**(en+5)),le=Un(kt,ne,1);ze.push(le)}if(oe!=null){oe=dt(oe);const ne=new GainNode(r,{gain:oe});ae.push(ne),je.connectToOutput(ne)}else je.connectToOutput(kt);ae.slice(1).reduce((ne,le)=>ne.connect(le),ae[0]),ze=ze.concat(ae)},Bg=(e,t,n,s)=>{Xo(t,e-n,t.duration/s,s)},Sg=["triangle","square","sawtooth","sine","user"],Yg=[["tri","triangle"],["sqr","square"],["saw","sawtooth"],["sin","sine"]];function kg(e,t){const n=e,s=new Float32Array(t);for(let o=0;o<t;o++){const r=o*2/t-1;s[o]=Math.tanh(r*n)}return s}function xp(){[...Sg].forEach(e=>{ot(e,(t,n,s)=>{const[o,r,i,u]=De([n.attack,n.decay,n.sustain,n.release],"linear",[.001,.05,.6,.01]),a=Re(.3);let l=Yp(e,t,n,()=>{a.disconnect(),s()}),{node:p,stop:f,triggerRelease:g}=l;const{duration:X}=n,G=Re(1);let w=p.connect(a).connect(G);const F=t+X;Ee(w.gain,o,r,i,u,0,1,t,F,"linear");const v=F+u+.01;return g?.(v),f(v),{node:w,stop:z=>{f(z)}}},{type:"synth",prebake:!0})}),ot("sbd",(e,t,n)=>{const{duration:s,decay:o=.5,pdecay:r=.5,penv:i=36,clip:u}=t,a=J(),l=.02,p=1.2,f=.025,g=1,X=a.createOscillator();X.type="triangle",X.frequency.value=Lt(t,29),X.detune.setValueAtTime(i*100,0),X.detune.setValueAtTime(i*100,e),X.detune.exponentialRampToValueAtTime(.001,e+r);const G=Re(1);G.gain.setValueAtTime(1,e+l),G.gain.exponentialRampToValueAtTime(.001,e+l+o),X.start(e);const w=to("brown",e,2),F=Re(1);F.gain.setValueAtTime(p,e),F.gain.exponentialRampToValueAtTime(.001,e+f);const v=new WaveShaperNode(a);v.curve=kg(2,a.sampleRate);const z=Re(g);X.onended=()=>{X.disconnect(),G.disconnect(),v.disconnect(),w.node.disconnect(),F.disconnect(),z.disconnect(),n()};const B=X.connect(v).connect(G).connect(z);w.node.connect(F).connect(z);let R=e+o+.01;return u!=null&&(R=Math.min(e+u*s,R)),z.gain.setValueAtTime(g,R-.01),z.gain.linearRampToValueAtTime(0,R),X.stop(R),w.stop(R),{node:B,stop:N=>{X.stop(N)}}},{type:"synth",prebake:!0}),ot("supersaw",(e,t,n)=>{const s=J();let{duration:o,n:r,unison:i=5,spread:u=.6,detune:a}=t;a=a??r??.18;const l=Lt(t),[p,f,g,X]=De([t.attack,t.decay,t.sustain,t.release],"linear",[.001,.05,.6,.01]),G=e+o,w=G+X+.01,F=Xt(i,1,100);let v=F>1?Xt(u,0,1):0,z=ke(s,"supersaw-oscillator",{frequency:l,begin:e,end:w,freqspread:a,voices:F,panspread:v},{outputChannelCount:[2]});const B=1/Math.sqrt(F);It(z.parameters.get("detune"),t,e,G);const x=Jt(z.parameters.get("detune"),t,e),R=Zn(z.parameters.get("frequency"),t,e);let N=Re(1);N=z.connect(N),Ee(N.gain,p,f,g,X,0,.3*B,e,G,"linear");let O=Ct(s,()=>{Ot(z),N.disconnect(),n(),R?.stop(),x?.stop()},e,w);return{node:N,stop:j=>{O.stop(j)}}},{prebake:!0,type:"synth"}),ot("bytebeat",(e,t,n)=>{const s=["(t%255 >= t/255%255)*255","(t*(t*8%60 <= 300)|(-t)*(t*4%512 < 256))+t/400","t","t*(t >> 10^t)","t&128","t&t>>8","((t%255+t%128+t%64+t%32+t%16+t%127.8+t%64.8+t%32.8+t%16.8)/3)","((t%64+t%63.8+t%64.15+t%64.35+t%63.5)/1.25)","(t&(t>>7)-t)","(sin(t*PI/128)*127+127)","((t^t/2+t+64*(sin((t*PI/64)+(t*PI/32768))+64))%128*2)","((t^t/2+t+64*(cos >> 0))%127.85*2)","((t^t/2+t+64)%128*2)","(((t * .25)^(t * .25)/100+(t * .25))%128)*2","((t^t/2+t+64)%7 * 24)"],{n:o=0}=t,r=Lt(t),{byteBeatExpression:i=s[o%s.length],byteBeatStartTime:u}=t,a=J();let{duration:l}=t;const[p,f,g,X]=De([t.attack,t.decay,t.sustain,t.release],"linear",[.001,.05,.6,.01]),G=e+l,w=G+X+.01;let F=ke(a,"byte-beat-processor",{frequency:r,begin:e,end:w},{outputChannelCount:[2]});F.port.postMessage({codeText:i,byteBeatStartTime:u,frequency:r});let v=Re(1);v=F.connect(v),Ee(v.gain,p,f,g,X,0,1,e,G,"linear");let z=Ct(a,()=>{Ot(F),v.disconnect(),n()},e,w);return{node:v,stop:B=>{z.stop(B)}}},{prebake:!0,type:"synth"}),ot("pulse",(e,t,n)=>{const s=J();let{pwrate:o,pwsweep:r}=t;r==null&&(o!=null?r=.3:r=0),o==null&&r!=null&&(o=1);let{duration:i,pw:u=.5}=t;const a=Lt(t),[l,p,f,g]=De([t.attack,t.decay,t.sustain,t.release],"linear",[.001,.05,.6,.01]),X=e+i,G=X+g+.01;let w=ke(s,"pulse-oscillator",{frequency:a,begin:e,end:G,pulsewidth:u},{outputChannelCount:[2]});It(w.parameters.get("detune"),t,e,X);const F=Jt(w.parameters.get("detune"),t,e),v=Zn(w.parameters.get("frequency"),t,e);let z=Re(1);z=w.connect(z),Ee(z.gain,l,p,f,g,0,1,e,X,"linear");let B;r!=0&&(B=Gn(s,e,G,{frequency:o,depth:r}),B.connect(w.parameters.get("pulsewidth")));let x=Ct(s,()=>{Ot(w),Ot(B),z.disconnect(),n(),v?.stop(),F?.stop()},e,G);return{node:z,stop:R=>{x.stop(R)}}},{prebake:!0,type:"synth"}),[...no].forEach(e=>{ot(e,(t,n,s)=>{const[o,r,i,u]=De([n.attack,n.decay,n.sustain,n.release],"linear",[.001,.05,.6,.01]);let a,{density:l}=n;a=to(e,t,l);let{node:p,stop:f,triggerRelease:g}=a;const X=Re(.3),{duration:G}=n;p.onended=()=>{p.disconnect(),X.disconnect(),s()};const w=Re(1);let F=p.connect(X).connect(w);const v=t+G;Ee(F.gain,o,r,i,u,0,1,t,v,"linear");const z=v+u+.01;return g?.(z),f(z),{node:F,stop:B=>{f(B)}}},{type:"synth",prebake:!0})}),Yg.forEach(([e,t])=>$e.set({...$e.get(),[e]:$e.get()[t]}))}const Bp=2*Math.PI;function Sp(e,t,n){e=typeof e=="object"?e:new Float32Array(e).fill(1);const o=e.length,r=new Float32Array(o+1),i=new Float32Array(o+1),u=J(),a=u.createOscillator(),l={sawtooth:f=>[0,-1/f],square:f=>[0,f%2===0?0:1/f],triangle:f=>[f%2===0?0:1/(f*f),0],user:f=>[0,1]};if(!l[n])throw new Error(`unknown wave type ${n}`);for(let f=0;f<o;f++){const g=e[f],[X,G]=l[n](f+1),w=t?.[f]??0;let F=X*g,v=G*g;if(w!==0){const z=Math.cos(Bp*w),B=Math.sin(Bp*w);F=z*F-B*v,v=B*F+z*v}r[f+1]=F,i[f+1]=v}const p=u.createPeriodicWave(r,i);return a.setPeriodicWave(p),a}function Yp(e,t,n,s){const{duration:o,noise:r=0}=n,i=n.partials??n.n;let u;e==="user"&&!i&&(Ze("[superdough] Synth 'user' was selected, but partials not specified. Defaulting to triangle. Use pat.partials to setup custom waveform"),e="triangle"),e=e==="user"&&!i?"triangle":e,!i||i?.length===0||e==="sine"?(u=J().createOscillator(),u.type=e||"triangle"):u=Sp(i,n.phases,e),u.frequency.value=Lt(n);let a=Jt(u.detune,n,t);It(u.detune,n,t,t+o);const l=Zn(u.frequency,n,t);let p;return r&&(p=Jb(u,r,t)),u.onended=()=>{p||u.disconnect(),p?.node.disconnect(),s()},u.start(t),{node:p?.node||u,stop:f=>{l.stop(f),a?.stop(f),p?.stop(f),u.stop(f)},triggerRelease:f=>{}}}function Tg(e=1,t=.05,n=220,s=0,o=0,r=.1,i=0,u=1,a=0,l=0,p=0,f=0,g=0,X=0,G=0,w=0,F=0,v=1,z=0,B=0){let x=Math.PI*2,R=J().sampleRate,N=Ve=>Ve>0?1:-1,O=a*=500*x/R/R,j=n*=(1+t*2*Math.random()-t)*x/R,te=[],T=0,ue=0,H=0,q=1,U=0,pe=0,$=0,oe,he;for(s=s*R+9,z*=R,o*=R,r*=R,F*=R,l*=500*x/R**3,G*=x/R,p*=x/R,f*=R,g=g*R|0,he=s+z+o+r+F|0;H<he;te[H++]=$)++pe%(w*100|0)||($=i?i>1?i>2?i>3?Math.sin((T%x)**3):Math.max(Math.min(Math.tan(T),1),-1):1-(2*T/x%2+2)%2:1-4*Math.abs(Math.round(T/x)-T/x):Math.sin(T),$=(g?1-B+B*Math.sin(x*H/g):1)*N($)*Math.abs($)**u*e*1*(H<s?H/s:H<s+z?1-(H-s)/z*(1-v):H<s+z+o?v:H<he-F?(he-H-F)/r*v:0),$=F?$/2+(F>H?0:(H<he-F?1:(he-H)/F)*te[H-F|0]/2):$),oe=(n+=a+=l)*Math.cos(G*ue++),T+=oe-oe*X*(1-(Math.sin(H)+1)*1e9%2),q&&++q>f&&(n+=p,j+=p,q=0),g&&!(++U%g)&&(n=j,a=O,q||=1);return te}const kp=(e,t)=>{let{s:n,note:s=36,freq:o,zrand:r=0,attack:i=0,decay:u=0,sustain:a=.8,release:l=.1,curve:p=1,slide:f=0,deltaSlide:g=0,pitchJump:X=0,pitchJumpTime:G=0,lfo:w=0,znoise:F=0,zmod:v=0,zcrush:z=0,zdelay:B=0,tremolo:x=0,duration:R=.2,zzfx:N}=e;const O=Math.max(R-i-u,0);typeof s=="string"&&(s=jn(s)),!o&&typeof s=="number"&&(o=J0(s)),n=n.replace("z_","");const j=["sine","triangle","sawtooth","tan","noise"].indexOf(n)||0;p=n==="square"?0:p;const T=Tg(...N||[.25,r,o,i,O,l,j,p,f,g,X,G,w,F,v,z,B,a,u,x]),ue=J(),H=ue.createBuffer(1,T.length,ue.sampleRate);H.getChannelData(0).set(T);const q=J().createBufferSource();return q.buffer=H,q.start(t),{node:q}};function Ag(){["zzfx","z_sine","z_sawtooth","z_triangle","z_square","z_tan","z_noise"].forEach(e=>{ot(e,(t,n,s)=>{const{node:o}=kp({s:e,...n},t);return o.onended=()=>{o.disconnect(),s()},{node:o,stop:()=>{}}},{type:"synth",prebake:!0})})}let qt;async function Tp(e,t){const n=`dsp-worklet-${Date.now()}`,s=`${t}
let __q = []; // trigger queue
class MyProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.t = 0;
    this.stopped = false;
    this.port.onmessage = (e) => {
      if(e.data==='stop') {
        this.stopped = true;
      } else if(e.data?.dough) {
        __q.push(e.data)
      } else {
        msg?.(e.data)
      }
    };
  }
  process(inputs, outputs, parameters) {
    const output = outputs[0];
    if(__q.length) {
      for(let i=0;i<__q.length;++i) {
        const deadline = __q[i].time-currentTime;
        if(deadline<=0) {
          trigger(__q[i].dough)
          __q.splice(i,1)
        }
      }
    }
    for (let i = 0; i < output[0].length; i++) {
      const out = dsp(this.t / sampleRate);
      output.forEach((channel) => {
        channel[i] = out;
      });
      this.t++;
    }
  return !this.stopped;
  }
}
registerProcessor('${n}', MyProcessor);
`,r=`data:text/javascript;base64,${btoa(s)}`;await e.audioWorklet.addModule(r);const i=new AudioWorkletNode(e,n);return{node:i,stop:()=>i.port.postMessage("stop")}}const Ap=()=>{qt&&(qt?.stop(),qt?.node?.disconnect())};typeof window<"u"&&window.addEventListener("message",e=>{e.data==="strudel-stop"?Ap():e.data?.dough&&qt?.node.port.postMessage(e.data)});const Ng=async e=>{const t=J();Ap(),qt=await Tp(t,e),qt.node.connect(t.destination)};function Np(e,t,n,s){window.postMessage({time:s,dough:e.value,currentTime:t,duration:e.duration,cps:n})}const Go=Object.freeze({NONE:0,ASYM:1,MIRROR:2,BENDP:3,BENDM:4,BENDMP:5,SYNC:6,QUANT:7,FOLD:8,PWM:9,ORBIT:10,SPIN:11,CHAOS:12,PRIMES:13,BINARY:14,BROWNIAN:15,RECIPROCAL:16,WORMHOLE:17,LOGISTIC:18,SIGMOID:19,FRACTAL:20,FLIP:21}),_p=new Set;async function _g(e,t,n=2048){const s=`${e},${n}`;if(!_p.has(s)){const r=(await Eg(e,t)).getChannelData(0),i=r.length,u=Math.max(1,Math.floor(i/n)),a=new Array(u);for(let l=0;l<u;l++){const p=l*n;a[l]=r.subarray(p,p+n)}return _p.add(s),{frames:a,frameLen:n,numFrames:u,key:s}}return{frameLen:n,key:s}}function Kg(e,t){var n=1024;if(e<n)return e+" B";var s=["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],o=-1;do e/=n,++o;while(e>=n);return e.toFixed(1)+" "+s[o]}function Hg(e){const t=new DataView(e);let n=12;for(;n+8<=t.byteLength;){const s=String.fromCharCode(t.getUint8(n),t.getUint8(n+1),t.getUint8(n+2),t.getUint8(n+3)),o=t.getUint32(n+4,!0);if(s==="fmt ")return t.getUint32(n+12,!0);n+=8+o+(o&1)}return null}async function Pg(e){const t=Hg(e)||44100;return await new OfflineAudioContext(1,1,t).decodeAudioData(e)}const Zo={},Eg=(e,t)=>{if(e=e.replace("#","%23"),!Zo[e]){Ze(`[wavetable] load table ${t}..`,"load-table",{url:e});const n=Date.now();Zo[e]=fetch(e).then(s=>s.arrayBuffer()).then(async s=>{const o=Date.now()-n,r=Kg(s.byteLength);return Ze(`[wavetable] load table ${t}... done! loaded ${r} in ${o}ms`,"loaded-table",{url:e}),await Pg(s)})}return Zo[e]};function Kp(e,t=""){if(!e.startsWith("github:"))throw new Error('expected "github:" at the start of pseudoUrl');let[n,s]=e.split("github:");return s=s.endsWith("/")?s.slice(0,-1):s,s.split("/").length===2&&(s+="/main"),`https://raw.githubusercontent.com/${s}/${t}`}const Hp=(e,t,n,s={})=>(t=e._base||t,Object.entries(e).forEach(([o,r])=>{if(o==="_base")return!1;if(typeof r=="string"&&(r=[r]),typeof r!="object")throw new Error("wrong json format for "+o);let i=t;i.startsWith("github:")&&(i=Kp(i,"")),r=r.map(u=>i+u).filter(u=>u.toLowerCase().endsWith(".wav")?!0:(Ze(`[wavetable] skipping ${u} -- wavetables must be ".wav" format`),!1)),r.length&&wo(o,r,{baseUrl:t,frameLen:n})}));function wo(e,t,n){ot(e,(s,o,r,i)=>Pp(s,o,r,t,i,n?.frameLen??2048),{type:"wavetable",tables:t,...n})}const Dg=async(e,t,n,s={})=>{if(n!==void 0)return Hp(n,e,t);e.startsWith("github:")&&(e=Kp(e,"strudel.json")),e.startsWith("local:")&&(e="http://localhost:5432");const o=Q0(e);if(typeof fetch=="function"&&!(typeof fetch>"u"))return fetch(e).then(r=>r.json()).then(r=>Hp(r,o,t,s)).catch(r=>{throw console.error(r),new Error(`error loading "${e}"`)})};async function Pp(e,t,n,s,o,r){const{s:i,n:u=0,duration:a,clip:l}=t,p=J(),[f,g,X,G]=De([t.attack,t.decay,t.sustain,t.release]);let{warpmode:w}=t;typeof w=="string"&&(w=Go[w.toUpperCase()]??Go.NONE);const F=Lt(t),{url:v,label:z}=U0(t,s),B=await _g(v,z,r);let x=e+a;l!==void 0&&(x=Math.min(e+l*a,x));const R=x+G,N=R+.01,O=ke(p,"wavetable-oscillator-processor",{begin:e,end:N,frequency:F,freqspread:t.detune,position:t.wt,warp:t.warp,warpMode:w,voices:Math.max(t.unison??1,1),panspread:t.spread,phaserand:t.wtphaserand??t.unison>1?1:0},{outputChannelCount:[2]});if(O.port.postMessage({type:"table",payload:B}),p.currentTime>e){Ze(`[wavetable] still loading sound "${i}:${u}"`,"highlight");return}const j=[t.wtattack,t.wtdecay,t.wtsustain,t.wtrelease],te=[t.warpattack,t.warpdecay,t.warpsustain,t.warprelease],T=O.parameters,ue=T.get("position"),H=T.get("warp");let q=t.wtrate;t.wtsync!=null&&(q=o*t.wtsync);const U=oo(p,ue,e,R,{offset:t.wt,amount:t.wtenv,defaultAmount:.5,values:j,holdEnd:x,defaultValues:[0,.5,0,.1]},{frequency:q,depth:t.wtdepth,defaultDepth:.5,shape:t.wtshape,skew:t.wtskew,dcoffset:t.wtdc??0});let pe=t.warprate;t.warpsync!=null&&(pe=pe=o*t.warpsync);const $=oo(p,H,e,R,{offset:t.warp,amount:t.warpenv,defaultAmount:.5,values:te,holdEnd:x,defaultValues:[0,.5,0,.1]},{frequency:pe,depth:t.warpdepth,defaultDepth:.5,shape:t.warpshape,skew:t.warpskew,dcoffset:t.warpdc??0}),oe=Jt(O.parameters.get("detune"),t,e),he=Zn(O.parameters.get("frequency"),t,e),Ve=p.createGain(),He=O.connect(Ve);Ee(He.gain,f,g,X,G,0,.3,e,x,"linear"),It(O.parameters.get("detune"),t,e,x);const Te={node:He,source:O},K=Ct(p,()=>{Ot(O),oe?.stop(),he?.stop(),He.disconnect(),U?.disconnect(),$?.disconnect(),n()},e,N);return Te.stop=I=>{K.stop(I)},Te}let vn;function Ig(){const e=J();vn=ke(e,"dough-processor",{},{outputChannelCount:[2]}),zp(vn)}const ns=new Map,Ep=new Map;L.prototype.supradough=function(){return this.onTrigger((e,t,n,s)=>{e.value._begin=s,e.value._duration=e.duration/n,!vn&&Ig();const o=(e.value.bank?e.value.bank+"_":"")+e.value.s,r=e.value.n??0,i=`${o}:${r}`;if(ns.has(o)&&(e.value.s=i),ns.has(o)&&!Ep.has(i)){const u=ns.get(o),a=u[r%u.length];console.log(`load ${i} from ${a}`);const l=Og(a);Ep.set(i,l),l.then(({channels:p,sampleRate:f})=>vn.port.postMessage({sample:i,channels:p,sampleRate:f}))}vn.port.postMessage({spawn:e.value})},1)};function Jg(e,t=""){if(!e.startsWith("github:"))throw new Error('expected "github:" at the start of pseudoUrl');let[n,s]=e.split("github:");return s=s.endsWith("/")?s.slice(0,-1):s,s.split("/").length===2&&(s+="/main"),`https://raw.githubusercontent.com/${s}/${t}`}async function jg(e){if(e.startsWith("github:")&&(e=Jg(e,"strudel.json")),e.startsWith("local:")&&(e="http://localhost:5432"),e.startsWith("shabda:")){let[s,o]=e.split("shabda:");e=`https://shabda.ndre.gr/${o}.json?strudel=1`}if(e.startsWith("shabda/speech")){let[s,o]=e.split("shabda/speech");o=o.startsWith("/")?o.substring(1):o;let[r,i]=o.split(":"),u="f",a="en-GB";r&&([a,u]=r.split("/")),e=`https://shabda.ndre.gr/speech/${i}.json?gender=${u}&language=${a}&strudel=1'`}if(typeof fetch!="function")return;const t=e.split("/").slice(0,-1).join("/");if(typeof fetch>"u")return;const n=await fetch(e).then(s=>s.json()).catch(s=>{throw console.error(s),new Error(`error loading "${e}"`)});return[n,n._base||t]}async function Og(e){const t=await fetch(e).then(s=>s.arrayBuffer()).then(s=>J().decodeAudioData(s));let n=[];for(let s=0;s<t.numberOfChannels;s++)n.push(t.getChannelData(s));return{channels:n,sampleRate:t.sampleRate}}async function Dp(e,t){if(typeof e=="string"){const[n,s]=await jg(e);return Dp(n,s)}Object.entries(e).map(async([n,s])=>{n!=="_base"&&(s=s.map(o=>t+o),ns.set(n,s))})}const Ug="data:text/javascript;base64,KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NvbnN0IGQ9dHlwZW9mIHNhbXBsZVJhdGU8InUiP3NhbXBsZVJhdGU6NDhlMyxBPU1hdGguUEkvZCxiPTEvZDtsZXQgRT1pPT5NYXRoLnBvdyhpLDIpO2NvbnN0IFY9KGkscyx0KT0+TWF0aC5taW4oTWF0aC5tYXgoaSxzKSx0KTtmdW5jdGlvbiBjKGkpe3JldHVybiBFKGkpfWZ1bmN0aW9uIE8oaSxzLHQpe2NvbnN0IGU9TWF0aC5zaW4oKDEtdCkqLjUqTWF0aC5QSSksaD1NYXRoLnNpbih0Ki41Kk1hdGguUEkpO3JldHVybiBpKmUrcypofWNsYXNzIHZ7cGhhc2U9MDt1cGRhdGUocyl7Y29uc3QgdD1NYXRoLnNpbih0aGlzLnBoYXNlKjIqTWF0aC5QSSk7cmV0dXJuIHRoaXMucGhhc2U9KHRoaXMucGhhc2Urcy9kKSUxLHR9fWNsYXNzIHh7cGhhc2U9MDt1cGRhdGUocyl7cmV0dXJuIHRoaXMucGhhc2UrPWIqcyx0aGlzLnBoYXNlJTEqMi0xfX1mdW5jdGlvbiB5KGkscyl7cmV0dXJuIGk8cz8oaS89cyxpK2ktaSppLTEpOmk+MS1zPyhpPShpLTEpL3MsaSppK2kraSsxKTowfWNsYXNzIFJ7Y29uc3RydWN0b3Iocz17fSl7dGhpcy5waGFzZT1zLnBoYXNlPz8wfXVwZGF0ZShzKXtjb25zdCB0PXMvZDtsZXQgZT15KHRoaXMucGhhc2UsdCksaD0yKnRoaXMucGhhc2UtMS1lO3JldHVybiB0aGlzLnBoYXNlKz10LHRoaXMucGhhc2U+MSYmKHRoaXMucGhhc2UtPTEpLGh9fWZ1bmN0aW9uIFQoaSxzLHQpe3JldHVybiBpPDI/MDooKGgsbyxuKT0+biooby1oKStoKSgtcyouNSxzKi41LHQvKGktMSkpfWZ1bmN0aW9uIHooaSxzKXtyZXR1cm4gaSpNYXRoLnBvdygyLHMvMTIpfWNsYXNzIEZ7Y29uc3RydWN0b3Iocz17fSl7dGhpcy52b2ljZXM9cy52b2ljZXM/PzUsdGhpcy5mcmVxc3ByZWFkPXMuZnJlcXNwcmVhZD8/LjIsdGhpcy5wYW5zcHJlYWQ9cy5wYW5zcHJlYWQ/Py40LHRoaXMucGhhc2U9bmV3IEZsb2F0MzJBcnJheSh0aGlzLnZvaWNlcykubWFwKCgpPT5NYXRoLnJhbmRvbSgpKX11cGRhdGUocyl7Y29uc3QgdD1NYXRoLnNxcnQoMS10aGlzLnBhbnNwcmVhZCksZT1NYXRoLnNxcnQodGhpcy5wYW5zcHJlYWQpO2xldCBoPTAsbz0wO2ZvcihsZXQgbj0wO248dGhpcy52b2ljZXM7bisrKXtjb25zdCBhPXoocyxUKHRoaXMudm9pY2VzLHRoaXMuZnJlcXNwcmVhZCxuKSkvZCxwPShuJjEpPT0xO2xldCB1PXQ7cCYmKHU9ZSk7bGV0IHE9eSh0aGlzLnBoYXNlW25dLGEpLEQ9Mip0aGlzLnBoYXNlW25dLTEtcTtoPWgrRCp1LG89bytEKnUsdGhpcy5waGFzZVtuXSs9YSx0aGlzLnBoYXNlW25dPjEmJih0aGlzLnBoYXNlW25dLT0xKX1yZXR1cm4gaCtvfX1jbGFzcyB3e3BoYXNlPTA7dXBkYXRlKHMpe3RoaXMucGhhc2UrPWIqcztsZXQgdD10aGlzLnBoYXNlJTE7cmV0dXJuKHQ8LjU/Mip0OjEtMioodC0uNSkpKjItMX19Y2xhc3MgZ3tzMD0wO3MxPTA7dXBkYXRlKHMsdCxlPTApe2U9TWF0aC5tYXgoZSwwKSx0PU1hdGgubWluKHQsMmU0KTtsZXQgaD0yKk1hdGguc2luKHQqQSk7aD1WKGgsMCwxLjE0KTtjb25zdCBuPTEtTWF0aC5wb3coLjUsKGUrLjEyNSkvLjEyNSkqaDtyZXR1cm4gdGhpcy5zMD1uKnRoaXMuczAtaCp0aGlzLnMxK2gqcyx0aGlzLnMxPW4qdGhpcy5zMStoKnRoaXMuczAsdGhpcy5zMX19Y2xhc3MgSXtjb25zdHJ1Y3RvcihzPTApe3RoaXMucGhhc2U9c31zYXcocyx0KXtsZXQgZT0odGhpcy5waGFzZStzKSUxLGg9eShlLHQpO3JldHVybiAyKmUtMS1ofXVwZGF0ZShzLHQ9LjUpe2NvbnN0IGU9cy9kO2xldCBoPXRoaXMuc2F3KDAsZSktdGhpcy5zYXcodCxlKTtyZXR1cm4gdGhpcy5waGFzZT0odGhpcy5waGFzZStlKSUxLGgrdCoyLTF9fWNsYXNzIEx7cGhhc2U9MDt1cGRhdGUocyx0PS41KXtyZXR1cm4gdGhpcy5waGFzZSs9YipzLHRoaXMucGhhc2UlMTx0PzE6LTF9fWNsYXNzIFN7dXBkYXRlPXM9Pk1hdGgucmFuZG9tKCk8cypiP01hdGgucmFuZG9tKCk6MH1jbGFzcyBOe3VwZGF0ZSgpe3JldHVybiBNYXRoLnJhbmRvbSgpKjItMX19Y2xhc3MgQntjb25zdHJ1Y3Rvcigpe3RoaXMub3V0PTB9dXBkYXRlKCl7bGV0IHM9TWF0aC5yYW5kb20oKSoyLTE7cmV0dXJuIHRoaXMub3V0PSh0aGlzLm91dCsuMDIqcykvMS4wMix0aGlzLm91dH19Y2xhc3MgR3tjb25zdHJ1Y3Rvcigpe3RoaXMuYjA9MCx0aGlzLmIxPTAsdGhpcy5iMj0wLHRoaXMuYjM9MCx0aGlzLmI0PTAsdGhpcy5iNT0wLHRoaXMuYjY9MH11cGRhdGUoKXtjb25zdCBzPU1hdGgucmFuZG9tKCkqMi0xO3RoaXMuYjA9Ljk5ODg2KnRoaXMuYjArcyouMDU1NTE3OSx0aGlzLmIxPS45OTMzMip0aGlzLmIxK3MqLjA3NTA3NTksdGhpcy5iMj0uOTY5KnRoaXMuYjIrcyouMTUzODUyLHRoaXMuYjM9Ljg2NjUqdGhpcy5iMytzKi4zMTA0ODU2LHRoaXMuYjQ9LjU1KnRoaXMuYjQrcyouNTMyOTUyMix0aGlzLmI1PS0uNzYxNip0aGlzLmI1LXMqLjAxNjg5ODtjb25zdCB0PXRoaXMuYjArdGhpcy5iMSt0aGlzLmIyK3RoaXMuYjMrdGhpcy5iNCt0aGlzLmI1K3RoaXMuYjYrcyouNTM2MjtyZXR1cm4gdGhpcy5iNj1zKi4xMTU5MjYsdCouMTF9fWNsYXNzIGp7cGhhc2U9MTt1cGRhdGUocyl7dGhpcy5waGFzZSs9YipzO2xldCB0PXRoaXMucGhhc2U+PTE/MTowO3JldHVybiB0aGlzLnBoYXNlPXRoaXMucGhhc2UlMSx0fX1mdW5jdGlvbiBNKGkscyx0LGU9MSl7aWYoaTw9MClyZXR1cm4gcztpZihpPj0xKXJldHVybiB0O2xldCBoO3JldHVybiBlPT09MD9oPWk6ZT4wP2g9TWF0aC5wb3coaSxlKTpoPTEtTWF0aC5wb3coMS1pLC1lKSxzKyh0LXMpKmh9Y2xhc3MgZntjb25zdHJ1Y3RvcihzPXt9KXt0aGlzLnN0YXRlPSJvZmYiLHRoaXMuc3RhcnRUaW1lPTAsdGhpcy5zdGFydFZhbD0wLHRoaXMuZGVjYXlDdXJ2ZT1zLmRlY2F5Q3VydmU/PzF9dXBkYXRlKHMsdCxlLGgsbyxuKXtzd2l0Y2godGhpcy5zdGF0ZSl7Y2FzZSJvZmYiOnJldHVybiB0PjAmJih0aGlzLnN0YXRlPSJhdHRhY2siLHRoaXMuc3RhcnRUaW1lPXMsdGhpcy5zdGFydFZhbD0wKSwwO2Nhc2UiYXR0YWNrIjp7bGV0IGw9cy10aGlzLnN0YXJ0VGltZTtyZXR1cm4gbD5lPyh0aGlzLnN0YXRlPSJkZWNheSIsdGhpcy5zdGFydFRpbWU9cywxKTpNKGwvZSx0aGlzLnN0YXJ0VmFsLDEsMSl9Y2FzZSJkZWNheSI6e2xldCBsPXMtdGhpcy5zdGFydFRpbWUsYT1NKGwvaCwxLG8sLXRoaXMuZGVjYXlDdXJ2ZSk7cmV0dXJuIHQ8PTA/KHRoaXMuc3RhdGU9InJlbGVhc2UiLHRoaXMuc3RhcnRUaW1lPXMsdGhpcy5zdGFydFZhbD1hLGEpOmw+aD8odGhpcy5zdGF0ZT0ic3VzdGFpbiIsdGhpcy5zdGFydFRpbWU9cyxvKTphfWNhc2Uic3VzdGFpbiI6cmV0dXJuIHQ8PTAmJih0aGlzLnN0YXRlPSJyZWxlYXNlIix0aGlzLnN0YXJ0VGltZT1zLHRoaXMuc3RhcnRWYWw9byksbztjYXNlInJlbGVhc2UiOntsZXQgbD1zLXRoaXMuc3RhcnRUaW1lO2lmKGw+bilyZXR1cm4gdGhpcy5zdGF0ZT0ib2ZmIiwwO2xldCBhPU0obC9uLHRoaXMuc3RhcnRWYWwsMCwtdGhpcy5kZWNheUN1cnZlKTtyZXR1cm4gdD4wJiYodGhpcy5zdGF0ZT0iYXR0YWNrIix0aGlzLnN0YXJ0VGltZT1zLHRoaXMuc3RhcnRWYWw9YSksYX19dGhyb3ciaW52YWxpZCBlbnZlbG9wZSBzdGF0ZSJ9fWNvbnN0ICQ9MTA7Y2xhc3Mga3t3cml0ZUlkeD0wO3JlYWRJZHg9MDtidWZmZXI9bmV3IEZsb2F0MzJBcnJheSgkKmQpO3dyaXRlKHMsdCl7dGhpcy53cml0ZUlkeD0odGhpcy53cml0ZUlkeCsxKSV0aGlzLmJ1ZmZlci5sZW5ndGgsdGhpcy5idWZmZXJbdGhpcy53cml0ZUlkeF09cztsZXQgZT1NYXRoLm1pbihNYXRoLmZsb29yKGQqdCksdGhpcy5idWZmZXIubGVuZ3RoLTEpO3RoaXMucmVhZElkeD10aGlzLndyaXRlSWR4LWUsdGhpcy5yZWFkSWR4PDAmJih0aGlzLnJlYWRJZHgrPXRoaXMuYnVmZmVyLmxlbmd0aCl9dXBkYXRlKHMsdCl7cmV0dXJuIHRoaXMud3JpdGUocyx0KSx0aGlzLmJ1ZmZlclt0aGlzLnJlYWRJZHhdfX1jbGFzcyBXe2RlbGF5PW5ldyBrO21vZHVsYXRvcj1uZXcgdzt1cGRhdGUocyx0LGUsaCxvKXtjb25zdCBuPXRoaXMubW9kdWxhdG9yLnVwZGF0ZShoKSpvLGw9dGhpcy5kZWxheS51cGRhdGUocyxlKigxK24pKTtyZXR1cm4gTyhzLGwsdCl9fWNsYXNzIFh7aG9sZD0wO3Q9MDt1cGRhdGUocyx0KXtyZXR1cm4gdGhpcy50KysldD09PTAmJih0aGlzLnQ9MCx0aGlzLmhvbGQ9cyksdGhpcy5ob2xkfX1jbGFzcyBVe3VwZGF0ZShzLHQpe3Q9TWF0aC5tYXgoMSx0KTtjb25zdCBlPU1hdGgucG93KDIsdC0xKTtyZXR1cm4gTWF0aC5yb3VuZChzKmUpL2V9fWNsYXNzIFl7dXBkYXRlKHMsdD0wLGU9MSl7ZT1NYXRoLm1heCguMDAxLE1hdGgubWluKDEsZSkpO2NvbnN0IGg9TWF0aC5leHBtMSh0KTtyZXR1cm4oMStoKSpzLygxK2gqTWF0aC5hYnMocykpKmV9fWNsYXNzIF97c3RhdGljIHNhbXBsZXM9bmV3IE1hcDtidWZmZXI7c2FtcGxlUmF0ZTtwb3M9MDtzYW1wbGVGcmVxPVAoKTtjb25zdHJ1Y3RvcihzLHQsZSl7dGhpcy5idWZmZXI9cyx0aGlzLnNhbXBsZVJhdGU9dCx0aGlzLmR1cmF0aW9uPXRoaXMuYnVmZmVyLmxlbmd0aC90aGlzLnNhbXBsZVJhdGUsdGhpcy5zcGVlZD1kL3RoaXMuc2FtcGxlUmF0ZSxlJiYodGhpcy5zcGVlZCo9dGhpcy5kdXJhdGlvbil9dXBkYXRlKHMpe2lmKHRoaXMucG9zPj10aGlzLmJ1ZmZlci5sZW5ndGgpcmV0dXJuIDA7Y29uc3QgdD1zL3RoaXMuc2FtcGxlRnJlcSp0aGlzLnNwZWVkO2xldCBlPXRoaXMuYnVmZmVyW01hdGguZmxvb3IodGhpcy5wb3MpXTtyZXR1cm4gdGhpcy5wb3M9dGhpcy5wb3MrdCxlfX1jb25zdCBtPShpLHM9ImxpbmVhciIsdCk9Pntjb25zdFtuLGwsYSxwXT1pO2lmKG49PW51bGwmJmw9PW51bGwmJmE9PW51bGwmJnA9PW51bGwpcmV0dXJuIHQ/P1suMDAxLC4wMDEsMSwuMDFdO2NvbnN0IHU9YT8/KG4hPW51bGwmJmw9PW51bGx8fG49PW51bGwmJmw9PW51bGw/MTouMDAxKTtyZXR1cm5bTWF0aC5tYXgobj8/MCwuMDAxKSxNYXRoLm1heChsPz8wLC4wMDEpLE1hdGgubWluKHUsMSksTWF0aC5tYXgocD8/MCwuMDEpXX07bGV0IEM9e3NpbmU6dixzYXc6Uix6YXc6eCxzYXd0b290aDpSLHphd3Rvb3RoOngsc3VwZXJzYXc6Rix0cmk6dyx0cmlhbmdsZTp3LHB1bHNlOkksc3F1YXJlOkkscHVsemU6TCxkdXN0OlMsY3JhY2tsZTpTLGltcHVsc2U6aix3aGl0ZTpOLGJyb3duOkIscGluazpHfTtjb25zdCBaPXtjaG9ydXM6MCxub3RlOjQ4LHM6InRyaWFuZ2xlIixiYW5rOiIiLGdhaW46MSxwb3N0Z2FpbjoxLHZlbG9jaXR5OjEsZGVuc2l0eToiLjAzIixmdHlwZToiMTJkYiIsZmFuY2hvcjowLHJlc29uYW5jZTowLGhyZXNvbmFuY2U6MCxiYW5kcTowLGNoYW5uZWxzOlsxLDJdLHBoYXNlcmRlcHRoOi43NSxzaGFwZXZvbDoxLGRpc3RvcnR2b2w6MSxkZWxheTowLGJ5dGVCZWF0RXhwcmVzc2lvbjoiMCIsZGVsYXlmZWVkYmFjazouNSxkZWxheXNwZWVkOjEsZGVsYXl0aW1lOi4yNSxvcmJpdDoxLGk6MSxmZnQ6OCx6OiJ0cmlhbmdsZSIscGFuOi41LGZtaDoxLGZtZW52OjAsc3BlZWQ6MSxwdzouNX07bGV0IHI9aT0+WltpXTtjb25zdCBIPXtjOjAsZDoyLGU6NCxmOjUsZzo3LGE6OSxiOjExfSxKPXsiIyI6MSxiOi0xLHM6MSxmOi0xfSxLPShpLHM9Myk9PntsZXRbdCxlPSIiLGg9IiJdPVN0cmluZyhpKS5tYXRjaCgvXihbYS1nQS1HXSkoWyNic2ZdKikoWzAtOV0qKSQvKT8uc2xpY2UoMSl8fFtdO2lmKCF0KXRocm93IG5ldyBFcnJvcignbm90IGEgbm90ZTogIicraSsnIicpO2NvbnN0IG89SFt0LnRvTG93ZXJDYXNlKCldLG49ZT8uc3BsaXQoIiIpLnJlZHVjZSgoYSxwKT0+YStKW3BdLDApfHwwO3JldHVybihOdW1iZXIoaHx8cykrMSkqMTIrbytufSxRPWk9Pk1hdGgucG93KDIsKGktNjkpLzEyKSo0NDAsUD1pPT4oaT1pfHxyKCJub3RlIiksdHlwZW9mIGk9PSJzdHJpbmciJiYoaT1LKGksMykpLFEoaSkpO2NsYXNzIHR0e2lkPTA7b3V0PVswLDBdO2F0dGFjaztkZWNheTtzdXN0YWluO3JlbGVhc2U7X2JlZ2luO19kdXJhdGlvbjtfc291bmQ7X2NoYW5uZWxzPTE7X2J1ZmZlcnM7dW5pdDtfcGVudjtwZW52O3BhdHRhY2s7cGRlY2F5O3BzdXN0YWluO3ByZWxlYXNlO3ZpYjtfdmliO3ZpYm1vZDtfZm07Zm1oO2ZtaTtfZm1lbnY7Zm1hdHRhY2s7Zm1kZWNheTtmbXN1c3RhaW47Zm1yZWxlYXNlO19scGVudjtscGVudjtscGF0dGFjaztscGRlY2F5O2xwc3VzdGFpbjtscHJlbGVhc2U7X2hwZW52O2hwZW52O2hwYXR0YWNrO2hwZGVjYXk7aHBzdXN0YWluO2hwcmVsZWFzZTtfYnBlbnY7YnBlbnY7YnBhdHRhY2s7YnBkZWNheTticHN1c3RhaW47YnByZWxlYXNlO2N1dG9mZjtoY3V0b2ZmO2JhbmRmO2NvYXJzZTtjcnVzaDtkaXN0b3J0O2ZyZXE7bm90ZTtfbHBmO19ocGY7X2JwZjtfY2hvcnVzO19jb2Fyc2U7X2NydXNoO19kaXN0b3J0O2NvbnN0cnVjdG9yKHMpe3RoaXMuZnJlcT8/PVAocy5ub3RlKSx0aGlzLl9iZWdpbj1zLl9iZWdpbix0aGlzLl9kdXJhdGlvbj1zLl9kdXJhdGlvbix0aGlzLnJlbGVhc2U9cy5yZWxlYXNlPz8wO2xldCB0PXRoaXM7aWYoT2JqZWN0LmFzc2lnbih0LHMpLHQucz10LnM/P3IoInMiKSx0LmdhaW49Yyh0LmdhaW4/P3IoImdhaW4iKSksdC52ZWxvY2l0eT1jKHQudmVsb2NpdHk/P3IoInZlbG9jaXR5IikpLHQucG9zdGdhaW49Yyh0LnBvc3RnYWluPz9yKCJwb3N0Z2FpbiIpKSx0LmRlbnNpdHk9dC5kZW5zaXR5Pz9yKCJkZW5zaXR5IiksdC5mYW5jaG9yPXQuZmFuY2hvcj8/cigiZmFuY2hvciIpLHQuZHJpdmU9dC5kcml2ZT8/LjY5LHQucGhhc2VyZGVwdGg9dC5waGFzZXJkZXB0aD8/cigicGhhc2VyZGVwdGgiKSx0LnNoYXBldm9sPWModC5zaGFwZXZvbD8/cigic2hhcGV2b2wiKSksdC5kaXN0b3J0dm9sPWModC5kaXN0b3J0dm9sPz9yKCJkaXN0b3J0dm9sIikpLHQuaT10Lmk/P3IoImkiKSx0LmNob3J1cz10LmNob3J1cz8/cigiY2hvcnVzIiksdC5mZnQ9dC5mZnQ/P3IoImZmdCIpLHQucGFuPXQucGFuPz9yKCJwYW4iKSx0Lm9yYml0PXQub3JiaXQ/P3IoIm9yYml0IiksdC5mbWVudj10LmZtZW52Pz9yKCJmbWVudiIpLHQucmVzb25hbmNlPXQucmVzb25hbmNlPz9yKCJyZXNvbmFuY2UiKSx0LmhyZXNvbmFuY2U9dC5ocmVzb25hbmNlPz9yKCJocmVzb25hbmNlIiksdC5iYW5kcT10LmJhbmRxPz9yKCJiYW5kcSIpLHQuc3BlZWQ9dC5zcGVlZD8/cigic3BlZWQiKSx0LnB3PXQucHc/P3IoInB3IiksW3QuYXR0YWNrLHQuZGVjYXksdC5zdXN0YWluLHQucmVsZWFzZV09bShbdC5hdHRhY2ssdC5kZWNheSx0LnN1c3RhaW4sdC5yZWxlYXNlXSksdC5faG9sZEVuZD10Ll9iZWdpbit0Ll9kdXJhdGlvbix0Ll9lbmQ9dC5faG9sZEVuZCt0LnJlbGVhc2UrLjAxLHQuZm1pJiYodC5zPT09InNhdyJ8fHQucz09PSJzYXd0b290aCIpJiYodC5zPSJ6YXciKSxDW3Quc10pe2NvbnN0IGU9Q1t0LnNdO3QuX3NvdW5kPW5ldyBlLHQuX2NoYW5uZWxzPTF9ZWxzZSBpZihfLnNhbXBsZXMuaGFzKHQucykpe2NvbnN0IGU9Xy5zYW1wbGVzLmdldCh0LnMpO3QuX2J1ZmZlcnM9W10sdC5fY2hhbm5lbHM9ZS5jaGFubmVscy5sZW5ndGg7Zm9yKGxldCBoPTA7aDx0Ll9jaGFubmVscztoKyspdC5fYnVmZmVycy5wdXNoKG5ldyBfKGUuY2hhbm5lbHNbaF0sZS5zYW1wbGVSYXRlLHQudW5pdD09PSJjIikpfWVsc2UgY29uc29sZS53YXJuKCJzb3VuZCBub3QgbG9hZGVkIix0LnMpO3QucGVudiYmKHQuX3BlbnY9bmV3IGYoe2RlY2F5Q3VydmU6NH0pLFt0LnBhdHRhY2ssdC5wZGVjYXksdC5wc3VzdGFpbix0LnByZWxlYXNlXT1tKFt0LnBhdHRhY2ssdC5wZGVjYXksdC5wc3VzdGFpbix0LnByZWxlYXNlXSkpLHQudmliJiYodC5fdmliPW5ldyB2LHQudmlibW9kPXQudmlibW9kPz9yKCJ2aWJtb2QiKSksdC5mbWkmJih0Ll9mbT1uZXcgdix0LmZtaD10LmZtaD8/cigiZm1oIiksdC5mbWVudiYmKHQuX2ZtZW52PW5ldyBmKHtkZWNheUN1cnZlOjJ9KSxbdC5mbWF0dGFjayx0LmZtZGVjYXksdC5mbXN1c3RhaW4sdC5mbXJlbGVhc2VdPW0oW3QuZm1hdHRhY2ssdC5mbWRlY2F5LHQuZm1zdXN0YWluLHQuZm1yZWxlYXNlXSkpKSx0Ll9hZHNyPW5ldyBmKHtkZWNheUN1cnZlOjJ9KSx0LmRlbGF5PWModC5kZWxheT8/cigiZGVsYXkiKSksdC5kZWxheWZlZWRiYWNrPXQuZGVsYXlmZWVkYmFjaz8/cigiZGVsYXlmZWVkYmFjayIpLHQuZGVsYXlzcGVlZD10LmRlbGF5c3BlZWQ/P3IoImRlbGF5c3BlZWQiKSx0LmRlbGF5dGltZT10LmRlbGF5dGltZT8/cigiZGVsYXl0aW1lIiksdC5scGVudiYmKHQuX2xwZW52PW5ldyBmKHtkZWNheUN1cnZlOjR9KSxbdC5scGF0dGFjayx0LmxwZGVjYXksdC5scHN1c3RhaW4sdC5scHJlbGVhc2VdPW0oW3QubHBhdHRhY2ssdC5scGRlY2F5LHQubHBzdXN0YWluLHQubHByZWxlYXNlXSkpLHQuaHBlbnYmJih0Ll9ocGVudj1uZXcgZih7ZGVjYXlDdXJ2ZTo0fSksW3QuaHBhdHRhY2ssdC5ocGRlY2F5LHQuaHBzdXN0YWluLHQuaHByZWxlYXNlXT1tKFt0LmhwYXR0YWNrLHQuaHBkZWNheSx0Lmhwc3VzdGFpbix0LmhwcmVsZWFzZV0pKSx0LmJwZW52JiYodC5fYnBlbnY9bmV3IGYoe2RlY2F5Q3VydmU6NH0pLFt0LmJwYXR0YWNrLHQuYnBkZWNheSx0LmJwc3VzdGFpbix0LmJwcmVsZWFzZV09bShbdC5icGF0dGFjayx0LmJwZGVjYXksdC5icHN1c3RhaW4sdC5icHJlbGVhc2VdKSksdC5fY2hvcnVzPXQuY2hvcnVzP1tdOm51bGwsdC5fbHBmPXQuY3V0b2ZmP1tdOm51bGwsdC5faHBmPXQuaGN1dG9mZj9bXTpudWxsLHQuX2JwZj10LmJhbmRmP1tdOm51bGwsdC5fY29hcnNlPXQuY29hcnNlP1tdOm51bGwsdC5fY3J1c2g9dC5jcnVzaD9bXTpudWxsLHQuX2Rpc3RvcnQ9dC5kaXN0b3J0P1tdOm51bGw7Zm9yKGxldCBlPTA7ZTx0aGlzLl9jaGFubmVscztlKyspdC5fbHBmPy5wdXNoKG5ldyBnKSx0Ll9ocGY/LnB1c2gobmV3IGcpLHQuX2JwZj8ucHVzaChuZXcgZyksdC5fY2hvcnVzPy5wdXNoKG5ldyBXKSx0Ll9jb2Fyc2U/LnB1c2gobmV3IFgpLHQuX2NydXNoPy5wdXNoKG5ldyBVKSx0Ll9kaXN0b3J0Py5wdXNoKG5ldyBZKX11cGRhdGUocyl7aWYoIXRoaXMuX3NvdW5kJiYhdGhpcy5fYnVmZmVycylyZXR1cm4gMDtsZXQgdD0rKHM+PXRoaXMuX2JlZ2luJiZzPD10aGlzLl9ob2xkRW5kKSxlPXRoaXMuZnJlcSp0aGlzLnNwZWVkO2lmKHRoaXMuX2ZtJiZ0aGlzLmZtaCE9PXZvaWQgMCYmdGhpcy5mbWkhPT12b2lkIDApe2xldCBhPXRoaXMuZm1pO2lmKHRoaXMuX2ZtZW52KXtjb25zdCBxPXRoaXMuX2ZtZW52LnVwZGF0ZShzLHQsdGhpcy5mbWF0dGFjayx0aGlzLmZtZGVjYXksdGhpcy5mbXN1c3RhaW4sdGhpcy5mbXJlbGVhc2UpO2E9dGhpcy5mbWVudipxKmF9Y29uc3QgcD1lKnRoaXMuZm1oLHU9cCphO2U9ZSt0aGlzLl9mbS51cGRhdGUocCkqdX1pZih0aGlzLl92aWImJnRoaXMudmlibW9kIT09dm9pZCAwJiYoZT1lKjIqKih0aGlzLl92aWIudXBkYXRlKHRoaXMudmliKSp0aGlzLnZpYm1vZC8xMikpLHRoaXMuX3BlbnYmJnRoaXMucGVudiE9PXZvaWQgMCl7Y29uc3QgYT10aGlzLl9wZW52LnVwZGF0ZShzLHQsdGhpcy5wYXR0YWNrLHRoaXMucGRlY2F5LHRoaXMucHN1c3RhaW4sdGhpcy5wcmVsZWFzZSk7ZT1lK2EqdGhpcy5wZW52fWxldCBoPXRoaXMuY3V0b2ZmO2lmKGghPT12b2lkIDAmJnRoaXMuX2xwZW52KXtjb25zdCBhPXRoaXMuX2xwZW52LnVwZGF0ZShzLHQsdGhpcy5scGF0dGFjayx0aGlzLmxwZGVjYXksdGhpcy5scHN1c3RhaW4sdGhpcy5scHJlbGVhc2UpO2g9dGhpcy5scGVudiphKmgraH1sZXQgbz10aGlzLmhjdXRvZmY7aWYobyE9PXZvaWQgMCYmdGhpcy5faHBlbnYmJnRoaXMuaHBlbnYhPT12b2lkIDApe2NvbnN0IGE9dGhpcy5faHBlbnYudXBkYXRlKHMsdCx0aGlzLmhwYXR0YWNrLHRoaXMuaHBkZWNheSx0aGlzLmhwc3VzdGFpbix0aGlzLmhwcmVsZWFzZSk7bz0yKip0aGlzLmhwZW52KmEqbytvfWxldCBuPXRoaXMuYmFuZGY7aWYobiE9PXZvaWQgMCYmdGhpcy5fYnBlbnYmJnRoaXMuYnBlbnYhPT12b2lkIDApe2NvbnN0IGE9dGhpcy5fYnBlbnYudXBkYXRlKHMsdCx0aGlzLmJwYXR0YWNrLHRoaXMuYnBkZWNheSx0aGlzLmJwc3VzdGFpbix0aGlzLmJwcmVsZWFzZSk7bj0yKip0aGlzLmJwZW52KmEqbitufWNvbnN0IGw9dGhpcy5fYWRzci51cGRhdGUocyx0LHRoaXMuYXR0YWNrLHRoaXMuZGVjYXksdGhpcy5zdXN0YWluLHRoaXMucmVsZWFzZSk7Zm9yKGxldCBhPTA7YTx0aGlzLl9jaGFubmVsczthKyspe2lmKHRoaXMuX3NvdW5kJiZ0aGlzLnM9PT0icHVsc2UiP3RoaXMub3V0W2FdPXRoaXMuX3NvdW5kLnVwZGF0ZShlLHRoaXMucHcpOnRoaXMuX3NvdW5kP3RoaXMub3V0W2FdPXRoaXMuX3NvdW5kLnVwZGF0ZShlKTp0aGlzLl9idWZmZXJzJiYodGhpcy5vdXRbYV09dGhpcy5fYnVmZmVyc1thXS51cGRhdGUoZSkpLHRoaXMub3V0W2FdPXRoaXMub3V0W2FdKnRoaXMuZ2Fpbip0aGlzLnZlbG9jaXR5LHRoaXMuX2Nob3J1cyl7Y29uc3QgcD10aGlzLl9jaG9ydXNbYV0udXBkYXRlKHRoaXMub3V0W2FdLHRoaXMuY2hvcnVzLC4wMysuMDUqYSwxLC4xMSk7dGhpcy5vdXRbYV09cCt0aGlzLm91dFthXX10aGlzLl9scGYmJih0aGlzLl9scGZbYV0udXBkYXRlKHRoaXMub3V0W2FdLGgsdGhpcy5yZXNvbmFuY2UpLHRoaXMub3V0W2FdPXRoaXMuX2xwZlthXS5zMSksdGhpcy5faHBmJiYodGhpcy5faHBmW2FdLnVwZGF0ZSh0aGlzLm91dFthXSxvLHRoaXMuaHJlc29uYW5jZSksdGhpcy5vdXRbYV09dGhpcy5vdXRbYV0tdGhpcy5faHBmW2FdLnMxKSx0aGlzLl9icGYmJih0aGlzLl9icGZbYV0udXBkYXRlKHRoaXMub3V0W2FdLG4sdGhpcy5iYW5kcSksdGhpcy5vdXRbYV09dGhpcy5fYnBmW2FdLnMwKSx0aGlzLl9jb2Fyc2UmJih0aGlzLm91dFthXT10aGlzLl9jb2Fyc2VbYV0udXBkYXRlKHRoaXMub3V0W2FdLHRoaXMuY29hcnNlKSksdGhpcy5fY3J1c2gmJih0aGlzLm91dFthXT10aGlzLl9jcnVzaFthXS51cGRhdGUodGhpcy5vdXRbYV0sdGhpcy5jcnVzaCkpLHRoaXMuX2Rpc3RvcnQmJih0aGlzLm91dFthXT10aGlzLl9kaXN0b3J0W2FdLnVwZGF0ZSh0aGlzLm91dFthXSx0aGlzLmRpc3RvcnQsdGhpcy5kaXN0b3J0dm9sKSksdGhpcy5vdXRbYV09dGhpcy5vdXRbYV0qbCx0aGlzLm91dFthXT10aGlzLm91dFthXSp0aGlzLnBvc3RnYWluLHRoaXMuX2J1ZmZlcnN8fCh0aGlzLm91dFthXT10aGlzLm91dFthXSouMil9aWYodGhpcy5fY2hhbm5lbHM9PT0xJiYodGhpcy5vdXRbMV09dGhpcy5vdXRbMF0pLHRoaXMucGFuIT09LjUpe2NvbnN0IGE9dGhpcy5wYW4qTWF0aC5QSS8yO3RoaXMub3V0WzBdPXRoaXMub3V0WzBdKk1hdGguY29zKGEpLHRoaXMub3V0WzFdPXRoaXMub3V0WzFdKk1hdGguc2luKGEpfX19Y2xhc3Mgc3R7dm9pY2VzPVtdO3ZpZD0wO3E9W107b3V0PVswLDBdO2RlbGF5c2VuZD1bMCwwXTtkZWxheXRpbWU9cigiZGVsYXl0aW1lIik7ZGVsYXlmZWVkYmFjaz1yKCJkZWxheWZlZWRiYWNrIik7ZGVsYXlzcGVlZD1yKCJkZWxheXNwZWVkIik7dD0wO2NvbnN0cnVjdG9yKHM9NDhlMyx0PTApe3RoaXMuc2FtcGxlUmF0ZT1zLHRoaXMudD1NYXRoLmZsb29yKHQqcyksdGhpcy5fZGVsYXlMPW5ldyBrLHRoaXMuX2RlbGF5Uj1uZXcga31sb2FkU2FtcGxlKHMsdCxlKXtfLnNhbXBsZXMuc2V0KHMse2NoYW5uZWxzOnQsc2FtcGxlUmF0ZTplfSl9c2NoZWR1bGVTcGF3bihzKXtpZihzLl9iZWdpbj09PXZvaWQgMCl0aHJvdyBuZXcgRXJyb3IoIltkb3VnaF06IHNjaGVkdWxlU3Bhd24gZXhwZWN0ZWQgX2JlZ2luIHRvIGJlIHNldCIpO2lmKHMuX2R1cmF0aW9uPT09dm9pZCAwKXRocm93IG5ldyBFcnJvcigiW2RvdWdoXTogc2NoZWR1bGVTcGF3biBleHBlY3RlZCBfZHVyYXRpb24gdG8gYmUgc2V0Iik7cy5zYW1wbGVSYXRlPXRoaXMuc2FtcGxlUmF0ZTtjb25zdCB0PU1hdGguZmxvb3Iocy5fYmVnaW4qdGhpcy5zYW1wbGVSYXRlKTt0aGlzLnNjaGVkdWxlKHt0aW1lOnQsdHlwZToic3Bhd24iLGFyZzpzfSl9c3Bhd24ocyl7cy5pZD10aGlzLnZpZCsrO2NvbnN0IHQ9bmV3IHR0KHMpO3RoaXMudm9pY2VzLnB1c2godCk7Y29uc3QgZT1NYXRoLmNlaWwodC5fZW5kKnRoaXMuc2FtcGxlUmF0ZSk7dGhpcy5zY2hlZHVsZSh7dGltZTplLHR5cGU6ImRlc3Bhd24iLGFyZzp0LmlkfSl9ZGVzcGF3bihzKXt0aGlzLnZvaWNlcz10aGlzLnZvaWNlcy5maWx0ZXIodD0+dC5pZCE9PXMpfXNjaGVkdWxlKHMpe2lmKCF0aGlzLnEubGVuZ3RoKXt0aGlzLnEucHVzaChzKTtyZXR1cm59bGV0IHQ9MDtmb3IoO3Q8dGhpcy5xLmxlbmd0aCYmdGhpcy5xW3RdLnRpbWU8cy50aW1lOyl0Kys7dGhpcy5xLnNwbGljZSh0LDAscyl9dXBkYXRlKCl7Zm9yKDt0aGlzLnEubGVuZ3RoPjAmJnRoaXMucVswXS50aW1lPD10aGlzLnQ7KXRoaXNbdGhpcy5xWzBdLnR5cGVdKHRoaXMucVswXS5hcmcpLHRoaXMucS5zaGlmdCgpO3RoaXMub3V0WzBdPTAsdGhpcy5vdXRbMV09MDtmb3IobGV0IGU9MDtlPHRoaXMudm9pY2VzLmxlbmd0aDtlKyspdGhpcy52b2ljZXNbZV0udXBkYXRlKHRoaXMudC90aGlzLnNhbXBsZVJhdGUpLHRoaXMub3V0WzBdKz10aGlzLnZvaWNlc1tlXS5vdXRbMF0sdGhpcy5vdXRbMV0rPXRoaXMudm9pY2VzW2VdLm91dFsxXSx0aGlzLnZvaWNlc1tlXS5kZWxheSYmKHRoaXMuZGVsYXlzZW5kWzBdKz10aGlzLnZvaWNlc1tlXS5vdXRbMF0qdGhpcy52b2ljZXNbZV0uZGVsYXksdGhpcy5kZWxheXNlbmRbMV0rPXRoaXMudm9pY2VzW2VdLm91dFsxXSp0aGlzLnZvaWNlc1tlXS5kZWxheSx0aGlzLmRlbGF5dGltZT10aGlzLnZvaWNlc1tlXS5kZWxheXRpbWUsdGhpcy5kZWxheXNwZWVkPXRoaXMudm9pY2VzW2VdLmRlbGF5c3BlZWQsdGhpcy5kZWxheWZlZWRiYWNrPXRoaXMudm9pY2VzW2VdLmRlbGF5ZmVlZGJhY2spO2NvbnN0IHM9dGhpcy5fZGVsYXlMLnVwZGF0ZSh0aGlzLmRlbGF5c2VuZFswXSx0aGlzLmRlbGF5dGltZSksdD10aGlzLl9kZWxheVIudXBkYXRlKHRoaXMuZGVsYXlzZW5kWzFdLHRoaXMuZGVsYXl0aW1lKTt0aGlzLmRlbGF5c2VuZFswXT1zKnRoaXMuZGVsYXlmZWVkYmFjayx0aGlzLmRlbGF5c2VuZFsxXT10KnRoaXMuZGVsYXlmZWVkYmFjayx0aGlzLm91dFswXSs9cyx0aGlzLm91dFsxXSs9dCx0aGlzLnQrK319Y29uc3QgZXQ9KGkscyx0KT0+TWF0aC5taW4oTWF0aC5tYXgoaSxzKSx0KTtjbGFzcyBpdCBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3Nvcntjb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5kb3VnaD1uZXcgc3Qoc2FtcGxlUmF0ZSxjdXJyZW50VGltZSksdGhpcy5wb3J0Lm9ubWVzc2FnZT1zPT57cy5kYXRhLnNwYXduP3RoaXMuZG91Z2guc2NoZWR1bGVTcGF3bihzLmRhdGEuc3Bhd24pOnMuZGF0YS5zYW1wbGU/dGhpcy5kb3VnaC5sb2FkU2FtcGxlKHMuZGF0YS5zYW1wbGUscy5kYXRhLmNoYW5uZWxzLHMuZGF0YS5zYW1wbGVSYXRlKTpzLmRhdGEuc2FtcGxlcz9zLmRhdGEuc2FtcGxlcy5mb3JFYWNoKChbdCxlLGhdKT0+e3RoaXMuZG91Z2gubG9hZFNhbXBsZSh0LGUsaCl9KTpjb25zb2xlLmxvZygidW5yZWNvZ25pemVkIGV2ZW50IHR5cGUiLHMuZGF0YSl9fXByb2Nlc3Mocyx0LGUpe2lmKHRoaXMuZGlzY29ubmVjdGVkKXJldHVybiExO2NvbnN0IGg9dFswXTtmb3IobGV0IG89MDtvPGhbMF0ubGVuZ3RoO28rKyl7dGhpcy5kb3VnaC51cGRhdGUoKTtmb3IobGV0IG49MDtuPGgubGVuZ3RoO24rKyloW25dW29dPWV0KHRoaXMuZG91Z2gub3V0W25dLC0xLDEpfXJldHVybiEwfX1yZWdpc3RlclByb2Nlc3NvcigiZG91Z2gtcHJvY2Vzc29yIixpdCl9KSgpOwo=";typeof sampleRate<"u"&&sampleRate,Lp(Ug);const{Pattern:Qg,logger:qg,repl:$g}=js;I0(qg);const e2=e=>(e.ensureObjectValue(),e.value),Ip=(e,t,n,s,o)=>Xo(e2(e),o,n,s,e.whole?.begin.valueOf());function Jp(e={}){return e={getTime:()=>J().currentTime,defaultOutput:Ip,...e},$g(e)}Qg.prototype.dough=function(){return this.onTrigger(Np,1)};const Mt=(e="test-canvas",t)=>{let{contextType:n="2d",pixelated:s=!1,pixelRatio:o=window.devicePixelRatio}={},r=document.querySelector("#"+e);if(!r){r=document.createElement("canvas"),r.id=e,r.width=window.innerWidth*o,r.height=window.innerHeight*o,r.style="pointer-events:none;width:100%;height:100%;position:fixed;top:0;left:0",s&&(r.style.imageRendering="pixelated"),document.body.prepend(r);let i;window.addEventListener("resize",()=>{i&&clearTimeout(i),i=setTimeout(()=>{r.width=window.innerWidth*o,r.height=window.innerHeight*o},200)})}return r.getContext(n,{willReadFrequently:!0})};let Vn={};function t2(e){Vn[e]!==void 0&&(cancelAnimationFrame(Vn[e]),delete Vn[e])}let pt={};L.prototype.draw=function(e,t){if(typeof window>"u")return this;let{id:n=1,lookbehind:s=0,lookahead:o=0}=t,r=Math.max(Is(),0);t2(n),s=Math.abs(s),pt[n]=(pt[n]||[]).filter(l=>!l.isInFuture(r));let i=this.queryArc(r,r+o).filter(l=>l.hasOnset());pt[n]=pt[n].concat(i);let u;const a=()=>{const l=Is(),p=l+o;pt[n]=pt[n].filter(X=>X.isInNearPast(s,l));let f=Math.max(u||p,p-1/10);const g=this.queryArc(f,p).filter(X=>X.hasOnset());pt[n]=pt[n].concat(g),u=p,e(pt[n],l,p,this),Vn[n]=requestAnimationFrame(a)};return Vn[n]=requestAnimationFrame(a),this},L.prototype.onPaint=function(e){return this.withState(t=>(t.controls.painters||(t.controls.painters=[]),t.controls.painters.push(e),t))},L.prototype.getPainters=function(){let e=[];return this.queryArc(0,0,{painters:e}),e};let n2={background:"#222",foreground:"#75baff",caret:"#ffcc00",selection:"rgba(128, 203, 196, 0.5)",selectionMatch:"#036dd626",lineHighlight:"#00000050",gutterBackground:"transparent",gutterForeground:"#8a919966"};function ht(){return n2}let jp="#22222210";L.prototype.animate=function({callback:e,sync:t=!1,smear:n=.5}={}){window.frame&&cancelAnimationFrame(window.frame);const s=Mt();let{clientWidth:o,clientHeight:r}=s.canvas;o*=window.devicePixelRatio,r*=window.devicePixelRatio;let i=n===0?"99":Number((1-n)*100).toFixed(0);i=i.length===1?`0${i}`:i,jp=`#200010${i}`;const u=a=>{let l;a=Math.round(a),l=this.slow(1e3).queryArc(a,a),s.fillStyle=jp,s.fillRect(0,0,o,r),l.forEach(p=>{let{x:f,y:g,w:X,h:G,s:w,r:F,angle:v=0,fill:z="darkseagreen"}=p.value;if(X*=o,G*=r,F!==void 0&&v!==void 0){const x=v*2*Math.PI,[R,N]=[(o-X)/2,(r-G)/2];f=R+Math.cos(x)*F*R,g=N+Math.sin(x)*F*N}else f*=o-X,g*=r-G;const B={...p.value,x:f,y:g,w:X,h:G};s.fillStyle=z,w==="rect"?s.fillRect(f,g,X,G):w==="ellipse"&&(s.beginPath(),s.ellipse(f+X/2,g+G/2,X/2,G/2,0,0,2*Math.PI),s.fill()),e&&e(s,B,p)}),window.frame=requestAnimationFrame(u)};return window.frame=requestAnimationFrame(u),se};const{x:Op,y:aG,w:lG,h:dG,angle:pG,r:hG,fill:fG,smear:mG}=xs("x","y","w","h","angle","r","fill","smear");Z("rescale",function(e,t){return t.mul(Op(e).w(e).y(e).h(e))}),Z("moveXY",function(e,t,n){return n.add(Op(e).y(t))}),Z("zoomIn",function(e,t){const n=Xe(1).sub(e).div(2);return t.rescale(e).move(n,n)});const Cn=(e,t,n)=>e*(n-t)+t,Up=e=>{let{value:t}=e;typeof e.value!="object"&&(t={value:t});let{note:n,n:s,freq:o,s:r}=t;if(o)return hs(o);if(n=n??s,typeof n=="string")try{return Nt(n)}catch{return 0}return typeof n=="number"?n:r?"_"+r:t};L.prototype.pianoroll=function(e={}){let{cycles:t=4,playhead:n=.5,overscan:s=0,hideNegative:o=!1,ctx:r=Mt(),id:i=1}=e,u=-t*n,a=t*(1-n);const l=(p,f)=>(!o||p.whole.begin>=0)&&p.isWithinTime(f+u,f+a);return this.draw((p,f)=>{Qp({...e,time:f,ctx:r,haps:p.filter(g=>l(g,f))})},{lookbehind:u-s,lookahead:a+s,id:i}),this};function Qp({time:e,haps:t,cycles:n=4,playhead:s=.5,flipTime:o=0,flipValues:r=0,hideNegative:i=!1,inactive:u=ht().foreground,active:a=ht().foreground,background:l="transparent",smear:p=0,playheadColor:f=ht().foreground,minMidi:g=10,maxMidi:X=90,autorange:G=0,timeframe:w,fold:F=1,vertical:v=0,labels:z=!1,fill:B=1,fillActive:x=!1,strokeActive:R=!0,stroke:N,hideInactive:O=0,colorizeInactive:j=1,fontFamily:te,ctx:T,id:ue}={}){const H=T.canvas.width,q=T.canvas.height;let U=-n*s,pe=n*(1-s);ue&&(t=t.filter(ee=>ee.hasTag(ue))),w&&(console.warn("timeframe is deprecated! use from/to instead"),U=0,pe=w);const $=v?q:H,oe=v?H:q;let he=v?[$,0]:[0,$];const Ve=pe-U,He=v?[0,oe]:[oe,0];let Te=X-g+1,K=oe/Te,I=[];o&&he.reverse(),r&&He.reverse();const{min:et,max:ie,values:rt}=t.reduce(({min:ee,max:re,values:Ie},Je)=>{const we=Up(Je);return{min:we<ee?we:ee,max:we>re?we:re,values:Ie.includes(we)?Ie:[...Ie,we]}},{min:1/0,max:-1/0,values:[]});G&&(g=et,X=ie,Te=X-g+1),I=rt.sort((ee,re)=>typeof ee=="number"&&typeof re=="number"?ee-re:typeof ee=="number"?1:String(ee).localeCompare(String(re))),K=F?oe/I.length:oe/Te,T.fillStyle=l,T.globalAlpha=1,p||(T.clearRect(0,0,H,q),T.fillRect(0,0,H,q)),t.forEach(ee=>{const re=ee.whole.begin<=e&&ee.endClipped>e;let Ie=N??(R&&re),Je=!re&&B||re&&x;if(O&&!re)return;let we=ee.value?.color;a=we||a,u=j&&we||u,we=re?a:u,T.fillStyle=Je?we:"transparent",T.strokeStyle=we;const{velocity:Zt=1,gain:Ln=1}=ee.value||{};T.globalAlpha=Zt*Ln;const wt=(ee.whole.begin-(o?pe:U))/Ve,$t=Cn(wt,...he);let ft=Cn(ee.duration/Ve,0,$);const Rt=Up(ee),xt=F?I.indexOf(Rt)/I.length:(Number(Rt)-g)/Te,Bt=Cn(xt,...He);let en=0;const St=Cn(e/Ve,...he);let ct;if(v?ct=[Bt+1-(r?K:0),$-St+$t+en+1-(o?0:ft),K-2,ft-2]:ct=[$t-St+en+1-(o?ft:0),Bt+1-(r?0:K),ft-2,K-2],Ie&&T.strokeRect(...ct),Je&&T.fillRect(...ct),z){const zn=ee.value.note??ee.value.s+(ee.value.n?`:${ee.value.n}`:""),{label:tn,activeLabel:Mn}=ee.value,Rn=(re&&Mn||tn)??zn;let je=v?ft:K*.75;T.font=`${je}px ${te||"monospace"}`,T.fillStyle=Je?"black":we,T.textBaseline="top",T.fillText(Rn,...ct)}}),T.globalAlpha=1;const Le=Cn(-U/Ve,...he);return T.strokeStyle=f,T.beginPath(),v?(T.moveTo(0,Le),T.lineTo(oe,Le)):(T.moveTo(Le,0),T.lineTo(Le,oe)),T.stroke(),this}function s2(e,t={}){let[n,s]=e;n=Math.abs(n);const o=s+n,r=o!==0?n/o:0;return{fold:1,...t,cycles:o,playhead:r}}const o2=(e={})=>(t,n,s,o)=>Qp({ctx:t,time:n,haps:s,...s2(o,e)});L.prototype.punchcard=function(e){return this.onPaint(o2(e))},L.prototype.wordfall=function(e){return this.punchcard({vertical:1,labels:1,stroke:0,fillActive:1,active:"white",...e})};function r2(e,t,n,s){const o=(e-90)*Math.PI/180;return[n+Math.cos(o)*t,s+Math.sin(o)*t]}const qp=(e,t,n,s,o=0)=>r2((e+o)*360,t*e,n,s);function $p(e){let{ctx:t,from:n=0,to:s=3,margin:o=50,cx:r=100,cy:i=100,rotate:u=0,thickness:a=o/2,color:l=ht().foreground,cap:p="round",stretch:f=1,fromOpacity:g=1,toOpacity:X=1}=e;n*=f,s*=f,u*=f,t.lineWidth=a,t.lineCap=p,t.strokeStyle=l,t.globalAlpha=g,t.beginPath();let[G,w]=qp(n,o,r,i,u);t.moveTo(G,w);const F=1/60;let v=n;for(;v<=s;){const[z,B]=qp(v,o,r,i,u);t.globalAlpha=(v-n)/(s-n)*X,t.lineTo(z,B),v+=F}t.stroke()}function c2(e){let{stretch:t=1,size:n=80,thickness:s=n/2,cap:o="butt",inset:r=3,playheadColor:i="#ffffff",playheadLength:u=.02,playheadThickness:a=s,padding:l=0,steady:p=1,activeColor:f=ht().foreground,inactiveColor:g=ht().gutterForeground,colorizeInactive:X=0,fade:G=!0,ctx:w,time:F,haps:v,drawTime:z,id:B}=e;B&&(v=v.filter(H=>H.hasTag(B)));const[x,R]=[w.canvas.width,w.canvas.height];w.clearRect(0,0,x*2,R*2);const[N,O]=[x/2,R/2],j={margin:n/t,cx:N,cy:O,stretch:t,cap:o,thickness:s},te={...j,thickness:a,from:r-u,to:r,color:i},[T]=z,ue=p*F;v.forEach(H=>{const q=H.whole.begin<=F&&H.endClipped>F,U=H.whole.begin-F+r,pe=H.endClipped-F+r-l,$=H.value?.color||f,oe=X||q?$:g,he=G?1-Math.abs((H.whole.begin-F)/T):1;$p({ctx:w,...j,from:U,to:pe,rotate:ue,color:oe,fromOpacity:he,toOpacity:he})}),$p({ctx:w,...te,rotate:ue})}L.prototype.spiral=function(e={}){return this.onPaint((t,n,s,o)=>c2({ctx:t,time:n,haps:s,drawTime:o,...e}))};const i2=vt(36),eh=(e,t,n,s)=>{s=s*Math.PI*2;const o=Math.sin(s)*n+e,r=Math.cos(s)*n+t;return[o,r]},th=(e,t)=>.5-Math.log2(e/t)%1;function u2({haps:e,ctx:t,id:n,hapcircles:s=1,circle:o=0,edo:r=12,root:i=i2,thickness:u=3,hapRadius:a=6,mode:l="flake",margin:p=10}={}){const f=l==="polygon",g=l==="flake",X=t.canvas.width,G=t.canvas.height;t.clearRect(0,0,X,G);const w=ht().foreground,v=Math.min(X,G)/2-u/2-a-p,z=X/2,B=G/2;n&&(e=e.filter(R=>R.hasTag(n))),t.strokeStyle=w,t.fillStyle=w,t.globalAlpha=1,t.lineWidth=u,o&&(t.beginPath(),t.arc(z,B,v,0,2*Math.PI),t.stroke()),r&&(Array.from({length:r},(R,N)=>{const O=th(i*Math.pow(2,N/r),i),[j,te]=eh(z,B,v,O);t.beginPath(),t.arc(j,te,a,0,2*Math.PI),t.fill()}),t.stroke());let x=[];t.lineWidth=a,e.forEach(R=>{let N;try{N=To(R)}catch{return}const O=th(N,i),[j,te]=eh(z,B,v,O),T=R.value.color||w;t.strokeStyle=T,t.fillStyle=T;const{velocity:ue=1,gain:H=1}=R.value||{},q=ue*H;t.globalAlpha=q,x.push([j,te,O,T,q]),t.beginPath(),s&&(t.moveTo(j+a,te),t.arc(j,te,a,0,2*Math.PI),t.fill()),g&&(t.moveTo(z,B),t.lineTo(j,te)),t.stroke()}),t.strokeStyle=w,t.globalAlpha=1,f&&x.length&&(x=x.sort((R,N)=>R[2]-N[2]),t.beginPath(),t.moveTo(x[0][0],x[0][1]),x.forEach(([R,N,O,j,te])=>{t.strokeStyle=j,t.globalAlpha=te,t.lineTo(R,N)}),t.lineTo(x[0][0],x[0][1]),t.stroke())}L.prototype.pitchwheel=function(e={}){let{ctx:t=Mt(),id:n=1}=e;return this.tag(n).onPaint((s,o,r)=>u2({...e,ctx:t,haps:r.filter(i=>i.isActive(o)),id:n}))};function nh(e,{align:t=!0,color:n="white",thickness:s=3,scale:o=.25,pos:r=.75,trigger:i=0,ctx:u=Mt(),id:a=1}={}){u.lineWidth=s,u.strokeStyle=n;let l=u.canvas;if(!e){u.beginPath();let w=r*l.height;u.moveTo(0,w),u.lineTo(l.width,w),u.stroke();return}const p=ts("time",a);u.beginPath();const f=e.frequencyBinCount;let g=t?Array.from(p).findIndex((w,F,v)=>F&&v[F-1]>-i&&w<=-i):0;g=Math.max(g,0);const X=l.width*1/f;let G=0;for(let w=g;w<f;w++){const F=p[w]+1,v=(r-o*(F-1))*l.height;w===0?u.moveTo(G,v):u.lineTo(G,v),G+=X}u.stroke()}function sh(e,{color:t="white",scale:n=.25,pos:s=.75,lean:o=.5,min:r=-150,max:i=0,ctx:u=Mt(),id:a=1}={}){if(!e){u.beginPath();let G=s*p.height;u.moveTo(0,G),u.lineTo(p.width,G),u.stroke();return}const l=ts("frequency",a),p=u.canvas;u.fillStyle=t;const f=e.frequencyBinCount,g=p.width*1/f;let X=0;for(let G=0;G<f;G++){const F=An((l[G]-r)/(i-r),0,1)*n,v=F*p.height,z=(s-F*o)*p.height;u.fillRect(X,z,Math.max(g,1),v),X+=g}}function oh(e=0,t="0,0,0",n=Mt()){e?(n.fillStyle=`rgba(${t},${1-e})`,n.fillRect(0,0,n.canvas.width,n.canvas.height)):n.clearRect(0,0,n.canvas.width,n.canvas.height)}L.prototype.fscope=function(e={}){let t=e.id??1;return this.analyze(t).draw(()=>{oh(e.smear,"0,0,0",e.ctx),xe[t]&&sh(xe[t],e)},{id:t})},L.prototype.tscope=function(e={}){let t=e.id??1;return this.analyze(t).draw(n=>{e.color=n[0]?.value?.color||ht().foreground,e.color,oh(e.smear,"0,0,0",e.ctx),nh(xe[t],e)},{id:t})},L.prototype.scope=L.prototype.tscope;let rh={};L.prototype.spectrum=function(e={}){let t=e.id??1;return this.analyze(t).draw(n=>{e.color=n[0]?.value?.color||rh[t]||ht().foreground,rh[t]=e.color,a2(xe[t],e)},{id:t})},L.prototype.scope=L.prototype.tscope;const Wo=new Map;function a2(e,{thickness:t=3,speed:n=1,min:s=-80,max:o=0,ctx:r=Mt(),id:i=1,color:u}={}){if(r.lineWidth=t,r.strokeStyle=u,!e)return;const a=n,l=ts("frequency",i),p=r.canvas;r.fillStyle=u;const f=e.frequencyBinCount;let g=Wo.get(i)||r.getImageData(0,0,p.width,p.height);Wo.set(i,g),r.clearRect(0,0,r.canvas.width,r.canvas.height),r.putImageData(g,-a,0);let X=p.width-n;for(let G=0;G<f;G++){const w=An((l[G]-s)/(o-s),0,1);r.globalAlpha=w;const F=Math.log(G+1)/Math.log(f)*p.height;r.fillRect(X,p.height-F,a,2)}Wo.set(i,r.getImageData(0,0,p.width,p.height))}const l2=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_MAX_POLYPHONY:lo,Warpmode:Go,aliasBank:Gg,get analysers(){return xe},get analysersData(){return zt},applyFM:Zn,applyGainCurve:dt,applyParameterModulators:oo,connectToDestination:zp,createFilter:Qn,destroyAudioWorkletNode:Ot,distortionAlgorithms:ro,dough:Ng,doughTrigger:Np,doughsamples:Dp,drawFrequencyScope:sh,drawTimeScope:nh,drywet:op,dspWorklet:Tp,effectSend:Un,errorLogger:D0,gainNode:Re,getADSRValues:De,getAnalyserById:Mp,getAnalyzerData:ts,getAudioContext:J,getAudioContextCurrentTime:Ib,getAudioDevices:vp,getCachedBuffer:ug,getCompressor:np,getDefaultValue:Fe,getDistortion:up,getDistortionAlgorithm:og,getFrequencyFromValue:Lt,getLfo:Gn,getLoadedBuffer:lg,getOscillator:Yp,getParamADSR:Ee,getParamLfo:so,getPitchEnvelope:It,getSampleBuffer:lp,getSampleBufferSource:dp,getSampleInfo:ap,getSound:Qt,getSuperdoughAudioController:es,getVibratoOscillator:Jt,getWorklet:ke,getZZFX:kp,initAudio:bo,initAudioOnFirstClick:zg,loadBuffer:uo,logger:Ze,noises:no,onTriggerSample:gp,onTriggerSynth:Pp,processSampleMap:mp,registerSampleSource:Xp,registerSamplesPrefix:dg,registerSound:ot,registerSynthSounds:xp,registerWaveTable:wo,registerWorklet:Lp,registerZZFXSounds:Ag,resetDefaultValues:Vp,resetDefaults:Fg,resetGlobalEffects:xg,resetLoadedSounds:Cg,reverseBuffer:pp,samples:ao,scheduleAtTime:Ub,setDefault:Wg,setDefaultAudioContext:$0,setDefaultValue:mo,setDefaultValues:vg,setGainCurve:gg,setLogger:I0,setMaxPolyphony:Zp,setMultiChannelOrbits:Wp,setVersionDefaults:Vg,soundAlias:Zg,soundMap:$e,superdough:Xo,superdoughTrigger:Bg,tables:Dg,waveformN:Sp,webAudioTimeout:Ct,webaudioOutput:Ip,webaudioRepl:Jp},Symbol.toStringTag,{value:"Module"})),{evalScope:d2}=js,b={};b.last_eval_error="",b.handle_eval_error=e=>{b.has_error=!0,b.last_eval_error=e?.message||`${e}`,typeof b.set_status=="function"?b.set_status(b.last_eval_error):console.error("Strudel evaluation error",b.last_eval_error)};const{evaluate:ch,scheduler:p2}=Jp({onEvalError:e=>{b.handle_eval_error(e)}});b.poll_minutes=.2,b.audio_started=!1,b.poll_in_flight=!1,b.volume_percent=100,b.volume_storage_key="slide.volumePercent",b.default_cpm=60,b.tempo_cpm=b.default_cpm,b.tempo_storage_key="slide.tempoCpm",b.tempo_debounce_timer=void 0,b.is_playing=!1,b.color_index=0,b.color_cycle_timer=void 0,b.do_partial_updates=!1,b.cycle_colors=["#94dd94","rgb(197, 187, 106)","rgb(222, 143, 143)","rgb(127, 155, 210)"],b.clear_status_watch=()=>{b.poll_timer&&(clearInterval(b.poll_timer),b.poll_timer=void 0)},b.apply_color=(e,t)=>{let n=document.getElementById("code-input"),s=document.getElementById("volume-value"),o=document.getElementById("volume-slider"),r=document.getElementById("tempo-value"),i=document.getElementById("tempo-slider"),u=document.getElementById("status"),a=document.getElementById("image");n&&(n.style.color=e),s&&(s.style.color=e),o&&(o.style.accentColor=e),r&&(r.style.color=e),i&&(i.style.accentColor=e),u&&(u.style.color=e),a&&(a.style.filter=`drop-shadow(0 0 0.15rem ${e})`)},b.start_color_cycle=()=>{b.color_cycle_timer||(b.is_playing=!0,b.color_index=0,b.apply_color(b.cycle_colors[0],0),b.color_cycle_timer=setInterval(()=>{b.color_index=(b.color_index+1)%b.cycle_colors.length,b.apply_color(b.cycle_colors[b.color_index],b.color_index)},3*1e3))},b.stop_color_cycle=()=>{b.color_cycle_timer&&(clearInterval(b.color_cycle_timer),b.color_cycle_timer=void 0),b.is_playing=!1,b.color_index=0;let e=b.cycle_colors[0],t=document.getElementById("code-input"),n=document.getElementById("volume-value"),s=document.getElementById("volume-slider"),o=document.getElementById("tempo-value"),r=document.getElementById("tempo-slider"),i=document.getElementById("status"),u=document.getElementById("image");t&&(t.style.color=e),n&&(n.style.color=e),s&&(s.style.accentColor=e),o&&(o.style.color=e),r&&(r.style.accentColor=e),i&&(i.style.color=e),u&&(u.style.filter="")},b.get_volume_slider=()=>document.getElementById("volume-slider"),b.get_volume_value=()=>document.getElementById("volume-value"),b.read_volume_value=e=>{if(!e)return b.volume_percent;const t=e.valueAsNumber;if(Number.isFinite(t))return t;const n=parseInt(e.value,10);return Number.isFinite(n)?n:b.volume_percent},b.refresh_volume_ui=()=>{const e=b.get_volume_slider(),t=b.get_volume_value();e&&(e.value=`${b.volume_percent}`),t&&(t.innerText=`${b.volume_percent}%`)},b.persist_volume=()=>{if(!(typeof window>"u"))try{window.localStorage?.setItem(b.volume_storage_key,`${b.volume_percent}`)}catch(e){console.warn("Failed to persist volume",e)}},b.load_saved_volume=()=>{if(!(typeof window>"u"))try{const e=window.localStorage?.getItem(b.volume_storage_key);if(e==null)return;const t=Number(e);return Number.isFinite(t)?t:void 0}catch(e){console.warn("Failed to load volume",e);return}},b.apply_volume=()=>{if(b.audio_started)try{const t=es()?.output?.destinationGain;if(!t){console.warn("Destination gain node missing");return}t.gain.value=b.volume_percent/100}catch(e){console.error("Failed to apply volume",e)}},b.update_volume=e=>{let t=Number(e);Number.isFinite(t)||(t=b.volume_percent),t=Math.min(100,Math.max(0,t)),b.volume_percent=t,b.refresh_volume_ui(),b.persist_volume(),b.apply_volume()},b.init_volume_controls=()=>{const e=b.get_volume_slider();if(!e)return;const t=b.load_saved_volume(),n=b.read_volume_value(e);Number.isFinite(t)?b.volume_percent=t:b.volume_percent=n,b.refresh_volume_ui(),b.persist_volume(),e.addEventListener("input",s=>{b.update_volume(b.read_volume_value(s.target))}),e.addEventListener("wheel",s=>{s.preventDefault();let o=parseInt(s.target.step,10)||1,r=parseInt(s.target.value,10);s.deltaY<0?s.target.value=r+o:s.target.value=r-o,b.update_volume(b.read_volume_value(s.target))})},b.get_tempo_slider=()=>document.getElementById("tempo-slider"),b.get_tempo_value=()=>document.getElementById("tempo-value"),b.refresh_tempo_ui=()=>{let e=b.get_tempo_slider(),t=b.get_tempo_value();e&&(e.value=`${b.tempo_cpm}`),t&&(t.textContent=`${b.tempo_cpm} cpm`)},b.persist_tempo=()=>{if(!(typeof window>"u"))try{window.localStorage?.setItem(b.tempo_storage_key,`${b.tempo_cpm}`)}catch(e){console.warn("Failed to persist tempo",e)}},b.load_saved_tempo=()=>{if(!(typeof window>"u"))try{let e=window.localStorage?.getItem(b.tempo_storage_key);if(e==null)return;let t=parseInt(e,10);return Number.isFinite(t)?t:void 0}catch(e){console.warn("Failed to load tempo",e);return}},b.update_tempo=e=>{let t=parseInt(e,10);Number.isFinite(t)||(t=b.tempo_cpm),t=Math.min(200,Math.max(20,t)),b.tempo_cpm=t,b.refresh_tempo_ui(),b.persist_tempo()},b.on_tempo_change=e=>{b.update_tempo(e.target.value),b.tempo_debounce_timer&&clearTimeout(b.tempo_debounce_timer),b.tempo_debounce_timer=setTimeout(()=>{b.tempo_debounce_timer=void 0,b.set_tempo()},10)},b.init_tempo_controls=()=>{let e=b.get_tempo_slider();if(!e)return;let t=b.load_saved_tempo();Number.isFinite(t)&&(b.tempo_cpm=t),b.refresh_tempo_ui(),b.persist_tempo(),e.addEventListener("input",n=>{b.update_tempo(n.target.value)}),e.addEventListener("auxclick",n=>{n.button===1&&(n.target.value=b.default_cpm,b.update_tempo(b.default_cpm),b.set_tempo())}),e.addEventListener("wheel",n=>{n.preventDefault();let s=parseInt(n.target.step,10)||1,o=parseInt(n.target.value,10);n.deltaY<0?n.target.value=o+s:n.target.value=o-s,b.on_tempo_change(n)}),e.addEventListener("change",n=>{b.on_tempo_change(n)})},b.ensure_scope=()=>(b.scope_promise||(b.scope_promise=d2(js,Sb,l2).catch(e=>{throw b.scope_promise=void 0,console.error("Strudel scope failed to load",e),e})),b.scope_promise),b.strudel_init=async()=>{if(!b.audio_started){console.info("Initializing Audio...");try{await b.ensure_scope(),await bo(),P0(),await xp(),await ao("github:tidalcycles/dirt-samples"),b.audio_started=!0,b.apply_volume(),b.strudel_watch_status(),console.info("Audio Ready.")}catch(e){throw console.error("Audio Failed:",e),e}}},b.playing=e=>{let t="Playing 🥁";e&&(t=`${t} - ${e}`.trim()),b.set_status(t)},b.set_tempo=()=>{p2.setCps(b.tempo_cpm/60)},b.strudel_update=async e=>{if(!b.audio_started){console.warn("Audio not started yet. Call strudel_init() first.");return}console.info("Updating 💨"),b.set_tempo();const t=await b.run_eval(e);if(t.ok){b.set_input(e),b.playing();return}b.do_partial_updates&&await b.apply_partial_update(e)||b.report_eval_failure(t.error)},b.set_input=e=>{const t=b.get_input();t.value=e},b.strudel_stop=()=>{b.stop_status_watch(),b.stop_color_cycle(),ch("hush")},b.fetch_status_code=async()=>{const e=await fetch("/status",{cache:"no-store"});if(!e.ok)throw new Error(`Status endpoint returned ${e.status}`);return e.text()},b.stop_status_watch=()=>{b.clear_status_watch()},b.strudel_watch_status=()=>{if(b.poll_timer)return;if(!b.poll_minutes||b.poll_minutes<=0){console.error("Provide a polling interval in minutes greater than zero");return}const e=b.poll_minutes*60*1e3,t=async()=>{if(!b.poll_in_flight){if(!b.audio_started){console.warn("Audio not started yet.");return}b.poll_in_flight=!0;try{const s=(await b.fetch_status_code()).trim();if(!s)return;await b.play_action(s)}catch(n){console.error("Failed to update Strudel status",n)}finally{b.poll_in_flight=!1}}};b.clear_status_watch(),t(),b.poll_timer=setInterval(()=>{t()},e),console.info("Interval started.")},b.set_status=e=>{let t=document.getElementById("status");t.innerText=e},b.reset_eval_state=()=>{b.has_error=!1},b.report_eval_failure=e=>{const t=e?.message||b.last_eval_error||"Failed to evaluate Strudel code";b.last_eval_error=t,b.set_status(t)},b.run_eval=async e=>{b.reset_eval_state();try{console.log(e),await ch(e)}catch(t){return{ok:!1,error:t}}return b.has_error?{ok:!1,error:new Error(b.last_eval_error||"Evaluation error")}:{ok:!0}},b.normalize_code=(e="")=>e.replace(/\r\n/g,`
`).trim(),b.strip_set_cpm=e=>e.split(`
`).filter(t=>!t.trim().match(/^setCpm\s*\(/)).join(`
`),b.split_by_newlines=e=>{let t="",n=null,s=0,o=0,r=0;const i=[],u=()=>{const a=t.trim();a&&i.push(a),t=""};for(let a=0;a<e.length;a+=1){const l=e[a],p=e[a-1];if(t+=l,n){l===n&&p!=="\\"&&(n=null);continue}if(l==='"'||l==="'"||l==="`"){n=l;continue}if(l==="("?s+=1:l===")"?s=Math.max(0,s-1):l==="["?o+=1:l==="]"?o=Math.max(0,o-1):l==="{"?r+=1:l==="}"&&(r=Math.max(0,r-1)),l!==`
`)continue;const f=e[a+1];s===0&&o===0&&r===0&&!(f===" "||f==="	")&&!(f===`
`)&&u()}return u(),i},b.segment_code=e=>{const t=b.normalize_code(e);if(!t)return[];const n=t.split(/\n{2,}/g).map(o=>o.trim()).filter(Boolean),s=[];for(const o of n){if(!o.includes(`
`)){s.push(o);continue}const r=b.split_by_newlines(o);r.length?s.push(...r):s.push(o)}if(s.length<=1&&t.includes(`
`)){const o=t.split(/\n+/g).map(r=>r.trim()).filter(Boolean);if(o.length>1)return o}return s},b.apply_partial_update=async e=>{const t=b.segment_code(e);if(!t.length)return!1;const n=[];let s=0;for(const r of t){const i=await b.run_eval(r);if(i.ok){n.push(r);continue}s+=1,console.warn("Skipping segment due to error",i.error)}if(!n.length)return!1;const o=n.join(`

`);return b.set_input(o),s>0?b.playing(`Skipped ${s} segment(s)`):b.playing(),!0},b.ensure_strudel_ready=async()=>window.strudel_init?(await window.strudel_init(),!0):(b.set_status("Bundle not loaded. Check console for errors"),console.error("strudel.bundle.js is missing or failed to load"),!1),b.get_input=()=>document.getElementById("code-input"),b.play_action=async(e="")=>{if(await b.ensure_strudel_ready()&&(e||(e=b.get_input().value),!!e&&e!==b.last_code)){b.last_code=e,b.start_color_cycle();try{await b.strudel_update(e)}catch(n){b.set_status(`Error: ${n.message}`)}}},b.stop_action=()=>{if(!window.strudel_stop){b.set_status("Bundle not loaded. Cannot stop audio");return}window.strudel_stopStatusWatch&&window.strudel_stopStatusWatch(),window.strudel_stop(),b.set_status("Stopped")},b.start_status_watch=()=>{if(!window.strudel_watchStatus){console.warn("Polling function missing. Did strudel bundle load?");return}let e=window.App&&window.App.statusPollMinutes||1;window.strudel_watchStatus(e)},b.start_events=()=>{document.getElementById("btn-play").addEventListener("click",async()=>{b.play_action(),b.start_status_watch()}),document.getElementById("btn-stop").addEventListener("click",()=>{b.stop_action()}),b.init_volume_controls(),b.init_tempo_controls()},window.strudel_init=b.strudel_init,window.strudel_update=b.strudel_update,window.strudel_stop=b.strudel_stop,window.strudel_watchStatus=b.strudel_watch_status,window.strudel_stopStatusWatch=b.stop_status_watch,window.App=b,b.start_events()})();
