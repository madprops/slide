<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Slide</title>

    <style>
        body { font-family: monospace; padding: 20px; background: #222; color: #eee; }
        textarea { width: 100%; height: 100px; background: #111; color: #0f0; border: 1px solid #444; padding: 10px; }
        button { padding: 10px 20px; cursor: pointer; font-weight: bold; }
        .controls { margin-top: 10px; display: flex; gap: 10px; }
    </style>
</head>
<body>

    <h2>Strudel Vanilla Controller</h2>

    <textarea id="code-input">s("bd sd").fast(2)</textarea>

    <div class="controls">
        <button id="btn-start">Start Audio</button>
        <button id="btn-update">Update Pattern</button>
        <button id="btn-stop">Stop</button>
    </div>

    <pre id="status" style="margin-top:20px; color: #888;">Waiting for audio...</pre>

    <script src="/dist/slide.bundle.js"></script>
    <script>
        const statusEl = document.getElementById('status');
        const codeInput = document.getElementById('code-input');

        const ensureStrudelReady = async () => {
            if (!window.strudel_init) {
                statusEl.innerText = 'Bundle not loaded. Check console for errors.';
                console.error('slide.bundle.js is missing or failed to load');
                return false;
            }
            await window.strudel_init();
            return true;
        };

        document.getElementById('btn-start').addEventListener('click', async () => {
            const ready = await ensureStrudelReady();
            if (!ready) {
                return;
            }
            statusEl.innerText = 'Audio Ready! Click Update to play.';
        });

        document.getElementById('btn-update').addEventListener('click', async () => {
            const ready = await ensureStrudelReady();
            if (!ready) {
                return;
            }

            const code = codeInput.value;

            try {
                window.strudel_update(code);
                statusEl.innerText = `Playing:\n${code}`;
            } catch (e) {
                statusEl.innerText = `Error: ${e.message}`;
            }
        });

        document.getElementById('btn-stop').addEventListener('click', () => {
            if (!window.strudel_stop) {
                statusEl.innerText = 'Bundle not loaded. Cannot stop audio.';
                return;
            }
            window.strudel_stop();
            statusEl.innerText = 'Stopped.';
        });
    </script>
</body>
</html>